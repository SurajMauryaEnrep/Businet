
/************************************************
Javascript Name:Common
Created By:Suraj
Created Date: 23-10-2021
Description: This Javascript use for the all pages many function

Modified By:
Modified Date:
Description:

*************************************************/

//  #ValDigit=amount
//  #QtyDigit = quantity
//  #RateDigit = rate of item


//-------------------For Avoiding Inspect Element on Pages -----------------------------//

//document.onkeydown = function (e) {
//    if (event.keyCode == 123) {
//        return false;
//    }
//    if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) {
//        return false;
//    }
//    if (e.ctrlKey && e.shiftKey && e.keyCode == 'C'.charCodeAt(0)) {
//        return false;
//    }
//    if (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) {
//        return false;
//    }
//    if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) {
//        return false;
//    }
//}


/*-----------------Modified by Suraj Maurya on 22-10-2024-------------------*/
const cmn_ExchDecDigit = $("#ExchDigit").text();///Exchange Rate
const curr_format = $("#curr_format").text();///add by shubham maurya on 27-11-2024
const cmn_PerDecDigit = 2;///Percentage
const cmn_GrnRateDigit = 5;///GrnRate used in GRN Details & Supplementary Purchase Invoice
let cmn_imp_exp = false;///Amount
let cmn_QtyDecDigit, cmn_RateDecDigit, cmn_ValDecDigit, cmn_QtyDecDigit_id, cmn_RateDecDigit_id, cmn_ValDecDigit_id;
let format = new Intl.NumberFormat(curr_format);
var ValDigit = $("#ValDigit").text();
$(document).ready(function () {
    Cmn_SerialDetailCheckboxSelectAlldeselectAll();
    Cmn_GetParameterValues();// Added by Suraj Maurya on 09-12-2025 To Set Parameter values
    let cmn_DocMenuId = $("#DocumentMenuId").val();
    if (cmn_DocMenuId == "105101140101" || cmn_DocMenuId == "105101140125" || cmn_DocMenuId == "105103145101" || cmn_DocMenuId == "105103145105"
        || cmn_DocMenuId == "105103145110" || cmn_DocMenuId == "105103145115" || cmn_DocMenuId == "105103145120" || cmn_DocMenuId == "105103145125"
        || cmn_DocMenuId == "105103145127" || cmn_DocMenuId == "105103145135") {
        cmn_imp_exp = true;
    }
    else if (cmn_DocMenuId == "105102115101")/*For GRN*/ {
        if ($("#hdnOrderType").val() == "I") {
            cmn_imp_exp = true;
        }
    }
    else if (cmn_DocMenuId == "105102110")/*For Get Entry*/ {

    }
    cmn_QtyDecDigit_id = cmn_imp_exp ? "#ExpImpQtyDigit" : "#QtyDigit";///Quantity
    cmn_RateDecDigit_id = cmn_imp_exp ? "#ExpImpRateDigit" : "#RateDigit";///Rate And Percentage
    cmn_ValDecDigit_id = cmn_imp_exp ? "#ExpImpValDigit" : "#ValDigit";///Amount

    //cmn_QtyDecDigit = cmn_imp_exp ? $("#ExpImpQtyDigit").text() : $("#QtyDigit").text();///Quantity
    //cmn_RateDecDigit = cmn_imp_exp ? $("#ExpImpRateDigit").text() : $("#RateDigit").text();///Rate And Percentage
    //cmn_ValDecDigit = cmn_imp_exp ? $("#ExpImpValDigit").text() : $("#ValDigit").text();///Amount

    cmn_QtyDecDigit = $(cmn_QtyDecDigit_id).text();///Quantity
    cmn_RateDecDigit = $(cmn_RateDecDigit_id).text();///Rate And Percentage
    cmn_ValDecDigit = $(cmn_ValDecDigit_id).text();///Amount


    // Select all tables with the given class
    document.querySelectorAll('.itmfrz').forEach(table => {

        table.addEventListener('click', function (e) {
            const row = e.target.closest('tr');

            // Ignore header rows
            if (!row || row.parentNode.tagName === 'THEAD') return;

            // Remove 'selected' from all rows in this table
            table.querySelectorAll('tr.highlight_tr').forEach(tr => tr.classList.remove('highlight_tr'));

            // Add 'selected' to clicked row
            row.classList.add('highlight_tr');
        });

    });
    Cmn_GLNarrKeepSpanAlive(); // For GL Details Narration; Added by Suraj Maurya on 01-09-2025
});



/*-----------------Modified by Suraj Maurya on 22-10-2024 End-------------------*/

//-------------------For Avoiding Inspect Element on Pages End-----------------------------//
window.addEventListener('keydown', function (event) {

    if (event.ctrlKey && event.shiftKey && event.code === 'KeyL') {
        location.href = "/DashboardHome/Logout";
    }
    if (event.code == "Tab") {
        Cmn_CheckSessionAvailablity();
    }
    //if (event.ctrlKey && event.shiftKey && event.code === 'KeyS') {
    //    location.href = "/ApplicationLayer/LSOList/LSOList";
    //}
});

/*---------------------------------- Added by Suraj Maurya on 26-08-2025 to check session status ------------------------------------*/
window.addEventListener('mousedown', function (event) {
    Cmn_CheckSessionAvailablity();
});

async function Cmn_CheckSessionAvailablity() {
    sessionStorage.setItem("ShowLoader", "N");
    await $.ajax({
        type: "POST",
        url: "/Common/Common/Cmn_CheckSessionAvailablity",
        data: {},
        dataType: "json",
        contentType: 'application/json',
        success: function (data) {

            if (data == "Expired") {
                //swal({
                //    title: "",
                //    text: $("#SessionHasBeenExpiredPleaseReLogin").text(),
                //    type: "warning",
                //    //showCancelButton: true,
                //    confirmButtonClass: "btn-primary",
                //    confirmButtonText: "Ok"
                //    //closeOnConfirm: false
                //}, function (isConfirm) {
                //    if (isConfirm) {
                //        location.href = "/DashboardHome/Logout";
                //    }
                //});
            }
        },
    });
}


/*---------------------------------- Added by Suraj Maurya on 26-08-2025 to check session status End ------------------------------------*/
///*---------------Arrow Key Functionality----------------*/ //Under Development

//var start = document.getElementById('srno');
//start.focus();
//start.style.backgroundColor = 'green';
//start.style.color = 'white';

//function dotheneedful(sibling) {
//    if (sibling != null) {
//        start.focus();
//        start.style.backgroundColor = '';
//        start.style.color = '';
//        sibling.focus();
//        sibling.style.backgroundColor = 'green';
//        sibling.style.color = 'white';
//        start = sibling;
//    }
//}

//$(document).on('keydown',checkKey);

//function checkKey(e) {
//    
//    e = e || window.event;
//    if (e.keyCode == '38') {
//        // up arrow
//        var idx = start.cellIndex;
//        var nextrow = start.parentElement.previousElementSibling;
//        if (nextrow != null) {
//            var sibling = nextrow.cells[idx];
//            dotheneedful(sibling);
//        }
//    } else if (e.keyCode == '40') {
//        // down arrow
//        var idx = start.cellIndex;
//        var nextrow = start.parentElement.nextElementSibling;
//        if (nextrow != null) {
//            var sibling = nextrow.cells[idx];
//            dotheneedful(sibling);
//        }
//    } else if (e.keyCode == '37') {
//        // left arrow
//        var sibling = start.previousElementSibling;
//        dotheneedful(sibling);
//    } else if (e.keyCode == '39') {
//        // right arrow
//        var sibling = start.nextElementSibling;
//        dotheneedful(sibling);
//    }
//}

///*---------------Arrow Key Functionality End----------------*/


//-------------------Avoiding Charector in Fields-------------------------------------//
function AvoidChar(el, Digit) {
    var a = el.value;
    Digit = $("#" + Digit).text().trim();

    if (a.length > 0) {
        for (var i = 0; i < a.length; i++) {
            var charCode = a.charCodeAt(i)
            if (Cmn_Valueonly(charCode, el) == false) {
                el.value = parseFloat(0).toFixed(Digit);
                return false;
            }
            if (AvoidDot(a) == false) {
                el.value = parseFloat(0).toFixed(Digit);
                return false;
            };
            if (parseFloat(a) < 0) {
                el.value = parseFloat(0).toFixed(Digit);
                return false;
            }
        }
    }

    el.value = parseFloat(CheckNullNumber(a.trim()));
}
function CheckNullNumber(data) {

    if (AvoidDot(data) == false) {
        return 0;
    }
    else {
        return data;
    }
}
//function cmn_addCommas(nStr) {
//    nStr += '';
//    var x = nStr.split('.');
//    var x1 = x[0];
//    var x2 = x.length > 1 ? '.' + x[1] : '';
//    var rgx = /(\d+)(\d{3})/;
//    while (rgx.test(x1)) {
//        x1 = x1.replace(rgx, '$1' + ',' + '$2');
//    }
//    return x1 + x2;
//}
function cmn_addCommas(nStr) {
    nStr = cmn_ReplaceCommas(nStr);//Added by Suraj Maurya on 29-11-2024 for Case : cmn_addCommas("1,25,898.098")

    nStr += '';
    var x = nStr.split('.');
    var x1 = x[0];
    var x2 = x.length > 1 ? '.' + x[1] : '';
    return format.format(x1) + x2;
}
function cmn_ReplaceCommas(values) {
    if (values != 0) {
        var amt = String(values).replaceAll(",", "");
        return amt;
    }
    return values;
}
function toDecimal(value, digit) {
    let newNum = CheckNullNumber(value);
    //let DocMenuId = $("#DocumentMenuId").val();
    //if (DocMenuId == "105104115120") {
    return parseFloat(newNum).toFixed(digit);
    //}
    //else {

    //    let numArr = newNum.toString().split('.');
    //    if (numArr.length > 1) {
    //        if (numArr[1].length > digit) {
    //            return numArr[0] + '.' + numArr[1].toString().substring(0, digit);
    //        } else {
    //            return numArr[0] + '.' + numArr[1] + raplicateChar("0", digit - numArr[1].length);
    //        }

    //    } else {
    //        return numArr[0] + '.' + raplicateChar("0", digit);
    //    }
    //}

    //let num = Number(Math.round(CheckNullNumber(value) + 'e' + digit) + 'e-' + digit);
    //return num.toString().split('.').length == 2 ?
    //    (num.toString().split('.')[1].length == digit ? num
    //        : num.toString() + raplicateChar("0", digit - num.toString().split('.')[1].length))
    //    : num.toString()+ '.' + raplicateChar("0", digit);
}
function raplicateChar(char, count) {
    let result = "";
    for (let i = 0; i < count; i++) {
        result += char;
    }
    return result;
}

function formatDateYYYYMMDD(date) {
    var d = new Date(date),
        month = '' + (d.getMonth() + 1),
        day = '' + d.getDate(),
        year = d.getFullYear();

    if (month.length < 2)
        month = '0' + month;
    if (day.length < 2)
        day = '0' + day;

    return [year, month, day].join('-');
}
function CopyPasteData(e) {
    var pasteData = e.clipboardData.getData('text');


    if (pasteData.length > 0) {
        var number = pasteData.split('.');
        if (number.length > 2) {
            return false;
        }
        for (var i = 0; i < pasteData.length; i++) {
            var charCode = pasteData.charCodeAt(i)
            if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            if (charCode == 46) {
                var number = pasteData.split('.');
                if (number.length > 2) {
                    return false;
                }
            }
        }
    }

}

function CopyPasteAvoidFloat(e) {/*To Get Only Int Value*/
    var pasteData = e.clipboardData.getData('text');


    if (pasteData.length > 0) {
        var number = pasteData.split('.');
        if (number.length > 1) {
            return false;
        }
        for (var i = 0; i < pasteData.length; i++) {
            var charCode = pasteData.charCodeAt(i)
            if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            if (charCode == 46) {
                var number = pasteData.split('.');
                if (number.length > 1) {
                    return false;
                }
            }
        }
    }

}

function Cmn_Valueonly(charCode, el) {

    if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {
        return false;
    }
    if (charCode == 46) {
        var number = el.value.split('.');
        if (number.length > 2) {
            return false;
        }
    }
    //var key = evt.key;
    var number = el.value.split('.');

    // if (number.length == 1) {
    var valPer = number[0];// + '' + key;
    if (parseFloat(valPer) >= 1000000000) {
        return false;
    }
    // }
    return true;
}
//-------------------Avoiding Charector in Fields-------------------------------------//
document.onkeydown = function (e) {
    //
    if (event.keyCode == 13 && e.target.className.includes('remarksmessage') == false && e.target.className.includes('dtSearchBox') == false) {
        return false;
    }
}
$(document).ready(function () {


    $("#file-1").click(function () { if ($(".file-error-message").css("display") == "block") { $(".kv-error-close").click() } })
    $(".remarksmessage").attr('onmouseover', 'OnMouseOver(this)');
    WorkflowdetailLoadFX();

    $(".itmfrz >tbody").bind("click", function (e) {
        //
        var clickedrow = $(e.target).closest("tr");
        $(".itmfrz >tbody >tr").css("background-color", "#ffffff");
        $(".itmfrz >tbody >tr > #tditem").css("background-color", "#ffffff");
        $(".itmfrz >tbody >tr > #tditem").css("background-image", "");

        $(".itmfrz >tbody >tr > .tditemfrz").css("background-color", "#ffffff");
        $(".itmfrz >tbody >tr > .tditemfrz").css("background-image", "");

        $(clickedrow).css("background-color", "rgba(38, 185, 154, .16)");
        clickedrow.find("#tditem").css("background-color", "rgba(220, 244, 239)");

        clickedrow.find(".tditemfrz").css("background-color", "rgba(220, 244, 239)");
    });

    $(".rowhighlighttbl >tbody").bind("click", function (e) {
        var clickedrow = $(e.target).closest("tr");
        //
        $(".rowhighlighttbl >tbody >tr").css("background-color", "#ffffff");
        $(clickedrow).css("background-color", "rgba(38, 185, 154, .16)");
        //ListRowHighLight();
        clickdownAndUp();
        try {
            var Doc_Menu_id = $("#DocumentMenuId").val();
            if (Doc_Menu_id == "105102120" || Doc_Menu_id == "105105135") {
                GetDocWiseWorkflowBar(e);// For Quality Inspection 
            }
            else {
                CmnGetWorkFlowDetails(e);
            }

        }
        catch (err) {
            /*console.log("GetMenuData Error : " + err.message);*/
        }
    });
    sessionStorage.removeItem("selecteditemlist");
    $(".rowhighlighttbltopup >tbody").bind("click", function (e) {
        var clickedrow = $(e.target).closest("tr");
        //
        $(".rowhighlighttbltopup >tbody >tr").css("background-color", "#ffffff");
        $(clickedrow).css("background-color", "rgba(38, 185, 154, .16)");
    });

});

function clickdownAndUp() {

    $(document).ready(function () {
        $("td").keydown(function (evt) {
            //
            if (evt.keyCode == 40) {

                var currentRow = $(this).closest('tr');
                currentRow.parent().find("tr").css("background-color", "");
                currentRow.next().css("background-color", "rgba(38, 185, 154, .16)");
                currentRow.next().focus();
            } else if (evt.keyCode == 38) {
                var currentRow = $(this).closest('tr');
                currentRow.parent().find("tr").css("background-color", "");
                currentRow.prev().css("background-color", "rgba(38, 185, 154, .16)");
                currentRow.prev().focus();
            }
        })
    });
}
function HideErrorMsg() {
    $('.error-message').delay(5000).fadeOut(400);
}
function OnMouseOver(el) {
    $(el).prop("title", el.value);
    // $('.remarksmessage').prop('title', remarkstext);
}
function ResetWF_Level() {
    var li_count = $("#wizard ul li").length;
    if (li_count > 0) {
        for (var y = 0; y < li_count; y++) {
            var id = parseInt(y) + 1;
            $("#a_" + id).removeClass("done");
            $("#a_" + id).removeClass("selected");
            $("#a_" + id).addClass("disabled");
        }
    }
}
function AvoidDot(a) {
    if (a != null) {
        if (a.length == 1 && a == ".") {
            return false;
        }
        else if (parseFloat(a) == 0) {
            return false;
        } else if (a.toString().trim() == "") {
            return false;
        }
        else if (a.toString().trim() == "NaN") {
            return false;
        }
        else {
            return true;
        }
    }
    else {
        return false;
    }

}

function Cmn_rowHighLight() {

    $(".rowhighlighttbl >tbody").bind("click", function (e) {
        var clickedrow = $(e.target).closest("tr");
        //
        $(e.target).closest("tr").parent().find("tr").css("background-color", "#ffffff");
        $(clickedrow).css("background-color", "rgba(38, 185, 154, .16)");
        clickdownAndUp();
        try {
            var Doc_Menu_id = $("#DocumentMenuId").val();
            if (Doc_Menu_id == "105102120" || Doc_Menu_id == "105105135") {
                GetDocWiseWorkflowBar(e);// For Quality Inspection 
            }
            else {
                CmnGetWorkFlowDetails(e);
            }
        }
        catch (err) {
            /*console.log("GetMenuData Error : " + err.message);*/
        }
    });
}
function ListRowHighLight() {


    $("#datatable-buttons >tbody").bind("click", function (e) {
        var clickedrow = $(e.target).closest("tr");
        $("#datatable-buttons >tbody >tr").css("background-color", "#ffffff");
        $(clickedrow).css("background-color", "rgba(38, 185, 154, .16)");
        //CmnGetWorkFlowDetails(e);
    });
}
function ListRowHighLight1() {

    $("#datatable-buttons1 >tbody").bind("click", function (e) {
        var clickedrow = $(e.target).closest("tr");
        $("#datatable-buttons1 >tbody >tr").css("background-color", "#ffffff");
        $(clickedrow).css("background-color", "rgba(38, 185, 154, .16)");
    });
}
function ListRowHighLight2() {

    $("#datatable-buttons2 >tbody").bind("click", function (e) {
        var clickedrow = $(e.target).closest("tr");
        $("#datatable-buttons2 >tbody >tr").css("background-color", "#ffffff");
        $(clickedrow).css("background-color", "rgba(38, 185, 154, .16)");
    });
}
function ListRowHighLight9() {

    $("#datatable-buttons9 >tbody").bind("click", function (e) {
        var clickedrow = $(e.target).closest("tr");
        $("#datatable-buttons2 >tbody >tr").css("background-color", "#ffffff");
        $(clickedrow).css("background-color", "rgba(38, 185, 154, .16)");
    });
}
function Cmn_IntValueonly(el, evt) {
    //
    var charCode = (evt.which) ? evt.which : event.keyCode;
    if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {
        return false;
    }
    if (charCode == 46 && el.value.indexOf(".") !== -1) {
        return false;
    }
    var key = evt.key;
    if (key == ".") {
        return false;
    }
    var number = el.value
    if (key == "0" && number == "0") {
        return false;
    }
    //var numval = number + key + "";
    var selectedval = Cmn_SelectedTextInTextField(evt);
    var KeyLocation = evt.currentTarget.selectionStart;
    var valPer = el.value.splice(KeyLocation, 0, key);
    valPer = Cmn_CheckSelectedTextInTextField(evt) == true ? el.value.replace(selectedval, key) : valPer;

    if (parseFloat(valPer) >= 1000000000) {
        return false;
    }
    return true;
}
function Cmn_NumericValueonly(el, evt) {

    var charCode = (evt.which) ? evt.which : event.keyCode;
    if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {
        return false;
    }
    if (charCode == 46 && el.value.indexOf(".") !== -1) {
        return false;
    }
    var key = evt.key;
    if (key == ".") {
        return false;
    }
    var number = el.value
    if (key == "0" && number == "0") {
        return false;
    }
    //var numval = number + key + "";
    var selectedval = Cmn_SelectedTextInTextField(evt);
    var KeyLocation = evt.currentTarget.selectionStart;
    var valPer = el.value.splice(KeyLocation, 0, key);
    valPer = Cmn_CheckSelectedTextInTextField(evt) == true ? el.value.replace(selectedval, key) : valPer;
    return true;
}
function Cmn_FloatValueonly(el, evt, Digit, Negative) {
    //
    var DocumentMenuId = $("#DocumentMenuId").val();
    if (DocumentMenuId == "105103145105" || DocumentMenuId == "105103145110" || DocumentMenuId == "105103145115"
        || DocumentMenuId == "105103145120" || DocumentMenuId == "105103145125" || DocumentMenuId == "105103145127") {
        if (Digit == "#QtyDigit") {
            Digit = "#ExpImpQtyDigit";
        }
        if (Digit == "#RateDigit") {
            Digit = "#ExpImpRateDigit";
        }
        if (Digit == "#ValDigit") {
            Digit = "#ExpImpValDigit";
        }
    }
    var BooleanTF = false;
    var charCode = (evt.which) ? evt.which : event.keyCode;
    if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {
        if (Negative == "Y") {
            if (charCode != 45) {
                return false;
            }
        } else {
            return false;
        }

    }
    if (charCode == 46 && el.value.indexOf(".") !== -1) {
        return false;
    }
    if (Negative == "Y") {
        if (charCode == 45 && el.value.indexOf("-") !== -1) {
            if (Cmn_SelectedTextInTextField(evt).indexOf("-") == -1) {
                return false;
            }

        }
    }

    var ValDecDigit;
    if (Digit == "0") {
        ValDecDigit = "";
    } else {
        ValDecDigit = $(Digit).text();
    }
    if (DocumentMenuId == "105102115101" || DocumentMenuId == "105101145") {
        if (Digit == "#RateDigit") {
            ValDecDigit = $("#PurCostingRateDigit").text();
        }
    }
    if (Digit == "#PerDigit") {
        ValDecDigit = cmn_PerDecDigit;
    }
    /*Added by Surbhi on 17/10/2025 for Supplementary Purchase Invoice(105101147) Rate Digit*/
    if (DocumentMenuId == "105101147") {
        ValDecDigit = Digit
    }
    if (Cmn_CheckSelectedTextInTextField(evt) == true) {
        return true;
    };
    var key = evt.key;
    var number = el.value.split('.');
    if (key == "0" && number[0] == "0" && number.length == 1) {
        return false;
    }
    if (number.length == 1) {
        //var valPer = number[0] + '' + key;
        var selectedval = Cmn_SelectedTextInTextField(evt);
        var KeyLocation = evt.currentTarget.selectionStart;
        var valPer = el.value.splice(KeyLocation, 0, key);
        valPer = Cmn_CheckSelectedTextInTextField(evt) == true ? el.value.replace(selectedval, key) : valPer;
        if (parseFloat(Math.abs(valPer)) >= 1000000000) {
            return false;
        }
    }
    else {
        //var valPer = number[0] + '.' + key;
        var KeyLocation = evt.currentTarget.selectionStart;
        var decDgtLength = number[1].length;
        if (KeyLocation < (el.value.length - (decDgtLength))) {
            if (KeyLocation < (el.value.length - (decDgtLength))) {
                //valPer = number[0].splice(KeyLocation, 0, key);
                BooleanTF = true;
            }
        } else {
            //valPer = el.value.splice(KeyLocation, 0, key);
        }
        var selectedval = Cmn_SelectedTextInTextField(evt);
        var KeyLocation = evt.currentTarget.selectionStart;
        var valPer = el.value.splice(KeyLocation, 0, key);
        valPer = Cmn_CheckSelectedTextInTextField(evt) == true ? el.value.replace(selectedval, key) : valPer;
        if (parseFloat(Math.abs(valPer)) >= 1000000000) {
            return false;
        }
    }

    //var valPer = number[0] + '' + key;
    //if (parseFloat(valPer) >= 1000000000) {
    //    return false;
    //}
    if (ValDecDigit != "") {
        var number = el.value.split('.');
        if (number.length == 2 && number[1].length > (parseInt(ValDecDigit) - 1)) {
            if (BooleanTF) {
                if (Negative == "Y") {
                    if (charCode == 45) {
                        el.value = charCode == 45 ? "-" + parseFloat(CheckNullNumber(el.value)) : el.value;
                        return false;
                    }
                }
                return true;
            }
            return false;
        }

    }
    if (Negative == "Y") {
        if (charCode == 45) {
            el.value = charCode == 45 ? "-" + parseFloat(CheckNullNumber(el.value)) : el.value;
            return false;
        }
    }


    return true;
}
String.prototype.splice = function (idx, rem, str) {
    return this.slice(0, idx) + str + this.slice(idx + Math.abs(rem));
};
function IsNull(data, Output) {
    return data == null ? Output : data;
};

function Cmn_CheckSelectedTextInTextField(evt) {
    var textComponent = evt.currentTarget;//document.getElementById($(evt.currentTarget)[0].id);
    var selectedText;

    if (textComponent.selectionStart !== undefined) { // Standards-compliant version
        var startPos = textComponent.selectionStart;
        var endPos = textComponent.selectionEnd;
        selectedText = textComponent.value.substring(startPos, endPos);
    }
    else if (document.selection !== undefined) { // Internet Explorer version
        textComponent.focus();
        var sel = document.selection.createRange();
        selectedText = sel.text;
    }
    if (selectedText != "" && selectedText != null) {
        //selectedText = selectedText.split('.');
        if (selectedText.length > 0) {
            //if (selectedText[1].length == ValDecDigit) {
            return true;
            //}
        }
    }
}
function Cmn_SelectedTextInTextField(evt) {
    var textComponent = evt.currentTarget;//document.getElementById($(evt.currentTarget)[0].id);
    var selectedText;

    if (textComponent.selectionStart !== undefined) { // Standards-compliant version
        var startPos = textComponent.selectionStart;
        var endPos = textComponent.selectionEnd;
        selectedText = textComponent.value.substring(startPos, endPos);
    }
    else if (document.selection !== undefined) { // Internet Explorer version
        textComponent.focus();
        var sel = document.selection.createRange();
        selectedText = sel.text;
    }
    return selectedText;
}
function Cmn_PercentageValueonly(el, evt, flag = '') {
    if (flag == 'FPayment') {
        // numbers only
        el.value = el.value.replace(/[^0-9]/g, '');

        // max 3 digits
        if (el.value.length > 3) {
            el.value = el.value.substring(0, 3);
        }

        // allow up to 100 only
        let val = parseInt(el.value, 10);
        if (val > 100) {
            el.value = "100";
        }
      
    }
    else {
        var BooleanTF = false;
        var charCode = (evt.which) ? evt.which : event.keyCode;
        if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }
        if (charCode == 46 && el.value.indexOf(".") !== -1) {
            return false;
        }
        if (Cmn_CheckSelectedTextInTextField(evt) == true) {
            return true;
        };
        var key = evt.key;
        var number = el.value.split('.');

        if (number.length == 1) {
            var valPer = number[0] + '' + key;
            if (parseFloat(valPer) >= 100) {
                return false;
            }
        }
        else {
            var valPer = number[0] + '.' + key;
            var KeyLocation = evt.currentTarget.selectionStart;
            //if (KeyLocation < 3) {
            //    if (KeyLocation == 0) {
            //        valPer = key + '' + number[0];
            //    }
            //    if (KeyLocation == 1) {
            //        var txtnum = number[0].split('');
            //        valPer = txtnum[0] + '' + key + txtnum[1];
            //    }
            //    if (KeyLocation == 2) {
            //        valPer = number[0] + '' + key;
            //    }
            //}

            var decDgtLength = number[1].length;
            if (KeyLocation < (el.value.length - (decDgtLength))) {
                if (KeyLocation < (el.value.length - (decDgtLength))) {
                    valPer = number[0].splice(KeyLocation, 0, key);
                    BooleanTF = true;
                }
            }
            var selectedval = Cmn_SelectedTextInTextField(evt);
            //var KeyLocation = evt.currentTarget.selectionStart;
            valPer = el.value.splice(KeyLocation, 0, key);
            valPer = Cmn_CheckSelectedTextInTextField(evt) == true ? el.value.replace(selectedval, key) : valPer;

            if (parseFloat(valPer) >= 100) {
                return false;
            }

        }

        if (number.length == 2 && number[1].length > 1) {
            if (BooleanTF) {
                return true;
            }
            return false;
        }

        return true;
    }
 
}

function upper(ustr) {

    var str = ustr.value;
    ustr.value = str.toUpperCase();
}
function CheckVallidation(main_ID, Message_ID, Alowed_Chars) {
    /*Use this function for validation message in input and simple dropdownfields 
     *  as if(CheckVallidation(main_ID, Message_ID)==(true/false))*/
    var Field_Data = $("#" + main_ID).val();
    var ErrorFlag = "N";
    Field_Data = Field_Data != null ? Field_Data.trim() : Field_Data;
    if (Alowed_Chars != null && Alowed_Chars != "") {
        if (Field_Data == Alowed_Chars) {
            $("#" + main_ID).css("border-color", "#ced4da");
            $('[aria-labelledby="select2-' + main_ID + '-container"]').css("border-color", "#ced4da");
            $("#" + Message_ID).text("");
            $("#" + Message_ID).css("display", "none");
            return true;
        }
    }

    if (Field_Data == null | Field_Data == "" || parseFloat(Field_Data) == 0) {
        $("#" + main_ID).css("border-color", "red");
        $('[aria-labelledby="select2-' + main_ID + '-container"]').css("border-color", "red");
        $("#" + Message_ID).text($("#valueReq").text());
        $("#" + Message_ID).css("display", "block");
        ErrorFlag = "Y";
    }
    else {
        $("#" + main_ID).css("border-color", "#ced4da");
        $('[aria-labelledby="select2-' + main_ID + '-container"]').css("border-color", "#ced4da");
        $("#" + Message_ID).text("");
        $("#" + Message_ID).css("display", "none");
    }
    if (ErrorFlag == "Y") {
        return false;
    }
    else {
        return true;
    }
}

//function ValidateEyeColor(Row, FieldId, ValidateFlag) {
//    if (Row == "") {
//        if (ValidateFlag == "Y") {
//            $("#" + FieldId).children().addClass("required");
//        } else {
//            $("#" + FieldId).children().removeClass("required").addClass("success");;
//        }
//    } else {
//        if (ValidateFlag == "Y") {
//            Row.find("#" + FieldId).children().addClass("required");
//        } else {
//            Row.find("#" + FieldId).children().removeClass("required").addClass("success");;
//        }
//    }
//}
function ValidateEyeColor(Row, FieldId, ValidateFlag) {
    if (Row == "") {
        if (ValidateFlag == "Y") {
            $("#" + FieldId).children().addClass("required").removeClass("green");
        }
        else if (ValidateFlag == "Empty") {/*add by Hina Sharma on 15-10-2025 for all GL Vouchers*/
            $("#" + FieldId).children().removeClass("required").removeClass("green");
        }
        else {
            $("#" + FieldId).children().removeClass("required").addClass("green");
        }
    }
    else {
        if (ValidateFlag == "Y") {
            Row.find("#" + FieldId).children().addClass("required").removeClass("green");
        }
        else if (ValidateFlag == "Empty") {/*add by Hina Sharma on 15-10-2025 for all GL Vouchers*/
            Row.find("#" + FieldId).children().removeClass("required").removeClass("green");
        }
        else {
            Row.find("#" + FieldId).children().removeClass("required").addClass("green");
        }
    }
}

function RemoveCheckVallidation(main_ID, Message_ID) {
    /*Use this function for remove validation message in input and simple dropdownfields */


    $("#" + main_ID).css("border-color", "#ced4da");
    $('[aria-labelledby="select2-' + main_ID + '-container"]').css("border-color", "#ced4da");
    $("#" + Message_ID).text("");
    $("#" + Message_ID).css("display", "none");

}

//---------------------------WorkFlow--------------------------------------------------------//
async function Cmn_InsertDocument_ForwardedDetail(DocNo, DocDate, docid, level, forwardedto, status, Remarks) {
    await $.ajax({
        type: "POST",
        url: "/Common/Common/InsertForwardDetails",
        data: { docno: DocNo, docdate: DocDate, doc_id: docid, level: parseInt(level) - 1, forwardedto: forwardedto, fstatus: status, remarks: Remarks },
        dataType: "json",
        success: function (data) {

            if (data == 'ErrorPage') {
                Comn_ErrorPage();
                return false;
            }
            if (data !== null && data !== "") {
                var FData = data.split(',');
                var StatusC = FData[0].trim();
                var StatusName = FData[1].trim();

                GetWorkFlowDetails(DocNo, DocDate, docid);
                $("#hdDoc_No").val(DocNo);
                try {
                    OtherFunctions(StatusC, StatusName);
                }
                catch (error) {

                }
            }
        },
    });
}
async function Cmn_InsertDocument_ForwardedDetail1(DocNo, DocDate, docid, level, forwardedto, status, Remarks, pdfFilePath) {
    await $.ajax({
        type: "POST",
        url: "/Common/Common/InsertForwardDetails1",
        data: { docno: DocNo, docdate: DocDate, doc_id: docid, level: parseInt(level) - 1, forwardedto: forwardedto, fstatus: status, remarks: Remarks, pdfPathToSendEmailAlert: pdfFilePath },
        dataType: "json",
        success: function (data) {

            if (data == 'ErrorPage') {
                Comn_ErrorPage();
                return false;
            }
            if (data == 'ErrorInMail') {
                $("#MailError").val("ErrorInMail");
                return false;
            }
            else if (data !== null && data !== "") {
                var FData = data.split(',');
                var StatusC = FData[0].trim();
                var StatusName = FData[1].trim();

                GetWorkFlowDetails(DocNo, DocDate, docid);
                $("#hdDoc_No").val(DocNo);
                try {
                    OtherFunctions(StatusC, StatusName);
                }
                catch (error) {
                    ToAddJsErrorLogs(error)
                }
            }
        },
    });
}
function GetWorkFlowDetails(DocNo, DocDate, doc_Id, DocStatus) {
    if (DocNo != null && DocNo != "" && DocDate != null && DocDate != "" && doc_Id != null && doc_Id != "") {
        DocStatus = DocStatus == null ? "" : DocStatus;
        sessionStorage.setItem("ShowLoader", "N");
        $.ajax({
            type: "POST",
            url: "/Common/Common/GetWFLevel_Detail",
            data: { Doc_No: DocNo, Doc_Date: DocDate, DocumentMenuId: doc_Id, DocStatus: DocStatus },
            dataType: "json",
            success: function (data) {

                if (data == 'ErrorPage') {
                    Comn_ErrorPage();
                    return false;
                }
                var WFBarHtml = "";


                //ResetWF_Level();
                if (data !== null && data !== "") /*For Chekin Json Data is return or not */ {
                    var arr = [];

                    arr = JSON.parse(data);
                    if (arr.Table1.length > 0) {
                        var DocStatus = arr.Table.length > 0 ? arr.Table[0].DocStatus : "";
                        if (DocStatus != "D" && DocStatus != "F" && DocStatus != "") {
                            var LastLevel = parseInt(arr.Table[arr.Table.length - 1].level);
                            for (var l = 1; l <= LastLevel; l++) {
                                WFBarHtml += `<li>
                        <a href="#step-${l}" class="disabled" isdone="${l}" onclick="ForwardBarHistoryClick()" data-toggle="modal" data-target="#WorkflowInformation" data-backdrop="static" data-keyboard="false" rel="${l}" id="a_${l}">
                            <span class="step_no">${l}</span>
                        </a>
                    </li>`
                            }
                            $("#wizard ul").html(WFBarHtml);
                        } else {
                            var LastLevel = parseInt(arr.Table1[arr.Table1.length - 1].level);
                            for (var l = 1; l <= LastLevel; l++) {
                                WFBarHtml += `<li>
                        <a href="#step-${l}" class="disabled" isdone="${l}" onclick="ForwardBarHistoryClick()" data-toggle="modal" data-target="#WorkflowInformation" data-backdrop="static" data-keyboard="false" rel="${l}" id="a_${l}">
                            <span class="step_no">${l}</span>
                        </a>
                    </li>`
                            }
                            $("#wizard ul").html(WFBarHtml);
                        }
                    } else {
                        ResetWF_Level();
                    }
                    if (arr.Table.length > 0) {
                        for (var yw = 0; yw < arr.Table.length; yw++) {
                            var Level = parseInt(arr.Table[yw].level);
                            var nextLevel = parseInt(Level) + 1;

                            $("#a_" + Level).removeClass("disabled");
                            $("#a_" + Level).addClass("done");

                            $("#a_" + nextLevel).removeClass("disabled");
                            $("#a_" + nextLevel).addClass("selected");

                        }
                    }
                }
            }
        });
    }
}
function Cmn_GetForwarderList(Doc_id) {
    try {
        $.ajax(
            {
                type: "POST",
                url: "/Common/Common/GetForwarderList",
                data: { Doc_id },
                dataType: "json",
                success: function (data) {

                    if (data == 'ErrorPage') {
                        Comn_ErrorPage();
                        return false;
                    }
                    if (data !== null && data !== "") {
                        var arr = [];
                        arr = JSON.parse(data);
                        if (arr.Table.length > 0) {
                            var level;
                            $('#forwardDetailsTbl >tbody >tr').remove();
                            $("#hd_doc_id").val(arr.Table[0].doc_id);
                            for (i = 0; i < arr.Table.length; i++) {
                                $('#forwardDetailsTbl tbody').append(`<tr>
                                        <td width="15%"><input type="radio" name="radio_user" id="r_${arr.Table[i].user}" checked="checked" /></td>
                                        <td width="85%">${arr.Table[i].user_nm}</td>
                                        <td id="doc_id" style="display: none;">${arr.Table[i].doc_id}</td>
                                        <td id="user" style="display: none;">${arr.Table[i].user}</td>
                                        <td id="level" style="display: none;">${arr.Table[i].level}</td>
                                        </tr>`);
                                level = arr.Table[i].level;
                                $("#r_" + arr.Table[i].user).addClass("flat");
                            }
                            if (level == "1") {
                                $("#radio_reject").attr("disabled", "disabled");
                                $("#radio_revert").attr("disabled", "disabled");
                            }
                            else if (level == "2") {

                                $("#radio_revert").attr("disabled", "disabled");
                            }
                        }
                        else {
                            if (arr.Table1[0].ldata >= 2) {

                                $('#forwardDetailsTbl').css("display", "none");
                            }
                            else {

                                $('#forwardDetailsTbl').css("display", "none");
                            }
                        }
                        var create_Id = $("#Create_ID").val();
                        var UserID = $("#UserID").text();
                        if (UserID === create_Id) {
                            $("#radio_reject").prop("disabled", true);
                            $("#radio_revert").prop("disabled", true);
                        }
                    }
                },
            });
    }
    catch (ex) {
        console.log(ex);
    }
    
}
function Cmn_OnClickWFRadioBtns() {

    var fw_chkedval = $("input[name='forward_action']:checked").val();
    if (fw_chkedval === "Reject" || fw_chkedval === "Revert") {
        $('#forwardDetailsTbl').css("display", "none");
    }

    if (fw_chkedval === "Forward") {
        //$('#forwardDetailsTbl').css("display", "block");
        $('#forwardDetailsTbl').removeAttr("style");
    }
}
//check on POPUP of PartialForward or Approve by this function on discard button
function Cmn_OnClickRemarksClear() {

    $("#fw_remarks").val("");
    /*for set approve radio button by default on discard button*/
    $('#radio_forward').prop('checked', true);
    $('#forwardDetailsTbl').css("display", "");

}

function Cmn_GetForwarderHistoryList(Doc_no, Doc_id) {
    $.ajax(
        {
            type: "POST",
            url: "/Common/Common/GetForwardHistoryList",
            data: { Doc_no: Doc_no, Doc_id: Doc_id },
            dataType: "json",
            success: function (data) {

                if (data == 'ErrorPage') {
                    Comn_ErrorPage();
                    return false;
                }
                if (data !== null && data !== "") {
                    var arr = [];
                    arr = JSON.parse(data);
                    if (arr.Table.length > 0) {

                        $("#DocumentNumber").val(arr.Table[0].doc_no);
                        $("#DocumentDate").val(arr.Table[0].doc_dt);

                        $('#TblWorkflow >tbody >tr').remove();

                        for (i = 0; i < arr.Table.length; i++) {
                            var wf_status = "";
                            var wfInfo = "";
                            if (arr.Table[i].status === "AP") {
                                wf_status = $("#ApprovedBy").text();
                                wfInfo = wf_status + " " + arr.Table[i].sent_by;
                            }
                            if (arr.Table[i].status === "FW") {
                                wf_status = $("#ForwardedTo").text();
                                wfInfo = arr.Table[i].sent_by + " " + wf_status + " " + arr.Table[i].sent_to;
                            }
                            if (arr.Table[i].status === "RJ") {
                                wf_status = $("#RejectedBy").text();
                                wfInfo = wf_status + " " + arr.Table[i].sent_by;
                            }
                            if (arr.Table[i].status === "RV") {
                                wf_status = $("#RevertedTo").text();
                                wfInfo = arr.Table[i].sent_by + " " + wf_status + " " + arr.Table[i].sent_to;
                            }
                            if (arr.Table[i].status === "AM") {
                                wf_status = $("#OrderAmendmentBy").text();
                                wfInfo = wf_status + " " + arr.Table[i].sent_to;
                            }
                            $('#TblWorkflow tbody').append(`<tr>
                            <td>${arr.Table[i].post_date}</td>
                            <td>${wfInfo}</td>
                            <td>${arr.Table[i].remarks}</td>
                            </tr>`);
                        }
                    }
                    else {
                        //$('#forwardDetailsTbl').css("display", "none");
                    }
                }
            },
        });

}
function ForwardBarHistoryClick() {
    var Doc_ID = $("#DocumentMenuId").val();
    var Doc_No = $("#hdDoc_No").val();

    var WF_BarHistory = "N";
    var li_count = $("#wizard ul li").length;
    if (li_count > 0) {
        for (var y = 0; y < li_count; y++) {
            var id = "#a_" + (parseInt(y) + 1);
            var className = $(id).attr("class");
            if (className === "done" || className === "selected" || className === "selected done" || className === "done selected") {
                WF_BarHistory = "Y";
            }
        }
    }
    if (WF_BarHistory == "Y") {
        if (li_count > 0) {
            for (var x = 0; x < li_count; x++) {
                var id = "#a_" + (parseInt(x) + 1);
                $(id).attr("data-target", "#WorkflowInformation");
            }
        }

        if (Doc_No != "" && Doc_No != null && Doc_ID != "" && Doc_ID != null)
            Cmn_GetForwarderHistoryList(Doc_No, Doc_ID);
    }
    else {
        if (li_count > 0) {
            for (var z = 0; z < li_count; z++) {
                var id = "#a_" + (parseInt(z) + 1);
                $(id).attr("data-target", "");
            }
        }
    }
}

function WorkflowdetailLoadFX() {

    if ($("#WFBarStatus").val() != null && $("#WFBarStatus").val() != "") {
        var arr2 = $("#WFBarStatus").val();
        var arr = JSON.parse(arr2);
        $("#WFBarStatus").val();
        if (arr.length > 0) {
            for (var yw = 0; yw < arr.length; yw++) {
                var Level = parseInt(arr[yw].level);
                var nextLevel = parseInt(Level) + 1;
                $("#a_" + Level).removeClass("disabled");
                $("#a_" + Level).addClass("done");

                $("#a_" + nextLevel).removeClass("disabled");
                $("#a_" + nextLevel).addClass("selected");
            }
        }
    }
    if ($("#WFStatus").val() != null && $("#WFStatus").val() != "") {

        var arr2 = $("#WFStatus").val();
        var arr = JSON.parse(arr2);
        $("#WFStatus").val();
        if (arr.length > 0) {

            $("#hd_nextlevel").val(arr[0].nextlevel);
            $("#hd_currlevel").val(arr[0].userlevel);
            $("#hd_createrlevel").val(arr[0].createrlevel);
            var createlvl = arr[0].createrlevel;
            var userlvl = arr[0].userlevel;
            if (AvoidDot(createlvl) == false) {
                createlvl = 0;
            }
            if (AvoidDot(userlvl) == false) {
                userlvl = 0;
            }
            if (parseFloat(createlvl) < (parseFloat(userlvl) - parseFloat(createlvl))) {
                $("#radio_revert").prop("disabled", false);
            }
            else {
                $("#radio_revert").prop("disabled", true);
            }
            if (userlvl == 1) {
                $("#radio_revert").prop("disabled", true);
            }
            if (arr[0].nextlevel === "0") {
                $("#span_forward").css("display", "none");
                $("#span_approve").removeAttr("style");
                $("#radio_forward").val("Approve");
            }
            else {

            }
        }
    }

    var create_Id = $("#Create_ID").val();
    var UserID = $("#UserID").text();
    if (UserID === create_Id) {
        $("#radio_reject").prop("disabled", true);
        $("#radio_revert").prop("disabled", true);
    }

}

//-----------------------Item Information Button Click JS Start ---------------------------------//
function ItemInfoBtnClick(ItmCode) {

    debugger;
    $("#Txt_ItmOEMNo").val("");
    $("#Txt_ItmSampCode").val("");
    $("#Txt_ItmRefNo").val("");
    $("#Txt_ItmHSNCode").val("");
    $("#TechnicalDescription").val("");
    $("#TechnicalSpecification").val("");
    $("#SpanItemDescription").text("");
    $("#WeightInKgItem").text("");
    $("#NetWeightItem").text("");
    $("#GrossWeightItem").text("");
    $("#myCarousel").html("");
    if (ItmCode != "" && ItmCode != null) {
        try {
            $.ajax(
                {
                    type: "POST",
                    url: "/Common/Common/GetItemDetail",
                    data: { ItemID: ItmCode },
                    success: function (data) {

                        if (data == 'ErrorPage') {
                            Comn_ErrorPage();
                            return false;
                        }
                        if (data !== null && data !== "") {
                            var arr = [];
                            arr = JSON.parse(data);
                            if (arr.Table.length > 0) {
                                $("#Txt_ItmOEMNo").val(arr.Table[0].item_oem_no);
                                $("#Txt_ItmSampCode").val(arr.Table[0].item_sam_cd);
                                $("#Txt_ItmRefNo").val(arr.Table[0].RefNo);
                                $("#Txt_ItmHSNCode").val(arr.Table[0].HSN_code);
                                $("#TechnicalDescription").val(arr.Table[0].item_tech_des);
                                $("#TechnicalSpecification").val(arr.Table[0].item_tech_spec);
                                $("#SpanItemDescription").text(arr.Table[0].item_name);
                                $("#WeightInKgItem").val(arr.Table[0].wght_kg);
                                $("#NetWeightItem").val(arr.Table[0].nt_wght);
                                $("#GrossWeightItem").val(arr.Table[0].gr_wght);

                                var ImgFlag = "N";
                                for (var i = 0; i < arr.Table.length; i++) {
                                    var imgName = arr.Table[i].item_img_name;
                                    if (imgName != "" && imgName != null) {
                                        ImgFlag = "Y";
                                    }
                                }
                                if (ImgFlag == "Y") {
                                    var OL = '<ol class="carousel-indicators">';
                                    var Div = '<div class="carousel-inner">';
                                    for (var i = 0; i < arr.Table.length; i++) {
                                        var imgName1 = arr.Table[i].item_img_name, ImgFlag1 = "N";
                                        if (imgName1 != "" && imgName1 != null) {
                                            var type = imgName1.split(".")[imgName1.split(".").length - 1].toLowerCase();
                                            if (type == "jpg" || type == "png" || type == "jpeg" || type == "gif")
                                                ImgFlag1 = "Y";
                                        }
                                        if (ImgFlag1 == "Y") {
                                            var lclSrvrUrl = $('#hdnLocalServer').val();
                                            var ImgName = arr.Table[i].item_img_name;
                                            var origin = lclSrvrUrl + "/ItemSetup/" + ImgName;

                                            if (i === 0) {
                                                OL += '<li data-target="#myCarousel" data-slide-to="' + i + '" class="active"> <img src="' + origin + '" />'
                                                Div += '<div class="carousel-item active"><img src = "' + origin + '" /></div>'
                                                /*alert(origin);*/
                                            }
                                            else {
                                                OL += '<li data-target="#myCarousel" data-slide-to="' + i + '"><img src="' + origin + '" /></li>'
                                                Div += '<div class="carousel-item"><img src = "' + origin + '" /></div>'
                                                /*alert(origin);*/
                                            }
                                        }

                                    }
                                    OL += '</ol>'
                                    Div += '</div>'

                                    var Ach = '<a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="sr-only">Previous</span></a>';
                                    var Ach1 = '<a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="sr-only">Next</span></a>';

                                    $("#myCarousel").html(Div + OL + Ach + Ach1);
                                }
                                else {
                                    $("#myCarousel").html("");
                                }
                            }
                        }
                    },
                });
        } catch (err) {
            console.log("item-Info Error : " + err.message);
        }
    }
}
//-----------------------Sales Order History Button Click JS Start ---------------------------------//
function SalesOrderHistoryBtnClick(ItmCode, CustID, ItmName, UOMName) {

    // var FinStDt=$("#HiddenFinDt").val();
    //$("#HistoryFrom_date").val(FinStDt);
    //var Date12 = moment().format('YYYY-MM-DD');
    //$("#HistoryTo_date").val(Date12);
    //$("#HistoryItemName").val("");
    //$("#HistoryUOM").val(""); 
    var FinStDt;
    var HisStDt = $("#HistoryFrom_date").val();
    if (HisStDt == "") {
        var FinStDt = $("#HiddenFinDt").val();
        $("#HistoryFrom_date").val(FinStDt);
    }
    else {
        FinStDt = $("#HistoryFrom_date").val()
        $("#HistoryFrom_date").val(FinStDt);
    }
    var HisToDt = "";
    HisToDt = $("#HistoryTo_date").val();
    var Date12 = moment().format('YYYY-MM-DD');
    if (HisToDt == Date12) {
        $("#HistoryTo_date").val(Date12);
    }
    else {
        $("#HistoryTo_date").val(HisToDt);
    }

    if (ItmCode != "" && ItmCode != null && CustID != "" && CustID != null) {
        try {
            $.ajax(
                {
                    type: "POST",
                    url: "/Common/Common/GetItemSOHistory",
                    data: { ItemID: ItmCode, CustID: CustID, FinStDt: FinStDt, Date12: HisToDt },
                    success: function (data) {

                        if (data == 'ErrorPage') {
                            Comn_ErrorPage();
                            return false;
                        }

                        $("#tbody_ItemHistory").html(data);
                        $("#HistoryItemName").val(ItmName);
                        $("#HistoryUOM").val(UOMName);
                        $("#HistoryTo_date").val(HisToDt);
                        $("#HistoryFrom_date").val(FinStDt);
                        $("#hfHistoryItemID").val(ItmCode)
                        $("#hfHistoryItemName").val(ItmName)
                        $("#hfHistoryUOM").val(UOMName)
                    },
                });
        } catch (err) {
            console.log("item-Info Error : " + err.message);
        }
    }
}
//-----------------------Sales Order History Button Click JS End ---------------------------------//
//-----------------------Sales Order History Button Click JS Start ---------------------------------//
function CustomerSetupSaleHistory(CustID) {


    var FinStDt;
    var HisStDt = $("#HistoryFrom_date").val();
    if (HisStDt == "") {
        var FinStDt = $("#HiddenFinDt").val();
        $("#HistoryFrom_date").val(FinStDt);
    }
    else {
        FinStDt = $("#HistoryFrom_date").val()
        $("#HistoryFrom_date").val(FinStDt);
    }
    var HisToDt = "";
    HisToDt = $("#HistoryTo_date").val();
    var Date12 = moment().format('YYYY-MM-DD');
    if (HisToDt == Date12) {
        $("#HistoryTo_date").val(Date12);
    }
    else {
        $("#HistoryTo_date").val(HisToDt);
    }

    if (CustID != "" && CustID != null) {
        try {
            $.ajax(
                {
                    type: "POST",
                    url: "/Common/Common/GetCustomerSalesHistory",
                    data: { CustID: CustID, FinStDt: FinStDt, Date12: HisToDt },
                    success: function (data) {

                        if (data == 'ErrorPage') {
                            Comn_ErrorPage();
                            return false;
                        }

                        $("#CustomerSaleHistory").html(data);

                    },
                });
        } catch (err) {
            console.log("item-Info Error : " + err.message);
        }
    }
}
//-----------------------Sales Order History Button Click JS End ---------------------------------//
//-----------------------Purchase Order History Button Click JS Start ---------------------------------//
function PurchaseOrderHistoryBtnClick(ItmCode, SuppID, ItmName, UOMName) {

    var FinStDt;
    var DMenuId = $("#DocumentMenuId").val();
    var HisStDt = $("#HistoryFrom_date").val();
    if (HisStDt == "") {
        var FinStDt = $("#HiddenFinDt").val();
        $("#HistoryFrom_date").val(FinStDt);
    }
    else {
        FinStDt = $("#HistoryFrom_date").val()
        $("#HistoryFrom_date").val(FinStDt);
    }
    var HisToDt = "";
    HisToDt = $("#HistoryTo_date").val();
    var Date12 = moment().format('YYYY-MM-DD');
    if (HisToDt == Date12) {
        $("#HistoryTo_date").val(Date12);
    }
    else {
        $("#HistoryTo_date").val(HisToDt);
    }

    if (ItmCode != "" && ItmCode != null && SuppID != "" && SuppID != null) {
        try {
            $.ajax(
                {
                    type: "POST",
                    url: "/Common/Common/GetItemPOHistory",
                    data: { ItemID: ItmCode, SuppID: SuppID, FinStDt: FinStDt, Date12: HisToDt, DMenuId: DMenuId },
                    success: function (data) {

                        if (data == 'ErrorPage') {
                            Comn_ErrorPage();
                            return false;
                        }
                        $("#tbody_ItemHistory").html(data);
                        $("#HistoryItemName").val(ItmName);
                        $("#HistoryUOM").val(UOMName);
                        $("#HistoryTo_date").val(HisToDt);
                        $("#HistoryFrom_date").val(FinStDt);
                        $("#hfHistoryItemID").val(ItmCode)
                        $("#hfHistoryItemName").val(ItmName)
                        $("#hfHistoryUOM").val(UOMName)
                    },
                });
        } catch (err) {
            console.log("item-Info Error : " + err.message);
        }
    }
}
//----------------------Purchase Order History Button Click JS End------------------------------//
//----------------------Address Information Button Click JS Start------------------------------//

//----------------USE==> sq,po,pq,so-----------------//
function Cmn_AddrInfoBtnClick(Cust_id, CustPros_type, add_id, status, TransType) {

    if (Cust_id != "" && Cust_id != null)
    {
       var Add_type= $('#hd_add_type').val();
        try {
            $.ajax(
                {
                    type: "POST", 
                    url: "/Common/Common/GetAddressdetail",
                    data: {
                        CustID: Cust_id,
                        CustPros_type: CustPros_type,
                        Add_type: Add_type,
                        add_id: add_id,
                    },
                    success: function (data) {
                        // 
                        if (data == 'ErrorPage') {
                            Comn_ErrorPage();
                            return false;
                        }

                        $("#tbodyAddressBodyNew").html(data);
                        SelectAddress();
                        $("#ItemDetailsTbl >tbody >tr").each(function () {

                            var currentRow = $(this);
                            var Address_id = currentRow.find("#addhd").text().trim();
                            if (status == "D" && TransType == "Update") {
                                currentRow.find("#OrderTypeLocal").attr("disabled", false);
                                $("#addrSaveAndExit").css("display", "block");
                            } else if (status == null || status == "") {
                                currentRow.find("#OrderTypeLocal").attr("disabled", false);
                                $("#addrSaveAndExit").css("display", "block");
                            }
                            else {
                                currentRow.find("#OrderTypeLocal").attr("disabled", true);
                                $("#addrSaveAndExit").css("display", "none");
                            }
                            if (Address_id == add_id) {
                                currentRow.find('#OrderTypeLocal').prop("checked", true);
                                $("#ItemDetailsTbl >tbody >tr").css("background-color", "#ffffff");
                                $(currentRow).css("background-color", "rgba(38, 185, 154, .16)");
                            }
                        });
                    },
                });
        } catch (err) {
            console.log("GetMenuData Error : " + err.message);
        }
    }
}
function Cmn_SuppAddrInfoBtnClick(Supp_id, add_id, status, TransType) {

    if (Supp_id != "" && Supp_id != null) {
        try {
            $.ajax(
                {
                    type: "POST",
                    url: "/Common/Common/GetSuppAddressdetail",
                    data: { SuppID: Supp_id },
                    success: function (data) {

                        if (data == 'ErrorPage') {
                            Comn_ErrorPage();
                            return false;
                        }

                        $("#tbodyAddressBodyNew").html(data);
                        SelectAddress();
                        $("#ItemDetailsTbl >tbody >tr").each(function () {

                            var currentRow = $(this);
                            var Address_id = currentRow.find("#addhd").text().trim();
                            if (status == "D" && TransType == "Update") {
                                currentRow.find("#OrderTypeLocal").attr("disabled", false);
                                $("#addrSaveAndExit").css("display", "block");
                            } else if (status == null || status == "") {
                                currentRow.find("#OrderTypeLocal").attr("disabled", false);
                                $("#addrSaveAndExit").css("display", "block");
                            }
                            else {
                                currentRow.find("#OrderTypeLocal").attr("disabled", true);
                                $("#addrSaveAndExit").css("display", "none");
                            }
                            if (Address_id == add_id) {
                                currentRow.find('#OrderTypeLocal').prop("checked", true);
                                $("#ItemDetailsTbl >tbody >tr").css("background-color", "#ffffff");
                                $(currentRow).css("background-color", "rgba(38, 185, 154, .16)");
                            }
                        });
                    },
                });
        } catch (err) {
            console.log("GetMenuData Error : " + err.message);
        }
    }
}
function Cmn_SuppAddrInfoBtnClick1(Supp_id, add_id, status, TransType, SuppPros_type) {

    if (Supp_id != "" && Supp_id != null) {
        try {
            $.ajax(
                {
                    type: "POST",
                    url: "/Common/Common/GetSuppAddressdetail",
                    data: { SuppID: Supp_id, SuppPros_type: SuppPros_type },
                    success: function (data) {

                        if (data == 'ErrorPage') {
                            Comn_ErrorPage();
                            return false;
                        }

                        $("#tbodyAddressBodyNew").html(data);
                        SelectAddress();
                        $("#ItemDetailsTbl >tbody >tr").each(function () {

                            var currentRow = $(this);
                            var Address_id = currentRow.find("#addhd").text().trim();
                            if (status == "D" && TransType == "Update") {
                                currentRow.find("#OrderTypeLocal").attr("disabled", false);
                                $("#addrSaveAndExit").css("display", "block");
                            } else if (status == null || status == "") {
                                currentRow.find("#OrderTypeLocal").attr("disabled", false);
                                $("#addrSaveAndExit").css("display", "block");
                            }
                            else {
                                currentRow.find("#OrderTypeLocal").attr("disabled", true);
                                $("#addrSaveAndExit").css("display", "none");
                            }
                            if (Address_id == add_id) {
                                currentRow.find('#OrderTypeLocal').prop("checked", true);
                                $("#ItemDetailsTbl >tbody >tr").css("background-color", "#ffffff");
                                $(currentRow).css("background-color", "rgba(38, 185, 154, .16)");
                            }
                        });
                    },
                });
        } catch (err) {
            console.log("GetMenuData Error : " + err.message);
        }
    }
}
function SelectAddress() {
    $("#ItemDetailsTbl tbody").bind("click", function (e) {

        var clickedrow = $(e.target).closest("tr");

        if (clickedrow.find('#OrderTypeLocal').prop("disabled") == false) {
            $("#ItemDetailsTbl >tbody >tr").css("background-color", "#ffffff");
            $(clickedrow).css("background-color", "rgba(38, 185, 154, .16)");
            clickedrow.find('#OrderTypeLocal').prop("checked", true);
            var Address_id = clickedrow.find("#addhd").text();
            var Address = clickedrow.find("#cust_add").text();
            var pin = clickedrow.find("#cust_pin").text();
            var city = clickedrow.find("#city_name").text();
            var dist = clickedrow.find("#district_name").text();
            var state = clickedrow.find("#state_name").text();
            var country = clickedrow.find("#country_name").text();

            $('#hd_TxtBillingAddr').val(Address + ',' + ' ' + city + '-' + ' ' + pin + ',' + ' ' + dist + ',' + ' ' + state + ',' + ' ' + country);
            $("#hd_bill_add_id").val(Address_id);
        }
    });
}
//----------------------Address Information Button Click JS End------------------------------//

//----------------------Address Information Close Button Click JS Start------------------------------//
//--------OnClickClosebtn() USED IN -> _AddressInformation.cshtml---------//
function OnClickClosebtn() {
    var DocumentMenuId = $('#DocumentMenuId').val();
    var add_type = $('#hd_add_type').val();
    var gst_number = "";
    var gst_StateCode = "";
    $("#ItemDetailsTbl >tbody >tr").each(function () {
        var clickedrow = $(this);
        if (clickedrow.find('#OrderTypeLocal').prop("checked") == true) {
            var Address_id = clickedrow.find("#addhd").text();
            var Address = clickedrow.find("#cust_add").text();
            var pin = clickedrow.find("#cust_pin").text();
            var city = clickedrow.find("#city_name").text();
            var dist = clickedrow.find("#district_name").text();
            var state = clickedrow.find("#state_name").text();
            var country = clickedrow.find("#country_name").text();
            gst_number = clickedrow.find("#gst_number").text();
            gst_StateCode = clickedrow.find("#state_Code").text();

            $('#hd_TxtBillingAddr').val(Address + ',' + ' ' + city + '-' + ' ' + pin + ',' + ' ' + dist + ',' + ' ' + state + ',' + ' ' + country);
            $("#hd_bill_add_id").val(Address_id);
        }

    });


    if (add_type == "B") {
        var tempadd = $('#hd_TxtBillingAddr').val();
        var tempaddid = $('#hd_bill_add_id').val();
        if (tempadd != "" && tempaddid != "") {
            $('#TxtBillingAddr').val("");
            $('#TxtBillingAddr').val(tempadd);
            $('#Address').val(tempadd);
            $("#bill_add_id").val(tempaddid);

        }

    }
    if (add_type == "S") {
        var tempadd = $('#hd_TxtBillingAddr').val();
        var tempaddid = $('#hd_bill_add_id').val();
        if (tempadd != "" && tempaddid != "") {
            if (DocumentMenuId == "105102101" || DocumentMenuId == "105102105")
            {
                $('#Address').val(tempadd);
                $("#bill_add_id").val(tempaddid);
            }
            else {
                $('#TxtShippingAddr').val("");
                $('#TxtShippingAddr').val(tempadd);
                $("#ship_add_id").val(tempaddid);
            }
          

        }

    }
    try {
        var GstApplicable = $("#Hdn_GstApplicable").text();
        if (GstApplicable == "Y") {
            $("#ship_add_gstNo").val(gst_number);
            if (add_type == "B") {
                $("#Ship_StateCode").val(gst_StateCode);
            }
            
            var DMenuId = $("#DocumentMenuId").val();

            if (DMenuId == "105103120" && add_type == "B") {
                //ApplyGST(gst_number);
                Cmn_OnSaveAddressApplyGST(gst_number, "QTItmDetailsTbl", "hfItemID", "SNohiddenfiled", "item_ass_val", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105103125" && add_type == "B") {
                Cmn_OnSaveAddressApplyGST(gst_number, "SOItmDetailsTbl", "hfItemID", "SNohiddenfiled", "item_ass_val", "", "TaxCalcItemCode", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105103140" && add_type == "B") {
                Cmn_OnSaveAddressApplyGST(gst_number, "SInvItmDetailsTbl", "hfItemID", "SNohiddenfiled", "TxtItemGrossValue", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105101120" && add_type == "B") {
                Cmn_OnSaveAddressApplyGST(gst_number, "PQItmDetailsTbl", "Hdn_Item_ID", "SNohiddenfiled", "item_ass_val", "", "", "", "AddressSave", "AddSave")
            }
            if ((DMenuId == "105101130" || DMenuId == "105101136") && add_type == "B") {
                Cmn_OnSaveAddressApplyGST(gst_number, "PoItmDetailsTbl", "hfItemID", "SNohiddenfiled", "item_ass_val", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105101145" && add_type == "B") {
                Cmn_OnSaveAddressApplyGST(gst_number, "POInvItmDetailsTbl", "hfItemID", "", "TxtItemGrossValue", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105108101" && add_type == "B") {
                Cmn_OnSaveAddressApplyGST(gst_number, "JoItmDetailsTbl", "hfItemID", "SNohiddenfiled", "item_gr_val", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105101152" && add_type == "B") {
                Cmn_OnSaveAddressApplyGST(gst_number, "POInvItmDetailsTbl", "hfItemID", "SNohiddenfiled", "item_gr_val", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105101150" && add_type == "B") {
                Cmn_OnSaveAddressApplyGST(gst_number, "ServicePIItemTbl", "hfItemID", "SNohiddenfiled", "TxtItemGrossValue", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105103147" && add_type == "B") {
                Cmn_OnSaveAddressApplyGST(gst_number, "ServiceSIItemTbl", "hfItemID", "SNohiddenfiled", "TxtItemGrossValue", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105101135" && add_type == "B") {
                Cmn_OnSaveAddressApplyGST(gst_number, "SPOItmDetailsTbl", "hfItemID", "SNohiddenfiled", "item_gr_val", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105108123" && add_type == "B") {
                Cmn_OnSaveAddressApplyGST(gst_number, "JOInvItmDetailsTbl", "hfItemID", "", "TxtItemGrossValue", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105103148" && add_type == "B") {
                Cmn_OnSaveAddressApplyGST(gst_number, "ScrapSIItemTbl", "hfItemID", "SNohiddenfiled", "TxtItemGrossValue", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105103149" && add_type == "B") {//Add BY shubham Maurya on 02-06-2025
                Cmn_OnSaveAddressApplyGST(gst_number, "ScrapSIItemTbl", "hfItemID", "SNohiddenfiled", "TxtItemGrossValue", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105103117" && add_type == "B") {/*Add by Hina sharma on 20-01-2025 for sales enquiry*/
                Cmn_OnSaveAddressApplyGST(gst_number, "SlsEnqryItmDetailsTbl", "hfItemID", "SNohiddenfiled", "item_gr_val", "", "", "", "AddressSave", "AddSave")
            }
            if (DMenuId == "105101154" && add_type == "B") {/*Add by shubham maurya on 31-01-2025 for DPI*/
                Cmn_OnSaveAddressApplyGST(gst_number, "POInvItmDetailsTbl", "hfItemID", "SNohiddenfiled", "item_gr_val", "", "", "", "AddressSave", "AddSave")
            }
        }
    }
    catch (err) {
        console.log("GetMenuData Error : " + err.message);
    }
}
//--------Cmn_getCityList(cust_city) USED IN -> Customer Setup,Supplier Setup, Prospect Setup---------//
function Cmn_getCityList(cust_city) {

    $("#" + cust_city).select2({

        ajax: {
            url: "/Common/Common/GetAutoCompletecity",
            data: function (params) {
                var queryParameters = {
                    ddlCityName: params.term, // search term like "a" then "an"
                    Page: params.page
                };
                return queryParameters;
            },
            dataType: "json",
            cache: true,
            delay: 250,
            //type: 'POST',
            contentType: "application/json; charset=utf-8",
            processResults: function (data, params) {

                var pageSize = 20;
                var page = params.page || 1;
                var Fdata = data.slice((page - 1) * pageSize, page * pageSize);
                return {
                    results: $.map(Fdata, function (val, Item) {
                        return { id: val.ID, text: val.Name };
                    }),
                    pagination: {
                        more: (page * pageSize) < data.length
                    }
                };
            },

        },

    });
}

//----------------------Address Information Close Button Click JS End------------------------------//
//----------------------Buyer And Supplier Information Button Click JS End------------------------------//

function Cmn_BuyerInfoBtnClick(ItmCode, Cust_id) {



    if (ItmCode != "" && ItmCode != null) {
        try {
            $.ajax(
                {
                    type: "POST",
                    url: "/Common/Common/GetItemCustomerInfo",
                    data: { ItemID: ItmCode, CustID: Cust_id },
                    success: function (data) {

                        if (data == 'ErrorPage') {
                            Comn_ErrorPage();
                            return false;
                        }
                        if (data !== null && data !== "") {
                            var arr = [];
                            arr = JSON.parse(data);
                            if (arr.Table.length > 0) {
                                $("#ItemCode").val(arr.Table[0].Item_code);
                                $("#ItemDescription").val(arr.Table[0].item_des);
                                $("#PackingDetail").val(arr.Table[0].pack_dt);
                                $("#detailremarks").val(arr.Table[0].remark);
                                // $("#SpanItemDescription").text(ItmName);

                            } else {
                                $("#ItemCode").val("");
                                $("#ItemDescription").val("");
                                $("#PackingDetail").val("");
                                $("#detailremarks").val("");
                            }
                        }
                    },
                });
        } catch (err) {
            console.log("GetMenuData Error : " + err.message);
        }
    }

}
function Cmn_SupplierInfoIconBtnClick(ItmCode, Supp_id) {

    $("#ItemCode").val("");
    $("#ItemDescription").val("");
    $("#PackingDetail").val("");
    $("#Weight").val("");
    $("#detailremarks").val("");

    if (ItmCode != "" && ItmCode != null) {
        try {
            $.ajax(
                {
                    type: "POST",
                    url: "/Common/Common/GetItemSupplierInfo",
                    data: { ItemID: ItmCode, SuppID: Supp_id },
                    success: function (data) {

                        if (data == 'ErrorPage') {
                            Comn_ErrorPage();
                            return false;
                        }
                        if (data !== null && data !== "") {
                            var arr = [];
                            arr = JSON.parse(data);
                            if (arr.Table.length > 0) {
                                $("#ItemCode").val(arr.Table[0].Item_code);
                                $("#ItemDescription").val(arr.Table[0].item_des);
                                $("#PackingDetail").val(arr.Table[0].pack_dt);
                                $("#Weight").val(arr.Table[0].wt);
                                $("#detailremarks").val(arr.Table[0].remark);

                            }
                        }
                    },
                });
        } catch (err) {
            console.log("GetMenuData Error : " + err.message);
        }
    }
}
//----------------------Buyer Information Button Click JS End------------------------------//

function BindItemList(ItmDDLName, RowID, TableID, SnoHiddenField, OtherFx, PageName) {
    //
    if (PageName == "FGRInput" || PageName == "GatePassInWard" || PageName == "PRDQCDetail") { /*Added By Nitesh 24-06-2024 For Finish Good Reciept Consumption Item DropDown ("FGR")*/
        if ($(ItmDDLName + RowID).val() == "0" || $(ItmDDLName + RowID).val() == "" || $(ItmDDLName + RowID).val() == null) {
            $(ItmDDLName + RowID).append(`<optgroup class='def-cursor' id="Textddl1${RowID}" label='${$("#ItemName").text()}' data-uom='${$("#ItemUOM").text()}'></optgroup>`);
            $('#Textddl1' + RowID).append(`<option data-uom="0" value="0">---Select---</option>`);
        }
    }
    else {
        if ($(ItmDDLName + RowID).val() == "0" || $(ItmDDLName + RowID).val() == "" || $(ItmDDLName + RowID).val() == null) {
            $(ItmDDLName + RowID).append(`<optgroup class='def-cursor' id="Textddl${RowID}" label='${$("#ItemName").text()}' data-uom='${$("#ItemUOM").text()}'></optgroup>`);
            $('#Textddl' + RowID).append(`<option data-uom="0" value="0">---Select---</option>`);
        }
    }
    if ($(TableID + " tbody tr").length > 0 && OtherFx != "ForOneRow") { //Condition : OtherFx!="ForOneRow" Added by Suraj Maurya on 20-01-2025
        $(TableID + " tbody tr").each(function () {
            var currentRow = $(this);
            //
            var rowno = "";
            if (RowID != null && RowID != "") {
                rowno = currentRow.find(SnoHiddenField).val();
            }
            DynamicSerchableItemDDL(TableID, ItmDDLName, rowno, SnoHiddenField, OtherFx, PageName)

        });

    }
    else {
        DynamicSerchableItemDDL(TableID, ItmDDLName, RowID, SnoHiddenField, OtherFx, PageName)
    }
    //    $.ajax({
    //    success: function () {
    if (OtherFx == "BindData") {
        BindData();
    }
    //    }
    //});

}
function DynamicSerchableItemDDL(TableID, ItmDDLName, RowID, SnoHiddenField, OtherFx, PageName, WithoutUom) {
    debugger
    var firstEmptySelect = true;
    let cmn_DocMenuId = $("#DocumentMenuId").val();
    if (PageName == "SPO") {
        $(ItmDDLName + RowID).select2({

            ajax: {
                url: "/Common/Common/GetItemList2",
                data: function (params) {
                    var queryParameters = {
                        SearchName: params.term,
                        PageName: PageName,
                        page: params.page || 1
                    };
                    return queryParameters;
                },
                multiple: true,
                cache: true,
                processResults: function (data, params) {
                    //
                    var pageSize,
                        pageSize = 20;//50000; // or whatever pagesize
                    //results = [];
                    ConvertIntoArreyList(TableID, ItmDDLName, OtherFx, SnoHiddenField);
                    var ItemListArrey = [];
                    if (sessionStorage.getItem("selecteditemlist").length != null) {
                        ItemListArrey = sessionStorage.getItem("selecteditemlist");
                    }

                    let selected = [];
                    selected.push({ id: $(ItmDDLName + RowID).val() });
                    selected = JSON.stringify(selected);

                    var NewArrey = JSON.parse(ItemListArrey).filter(i => !selected.includes(i.id));


                    data = data.filter(j => !JSON.stringify(NewArrey).includes(j.ID.split("_")[0]));

                    if ($(".select2-search__field").parent().find("ul").length == 0) {
                        $(".select2-search__field").parent().append(`<ul class="select2-results__options"><li class="select2-results__option"><strong class="">
<div class="row"><div class="col-md-8 col-xs-6 def-cursor">${$("#ItemName").text()}</div></div>
</strong></li></ul>`)
                    }
                    var page = params.page || 1;
                    // data = data.slice((page - 1) * pageSize, page * pageSize); /*commented by Suraj For creating scroll*/
                    Fdata = data.slice((page - 1) * pageSize, page * pageSize);
                    if (page == 1) {
                        if (Fdata[0] != null) {
                            if (Fdata[0].Name.trim() != "---Select---") {
                                var select = { ID: "0_0", Name: " ---Select---" };
                                Fdata.unshift(select);
                            }
                        }
                    }

                    return {
                        results: $.map(Fdata, function (val, Item) {
                            return { id: val.ID.split("_")[0], text: val.Name };
                        }),
                        //results: data.slice((page - 1) * pageSize, page * pageSize),
                        //more: data.length >= page * pageSize,
                        pagination: {
                            more: (page * pageSize) < data.length
                        }
                    };
                },
                cache: true
            },
            templateResult: function (data) {

                var classAttr = $(data.element).attr('class');
                var hasClass = typeof classAttr != 'undefined';
                classAttr = hasClass ? ' ' + classAttr : '';
                var $result;
                $result = $(

                    '<div ' + classAttr + '">' + data.text + '</div>'
                );
                return $result;
                firstEmptySelect = false;
            },

        });
    }
    else if (PageName == "STKSWP" || PageName == "STKSWPSUBITEM") {
        $(ItmDDLName).select2({

            ajax: {
                url: "/Common/Common/GetItemList2",
                data: function (params) {
                    var queryParameters = {
                        SearchName: params.term,
                        PageName: PageName,
                        page: params.page || 1
                    };
                    return queryParameters;
                },
                multiple: true,
                cache: true,
                processResults: function (data, params) {

                    var pageSize,
                        pageSize = 20;//50000; // or whatever pagesize
                    //results = [];
                    //ConvertIntoArreyList(TableID, ItmDDLName, OtherFx, SnoHiddenField);
                    var ItemListArrey = [];

                    //sessionStorage.removeItem("selecteditemlist");
                    //-------------------
                    if (PageName == "STKSWP") {
                        ItemListArrey.push({ id: $(OtherFx).val() })
                    }
                    //-------------------
                    let selected = [];
                    selected.push({ id: $(ItmDDLName).val() });
                    selected = JSON.stringify(selected);

                    var NewArrey = ItemListArrey.filter(i => !selected.includes(i.id));


                    data = data.filter(j => !JSON.stringify(NewArrey).includes(j.ID.split("_")[0]));

                    if ($(".select2-search__field").parent().find("ul").length == 0) {
                        $(".select2-search__field").parent().append(`<ul class="select2-results__options"><li class="select2-results__option"><strong class="">
<div class="row"><div class="col-md-9 col-xs-6 def-cursor">${$("#ItemName").text()}</div>
<div class="col-md-3 col-xs-6 def-cursor">${$("#ItemUOM").text()}</div></div>
</strong></li></ul>`)
                    }
                    var page = params.page || 1;
                    // data = data.slice((page - 1) * pageSize, page * pageSize); /*commented by Suraj For creating scroll*/
                    Fdata = data.slice((page - 1) * pageSize, page * pageSize);
                    if (page == 1) {
                        if (Fdata[0] != null) {
                            if (Fdata[0].Name.trim() != "---Select---") {
                                var select = { ID: "0_0", Name: " ---Select---" };
                                Fdata.unshift(select);
                            }
                        }
                    }

                    return {
                        results: $.map(Fdata, function (val, Item) {
                            return { id: val.ID.split("_")[0], text: val.Name, UOM: val.ID.split("_")[1] };
                        }),
                        //results: data.slice((page - 1) * pageSize, page * pageSize),
                        //more: data.length >= page * pageSize,
                        pagination: {
                            more: (page * pageSize) < data.length
                        }
                    };
                },
                cache: true
            },
            templateResult: function (data) {

                var classAttr = $(data.element).attr('class');
                var hasClass = typeof classAttr != 'undefined';
                classAttr = hasClass ? ' ' + classAttr : '';
                var $result;
                $result = $(
                    '<div class="row">' +
                    '<div class="col-md-9 col-xs-6' + classAttr + '">' + data.text + '</div>' +
                    '<div class="col-md-3 col-xs-6' + classAttr + '">' + data.UOM + '</div>' +
                    '</div>'
                );
                return $result;
                firstEmptySelect = false;
            },

        });
    }
    else if (PageName == "PR" || PageName == "slsSrt" || PageName == "AdHocPrt" || PageName == "RFQ" /*Added By Nitesh 14072025*/
        || PageName == "PQ" || PageName == "DN" || PageName == "DNCPO" || PageName == "SO" || PageName == "SQ") {//Add By shubham Maurya on 09-06-2025 add 'slsSrt'
        $(ItmDDLName + RowID).select2({

            ajax: {
                url: "/Common/Common/GetItemList2",
                data: function (params) {
                    var queryParameters = {
                        SearchName: params.term,
                        PageName: PageName,
                        page: params.page || 1
                    };
                    return queryParameters;
                },
                multiple: true,
                cache: true,
                processResults: function (data, params) {

                    var pageSize,
                        pageSize = 20;//50000; // or whatever pagesize
                    //results = [];

                    if (PageName == "FGRInput") { /*Added By Nitesh 03-07-2024  For OutSelected Item Is Not Show InPut Item DropDown*/
                        ConvertIntoArreyList(TableID, ItmDDLName, OtherFx, SnoHiddenField);
                        var ItemListArrey = [];
                        if (sessionStorage.getItem("selecteditemlist").length != null) {
                            ItemListArrey = JSON.parse(sessionStorage.getItem("selecteditemlist"));
                        }
                        ConvertIntoArreyList1("#tblIDFinishGoodReceipt", "#ItemName_", OtherFx, "#hfSNo");
                        var ItemListArrey1 = [];
                        if (sessionStorage.getItem("selecteditemlist1").length != null) {
                            ItemListArrey1 = JSON.parse(sessionStorage.getItem("selecteditemlist1"));
                        }

                        let selected = [];
                        selected.push({ id: $(ItmDDLName + RowID).val() });
                        selected = JSON.stringify(selected);
                        var NewArrey = ItemListArrey.filter(i => !selected.includes(i.id));
                        data = data.filter(j => !JSON.stringify(NewArrey).includes(j.ID.split("_")[0]));

                        let selected1 = [];
                        selected1.push({ id: $(ItmDDLName + RowID).val() });
                        selected1 = JSON.stringify(selected1);
                        var NewArrey1 = ItemListArrey1.filter(i => !selected.includes(i.id));
                        data = data.filter(j => !JSON.stringify(NewArrey1).includes(j.ID.split("_")[0]));
                    }
                    else if (PageName == "FGROutput") /*Added By Nitesh 03-07-2024  For Input Item Is Not Show OutPut Item DropDown*/ {

                        ConvertIntoArreyList(TableID, ItmDDLName, OtherFx, SnoHiddenField);
                        var ItemListArrey = [];
                        if (sessionStorage.getItem("selecteditemlist").length != null) {
                            ItemListArrey = JSON.parse(sessionStorage.getItem("selecteditemlist"));
                        }
                        ConvertIntoArreyList1("#ConsumptionItmDetailsTbl", "#Consum_ItemName_", OtherFx, "#hfSNo");
                        var ItemListArrey1 = [];
                        if (sessionStorage.getItem("selecteditemlist1").length != null) {
                            ItemListArrey1 = JSON.parse(sessionStorage.getItem("selecteditemlist1"));
                        }

                        let selected = [];
                        selected.push({ id: $(ItmDDLName + RowID).val() });
                        selected = JSON.stringify(selected);
                        var NewArrey = ItemListArrey.filter(i => !selected.includes(i.id));
                        data = data.filter(j => !JSON.stringify(NewArrey).includes(j.ID.split("_")[0]));

                        let selected1 = [];
                        selected1.push({ id: $(ItmDDLName + RowID).val() });
                        selected1 = JSON.stringify(selected1);
                        var NewArrey1 = ItemListArrey1.filter(i => !selected.includes(i.id));
                        data = data.filter(j => !JSON.stringify(NewArrey1).includes(j.ID.split("_")[0]));

                    }
                    else {
                        ConvertIntoArreyList(TableID, ItmDDLName, OtherFx, SnoHiddenField);
                        var ItemListArrey = [];
                        if (sessionStorage.getItem("selecteditemlist").length != null) {
                            ItemListArrey = JSON.parse(sessionStorage.getItem("selecteditemlist"));
                        }
                        let selected = [];
                        selected.push({ id: $(ItmDDLName + RowID).val() });
                        selected = JSON.stringify(selected);

                        var NewArrey = ItemListArrey.filter(i => !selected.includes(i.id));


                        data = data.filter(j => !JSON.stringify(NewArrey).includes(j.ID.split("_")[0]));
                    }

                    if ($(".select2-search__field").parent().find("ul").length == 0) {
                        $(".select2-search__field").parent().append(`<ul class="select2-results__options"><li class="select2-results__option"><strong class="">
<div class="row"><div class="col-md-6 col-xs-6 def-cursor">${$("#ItemName").text()}</div>
<div class="col-md-3 col-xs-6 def-cursor">${$("#ItemUOM").text()}</div>
<div class="col-md-3 col-xs-6 def-cursor">${$("#ItemType").text()}</div></div>
</strong></li></ul>`)
                    }
                    var page = params.page || 1;
                    // data = data.slice((page - 1) * pageSize, page * pageSize); /*commented by Suraj For creating scroll*/
                    Fdata = data.slice((page - 1) * pageSize, page * pageSize);
                    if (page == 1) {
                        if (Fdata[0] != null) {
                            if (Fdata[0].Name.trim() != "---Select---") {
                                var select = { ID: "0_0", Name: " ---Select---_0" };
                                Fdata.unshift(select);
                            }
                        }
                    }

                    return {
                        results: $.map(Fdata, function (val, Item) {
                            return { id: val.ID.split("_")[0], text: val.Name.split("_")[0], UOM: val.ID.split("_")[1], type: val.Name.split("_")[1] };
                        }),
                        //results: data.slice((page - 1) * pageSize, page * pageSize),
                        //more: data.length >= page * pageSize,
                        pagination: {
                            more: (page * pageSize) < data.length
                        }
                    };
                },
                cache: true
            },
            templateResult: function (data) {

                var classAttr = $(data.element).attr('class');
                var hasClass = typeof classAttr != 'undefined';
                classAttr = hasClass ? ' ' + classAttr : '';
                var $result;
                $result = $(
                    '<div class="row">' +
                    '<div class="col-md-6 col-xs-6' + classAttr + '">' + data.text + '</div>' +
                    '<div class="col-md-3 col-xs-6' + classAttr + '">' + data.UOM + '</div>' +
                    '<div class="col-md-3 col-xs-6' + classAttr + '">' + data.type + '</div>' +
                    '</div>'
                );
                return $result;
                firstEmptySelect = false;
            },

        });
    }
    //else if (PageName == "MISOrderDeatil" || PageName == "AllItems" || PageName == "SlsTracking")//Added By Nidhi  
    //{
    //    $.ajax({
    //        url: "/Common/Common/GetItemList2",
    //        type: "GET",
    //        data: { PageName: PageName },
    //        success: function (data) {
    //            var $ddl = $(ItmDDLName + RowID);
    //            $ddl.empty();
    //            $.each(data, function (i, val) {
    //                var id = val.ID.split("_")[0];
    //                var text = val.Name;
    //                if (id !== "0" && id !== "0_0") {
    //                    $ddl.append(`<option value="${id}">${text}</option>`);
    //                }
    //            });
    //            Cmn_initializeMultiselect([$ddl]);
    //        }
    //    });
    //}
    else {
        $(ItmDDLName + RowID).select2({

            ajax: {
                url: "/Common/Common/GetItemList2",
                data: function (params) {
                    var queryParameters = {
                        SearchName: params.term,
                        PageName: PageName,
                        page: params.page || 1
                    };
                    return queryParameters;
                },
                multiple: true,
                cache: true,
                processResults: function (data, params) {
                    if (PageName == "PPL") {/* Added by Suraj Maurya on 11-11-2025 Under ticket id : 3055 */
                        data = JSON.parse(data).Table;
                    }
                    var pageSize,
                        pageSize = 20;//50000; // or whatever pagesize
                    //results = [];

                    if (PageName == "FGRInput") { /*Added By Nitesh 03-07-2024  For OutSelected Item Is Not Show InPut Item DropDown*/
                        ConvertIntoArreyList(TableID, ItmDDLName, OtherFx, SnoHiddenField);
                        var ItemListArrey = [];
                        if (sessionStorage.getItem("selecteditemlist").length != null) {
                            ItemListArrey = JSON.parse(sessionStorage.getItem("selecteditemlist"));
                        }
                        ConvertIntoArreyList1("#tblIDFinishGoodReceipt", "#ItemName_", OtherFx, "#hfSNo");
                        var ItemListArrey1 = [];
                        if (sessionStorage.getItem("selecteditemlist1").length != null) {
                            ItemListArrey1 = JSON.parse(sessionStorage.getItem("selecteditemlist1"));
                        }

                        let selected = [];
                        selected.push({ id: $(ItmDDLName + RowID).val() });
                        selected = JSON.stringify(selected);
                        var NewArrey = ItemListArrey.filter(i => !selected.includes(i.id));
                        data = data.filter(j => !JSON.stringify(NewArrey).includes(j.ID.split("_")[0]));

                        let selected1 = [];
                        selected1.push({ id: $(ItmDDLName + RowID).val() });
                        selected1 = JSON.stringify(selected1);
                        var NewArrey1 = ItemListArrey1.filter(i => !selected.includes(i.id));
                        data = data.filter(j => !JSON.stringify(NewArrey1).includes(j.ID.split("_")[0]));
                    }
                    else if (PageName == "FGROutput") /*Added By Nitesh 03-07-2024  For Input Item Is Not Show OutPut Item DropDown*/ {

                        ConvertIntoArreyList(TableID, ItmDDLName, OtherFx, SnoHiddenField);
                        var ItemListArrey = [];
                        if (sessionStorage.getItem("selecteditemlist").length != null) {
                            ItemListArrey = JSON.parse(sessionStorage.getItem("selecteditemlist"));
                        }
                        ConvertIntoArreyList1("#ConsumptionItmDetailsTbl", "#Consum_ItemName_", OtherFx, "#hfSNo");
                        var ItemListArrey1 = [];
                        if (sessionStorage.getItem("selecteditemlist1").length != null) {
                            ItemListArrey1 = JSON.parse(sessionStorage.getItem("selecteditemlist1"));
                        }

                        let selected = [];
                        selected.push({ id: $(ItmDDLName + RowID).val() });
                        selected = JSON.stringify(selected);
                        var NewArrey = ItemListArrey.filter(i => !selected.includes(i.id));
                        data = data.filter(j => !JSON.stringify(NewArrey).includes(j.ID.split("_")[0]));

                        let selected1 = [];
                        selected1.push({ id: $(ItmDDLName + RowID).val() });
                        selected1 = JSON.stringify(selected1);
                        var NewArrey1 = ItemListArrey1.filter(i => !selected.includes(i.id));
                        data = data.filter(j => !JSON.stringify(NewArrey1).includes(j.ID.split("_")[0]));

                    }

                    else {
                        debugger;
                        if (cmn_DocMenuId == "105102115120") {/* Added by Suraj Maurya on 21-08-2025 */
                            let array = [];
                            $(TableID).DataTable().rows().data().toArray().map((item) => {
                                return array.push({ id: item[1] });
                            });
                            sessionStorage.removeItem("selecteditemlist");
                            sessionStorage.setItem("selecteditemlist", JSON.stringify(array));
                        }
                        else if (PageName == "ItmAssemblyKitHeader") { /*Added By NItesh 28-01-2025 For Assembly Kit*/
                            ConvertIntoArreyList("#AsembliKit_tbl", "#ComponentName_", "", "#SNohf");
                        }
                        else {
                            ConvertIntoArreyList(TableID, ItmDDLName, OtherFx, SnoHiddenField);
                        }
                        var ItemListArrey = [];
                        if (sessionStorage.getItem("selecteditemlist").length != null) {
                            ItemListArrey = JSON.parse(sessionStorage.getItem("selecteditemlist"));
                        }
                        if (PageName == "MRP") { //added by Suraj Maurya on 15-11-2024

                            $("#SFMaterialDetailsTbl tbody tr").each(function () {
                                var currentRow = $(this);
                                //
                                var rowno = currentRow.find(SnoHiddenField).val();
                                var itemId = "";
                                itemId = currentRow.find("#hf_materialID").val();
                                if (itemId != "0") {
                                    ItemListArrey.push({ id: itemId });
                                }
                            });
                        }
                        else if (PageName == "AssemblyKit") { /*Added By NItesh 28-01-2025 For Assembly Kit*/
                            let selected1 = [];
                            var headerItemID = $("#ddlAssemblyProduct").val();
                            data = data.filter(j => !JSON.stringify(headerItemID).includes(j.ID.split("_")[0]));
                        }
                      
                      
                        let selected = [];
                        selected.push({ id: $(ItmDDLName + RowID).val() });
                        selected = JSON.stringify(selected);

                        var NewArrey = ItemListArrey.filter(i => !selected.includes(i.id));


                        /*data = data.filter(j => !JSON.stringify(NewArrey).includes(j.ID.split("_")[0]));*/
                        if (PageName == "PPL") {
                            data = data.filter(j => !JSON.stringify(NewArrey).includes(j.Item_id));
                        } else {
                            data = data.filter(j => !JSON.stringify(NewArrey).includes(j.ID.split("_")[0]));
                        }
                    }

                    if ($(".select2-search__field").parent().find("ul").length == 0) {
                        if (WithoutUom == "Y") {
                            //                            $(".select2-search__field").parent().append(`<ul class="select2-results__options">
                            //<li class="select2-results__option"><strong class="">
                            //<div class="row"><div class="col-md-12 col-xs-6 def-cursor">${$("#ItemName").text()}</div>
                            //</div>
                            //</strong></li></ul>`)
                        } else {
                            $(".select2-search__field").parent().append(`<ul class="select2-results__options"><li class="select2-results__option"><strong class="">
<div class="row"><div class="col-md-9 col-xs-6 def-cursor">${$("#ItemName").text()}</div>
<div class="col-md-3 col-xs-6 def-cursor">${$("#ItemUOM").text()}</div></div>
</strong></li></ul>`)
                        }

                    }
                    var page = params.page || 1;
                    // data = data.slice((page - 1) * pageSize, page * pageSize); /*commented by Suraj For creating scroll*/
                    Fdata = data.slice((page - 1) * pageSize, page * pageSize);
                    if (page == 1) {
                        if (Fdata[0] != null) {
                            if (PageName == "PPL") {/* Added by Suraj Maurya on 11-11-2025 Under ticket id : 3055 */
                                if (Fdata[0].Item_name.trim() != "---Select---") {
                                    var select = { Item_id: "0", Item_name: " ---Select---", uom_name: "", Bom_Avl: "" };
                                    Fdata.unshift(select);
                                }
                            } else {
                                if (Fdata[0].Name.trim() != "---Select---") {
                                    var select = { ID: "0_0", Name: " ---Select---" };
                                    Fdata.unshift(select);
                                }
                            }
                            //if (Fdata[0].Name.trim() != "---Select---") {
                            //    var select = { ID: "0_0", Name: " ---Select---" };
                            //    Fdata.unshift(select);
                            //}
                        }
                    }

                    return {
                        results: $.map(Fdata, function (val, Item) {
                            if (PageName == "PPL") {/* Added by Suraj Maurya on 11-11-2025 Under ticket id : 3055 */
                                return { id: val.Item_id, text: val.Item_name, UOM: val.uom_name, Bom_Avl: val.Bom_Avl };
                            }
                            else {
                                return { id: val.ID.split("_")[0], text: val.Name, UOM: val.ID.split("_")[1] };
                            }
                        }),
                        //results: data.slice((page - 1) * pageSize, page * pageSize),
                        //more: data.length >= page * pageSize,
                        pagination: {
                            more: (page * pageSize) < data.length
                        }
                    };
                },
                cache: true
            },
            templateResult: WithoutUom == "Y" ? TemplateResult_withoutUOM : TemplateResult_withUOM /*function (data) {

                var classAttr = $(data.element).attr('class');
                var hasClass = typeof classAttr != 'undefined';
                classAttr = hasClass ? ' ' + classAttr : '';
                var $result;
                $result = $(
                    '<div class="row">' +
                    '<div class="col-md-9 col-xs-6' + classAttr + '">' + data.text + '</div>' +
                    '<div class="col-md-3 col-xs-6' + classAttr + '">' + data.UOM + '</div>' +
                    '</div>'
                );
                return $result;
                firstEmptySelect = false;
            }*/,

        });
    }
}
function TemplateResult_withUOM(data) {

    var classAttr = $(data.element).attr('class');
    var hasClass = typeof classAttr != 'undefined';
    classAttr = hasClass ? ' ' + classAttr : '';
    var $result;
    $result = $(
        '<div class="row">' +
        '<div class="col-md-9 col-xs-6' + classAttr + '">' + data.text + '</div>' +
        '<div class="col-md-3 col-xs-6' + classAttr + '">' + data.UOM + '</div>' +
        '</div>'
    );
    return $result;
    firstEmptySelect = false;
}
function TemplateResult_withoutUOM(data) {

    var classAttr = $(data.element).attr('class');
    var hasClass = typeof classAttr != 'undefined';
    classAttr = hasClass ? ' ' + classAttr : '';
    var $result;
    $result = $(
        '<div class="row">' +
        '<div class="col-md-12 col-xs-6' + classAttr + '">' + data.text + '</div>' +
        '</div>'
    );
    return $result;
    firstEmptySelect = false;
}
function ConvertIntoArreyList(TableID, ItmDDLName, OtherFx, SnoHiddenField,) {
    let array = [];
    $(TableID + " tbody tr").each(function () {
        var currentRow = $(this);
        //
        var rowno = currentRow.find(SnoHiddenField).val();
        var itemId = "";
        if (OtherFx == "listToHide") {
            itemId = currentRow.find(SnoHiddenField).val();
        }
        else {
            itemId = currentRow.find(ItmDDLName + rowno).val();
        }
        if (itemId != "0" /*&& itemId != $(ItmDDLName + RowID).val()*/) {
            array.push({ id: itemId });
        }
    });

    sessionStorage.removeItem("selecteditemlist");
    sessionStorage.setItem("selecteditemlist", JSON.stringify(array));
    //return array;
}
function ConvertIntoArreyList1(TableID, ItmDDLName, OtherFx, SnoHiddenField,) { /*Added By Nitesh 03-07-2024 For Finished Goods Recipt*/
    let array = [];
    $(TableID + " tbody tr").each(function () {
        var currentRow = $(this);
        //
        var rowno = currentRow.find(SnoHiddenField).val();
        var itemId = "";
        if (OtherFx == "listToHide") {
            itemId = currentRow.find(SnoHiddenField).val();
        }
        else {
            itemId = currentRow.find(ItmDDLName + rowno).val();
        }
        if (itemId != "0" /*&& itemId != $(ItmDDLName + RowID).val()*/) {
            array.push({ id: itemId });
        }
    });

    sessionStorage.removeItem("selecteditemlist1");
    sessionStorage.setItem("selecteditemlist1", JSON.stringify(array));
    //return array;
}
function BindItemListOld(ItmDDLName, RowID, TableID, SnoHiddenField, OtherFx, PageName) {
    //
    $.ajax(
        {
            type: "POST",
            url: "/Common/Common/GetItemList",

            data: { PageName: PageName },
            dataType: "json",
            success: function (data) {
                //
                if (data == 'ErrorPage') {
                    Comn_ErrorPage();
                    return false;
                }
                if (data !== null && data !== "") {
                    var arr = [];
                    arr = JSON.parse(data);
                    sessionStorage.removeItem("itemList");
                    sessionStorage.setItem("itemList", JSON.stringify(arr.Table));
                    if (arr.Table.length > 0) {
                        $(ItmDDLName + RowID).append(`<optgroup class='def-cursor' id="Textddl${RowID}" label='${$("#ItemName").text()}' data-uom='${$("#ItemUOM").text()}'></optgroup>`);
                        for (var i = 0; i < arr.Table.length; i++) {
                            $('#Textddl' + RowID).append(`<option data-uom="${arr.Table[i].uom_name}" value="${arr.Table[i].Item_id}">${arr.Table[i].Item_name}</option>`);
                        }
                        var firstEmptySelect = true;
                        $(ItmDDLName + RowID).select2({
                            templateResult: function (data) {
                                var selected = $(ItmDDLName + RowID).val();
                                if (check(data, selected, TableID, SnoHiddenField, ItmDDLName) == true) {
                                    var UOM = $(data.element).data('uom');
                                    var classAttr = $(data.element).attr('class');
                                    var hasClass = typeof classAttr != 'undefined';
                                    classAttr = hasClass ? ' ' + classAttr : '';
                                    var $result = $(
                                        '<div class="row">' +
                                        '<div class="col-md-8 col-xs-6' + classAttr + '">' + data.text + '</div>' +
                                        '<div class="col-md-4 col-xs-6' + classAttr + '">' + UOM + '</div>' +
                                        '</div>'
                                    );
                                    return $result;
                                }
                                firstEmptySelect = false;
                            }
                        });
                        //
                        if (TableID != null && TableID != "") {
                            // HideSelectedItem(ItmDDLName, RowID, TableID, SnoHiddenField);
                        }
                        if (OtherFx == "BindData") {
                            BindData();
                        }
                    }
                }
            },
        });
}
function check(data, selected, TableNameID, HiddenSrNoID, ItemDDlNameID, selectedBr) {
    var dMenuId = $("#DocumentMenuId").val();
    var Flag = "N";
    $(TableNameID + " tbody tr").each(function () {
        var currentRow = $(this);
        //
        var rowno = currentRow.find(HiddenSrNoID).val();
        var itemId = currentRow.find(ItemDDlNameID + rowno).val();
        if (["105101154", "105101145"].includes(dMenuId)) {//Added by Suraj Maurya on 21-01-2026
            itemId = currentRow.find("#hfAccID").val();
        }
        if (itemId != null) {
            if (itemId == data.id) {
                if (itemId == "0") {
                }
                else if (selected == itemId) {
                }
                else {
                    if (dMenuId == "105104115120" || dMenuId == "105104115110") {//Added by Suraj on 16-08-2024
                        var GLbranch = $("#GLbranch_" + rowno).val();
                        if (selectedBr == GLbranch) {
                            Flag = "Y";
                        }
                    } else {
                        Flag = "Y";
                    }

                }
                return false;
            }
        }
    });
    //
    if (Flag == "Y") {
        return false;
    }
    else {
        return true;
    }
}
function HideSelectedItem(ItmDDLName, RowID, TableID, SnoHiddenField) {
    //
    //var tableName = $(ItmDDLName).closest("tr").closest("table").id;
    $(TableID + " >tbody >tr").each(function (i, row) {
        //
        var currentRow = $(this);
        var Sno = currentRow.find(SnoHiddenField).val();
        var ItemCode;
        ItemCode = currentRow.find(ItmDDLName + Sno).val();
        if (ItemCode != '0') {
            if (Sno != "0") {
                $(TableID + " >tbody >tr").each(function (i, row) {
                    // //
                    var currentRowD = $(this);
                    var SnoD = currentRowD.find(SnoHiddenField).val();
                    var ItemCodeD;
                    ItemCodeD = currentRowD.find(ItmDDLName + SnoD).val();
                    if (ItemCodeD != '0') {
                        if (currentRow.find(ItmDDLName + Sno).val() !== ItemCodeD) {
                            $(ItmDDLName + Sno + " option[value=" + ItemCodeD + "]").select2().hide();
                        }
                    }
                })
            }
            // $(ItmDDLName + RowID + " option[value=" + ItemCode + "]").select2().hide();
        }
        else {
            $(TableID + " >tbody >tr").each(function (i, row) {
                ////
                var currentRowD = $(this);
                var SnoD = currentRowD.find(SnoHiddenField).val();
                var ItemCodeD;
                ItemCodeD = currentRowD.find(ItmDDLName + SnoD).val();
                if (ItemCodeD != '0') {
                    if (currentRow.find(ItmDDLName + Sno).val() !== ItemCodeD) {
                        $(ItmDDLName + Sno + " option[value=" + ItemCodeD + "]").select2().hide();
                    }
                }
            })
        }
    });
}
/*Added by Surbhi on 18/08/2025 for OC HSN Code Application*/
function Cmn_OCHSNTaxes(ocid, status) {
    debugger;
    //showLoader();
    var docid = $("#DocumentMenuId").val();
    //var suppstate = $("#Ship_StateCode").val();//"0";
    //if ($("#OC_ThirdParty").is(":checked")) {
    if ($("#HdnTaxOn").val() == "OC") {
        if (status === "ADD") {
            if ($("#OC_ThirdParty").is(":checked")) {
                suppstate = $("#hdn_oc_supp_state_id").val();
            }
            else {
                suppstate = $("#Ship_StateCode").val();
            }
        }
        else if (status === "RESET") {
            if ($("#hdn_oc_supp_id_taxcal").val() == "0") { suppstate = $("#Ship_StateCode").val(); } else {
                suppstate = $("#hdn_oc_supp_state_id_taxcal").val() || "0";//$("#OcThirdPartySupp_DDL").val();//$("#Ship_StateCode").val();
            }
        }
    }
    else {
        suppstate = $("#Ship_StateCode").val();
    }

    $.ajax(
        {
            type: "POST",
            url: "/Common/Common/GetOCHSNDetails",
            data: {
                OC_ID: ocid, SuppStateId: suppstate
            },
            success: function (data) {
                debugger;
                if (data == 'ErrorPage') {
                    Comn_ErrorPage();
                    return false;
                }
                if (data !== null && data !== "") {
                    var arr = JSON.parse(data);
                    if (arr && Array.isArray(arr.Table) && arr.Table.length > 0) {
                        debugger;
                        $("#HdnTaxOn").val("OC");
                        if (status === "ADD") {

                            var lastLevel = 0;
                            lastLevel = arr.Table[arr.Table.length - 1].tax_level;
                            AddTaxByHSNCalculation_OC(arr.Table, "");
                            OnClickSaveAndExit();
                            Reset_ReOpen_LevelVal(lastLevel);
                        }
                        else if (status === "RESET") {
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table1, suppstate);
                        }
                    }
                }
            },
        });
}
function Cmn_BindUOM(clickedrow, Itm_ID, SNo, stockable, ItemUomType, ItemOnchange) {

    //var clickedrow = $(e.target).closest("tr");
    var docid = $("#DocumentMenuId").val();
    $.ajax(
        {
            type: "POST",
            url: "/Common/Common/GetItemUOM",
            data: {
                Itm_ID: Itm_ID,
                ItemUomType: ItemUomType
            },
            success: function (data) {
                debugger;
                if (data == 'ErrorPage') {
                    Comn_ErrorPage();
                    return false;
                }
                if (data !== null && data !== "") {
                    var arr = [];
                    arr = JSON.parse(data);
                    if (clickedrow != null && clickedrow != "") {
                        if (arr.Table.length > 0) {
                            //Added by Suraj on 26-02-2024 for add Dropdown list in place of UOM input
                            if (docid == "105101130" || docid == "105101140101" || docid == "105101120" || docid == "105101110" || docid == "105101136" || docid == "105101154" || docid == "105103142" || docid == "105102150") {
                                clickedrow.find("#hdnItemtype").val(arr.Table[0].ItemType);
                                clickedrow.find("#IDItemtype").val(arr.Table[0].ItemType);
                                if (docid == "105101154") {
                                    clickedrow.find("#ItemType").val(arr.Table[0].ItemType);
                                    clickedrow.find("#hfbatchable").val(arr.Table[0].i_batch);
                                    clickedrow.find("#hfserialable").val(arr.Table[0].i_serial);
                                    clickedrow.find("#hfexpiralble").val(arr.Table[0].i_exp);
                                    
                                    if (arr.Table[0].ItemType == "Service") {//UOM
                                        clickedrow.find("#UOM").attr("disabled", true);
                                    }
                                    else {
                                        clickedrow.find("#UOM").attr("disabled", false);
                                    }
                                    var Sno = clickedrow.find("#SNohiddenfiled").val();
                                    if (arr.Table[0].ItemType == "Consumable" || arr.Table[0].ItemType == "Service") {//UOM                                       
                                        clickedrow.find("#wh_id" + Sno).attr("disabled", true);
                                        clickedrow.find("#wh_id" + Sno).val("0");
                                    }
                                    else {
                                        clickedrow.find("#wh_id" + Sno).attr("disabled", false);
                                    }
                                    if (arr.Table[0].i_batch == "Y") {
                                        clickedrow.find("#BtnBatchDetail").attr("disabled", false);
                                        clickedrow.find("#BtnSerialDetail").attr("disabled", true);
                                    }
                                    else if (arr.Table[0].i_serial == "Y") {
                                        clickedrow.find("#BtnBatchDetail").attr("disabled", true);
                                        clickedrow.find("#BtnSerialDetail").attr("disabled", false);
                                    }
                                    else {
                                        clickedrow.find("#BtnBatchDetail").attr("disabled", true);
                                        clickedrow.find("#BtnSerialDetail").attr("disabled", true);
                                    }
                                    var DPISubItem = arr.Table[0].sub_item;
                                    clickedrow.find("#sub_item").val(DPISubItem);
                                    if (DPISubItem == "Y") {
                                        clickedrow.find("#SubItemDPIQty").attr("disabled", false)
                                    }
                                    else {
                                        clickedrow.find("#SubItemDPIQty").attr("disabled", true)
                                    }
                                }
                                if (docid == "105103142") {//add by shubham maurya on 31-03-2025 add "105103142"
                                    clickedrow.find("#hfbatchable").val(arr.Table[0].i_batch);
                                    clickedrow.find("#hfserialable").val(arr.Table[0].i_serial);
                                    clickedrow.find("#hfexpiralble").val(arr.Table[0].i_exp);
                                    clickedrow.find("#hdn_item_gl_acc").val(arr.Table[0].sal_ret_coa);
                                    clickedrow.find("#ItemType").val(arr.Table[0].ItemType);//Add By shubham Maurya on 09-06-2025
                                    clickedrow.find("#HsnNo").val(arr.Table[0].HSN_code);
                                    if (arr.Table[0].i_batch == "Y") {
                                        clickedrow.find("#BtnBatchDetail").attr("disabled", false);
                                        clickedrow.find("#BtnSerialDetail").attr("disabled", true);
                                    }
                                    else if (arr.Table[0].i_serial == "Y") {
                                        clickedrow.find("#BtnBatchDetail").attr("disabled", true);
                                        clickedrow.find("#BtnSerialDetail").attr("disabled", false);
                                    }
                                    else {
                                        clickedrow.find("#BtnBatchDetail").attr("disabled", true);
                                        clickedrow.find("#BtnSerialDetail").attr("disabled", true);
                                    }
                                    var Sno = clickedrow.find("#SNohiddenfiled").val();
                                    if (arr.Table[0].ItemType == "Consumable" || arr.Table[0].ItemType == "Service") {//UOM                                       
                                        clickedrow.find("#wh_id" + Sno).attr("disabled", true);
                                        clickedrow.find("#wh_id" + Sno).val("0");
                                    }
                                    else {
                                        clickedrow.find("#wh_id" + Sno).attr("disabled", false);
                                    }
                                    var DPISubItem = arr.Table[0].sub_item;
                                    clickedrow.find("#sub_item").val(DPISubItem);
                                    if (DPISubItem == "Y") {
                                        clickedrow.find("#SubItemReturnQty").attr("disabled", false)
                                    }
                                    else {
                                        clickedrow.find("#SubItemReturnQty").attr("disabled", true)
                                    }
                                }
                                if (docid == "105102150") {//add by shubham maurya on 31-03-2025 add "105103142"
                                    clickedrow.find("#hfbatchable").val(arr.Table[0].i_batch);
                                    clickedrow.find("#hfserialable").val(arr.Table[0].i_serial);
                                    clickedrow.find("#hdn_item_gl_acc").val(arr.Table[0].pur_ret_coa);
                                    clickedrow.find("#HsnNo").val(arr.Table[0].HSN_code);
                                    clickedrow.find("#hdUOMId").val(arr.Table[0].uom_id);
                                    clickedrow.find("#ItemType").val(arr.Table[0].ItemType);
                                    var DPISubItem = arr.Table[0].sub_item;
                                    clickedrow.find("#sub_item").val(DPISubItem);
                                    if (DPISubItem == "Y") {
                                        clickedrow.find("#SubItemReturnQty").attr("disabled", false)
                                        clickedrow.find("#SubItemAvlStk").attr("disabled", false)
                                    }
                                    else {
                                        clickedrow.find("#SubItemReturnQty").attr("disabled", true)
                                        clickedrow.find("#SubItemAvlStk").attr("disabled", true)
                                    }
                                    var Sno = clickedrow.find("#SNohiddenfiled").val();
                                    if (arr.Table[0].ItemType == "Consumable" || arr.Table[0].ItemType == "Service") {//UOM                                       
                                        clickedrow.find("#wh_id" + Sno).attr("disabled", true);
                                        clickedrow.find("#btnbatchdeatil").attr("disabled", true);
                                        clickedrow.find("#Price").attr("disabled", false);
                                        clickedrow.find("#btnbatchdeatil").attr("style", "filter:grayscale(100%)");
                                        clickedrow.find("#wh_id" + Sno).val("0");
                                    }
                                    else {
                                        clickedrow.find("#Price").attr("disabled", true);
                                        clickedrow.find("#btnbatchdeatil").attr("style", "");
                                        clickedrow.find("#btnbatchdeatil").attr("disabled", false);
                                        clickedrow.find("#wh_id" + Sno).attr("disabled", false);
                                    }
                                }
                                if (docid != "105103142") {
                                    if (arr.Table2.length > 0) {

                                        let s = '';
                                        for (let i = 0; i < arr.Table2.length; i++) {
                                            s += '<option value="' + arr.Table2[i].uom_id + '">' + arr.Table2[i].uom_alias + '</option>';
                                        }
                                        clickedrow.find("#UOM").html(s);
                                        clickedrow.find("#UOM").trigger('change');
                                    } else {
                                        s = '<option value="' + arr.Table[0].uom_id + '">' + arr.Table[0].uom_alias + '</option>';
                                        clickedrow.find("#UOM").html(s);
                                        clickedrow.find("#UOM").val(arr.Table[0].uom_id).trigger('change');
                                    }
                                }

                                if (docid == "105103142" || docid == "105102150") {//add by shubham maurya on 31-03-2025 add "105103142"
                                    clickedrow.find("#UOM").val(arr.Table[0].uom_alias);
                                    clickedrow.find("#UOMID").val(arr.Table[0].uom_id);
                                    clickedrow.find("#hdUOMId").val(arr.Table[0].uom_id);
                                }
                                if (docid == "105101110") {
                                    if (arr.Table[0].ItemType == "Service") {
                                        clickedrow.find("#UOM").attr("disabled", true);
                                    }
                                    else {
                                        clickedrow.find("#UOM").attr("disabled", false);
                                    }
                                }
                                
                            }
                            else if (docid == "105102115105") { /*Added by Nitesh For 24-06-2024 Finish Good Recipt("FGR")*/
                                if (ItemUomType == "Input") {
                                    clickedrow.find("#CUOM").val(arr.Table[0].uom_alias);
                                    clickedrow.find("#hdn_cuom").val(arr.Table[0].uom_id);
                                    var INputSubItem = arr.Table[0].sub_item;
                                    clickedrow.find("#Consumesub_item").val(INputSubItem);
                                    if (INputSubItem == "Y") {
                                        clickedrow.find("#SubItemConsumeQuantity").attr("disabled", false)
                                    }
                                    else {
                                        clickedrow.find("#SubItemConsumeQuantity").attr("disabled", true)
                                    }
                                    clickedrow.find("#hdi_cserial").val(arr.Table[0].i_serial);
                                    clickedrow.find("#hdi_cbatch").val(arr.Table[0].i_batch);
                                    HideAndShow_BatchSerialButton(clickedrow);
                                }
                                if (ItemUomType == "Output") {
                                    clickedrow.find("#UOM").val(arr.Table[0].uom_alias);
                                    clickedrow.find("#UOMID").val(arr.Table[0].uom_id);
                                    clickedrow.find("#UOMName_in_Spec").val(arr.Table[0].UOM_in_Sp);
                                    clickedrow.find("#Conv_rate").val(arr.Table[0].conv_rate);
                                    clickedrow.find("#hdnExperDate").val(arr.Table[0].i_exp);
                                    var OutPutSubItem = arr.Table[0].sub_item;
                                    var Qc_req = arr.Table[0].i_qc;
                                    clickedrow.find("#sub_item").val(OutPutSubItem);
                                    if (OutPutSubItem == "Y") {
                                        clickedrow.find("#SubItemButton").attr("disabled", false)
                                    }
                                    else {
                                        clickedrow.find("#SubItemButton").attr("disabled", true)
                                    }
                                    if (arr.Table[0].i_exp == "Y") {
                                        $("#ExpRequiredStar").css("display", "");
                                    } else {
                                        $("#ExpRequiredStar").css("display", "none");
                                    }
                                    var sno_ouput = clickedrow.find("#hfSNo").val();
                                    if (Qc_req == "Y") {

                                        /*clickedrow.find("#QC_" + sno_ouput).removeAttr("unchecked","");*/
                                        clickedrow.find("#QC_" + sno_ouput).prop("checked", true);
                                        clickedrow.find("#QC_" + sno_ouput).attr("disabled", false);
                                        clickedrow.find("#hdnQC").val(Qc_req);
                                    } else {
                                        clickedrow.find("#QC_" + sno_ouput).attr("disabled", true);
                                        /*clickedrow.find("#QC_" + sno_ouput).removeAttr("checked", "checked");*/
                                        clickedrow.find("#QC_" + sno_ouput).prop("checked", false);
                                        clickedrow.find("#hdnQC").val(Qc_req);
                                    }
                                }
                            }
                            else {
                                //Added By Hina on 21-05-2024 towork on Stock take Add New POPup
                                if (ItemUomType == "stockTake") {
                                    //clickedrow.find("#UOMIDPopup" + SNo).val(arr.Table[0].uom_id);
                                    //clickedrow.find("#UOMPopup" + SNo).val(arr.Table[0].uom_alias);
                                    clickedrow.find("#UOMIDPopup").val(arr.Table[0].uom_id);
                                    clickedrow.find("#UOMPopup").val(arr.Table[0].uom_alias);
                                    clickedrow.find("#PopUp_subitem").val(arr.Table[0].sub_item);
                                    clickedrow.find("#hfserialable").val(arr.Table[0].i_serial);
                                    clickedrow.find("#hfbatchable").val(arr.Table[0].i_batch);
                                    clickedrow.find("#hfexpiralble").val(arr.Table[0].i_exp);
                                    //var Batch = clickedrow.find("#hfbatchable" + SNo).val();
                                    //var Serial = clickedrow.find("#hfserialable" + SNo).val();
                                    var Batch = clickedrow.find("#hfbatchable").val();
                                    var Serial = clickedrow.find("#hfserialable").val();
                                    //currentRow.find("#wh_id" + Sno).attr("disabled", false);
                                    if (Batch == "Y") {
                                        clickedrow.find("#BtnBatchDetail").attr("disabled", false);
                                    }
                                    else {
                                        clickedrow.find("#BtnBatchDetail").attr("disabled", true);
                                    }
                                    if (Serial == "Y") {
                                        clickedrow.find("#BtnSerialDetail").attr("disabled", false);
                                    }
                                    else {
                                        clickedrow.find("#BtnSerialDetail").attr("disabled", true);
                                    }
                                    if (Batch == "N" && Serial == "N") {
                                        clickedrow.find("#BtnBatchDetail").attr("disabled", true);
                                        clickedrow.find("#BtnSerialDetail").attr("disabled", true);
                                    }

                                }
                                else if (ItemUomType == "ExternalReceipt" && docid == "105102115130") /*Added BY NItesh 25-09-2024 For External Receipt*/ {
                                    var Sub_itmFlag = arr.Table[0].sub_item;
                                    clickedrow.find("#sub_item").val(Sub_itmFlag);
                                    if (Sub_itmFlag == "Y") {
                                        clickedrow.find("#SubItemReceivedQty").attr("disabled", false)
                                    }
                                    else {
                                        clickedrow.find("#SubItemReceivedQty").attr("disabled", true)
                                    }
                                    clickedrow.find("#hdi_cserial").val(arr.Table[0].i_serial);
                                    clickedrow.find("#hdi_cbatch").val(arr.Table[0].i_batch);
                                    clickedrow.find("#UOM" + SNo).val(arr.Table[0].uom_alias);
                                    clickedrow.find("#hfexpiralble").val(arr.Table[0].i_exp);
                                    HideAndShow_BatchSerialButton(clickedrow);
                                }
                                else if ((ItemUomType == "AssemblyKit") && docid == "105102160") {

                                    clickedrow.find("#UOM").val(arr.Table[0].uom_alias);
                                    clickedrow.find("#UOMID").val(arr.Table[0].uom_id);
                                    var INputSubItem = arr.Table[0].sub_item;
                                    clickedrow.find("#hdnsub_item").val(INputSubItem);
                                    if (INputSubItem == "Y") {
                                        clickedrow.find("#div_SubItemInputQty").attr("disabled", false)
                                        clickedrow.find("#SubItemInputQty").attr("disabled", false)
                                    }
                                    else {
                                        clickedrow.find("#div_SubItemInputQty").attr("disabled", true)
                                        clickedrow.find("#SubItemInputQty").attr("disabled", true)
                                    }
                                    clickedrow.find("#hdn_batch").val(arr.Table[0].i_batch);
                                    clickedrow.find("#hdn_serial").val(arr.Table[0].i_serial);
                                    HideAndShow_BatchSerialButton(clickedrow);



                                }
                                else if (ItemUomType == "PackingList") { /*Added by NItesh 12082025 for PackingList*/
                                    clickedrow.find("#UOM").val(arr.Table[0].uom_alias);
                                    clickedrow.find("#hdUOMId").val(arr.Table[0].uom_id);
                                    var packingSubItem = arr.Table[0].sub_item;
                                    clickedrow.find("#sub_item").val(packingSubItem);
                                    if (packingSubItem == "Y") {
                                        clickedrow.find("#SubItemOrdQty").attr("disabled", false)
                                        clickedrow.find("#SubItemBalncQty").attr("disabled", false)
                                        clickedrow.find("#SubItemAvlStk").attr("disabled", false)
                                    }
                                    else {
                                        clickedrow.find("#SubItemOrdQty").attr("disabled", true)
                                        clickedrow.find("#SubItemBalncQty").attr("disabled", true)
                                        clickedrow.find("#SubItemAvlStk").attr("disabled", true)
                                    }
                                }
                                else {
                                    if (docid == "105101115") /*Added by NItesh 14072025*/ {
                                        clickedrow.find("#ItemType").val(arr.Table[0].ItemType);
                                    }
                                    else if (ItemUomType == "ProductionPlan" || ItemUomType =="MRPlan") {
                                        clickedrow.find("#ItemtypeFlag").val(arr.Table[0].i_pur);
                                    }
                                    clickedrow.find("#UOM" + SNo).val(arr.Table[0].uom_alias);
                                }
                                
                            }

                            if (ItemUomType == "AssemblyKit_Header" && docid == "105102160") {

                            }
                            else {
                                clickedrow.find("#UOMID" + SNo).val(arr.Table[0].uom_id);
                            }

                            $("#hd_tax_id").val(arr.Table[0].tmplt_id);
                            $("#hdn_i_serial").val(arr.Table[0].i_serial);
                            $("#hdn_i_batch").val(arr.Table[0].i_batch);
                            if (docid == '105101150' || docid == '105101152') {/*Added by Suraj on 07-08-2024 to avoide refresh gl account if user changed the account*/
                                clickedrow.find("#hdn_item_gl_acc").val(arr.Table[0].loc_pur_coa);
                            }
                            else if (docid == '105103147' || docid == '105103148' || docid == '105103149') {/*Add BY shubham Maurya on 02-06-2025*/ //Added by Suraj on 12-08-2024
                                if (docid == "105103148" || docid == "105103149") {/*Add BY shubham Maurya on 02-06-2025*///add by shubham maurya on 24-04-2025 for DPI
                                    clickedrow.find("#ItemType").val(arr.Table[0].ItemType);
                                    if (arr.Table[0].ItemType == "Service") {//UOM       
                                        var SrNo = clickedrow.find("#SNohiddenfiled").val()
                                        clickedrow.find("#wh_id" + SrNo).attr("disabled", true);
                                        clickedrow.find("#wh_id" + SrNo).val("0");
                                    }
                                    else {
                                        clickedrow.find("#wh_id" + Sno).attr("disabled", false);
                                    }
                                }
                                //clickedrow.find("#hdn_item_gl_acc").val(arr.Table[0].loc_sls_coa);
                                if (docid == "105103149") {
                                    if (arr.Table[0].interbr_sls_coa != 0) {
                                        clickedrow.find("#hdn_item_gl_acc").val(arr.Table[0].interbr_sls_coa);
                                    }
                                    else {
                                        clickedrow.find("#hdn_item_gl_acc").val(arr.Table[0].loc_sls_coa);
                                    }
                                }
                                else {
                                    clickedrow.find("#hdn_item_gl_acc").val(arr.Table[0].loc_sls_coa);
                                }

                            }
                            else {
                                if (["105101154", "105101145"].includes(docid)) {//Added by Suraj Maurya on 20-01-2026 to add assets account for cap. goods
                                    if (arr.Table[0].i_capg == "Y") {
                                        clickedrow.find("#hdn_item_gl_acc").val(arr.Table[0].asset_coa);
                                    }
                                    else {
                                        clickedrow.find("#hdn_item_gl_acc").val(arr.Table[0].loc_pur_coa);
                                    }
                                } else {
                                    clickedrow.find("#hdn_item_gl_acc").val(arr.Table[0].loc_pur_coa);
                                }
                            }
                            try {
                                HideShowPageWise(arr.Table[0].sub_item, clickedrow);
                                clickedrow.find("#BYPSsub_item").val(arr.Table[0].sub_item);
                            }
                            catch (ex) {
                                //console.log(ex);
                            }

                            /*SubItemHideShow(arr.Table[0].sub_item, clickedrow, "sub_item", "div_OrderToProduceQuantity","div_SubItemButton");*/
                            if (docid == '105101135') {
                                if (arr.Table[0].HSN_code == 0) {
                                    //clickedrow.find("#Hsn").val("");
                                    clickedrow.find("#ItemHsnCode").val("");//Modifyed By Nitesh 14-06-2024 Change HSN ID
                                    var GstApplicable = $("#Hdn_GstApplicable").text();
                                    if (GstApplicable == "Y") {
                                        swal("", $("#HSNNotDefinedFor").text() + ' ' + arr.Table[0].item_name, "warning");
                                    }
                                }
                                else {
                                    //clickedrow.find("#Hsn" + SNo).val(arr.Table[0].HSN_code);
                                    clickedrow.find("#ItemHsnCode").val(arr.Table[0].HSN_code);
                                }
                                /*clickedrow.find("#ItemtaxTmplt").val(arr.Table[0].tmplt_id);*/
                            }
                            if (docid == '105103120' || docid == '105101120' || docid == '105103145105' || docid == '105101130'
                                || docid == '105108101' || docid == '105101152' || docid == "105101136" || docid == "105101154") {
                                if (arr.Table[0].HSN_code == 0) {
                                    clickedrow.find("#ItemHsnCode").val("");
                                    var GstApplicable = $("#Hdn_GstApplicable").text();
                                    if (GstApplicable == "Y") {
                                        swal("", $("#HSNNotDefinedFor").text() + ' ' + arr.Table[0].item_name, "warning");
                                    }
                                }
                                else {
                                    clickedrow.find("#ItemHsnCode").val(arr.Table[0].HSN_code);
                                }
                                clickedrow.find("#ItemtaxTmplt").val(arr.Table[0].tmplt_id);
                                $("#hd_tax_id").val(arr.Table[0].tmplt_id);/*add by Hina on 22-05-2025 for SQ */
                                /*Start by Hina on 22-05-2025 for after tax add on OC*/
                                debugger;
                                if (docid == "105103120" || docid == "105101130") {/*add 105101130 by Hina on 09-07-2025 for PO */
                                    var GstApplicable = $("#Hdn_GstApplicable").text();
                                    if (GstApplicable != "Y") {


                                        if (arr.Table[0].tmplt_id != 0) {
                                            $("#HdnTaxOn").val("Tax");
                                            $("#Tax_Template").val(0);
                                            OnChangeTaxTmpltDdl(arr.Table[0].tmplt_id);
                                            $("#TaxCalcItemCode").val(Itm_ID);
                                            $("#HiddenRowSNo").val(SNo);
                                            $("#Tax_AssessableValue").val(0);
                                        }

                                    } else {
                                        $("#HdnTaxOn").val("Tax")
                                        Cmn_ApplyGST(arr, Itm_ID, SNo);
                                        OnClickSaveAndExit();
                                    }
                                }
                                /*end by Hina on 22-05-2025 for after tax add on OC*/
                            }
                            if (docid == '105101150') {
                                if (arr.Table[0].HSN_code == 0) {
                                    clickedrow.find("#HsnNo").val("");
                                }
                                else {
                                    clickedrow.find("#HsnNo" + SNo).val(arr.Table[0].HSN_code);
                                }
                                if (arr.Table[0].tmplt_id != 0) {
                                    clickedrow.find("#ItemtaxTmplt").val(arr.Table[0].tmplt_id);
                                }
                            }
                            if (docid == '105103147' || docid == '105103148' || docid == '105103149') {/*Add BY shubham Maurya on 02-06-2025 add 105103149*/

                                if (arr.Table[0].HSN_code == 0) {
                                    clickedrow.find("#HsnNo").val("");
                                }
                                else {
                                    clickedrow.find("#HsnNo" + SNo).val(arr.Table[0].HSN_code);
                                }
                            }
                            if (docid == '105101120') {
                                if (arr.Table[0].tax_exemp == 'Y') {
                                    clickedrow.find('#TaxExempted').prop('checked', true);
                                }
                                else {
                                    clickedrow.find('#TaxExempted').prop('checked', false);
                                }
                            }
                            if (docid == '105101130' || docid == "105101136") {
                                if (arr.Table[0].tax_exemp == 'Y') {
                                    clickedrow.find('#TaxExempted').prop('checked', true);
                                }
                                else {
                                    clickedrow.find('#TaxExempted').prop('checked', false);
                                }
                            }
                        }
                        else {
                            //Added by Suraj on 26-02-2024 for add Dropdown list in place of UOM input
                            if (docid == "105101130" || docid == "105101120" || docid == "105101110" || docid == "105101136" || docid == "105101154") {
                                clickedrow.find("#UOM").html(`<option value="0">---Select---</option>`);
                            } else {
                                clickedrow.find("#UOM").val("");

                            }

                            clickedrow.find("#Hsn").val("");
                        }
                    }
                    else {
                        if (arr.Table.length > 0) {
                            //Added by Suraj on 26-02-2024 for add Dropdown list in place of UOM input
                            if (docid == "105101130" || docid == "105101140101" || docid == "105101120" || docid == "105101110" || docid == "105101136" || docid == "105101154") {
                                if (arr.Table2.length > 0) {

                                    let s = '';
                                    for (let i = 0; i < arr.Table2.length; i++) {
                                        s += '<option value="' + arr.Table2[i].uom_id + '">' + arr.Table2[i].uom_alias + '</option>';
                                    }

                                    //let defUomId = $("#UOMID").val();
                                    //defUomId = (defUomId == "" || defUomId == null) ? arr.Table[0].uom_id : defUomId;

                                    $("#UOM").html(s);
                                    $("#UOM").trigger('change');
                                } else {
                                    s = '<option value="' + arr.Table[0].uom_id + '">' + arr.Table[0].uom_alias + '</option>';
                                    $("#UOM").html(s);
                                    $("#UOM").val(arr.Table[0].uom_id).trigger('change');
                                }
                            } else {
                                $("#UOM" + SNo).val(arr.Table[0].uom_alias);
                            }
                            if (ItemUomType == "AssemblyKit_Header") {
                                $("#AssemblyUOM").val(arr.Table[0].uom_alias);
                                $("#HdnAssemblyUOMID").val(arr.Table[0].uom_id);
                            }
                            $("#UOMID" + SNo).val(arr.Table[0].uom_id);
                            $("#hd_tax_id").val(arr.Table[0].tmplt_id);
                            $("#hdn_i_serial").val(arr.Table[0].i_serial);
                            $("#hdn_i_batch").val(arr.Table[0].i_batch);
                            $("#hdn_i_exp").val(arr.Table[0].i_exp);
                            try {
                                HideShowPageWise(arr.Table[0].sub_item, clickedrow);
                            }
                            catch (ex) {
                                //console.log(ex);
                            }
                            if (docid == '105102165') {
                                if (SNo == "Dest") {
                                    $("#UOMDest").val(arr.Table[0].uom_alias);
                                    $("#UOMIDDest").val(arr.Table[0].uom_id);
                                    if (arr.Table[0].sub_item == "N") {
                                        $("#SubItemAvlStkDest").attr("disabled", true)
                                        $("#DestSubItemReqQty").attr("disabled", true)
                                        $("#DestSubItem").val("N");
                                    }
                                    if (arr.Table[0].sub_item == "Y") {
                                        $("#SubItemAvlStkDest").attr("disabled", false)
                                        $("#DestSubItemReqQty").attr("disabled", false)
                                        $("#DestSubItem").val("Y");
                                    }
                                }
                                else {
                                    $("#UOMSourc").val(arr.Table[0].uom_alias);
                                    $("#UOMIDSourc").val(arr.Table[0].uom_id);
                                    if (arr.Table[0].sub_item == "N") {
                                        $("#SubItemAvlStk").attr("disabled", true)
                                        $("#SubItemReqQty").attr("disabled", true)
                                        $("#SrcSubItem").val("N");
                                    }
                                    if (arr.Table[0].sub_item == "Y") {
                                        $("#SubItemAvlStk").attr("disabled", false)
                                        $("#SubItemReqQty").attr("disabled", false)
                                        $("#SrcSubItem").val("Y");
                                    }
                                    if ($("#ItemOrderType").is(":checked") || $("#UOMItemOrderType").is(":checked")) {
                                        if (arr.Table[0].i_batch == "N") {
                                            $("#btnbatchdeatil").attr("disabled", true)
                                            $("#hdi_batch").val("N")
                                            $("#btach").removeClass("StockSwap"); /*Added By Nitesh For Stock Swap*/
                                        }
                                        if (arr.Table[0].i_batch == "Y") {
                                            $("#btnbatchdeatil").attr("disabled", false)
                                            $("#hdi_batch").val("Y")
                                            $("#btach").addClass("StockSwap"); /*Added By Nitesh For Stock Swap*/
                                        }
                                        if (arr.Table[0].i_serial == "N") {
                                            $("#btnserialdeatil").attr("disabled", true)
                                            $("#hdi_serial").val("N")
                                            $("#serial").removeClass("StockSwap");/*Added By Nitesh For Stock Swap*/
                                        }
                                        if (arr.Table[0].i_serial == "Y") {
                                            $("#btnserialdeatil").attr("disabled", false)
                                            $("#hdi_serial").val("Y")
                                            $("#serial").addClass("StockSwap");/*Added By Nitesh For Stock Swap*/
                                        }
                                    }
                                    else {
                                        if (arr.Table[0].i_batch == "N") {
                                            $("#btnbatchdeatil").attr("disabled", true)
                                            $("#hdi_batch").val("N")
                                            $("#btach").removeClass("StockSwap");/*Added By Nitesh For Stock Swap*/
                                        }
                                        if (arr.Table[0].i_serial == "N") {
                                            $("#btnserialdeatil").attr("disabled", true)
                                            $("#hdi_serial").val("N")
                                            $("#serial").removeClass("StockSwap");/*Added By Nitesh For Stock Swap*/
                                        }
                                    }
                                }
                            }
                            if (SNo == "UOM") {
                                $("#UOM").val(arr.Table[0].uom_name);
                                $("#UOMID").val(arr.Table[0].uom_id);
                            }

                            if (docid == '105105127' || docid == '105105128') { /*Added docid By Nitesh 25042024 (105105128)*/
                                var H_SubItem = arr.Table[0].sub_item;
                                $("#sub_itemHeadr").val(H_SubItem);
                                $("#sub_item").val(H_SubItem);
                                HideShowPageWise(arr.Table[0].sub_item, "NoRow");
                                var I_Exp = $("#hdn_i_exp").val();
                                $("#NewExpiry_Date").val("");
                                if (I_Exp == "Y") {
                                    //$("#NewExpiry_Date").prop("disabled", false);
                                    $("#Span_ManExpDt").css("display", "");
                                }
                                else {
                                    //$("#NewExpiry_Date").prop("disabled", true);
                                    $("#Span_ManExpDt").css("display", "none");
                                }
                            }
                            //if (docid == '105101135') {
                            //    if (arr.Table[0].HSN_code == 0) {
                            //        clickedrow.find("#Hsn").val("");
                            //        var GstApplicable = $("#Hdn_GstApplicable").text();
                            //        if (GstApplicable == "Y") {
                            //            swal("", $("#HSNNotDefinedFor").text() + ' ' + arr.Table[0].item_name, "warning");
                            //        }
                            //    }
                            //    else {
                            //        clickedrow.find("#Hsn" + SNo).val(arr.Table[0].HSN_code);
                            //    }
                            //}
                        }
                        else {
                            //Added by Suraj on 26-02-2024 for add Dropdown list in place of UOM input
                            if (docid == "105101130" || docid == "105101120" || docid == "105101110" || docid == "105101136" || docid == "105101154") {
                                $("#UOM").html(`<option value="0">---Select---</option>`);
                            } else {
                                $("#UOM").val("");
                            }

                            $("#Hsn").val("");
                        }
                    }
                    if (arr.Table.length > 0) {
                        var GstApplicable = $("#Hdn_GstApplicable").text();
                        var DMenuId = $("#DocumentMenuId").val();

                        if (GstApplicable != "Y") {
                            var matchDoc = ("105101120,105101130,105101135,105101145,105103120,105103125,105103140,105103145125,105108101,105101150,105103147,105103148,105101152,105101136,105101154,105103149").match(DMenuId);/*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                            if (matchDoc != null) {
                                if (matchDoc == DMenuId) {
                                    var br_state_code = arr.Table[0].br_state_code;
                                    var state_code = $("#Ship_StateCode").val();
                                    if (br_state_code == state_code) {
                                        $("#Hd_GstType").val("Both");
                                    }
                                    else {
                                        $("#Hd_GstType").val("IGST");
                                    }
                                    if (arr.Table[0].tmplt_id != 0) {
                                        $("#Tax_Template").val(0);
                                        OnChangeTaxTmpltDdl("", ItemOnchange);
                                        $("#TaxCalcItemCode").val(Itm_ID);
                                        if (SNo == "" || SNo == null) {
                                            if (clickedrow != null) {
                                                SNo = clickedrow.find("#SNohiddenfiled").val();
                                            }

                                        }
                                        $("#HiddenRowSNo").val(SNo);
                                        $("#Tax_AssessableValue").val(0);

                                    }
                                }
                            }

                        }
                        else {
                            var matchDoc = ("105101120,105101130,105101135,105101145,105103120,105103125,105103140,105103145125,105108101,105101152,105101150,105103147,105103148,105101136,105101154,105103142,105102150,105103149").match(DMenuId);/*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                            if (matchDoc != null) {
                                if (matchDoc == DMenuId) {
                                    if (SNo == "" || SNo == null) {
                                        if (clickedrow != null) {
                                            SNo = clickedrow.find("#SNohiddenfiled").val();
                                        }
                                    }
                                    Cmn_ApplyGST(arr, Itm_ID, SNo, "AddToHidden");

                                    if (!("105103148,105101150,105103149").split(',').includes(DMenuId)) {/*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                                        OnClickSaveAndExit();
                                    }
                                }

                            }


                        }

                    }

                }

                if (stockable == "Y") {
                    //Cmn_AvailableStk(clickedrow, Itm_ID, SNo)
                    ////var QtyDecDigit = $("#QtyDigit").text();

                    /*---Comented by Suraj on 23-10-2024*/
                    ////var QtyDecDigit = "";
                    //if (docid == "105103145110") {
                    //    QtyDecDigit = $("#ExpImpQtyDigit").text();
                    //}
                    //else {
                    //    QtyDecDigit = $("#QtyDigit").text();
                    //}
                    /*---Comented by Suraj on 23-10-2024 End*/
                    if (SNo == null || SNo == undefined || SNo == "undefined") {
                        SNo = "";
                    }
                    if (SNo == null || SNo == undefined || SNo == "undefined") {
                        SNo = "";
                    }
                    if (clickedrow != null) {
                        if (arr.Table1.length > 0) {
                            clickedrow.find("#AvailableStockInBase").val(parseFloat(arr.Table1[0].br_avl_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#AvailableStockInBase" + SNo).val(parseFloat(arr.Table1[0].br_avl_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#WIPstock" + SNo).val(parseFloat(arr.Table1[0].wip_stock).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ShopFloorstock" + SNo).val(parseFloat(arr.Table1[0].shfl_avl_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#INtransit" + SNo).val(parseFloat(arr.Table1[0].intransit_stock).toFixed(cmn_QtyDecDigit));
                        }
                        else {
                            clickedrow.find("#AvailableStockInBase").val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#AvailableStockInBase" + SNo).val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                        }
                    }
                    else {
                        if (arr.Table1.length > 0) {
                            $("#AvailableStockInBase").val(parseFloat(arr.Table1[0].br_avl_stk_bs).toFixed(cmn_QtyDecDigit));
                            $("#AvailableStockInBase" + SNo).val(parseFloat(arr.Table1[0].br_avl_stk_bs).toFixed(cmn_QtyDecDigit));
                        }
                        else {
                            $("#AvailableStockInBase").val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            $("#AvailableStockInBase" + SNo).val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                        }
                    }
                }
            },
        });
}
/*Used In Production Plan,Production Order*/
//function Cmn_SubItemHideShow(subitem, clickedrow,SubItm_YN_field_Id,Quantity_div_id,Button_div_id,col_Y,col_N) {
function Cmn_SubItemHideShow(subitem, clickedrow, SubItm_YN_field_Id, Button_div_id) {
    if (clickedrow == "NoRow") {
        if (subitem == "Y") {
            if (SubItm_YN_field_Id != "") {
                $("#" + SubItm_YN_field_Id).val("Y");
            }
            $("#" + Button_div_id).attr("disabled", false);
        } else {
            if (SubItm_YN_field_Id != "") {
                $("#" + SubItm_YN_field_Id).val("N");
            }
            $("#" + Button_div_id).attr("disabled", true);
        }
    } else {
        if (subitem == "Y") {
            if (SubItm_YN_field_Id != "") {
                clickedrow.find("#" + SubItm_YN_field_Id).val("Y");
            }
            clickedrow.find("#" + Button_div_id).attr("disabled", false);
        } else {
            if (SubItm_YN_field_Id != "") {
                clickedrow.find("#" + SubItm_YN_field_Id).val("N");
            }
            clickedrow.find("#" + Button_div_id).attr("disabled", true);
        }
    }


}
/*  Used in SO details JS,CommonJS            */
function Cmn_ApplyGST(arr, Itm_ID, SNo, flagAction) {
    console.log("Cmn_ApplyGST");
    $('#TaxCalculatorTbl tbody tr').remove();
    $("#TaxCalcItemCode").val(Itm_ID);
    $("#HiddenRowSNo").val(SNo);
    $("#Tax_AssessableValue").val(0);
    var Dmenu = $("#DocumentMenuId").val();
    var ship_StateCode = $("#Ship_StateCode").val();

    if (arr.Table.length > 0) {
        var tax_doc_no = $("#TaxCalcGRNNo").val();
        var tax_doc_date = $("#TaxCalcGRNDate").val();
        var NewArray = [];
        if (flagAction == "AddToHidden" && ("105103148,105101150,105103149").split(',').includes(Dmenu)) {/*Add BY shubham Maurya on 02-06-2025 add 105103149*/
            //Removing Already existed tax data for matching Items 
            $("#Hdn_TaxCalculatorTbl > tbody > tr #TaxItmCode:contains(" + Itm_ID + ")").closest('tr').each(function () {
                let row = $(this);
                let doc_no = row.find("#DocNo").text();
                let doc_date = row.find("#DocDate").text();
                let item_id = row.find("#TaxItmCode").text();
                if (item_id == Itm_ID && doc_no == tax_doc_no && doc_date == tax_doc_date) {
                    row.remove();
                }
            });
        }
        var Br_StateCode = arr.Table[0].br_state_code;
        if (parseInt(ship_StateCode) == parseInt(Br_StateCode) /*Br_Gst_number.substring(0, 2)*/) {
            if (flagAction == "AddToHidden" && ("105103148,105101150,105103149").split(',').includes(Dmenu)) {/*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                //Adding Data to Hidden Tax Table
                TaxTableDataBind_Hdn(1,
                    arr.Table[0].cgst_tax_name, arr.Table[0].cgst_tax_id, String(arr.Table[0].cgst_tax_per), 1,
                    "Immediate Level", 0, "I", 0, Itm_ID, tax_doc_no, tax_doc_date, arr.Table[0].cgst_tax_acc_id, "", arr.Table[0].cgst_tax_recov
                )
                //Adding Data to Hidden Tax Table
                TaxTableDataBind_Hdn(2,
                    arr.Table[0].sgst_tax_name, arr.Table[0].sgst_tax_id, String(arr.Table[0].sgst_tax_per), 1,
                    "Immediate Level", 0, "I", 0, Itm_ID, tax_doc_no, tax_doc_date, arr.Table[0].sgst_tax_acc_id, "", arr.Table[0].sgst_tax_recov
                )
                //Adding Tax data in Array
                NewArray.push({
                    TaxItmCode: Itm_ID, TaxName: arr.Table[0].cgst_tax_name
                    , TaxNameID: arr.Table[0].cgst_tax_id, TaxPercentage: String(arr.Table[0].cgst_tax_per), TaxLevel: 1
                    , TaxApplyOn: "Immediate Level"
                    , TaxAmount: parseFloat(0).toFixed(cmn_ValDecDigit)
                    , TotalTaxAmount: (0).toFixed(cmn_ValDecDigit), TaxApplyOnID: "I"
                });

                NewArray.push({
                    TaxItmCode: Itm_ID, TaxName: arr.Table[0].sgst_tax_name
                    , TaxNameID: arr.Table[0].sgst_tax_id, TaxPercentage: String(arr.Table[0].sgst_tax_per)
                    , TaxLevel: 1, TaxApplyOn: "Immediate Level"
                    , TaxAmount: parseFloat(0).toFixed(cmn_ValDecDigit)
                    , TotalTaxAmount: parseFloat(0).toFixed(cmn_ValDecDigit), TaxApplyOnID: "I"
                });

            } else {
                TaxTableDataBind(1,
                    arr.Table[0].cgst_tax_name, arr.Table[0].cgst_tax_id, String(arr.Table[0].cgst_tax_per), 1,
                    "Immediate Level", 0, "I", 0, arr.Table[0].cgst_tax_acc_id, "", arr.Table[0].cgst_tax_recov
                )
                TaxTableDataBind(2,
                    arr.Table[0].sgst_tax_name, arr.Table[0].sgst_tax_id, String(arr.Table[0].sgst_tax_per), 1,
                    "Immediate Level", 0, "I", 0, arr.Table[0].sgst_tax_acc_id, "", arr.Table[0].sgst_tax_recov
                )

            }
            $("#Hd_GstType").val("Both")/*Only for Domestic Purchase Invoice RCM Functionality*/
        }
        else {
            if (flagAction == "AddToHidden" && ("105103148,105101150,105103149").split(',').includes(Dmenu)) {/*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                TaxTableDataBind_Hdn(1,
                    arr.Table[0].igst_tax_name, arr.Table[0].igst_tax_id, String(arr.Table[0].igst_tax_per), 1,
                    "Immediate Level", 0, "I", 0, Itm_ID, tax_doc_no, tax_doc_date, arr.Table[0].igst_tax_acc_id, "", arr.Table[0].igst_tax_recov
                )
                //Adding Tax data in Array
                NewArray.push({
                    TaxItmCode: Itm_ID, TaxName: arr.Table[0].igst_tax_name
                    , TaxNameID: arr.Table[0].igst_tax_id, TaxPercentage: String(arr.Table[0].igst_tax_per), TaxLevel: 1
                    , TaxApplyOn: "Immediate Level"
                    , TaxAmount: parseFloat(0).toFixed(cmn_ValDecDigit), TotalTaxAmount: parseFloat(0).toFixed(cmn_ValDecDigit)
                    , TaxApplyOnID: "I"
                });
            } else {
                TaxTableDataBind(1,
                    arr.Table[0].igst_tax_name, arr.Table[0].igst_tax_id, String(arr.Table[0].igst_tax_per), 1,
                    "Immediate Level", 0, "I", 0, arr.Table[0].igst_tax_acc_id, "", arr.Table[0].igst_tax_recov
                )

            }
            $("#Hd_GstType").val("IGST")/*Only for Domestic Purchase Invoice RCM Functionality*/
        }
        if (flagAction == "AddToHidden" && ("105103148,105101150,105103149").split(',').includes(Dmenu)) {/*Add BY shubham Maurya on 02-06-2025 add 105103149*/
            BindTaxAmountDeatils(NewArray);
        }
    }


}
// Cmn_OnSaveAddressApplyGST_Async : this function is used in Custom Invoice. It is a copy of Cmn_OnSaveAddressApplyGST function.
async function Cmn_OnSaveAddressApplyGST_Async(gst_number, TableID, ItemID, SNohiddenfiled, item_ass_val, TaxGrnNo, TaxCalcItemCode, e, AddressSave, add) {
    debugger;
    var ItmCodes = "";
    var docid = $("#DocumentMenuId").val();
    $("#" + TableID + " >tbody >tr").each(function () {
        var clickedrow = $(this);
        var Itm_ID = clickedrow.find("#" + ItemID).val();
        var GstApplicable = $("#Hdn_GstApplicable").text();
        //clickedrow.find('#ManualGST').prop("checked", false);
        if (GstApplicable == "Y") {
            if (AddressSave != "AddressSave") {
                if (docid == "105101145") {
                    var GrnNo = clickedrow.find("#" + SNohiddenfiled).val();
                    var TaxGrn = $("#" + TaxGrnNo).val();
                    var TaxCalcItemCd = $("#" + TaxCalcItemCode).val();
                    if (Itm_ID == TaxCalcItemCd && GrnNo == TaxGrn) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {

                        }
                        else {
                            ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
                        }
                    }
                }
                else if (docid == "105103125") {
                    var GrnNo = clickedrow.find("#" + SNohiddenfiled).val();
                    var TaxGrn = $("#" + TaxGrnNo).val();
                    var TaxCalcItemCd = $("#" + TaxCalcItemCode).val();
                    if (Itm_ID == TaxCalcItemCd && GrnNo == TaxGrn) {
                        //if (Itm_ID == TaxCalcItemCd) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {

                        }
                        else {
                            ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
                        }
                    }
                }
                else {
                    if (clickedrow.find("#ManualGST").is(":checked")) {

                    }
                    else {
                        ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
                    }
                }
            }
            else {
                if (add == "AddSave") {
                    clickedrow.find('#ManualGST').prop("checked", false);
                    ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
                }
                else {
                    if (clickedrow.find("#ManualGST").is(":checked")) {

                    }
                    else {
                        clickedrow.find('#ManualGST').prop("checked", false);
                        ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
                    }
                }
            }
        }
        else {
            ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
        }
    });
    if (docid == "105103145127" && e != null) {
        var row = e;
        ItmCodes = row.find("#" + ItemID).val();
    }
    if (ItmCodes != "") {
        try {
            await $.ajax(
                {
                    type: "POST",
                    url: "/Common/Common/GetItemGstDetails",
                    data: { ItemIDs: ItmCodes, gst_number: gst_number },
                    success: function (data) {

                        if (data == 'ErrorPage') {
                            Comn_ErrorPage();
                            return false;
                        }
                        var arr = [];
                        arr = JSON.parse(data);
                        if (AddressSave != "AddressSave") {
                            if (docid == "105101145") {
                                if (arr.Table.length > 0) {
                                    ApplyGSTToAtable(ItemID, TableID, SNohiddenfiled, item_ass_val, arr.Table, "ItemTax")
                                    //GetAllGLID();
                                }
                            }
                            else if (docid == "105103140") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    GetAllGLID();
                                }
                            }
                            else if (docid == "105103125") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    var clickedrow = $(e.target).closest("tr");
                                    CalculationBaseQty(clickedrow);
                                }
                            }
                            else if (docid == "105108101") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    CalculationBaseRate(e);
                                }
                            }
                            else if (docid == "105108123") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    GetAllGLID();
                                }
                            }
                            /***Modifyed By Shubham Maurya on 26-10-2023 12:43 for custom invoice***/
                            else if (docid == "105103145127") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table, null, null, null, "AddToHidden")
                                    //GetAllGLID();//Commented by Suraj on 29-07-2024
                                }
                            }
                            /***Modifyed By Shubham Maurya on 26-10-2023 12:43 for Consumble invoice***/
                            else if (docid == "105101152") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    GetAllGLID();
                                }
                            }
                            else if (docid == "105101150") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    GetAllGLID();
                                }
                            }
                            else if (docid == "105101154") {//modifyed by shubham maurya on 29-01-2025
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    let SuppId = $("#SupplierName").val();
                                    let GrossAmt = CheckNullNumber($("#TxtGrossValue").val());
                                    if (GrossAmt != 0) {
                                        AutoTdsApply(SuppId, GrossAmt).then(() => {
                                            GetAllGLID();
                                        });
                                    }
                                    else {
                                        GetAllGLID();
                                    }
                                }
                            }
                            else {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                }
                            }
                        }
                        else {
                            /***Modifyed By Shubham Maurya on 26-10-2023 12:43 for custom invoice***/
                            if (docid == "105103140" || docid == "105103145127" || docid == "105108123" || docid == "105101152" || docid == "105101150") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    GetAllGLID();
                                }
                            }
                            if (docid == "105101145") {
                                if (arr.Table.length > 0) {
                                    ApplyGSTToAtable(ItemID, TableID, SNohiddenfiled, item_ass_val, arr.Table, "ItemTax", AutoAplyTaxPI)
                                    //GetAllGLID();
                                }
                            }
                            else {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                }
                            }
                        }
                    },
                });
        } catch (err) {
            console.log("GetMenuData Error : " + err.message);
        }
    }

}

function Cmn_OnSaveAddressApplyGST(gst_number, TableID, ItemID, SNohiddenfiled, item_ass_val, TaxGrnNo
    , TaxCalcItemCode, e, AddressSave, add, AutoAplyTaxPI) {
    debugger;
    var ItmCodes = "";
    var docid = $("#DocumentMenuId").val();
    $("#" + TableID + " >tbody >tr").each(function () {
        var clickedrow = $(this);
        var Itm_ID = clickedrow.find("#" + ItemID).val();
        var GstApplicable = $("#Hdn_GstApplicable").text();
        //clickedrow.find('#ManualGST').prop("checked", false);
        if (GstApplicable == "Y") {
            if (AddressSave != "AddressSave") {
                if (docid == "105101145" || docid == "105101147") {/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
                    var GrnNo = clickedrow.find("#" + SNohiddenfiled).val();
                    var TaxGrn = $("#" + TaxGrnNo).val();
                    var TaxCalcItemCd = $("#" + TaxCalcItemCode).val();
                    if (Itm_ID == TaxCalcItemCd && GrnNo == TaxGrn) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {

                        }
                        else {
                            ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
                        }
                    }
                }
                else if (docid == "105103125") {
                    var GrnNo = clickedrow.find("#" + SNohiddenfiled).val();
                    var TaxGrn = $("#" + TaxGrnNo).val();
                    var TaxCalcItemCd = $("#" + TaxCalcItemCode).val();
                    if (Itm_ID == TaxCalcItemCd && GrnNo == TaxGrn) {
                        //if (Itm_ID == TaxCalcItemCd) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {

                        }
                        else {
                            ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
                        }
                    }
                }
                //else if (docid == "105101154") {
                //    var GrnNo = clickedrow.find("#" + SNohiddenfiled).val();
                //    var TaxCalcItemCd = $("#" + TaxCalcItemCode).val();
                //    if (Itm_ID == TaxCalcItemCd) {
                //        if (clickedrow.find("#ManualGST").is(":checked")) {

                //        }
                //        else {
                //            ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
                //        }
                //    }
                //}
                else {

                    if (clickedrow.find("#ManualGST").is(":checked")) {

                    }
                    else {
                        ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
                    }
                }
            }
            else {
                if (add == "AddSave") {
                    clickedrow.find('#ManualGST').prop("checked", false);
                    ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
                }
                else {
                    if (clickedrow.find("#ManualGST").is(":checked")) {

                    }
                    else {
                        clickedrow.find('#ManualGST').prop("checked", false);
                        ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
                    }
                }
            }
        }
        else {
            ItmCodes += ItmCodes == "" ? Itm_ID : "," + Itm_ID;
        }
    });
    if (ItmCodes != "") {
        try {
            $.ajax(
                {
                    type: "POST",
                    url: "/Common/Common/GetItemGstDetails",
                    data: { ItemIDs: ItmCodes, gst_number: gst_number },
                    success: function (data) {

                        if (data == 'ErrorPage') {
                            Comn_ErrorPage();
                            return false;
                        }
                        var arr = [];
                        arr = JSON.parse(data);
                        if (AddressSave != "AddressSave") {
                            if (docid == "105101145" || docid == "105101147") {/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
                                if (arr.Table.length > 0) {
                                    ApplyGSTToAtable(ItemID, TableID, SNohiddenfiled, item_ass_val, arr.Table, "ItemTax", AutoAplyTaxPI)
                                    //GetAllGLID();
                                }
                            }
                            else if (docid == "105103140") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    GetAllGLID();
                                }
                            }
                            else if (docid == "105103125") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    var clickedrow = $(e.target).closest("tr");
                                    CalculationBaseQty(clickedrow);
                                }
                            }
                            else if (docid == "105103120") {//add by shubham maurya on 07-10-2025
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    //var clickedrow = $(e.target).closest("tr");
                                    CalculationBaseQty(e);
                                }
                            }
                            else if (docid == "105108101") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    if (e != undefined && e != null && e != "") { /* Condition is added by Suraj Maurya on 30-05-2025 */
                                        CalculationBaseRate(e);
                                    }
                                }
                            }
                            else if (docid == "105108123") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                    GetAllGLID();
                                }
                            }
                            /***Modifyed By Shubham Maurya on 26-10-2023 12:43 for custom invoice***/
                            else if (docid == "105103145127") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table, null, null, null, "AddToHidden")
                                    if (add == "NoApply") {
                                    }
                                    else {
                                        GetAllGLID();
                                    }
                                }
                            }
                            /***Modifyed By Shubham Maurya on 26-10-2023 12:43 for Consumble invoice***/
                            else if (docid == "105101152") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)

                                    GetAllGLID("Calc");
                                }
                            }
                            else if (docid == "105101150") {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table, null, null, null, "AddToHidden")
                                    GetAllGLID();
                                }
                            }
                            else if (docid == "105103148" || docid == "105103149") {/*add by Hina on 31-07-2024 for scrap sale invoice*//*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                                if (arr.Table.length > 0) {/*add null, null, null, "AddToHidden" by Hina on 13-01-2025 for scrap sale invoice*/
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table, null, null, null, "AddToHidden")
                                    GetAllGLID();
                                }
                            }
                            else if (docid == "105103147") {/*Add by Hina Sharma on 02-01-2025 to TaxExempted FOR ServiceSaleInvoice*/
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table, null, null, null, "AddToHidden")
                                    GetAllGLID();
                                }
                            }
                            else if (docid == "105101154") {/*Add by Shubham Maurya on 30-01-2025 For DPI*/
                                //if (arr.Table.length > 0) {
                                //    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table, null, null, null, "AddToHidden")
                                //    GetAllGLID();
                                //}
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table, null, null, null, "AddToHidden")
                                    let SuppId = $("#SupplierName").val();
                                    let GrossAmt = CheckNullNumber($("#TxtGrossValue").val());
                                    if (GrossAmt != 0) {
                                        AutoTdsApply(SuppId, GrossAmt).then(() => {
                                            GetAllGLID();
                                        });
                                    }
                                    else {
                                        GetAllGLID();
                                    }
                                }
                            }
                            else {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                                }
                            }
                        }
                        else {
                            /***Modifyed By Shubham Maurya on 26-10-2023 12:43 for custom invoice***/
                            if (docid == "105103140" || docid == "105103145127" || docid == "105108123" || docid == "105101152" || docid == "105101150" || docid == "105103148" || docid == "105103147" || docid == "105101154" || docid == "105103149") {/*Add docid == "105103147" by Hina Sharma on 02-01-2025 to TaxExempted for Service Sale Invoice*//*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table, null, null, null, "AddToHidden")
                                    //if (docid == "105103148") {/*Add by Hina on Scrap Sale invoice for gl chnge on behalf of address*//*commented by Hina on 13-01-2025*/
                                    //    CalculateAmount();
                                    //    //if ($("#chk_roundoff").is(":checked")) {//Commented by SUraj maurya on 29-11-2024
                                    //    //    /*await addRoundOffToNetValue();*/
                                    //    //    GetAllGLID('RO');
                                    //    //}
                                    //    //else {
                                    //    //    GetAllGLID();
                                    //    //}
                                    //} else if (docid == "105103140") {
                                    //    CalculateAmount();
                                    //    GetAllGLID();
                                    //}
                                    if (docid == "105103140") {
                                        CalculateAmount();
                                        GetAllGLID();
                                    }
                                    else {
                                        //GetAllGLID();
                                        if (docid == "105101154") {
                                            let SuppId = $("#SupplierName").val();
                                            let GrossAmt = CheckNullNumber($("#TxtGrossValue").val());
                                            if (GrossAmt != 0) {
                                                AutoTdsApply(SuppId, GrossAmt).then(() => {
                                                    GetAllGLID();
                                                });
                                            }
                                            else {
                                                GetAllGLID();
                                            }
                                        }
                                        else {
                                            GetAllGLID();
                                        }
                                    }
                                }
                            }
                            else if (docid == "105101145" || docid == "105101147") {/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
                                if (arr.Table.length > 0) {
                                    ApplyGSTToAtable(ItemID, TableID, SNohiddenfiled, item_ass_val, arr.Table, "ItemTax", AutoAplyTaxPI)
                                    //GetAllGLID();
                                }
                            }
                            else {
                                if (arr.Table.length > 0) {
                                    Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table, null, null, null, "AddToHidden")
                                }
                            }
                        }
                    },
                });
        } catch (err) {
            console.log("GetMenuData Error : " + err.message);
        }
    }

}
/*This Function Is used in PQ,PO,PI,SQ,SO,SI,CI*/
function Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, Taxarr, GL, TaxbySlab, AddRow/*For Add GL On Invoice*/, flagAction) {
    //
    var ConvRate = $("#conv_rate").val();
    var Dmenu = $("#DocumentMenuId").val();
    //var DecDigit = $("#ValDigit").text();
    //if (Dmenu == "105103145127") {
    //    DecDigit = $("#ExpImpValDigit").text();
    //}
    var OnAdd = "";
    var NewArray = [];
    var TaxExamptItems = [];
    $("#" + TableID + " >tbody >tr").each(function () {
        var clickedrow = $(this);
        var Itm_ID = clickedrow.find("#" + ItemID).val();
        var SNo = "";
        if (Dmenu != "105103140" && Dmenu != "105101145" && Dmenu != "105103145127" && Dmenu != "105108123"
            && Dmenu != "105102115101" && Dmenu != "105108120"/* && Dmenu != "105103148"*/) {/*commented 105103148 by Hina on 13-01-2025 for scrap sale invoice*/
            SNo = clickedrow.find("#" + SNohiddenfiled).val();
        }
        //
        var assessVal = clickedrow.find("#" + item_ass_val).val();
        if (Dmenu == "105103145127") {
            assessVal = parseFloat(CheckNullNumber(assessVal));// + parseFloat(CheckNullNumber(clickedrow.find("#TxtOtherCharge").val())) / ConvRate;
        }
        if (flagAction == "AddToHidden" && ("105103148,105101150,105103147,105103145127,105103149").split(',').includes(Dmenu)) {/*Add 105103147(SSI)  by Hina on 02-01-2025 for TaxExempted *//*Add BY shubham Maurya on 02-06-2025 add 105103149*/
            if (!clickedrow.find("#TaxExempted").is(":checked")) {
                TaxExamptItems.push(Itm_ID);
            }

        }
        var arr = Taxarr;
        let selected = []; selected.push({ item_id: Itm_ID });
        selected = JSON.stringify(selected);
        arr = arr.filter(i => selected.includes(i.item_id));

        for (var i = 0; i < arr.length; i++) {
            var DocNumber = true;
            if (Dmenu == "105101145") {
                var Grn_no = clickedrow.find("#TxtGrnNo").val();
                if (arr[i].mr_no != null) {
                    if (Itm_ID == arr[i].item_id && Grn_no == arr[i].mr_no) {
                        DocNumber = true;
                    } else {
                        DocNumber = false;
                    }
                }
            }
            if (Dmenu == "105103125") {
                var QuotationNumber = clickedrow.find("#QuotationNumber").val();
                if (arr[i].ship_no != null) {
                    if (Itm_ID == arr[i].item_id && QuotationNumber == arr[i].ship_no) {
                        DocNumber = true;
                    } else {
                        DocNumber = false;
                    }
                }
            }
            //
            if (Itm_ID == arr[i].item_id && DocNumber == true) {
                //
                $('#TaxCalculatorTbl tbody tr').remove();
                $("#TaxCalcItemCode").val(arr[i].item_id);
                if (Dmenu == "105103125") {
                    // if ($("#HiddenRowSNo").val() == SNo) {
                    $("#HiddenRowSNo").val(SNo);
                    //}
                }
                else {
                    $("#HiddenRowSNo").val(SNo);
                }
                if (Dmenu == "105103140") {
                    var DocNo = clickedrow.find("#TxtShipmentNo").val();
                    var DocDate = clickedrow.find("#hfShipmentDate").val();
                    $("#TaxCalcGRNNo").val(DocNo);
                    $("#TaxCalcGRNDate").val(DocDate);
                    OnAdd = "Y";
                }
                if (Dmenu == "105103145127") {
                    var DocNo = clickedrow.find("#TxtShipmentNo").val();
                    var DocDate = clickedrow.find("#hfShipmentDate").val();
                    $("#TaxCalcGRNNo").val(DocNo);
                    $("#TaxCalcGRNDate").val(DocDate);
                    OnAdd = "Y";
                }
                if (Dmenu == "105103125") {
                    //var QTNo = $("#TaxCalcGRNNo").val();
                    var DocNo = clickedrow.find("#QuotationNumber").val();
                    var DocDate = clickedrow.find("#QuotationDate").val()
                    $("#TaxCalcGRNNo").val(DocNo);/*Add  by Hina on 04-06-2025*/
                    var QTNo = $("#TaxCalcGRNNo").val();
                    var SrNo = clickedrow.find("#SNohiddenfiled").val()
                    if (QTNo == DocNo) {
                        $("#TaxCalcGRNNo").val(DocNo);
                        $("#TaxCalcGRNDate").val(DocDate);
                        $("#HiddenRowSNo").val(SrNo);
                    }
                    if (AddRow == "Add") {
                        $("#TaxCalcGRNNo").val(DocNo);
                        $("#TaxCalcGRNDate").val(DocDate);
                    }
                }
                if (Dmenu == "105101145") {
                    var GrnNo = $("#TaxCalcGRNNo").val();
                    var DocNo = clickedrow.find("#TxtGrnNo").val();
                    var DocDate = clickedrow.find("#hfGRNDate").val();
                    if (GrnNo == DocNo) {
                        $("#TaxCalcGRNNo").val(DocNo);
                        $("#TaxCalcGRNDate").val(DocDate);
                    }
                    if (AddRow == "Add") {
                        $("#TaxCalcGRNNo").val(DocNo);
                        $("#TaxCalcGRNDate").val(DocDate);
                    }
                    /***Modifyed By Shubham Maurya On 16-10-2023***/
                    //else {
                    //    $("#TaxCalcGRNNo").val(DocNo);
                    //    $("#TaxCalcGRNDate").val(DocDate);
                    //}
                }
                $("#Tax_AssessableValue").val(assessVal);
                var Ship_StateCode = $("#Ship_StateCode").val();
                //var Br_Gst_number = arr[i].br_gst_no;
                var Br_Gst_StateCode = arr[i].br_state_code;

                var tax_doc_no = $("#TaxCalcGRNNo").val();
                var tax_doc_date = $("#TaxCalcGRNDate").val();
                var itax_val = 0;
                var total_tax_val = 0;
                if (flagAction == "AddToHidden" && ("105103148,105101150,105103147,105103145127,105103149").split(',').includes(Dmenu)) {/*Add 105103147(SSI)  by Hina on 02-01-2025 for TaxExempted *//*Add BY shubham Maurya on 02-06-2025 add 105103149*/

                    $("#Hdn_TaxCalculatorTbl > tbody > tr #TaxItmCode:contains(" + Itm_ID + ")").closest('tr').each(function () {
                        let row = $(this);
                        let doc_no = row.find("#DocNo").text();
                        let doc_date = row.find("#DocDate").text();
                        let item_id = row.find("#TaxItmCode").text();
                        if (tax_doc_no == "" && tax_doc_date == "") {
                            if (item_id == Itm_ID) {
                                row.remove();
                            }
                        } else {
                            if (item_id == Itm_ID && doc_no == tax_doc_no && doc_date == tax_doc_date) {
                                row.remove();
                            }
                        }

                    });
                }
                //if (Ship_StateCode != null && Br_Gst_StateCode != null) {
                if (parseInt(Ship_StateCode) == parseInt(Br_Gst_StateCode) /*Br_Gst_number.substring(0, 2)*/) {
                    var ctax_val = (assessVal * arr[i].cgst_tax_per / 100).toFixed(cmn_ValDecDigit);
                    var stax_val = (assessVal * arr[i].sgst_tax_per / 100).toFixed(cmn_ValDecDigit);
                    total_tax_val = (parseFloat(ctax_val) + parseFloat(stax_val))
                    if (flagAction == "AddToHidden" && ("105103148,105101150,105103147,105103145127,105103149").split(',').includes(Dmenu)) {/*Add 105103147(SSI)  by Hina on 02-01-2025 for TaxExempted *//*Add BY shubham Maurya on 02-06-2025 add 105103149*/

                        if (Dmenu == "105103140" || Dmenu == "105101150" || Dmenu == "105101152" /*|| Dmenu == "105103148"*/) {/*commented 105103148 by Hina on 13-01-2025 for scrap sale invoice*/

                            TaxTableDataBind_Hdn(1, arr[i].cgst_tax_name, arr[i].cgst_tax_id, String(arr[i].cgst_tax_per), 1, "Immediate Level"
                                , ctax_val, "I", (parseFloat(ctax_val) + parseFloat(stax_val)), Itm_ID
                                , tax_doc_no, tax_doc_date, arr[i].cgst_tax_acc_id, "", arr[i].cgst_tax_recov)

                            TaxTableDataBind_Hdn(2, arr[i].sgst_tax_name, arr[i].sgst_tax_id, String(arr[i].sgst_tax_per), 1
                                , "Immediate Level", stax_val, "I", (parseFloat(ctax_val) + parseFloat(stax_val)), Itm_ID
                                , tax_doc_no, tax_doc_date, arr[i].sgst_tax_acc_id, "", arr[i].sgst_tax_recov)
                        }
                        else {
                            TaxTableDataBind_Hdn(1, arr[i].cgst_tax_name, arr[i].cgst_tax_id, String(arr[i].cgst_tax_per)
                                , 1, "Immediate Level", ctax_val, "I", (parseFloat(ctax_val) + parseFloat(stax_val)), Itm_ID
                                , tax_doc_no, tax_doc_date)

                            TaxTableDataBind_Hdn(2, arr[i].sgst_tax_name, arr[i].sgst_tax_id, String(arr[i].sgst_tax_per)
                                , 1, "Immediate Level", stax_val, "I", (parseFloat(ctax_val) + parseFloat(stax_val)), Itm_ID
                                , tax_doc_no, tax_doc_date)
                        }
                        //Adding Tax data in Array
                        NewArray.push({
                            TaxItmCode: Itm_ID, TaxName: arr[i].cgst_tax_name
                            , TaxNameID: arr[i].cgst_tax_id, TaxPercentage: String(arr[i].cgst_tax_per), TaxLevel: 1
                            , TaxApplyOn: "Immediate Level", TaxAmount: parseFloat(ctax_val).toFixed(cmn_ValDecDigit)
                            , TotalTaxAmount: (parseFloat(ctax_val) + parseFloat(stax_val)).toFixed(cmn_ValDecDigit)
                            , TaxApplyOnID: "I", TaxAccId: IsNull(arr[i].cgst_tax_acc_id, "")
                        });

                        NewArray.push({
                            TaxItmCode: Itm_ID, TaxName: arr[i].sgst_tax_name
                            , TaxNameID: arr[i].sgst_tax_id, TaxPercentage: String(arr[i].sgst_tax_per), TaxLevel: 1
                            , TaxApplyOn: "Immediate Level", TaxAmount: parseFloat(stax_val).toFixed(cmn_ValDecDigit)
                            , TotalTaxAmount: (parseFloat(ctax_val) + parseFloat(stax_val)).toFixed(cmn_ValDecDigit)
                            , TaxApplyOnID: "I", TaxAccId: IsNull(arr[i].sgst_tax_acc_id, "")
                        });
                    }
                    else {
                        $("#Hd_GstType").val("Both")/*Only for Domestic Purchase Invoice RCM Functionality*/
                        if (Dmenu == "105103140" || Dmenu == "105101150" || Dmenu == "105101152" || Dmenu == "105101154" || Dmenu == "105102115101" /*|| Dmenu == "105103148"*/) {/*commented 105103148 by Hina on 13-01-2025 for scrap sale invoice*/

                            TaxTableDataBind(1, arr[i].cgst_tax_name, arr[i].cgst_tax_id, String(arr[i].cgst_tax_per), 1, "Immediate Level"
                                , ctax_val, "I", (parseFloat(ctax_val) + parseFloat(stax_val)), arr[i].cgst_tax_acc_id, "", arr[i].cgst_tax_recov)

                            TaxTableDataBind(2, arr[i].sgst_tax_name, arr[i].sgst_tax_id, String(arr[i].sgst_tax_per), 1
                                , "Immediate Level", stax_val, "I", (parseFloat(ctax_val) + parseFloat(stax_val)), arr[i].sgst_tax_acc_id
                                , "", arr[i].sgst_tax_recov)
                        }
                        else {
                            TaxTableDataBind(1, arr[i].cgst_tax_name, arr[i].cgst_tax_id, String(arr[i].cgst_tax_per)
                                , 1, "Immediate Level", ctax_val, "I", (parseFloat(ctax_val) + parseFloat(stax_val)), "", "", arr[i].tax_recov)
                            TaxTableDataBind(2, arr[i].sgst_tax_name, arr[i].sgst_tax_id, String(arr[i].sgst_tax_per)
                                , 1, "Immediate Level", stax_val, "I", (parseFloat(ctax_val) + parseFloat(stax_val)), "", "", arr[i].tax_recov)
                        }
                    }
                }
                else {
                    if (flagAction == "AddToHidden" && ("105103148,105101150,105103147,105103145127,105103149").split(',').includes(Dmenu)) { /*Add 105103147(SSI)  by Hina on 02-01-2025 for TaxExempted *//*Add BY shubham Maurya on 02-06-2025 add 105103149*/

                        if (Dmenu == "105103145127") {
                            var itax_valsp = assessVal * arr[i].igst_tax_per / 100;
                            itax_val = (itax_valsp/* * ConvRate*/).toFixed(cmn_ValDecDigit);//Commented by Suraj on 23-07-2024
                        }
                        else {
                            itax_val = assessVal * arr[i].igst_tax_per / 100;
                        }
                        total_tax_val = itax_val;
                        $("#Hd_GstType").val("IGST")/*Only for Domestic Purchase Invoice RCM Functionality*/
                        if (Dmenu == "105103140" || Dmenu == "105101150" || Dmenu == "105101152") {
                            TaxTableDataBind_Hdn(1, arr[i].igst_tax_name, arr[i].igst_tax_id, String(arr[i].igst_tax_per)
                                , 1, "Immediate Level", itax_val, "I", itax_val, Itm_ID, tax_doc_no, tax_doc_date
                                , arr[i].igst_tax_acc_id, "", arr[i].igst_tax_recov)
                        }
                        else {
                            TaxTableDataBind_Hdn(1, arr[i].igst_tax_name, arr[i].igst_tax_id, String(arr[i].igst_tax_per)
                                , 1, "Immediate Level", itax_val, "I", itax_val, Itm_ID, tax_doc_no, tax_doc_date
                                , "", "", arr[i].tax_recov)
                        }
                        //Adding Tax data in Array
                        NewArray.push({
                            TaxItmCode: Itm_ID, TaxName: arr[i].igst_tax_name
                            , TaxNameID: arr[i].igst_tax_id, TaxPercentage: String(arr[i].igst_tax_per), TaxLevel: 1, TaxApplyOn: "Immediate Level"
                            , TaxAmount: parseFloat(itax_val).toFixed(cmn_ValDecDigit)
                            , TotalTaxAmount: parseFloat(itax_val).toFixed(cmn_ValDecDigit), TaxApplyOnID: "I"
                            , TaxAccId: arr[i].igst_tax_acc_id
                        });
                    }
                    else {
                        if (Dmenu == "105103145127") {
                            var itax_valsp = assessVal * arr[i].igst_tax_per / 100;
                            itax_val = (itax_valsp/* * ConvRate*/).toFixed(cmn_ValDecDigit);//Commented by Suraj on 23-07-2024
                        }
                        else {
                            itax_val = assessVal * arr[i].igst_tax_per / 100;
                        }
                        $("#Hd_GstType").val("IGST")/*Only for Domestic Purchase Invoice RCM Functionality*/
                        if (Dmenu == "105103140" || Dmenu == "105101150" || Dmenu == "105101152" || Dmenu == "105101154" || Dmenu == "105102115101") {
                            TaxTableDataBind(1, arr[i].igst_tax_name, arr[i].igst_tax_id, String(arr[i].igst_tax_per), 1
                                , "Immediate Level", itax_val, "I", itax_val, arr[i].igst_tax_acc_id, "", arr[i].igst_tax_recov)
                        }
                        else {
                            TaxTableDataBind(1, arr[i].igst_tax_name, arr[i].igst_tax_id, String(arr[i].igst_tax_per), 1
                                , "Immediate Level", itax_val, "I", itax_val, "", "", arr[i].tax_recov)
                        }
                    }

                }

                if (flagAction == "AddToHidden" && ("105103148,105101150,105103147,105103145127,105103149").split(',').includes(Dmenu)) {/*Add 105103147(SSI)  by Hina on 02-01-2025 for TaxExempted *//*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                    try {
                        Fn_AfterTaxChangeUpdateNetValueItemWise(clickedrow, total_tax_val, ConvRate);
                    } catch (err) {
                        console.log(err.message)
                    }
                }
                else {
                    if (Dmenu == "105103140" || Dmenu == "105103145127") {
                        if (GL == "N") {
                            if (TaxbySlab != "TaxbySlab") {
                                $("#HdnTaxOn").val("Item");
                                OnClickTaxSaveAndExit();
                            }
                        }
                        else {
                            if (TaxbySlab != "TaxbySlab") {
                                $("#HdnTaxOn").val("Item");
                                OnClickTaxSaveAndExit("Y");
                            }
                        }
                    }
                    else if (Dmenu == "105101145" || Dmenu == "105101150" /*|| Dmenu == "105103147"*/ || Dmenu == "105108123" /*|| Dmenu == "105103148"*/) {/*commented by Hina (105103147,105103148) on 02-01-2025,13-01-2025 for servic sale invoice,scrap sale invoice*/
                        if (GL == "N") {
                            OnClickSaveAndExit();
                        } else {
                            if (TaxbySlab == "TaxbySlab") {

                            }
                            else {
                                $("#HdnTaxOn").val("Item");
                                OnClickSaveAndExit("Y");
                            }
                        }
                    }
                    else {
                        if (TaxbySlab == "TaxbySlab") {

                        }
                        else {
                            $("#HdnTaxOn").val("Item");
                            OnClickSaveAndExit();
                        }
                    }
                }

            }
        }
    });
    if (flagAction == "AddToHidden" && ("105103148,105101150,105103147,105103145127,105103149").split(',').includes(Dmenu)) { /*Add 105103147(SSI)  by Hina on 02-01-2025 for TaxExempted service sale invoice*//*Add BY shubham Maurya on 02-06-2025 add 105103149*/
        let newArray = [];
        $('#Hdn_TaxCalculatorTbl tbody tr').each(function () {
            let CRow = $(this);
            let TaxItmCode = CRow.find("#TaxItmCode").text();
            if (TaxExamptItems.includes(TaxItmCode)) {
                let TaxName = CRow.find("#TaxName").text();
                let TaxNameID = CRow.find("#TaxNameID").text();
                let TaxPercentage = CRow.find("#TaxPercentage").text();
                let TaxLevel = CRow.find("#TaxLevel").text();
                let TaxApplyOn = CRow.find("#TaxApplyOn").text();
                let TaxAmount = CRow.find("#TaxAmount").text();
                let TotalTaxAmount = CRow.find("#TotalTaxAmount").text();
                let TaxApplyOnID = CRow.find("#TaxApplyOnID").text();
                let TaxAccId = CRow.find("#TaxAccId").text();
                let TaxRecov = CRow.find("#TaxRecov").text();

                newArray.push({
                    TaxItmCode: TaxItmCode, TaxName: TaxName
                    , TaxNameID: TaxNameID, TaxPercentage: TaxPercentage, TaxLevel: TaxLevel, TaxApplyOn: TaxApplyOn
                    , TaxAmount: TaxAmount, TotalTaxAmount: TotalTaxAmount, TaxApplyOnID: TaxApplyOnID
                    , TaxAccId: TaxAccId, TaxRecov: TaxRecov
                });
            }
            //newArray.push({
            //    TaxItmCode: Itm_ID, TaxName: arr[i].igst_tax_name
            //    , TaxNameID: arr[i].igst_tax_id, TaxPercentage: String(arr[i].igst_tax_per), TaxLevel: 1, TaxApplyOn: "Immediate Level"
            //    , TaxAmount: parseFloat(itax_val).toFixed(cmn_ValDecDigit)
            //    , TotalTaxAmount: parseFloat(itax_val).toFixed(cmn_ValDecDigit), TaxApplyOnID: "I"
            //    , TaxAccId: arr[i].igst_tax_acc_id
            //});
        });
        //$('#Hdn_TaxCalculatorTbl tbody').append(`<tr id="R${++rowIdx}">

        //    <td id="DocNo">${TaxCalculationListFinalList[i].DocNo}</td>
        //    <td id="DocDate">${TaxCalculationListFinalList[i].DocDate}</td>
        //    <td id="TaxItmCode">${TaxCalculationListFinalList[i].TaxItmCode}</td>
        //    <td id="TaxName">${TaxCalculationListFinalList[i].TaxName}</td>
        //    <td id="TaxNameID">${TaxCalculationListFinalList[i].TaxNameID}</td>
        //    <td id="TaxPercentage">${TaxCalculationListFinalList[i].TaxPercentage}</td>
        //    <td id="TaxLevel">${TaxCalculationListFinalList[i].TaxLevel}</td>
        //    <td id="TaxApplyOn">${TaxCalculationListFinalList[i].TaxApplyOn}</td>
        //    <td id="TaxAmount">${TaxCalculationListFinalList[i].TaxAmount}</td>
        //    <td id="TotalTaxAmount">${TaxCalculationListFinalList[i].TotalTaxAmount}</td>
        //    <td id="TaxApplyOnID">${TaxCalculationListFinalList[i].TaxApplyOnID}</td>
        //    <td id="TaxRecov">${TaxCalculationListFinalList[i].TaxRecov}</td>
        //    <td id="TaxAccId">${TaxCalculationListFinalList[i].TaxAccId}</td>
        //</tr>`);

        //BindTaxAmountDeatils(NewArray);
        BindTaxAmountDeatils(newArray);
    }
}
function Cmn_GstApplyOnRow(Tax_AssessableValue, Taxarr) {

    var ConvRate = $("#conv_rate").val();
    var Dmenu = $("#DocumentMenuId").val();
    //var DecDigit = $("#ValDigit").text();
    //if (Dmenu == "105103145127") {
    //    DecDigit = $("#ExpImpValDigit").text();
    //}
    var assessVal = $("#" + Tax_AssessableValue).val();
    var arr = Taxarr;
    //let selected = []; selected.push({ item_id: Itm_ID });
    //selected = JSON.stringify(selected);
    //arr = arr.filter(i => selected.includes(i.item_id));
    $('#TaxCalculatorTbl tbody tr').remove();
    for (var i = 0; i < arr.length; i++) {

        //var Ship_StateCode = $("#Ship_StateCode").val();
        var Ship_StateCode = "";
        /*Added by Surbhi on 27/08/2025 for OC HSN Code Application*/
        if ($("#HdnTaxOn").val() == "OC") {
            if (typeof StateCode === 'undefined' || StateCode === null || StateCode === '') {
                let val = $("#hdn_oc_supp_id_taxcal").val();
                if (val === "0" || val === undefined || val === null || val === "") {
                    //if ($("#hdn_oc_supp_id_taxcal").val() == "0" || $("#hdn_oc_supp_id_taxcal").val() == 'undefined') {
                    Ship_StateCode = $("#Ship_StateCode").val();
                } else {
                    Ship_StateCode = $("#hdn_oc_supp_state_id_taxcal").val() || "0";
                }
            }
            else {
                Ship_StateCode = StateCode;//$("#hdn_oc_supp_state_id_taxcal").val();
            }
        }
        else {
            Ship_StateCode = $("#Ship_StateCode").val();
        }

        var Br_Gst_StateCode = arr[i].br_state_code;
        var itax_val = 0;
        if (parseInt(Ship_StateCode) == parseInt(Br_Gst_StateCode)) {
            var ctax_val = (assessVal * arr[i].cgst_tax_per / 100).toFixed(cmn_ValDecDigit);
            var stax_val = (assessVal * arr[i].sgst_tax_per / 100).toFixed(cmn_ValDecDigit);

            $("#Hd_GstType").val("Both")/*Only for Domestic Purchase Invoice RCM Functionality*/
            TaxTableDataBind(1,
                arr[i].cgst_tax_name, arr[i].cgst_tax_id, String(arr[i].cgst_tax_per), 1,
                "Immediate Level", ctax_val, "I", (parseFloat(ctax_val) + parseFloat(stax_val))
                , arr[i].cgst_tax_acc_id, "", arr[i].cgst_recov
            )

            TaxTableDataBind(2,
                arr[i].sgst_tax_name, arr[i].sgst_tax_id, String(arr[i].sgst_tax_per), 1,
                "Immediate Level", stax_val, "I", (parseFloat(ctax_val) + parseFloat(stax_val))
                , arr[i].sgst_tax_acc_id, "", arr[i].sgst_recov
            )

        } else {
            if (Dmenu == "105103145127") {
                var itax_valsp = assessVal * arr[i].igst_tax_per / 100;
                /***Modifyed By Shubham Maurya on 26-10-2023 12:43 for custom invoice***/
                //itax_val = (itax_valsp * ConvRate).toFixed(cmn_ValDecDigit);
                itax_val = (itax_valsp).toFixed(cmn_ValDecDigit);
            }
            else {
                itax_val = assessVal * arr[i].igst_tax_per / 100;
            }
            $("#Hd_GstType").val("IGST")/*Only for Domestic Purchase Invoice RCM Functionality*/
            TaxTableDataBind(1,
                arr[i].igst_tax_name, arr[i].igst_tax_id, String(arr[i].igst_tax_per), 1,
                "Immediate Level", itax_val, "I", itax_val, arr[i].igst_tax_acc_id, "", arr[i].igst_recov
            )
        }
    }
}
function Cmn_AvailableStk(clickedrow, Itm_ID, SNo) {
    ////var QtyDecDigit = "";
    //var DocumentMenuId = $("#DocumentMenuId").val();
    //if (DocumentMenuId == "105103145110") {
    //    QtyDecDigit = $("#ExpImpQtyDigit").text();
    //}
    //else {
    //    QtyDecDigit = $("#QtyDigit").text();
    //}
    try {
        $.ajax({
            type: "POST",
            url: "/Common/Common/GetItemAvlStock",
            data: {
                Itm_ID: Itm_ID
            },
            success: function (data) {
                //
                if (data == 'ErrorPage') {
                    Comn_ErrorPage();
                    return false;
                }
                if (data !== null && data !== "") {
                    var arr = [];
                    arr = JSON.parse(data);
                    if (SNo == null || SNo == undefined || SNo == "undefined") {
                        SNo = "";
                    }
                    if (clickedrow != null) {
                        if (arr.Table.length > 0) {
                            clickedrow.find("#AvailableStockInBase").val(parseFloat(arr.Table[0].br_avl_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#AvailableStockInBase" + SNo).val(parseFloat(arr.Table[0].br_avl_stk_bs).toFixed(cmn_QtyDecDigit));
                            /*Add by Hina Sharma on 10-03-2025 for Sales Order Export only*/
                            clickedrow.find("#ReservedStockInBase").val(parseFloat(arr.Table[0].br_res_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ReservedStockInBase" + SNo).val(parseFloat(arr.Table[0].br_res_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#RejectedStockInBase").val(parseFloat(arr.Table[0].br_rej_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#RejectedStockInBase" + SNo).val(parseFloat(arr.Table[0].br_rej_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ReworkableStockInBase").val(parseFloat(arr.Table[0].br_rwk_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ReworkableStockInBase" + SNo).val(parseFloat(arr.Table[0].br_rwk_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#TotalStock").val(parseFloat(arr.Table[0].Total_stk).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#TotalStock" + SNo).val(parseFloat(arr.Table[0].Total_stk).toFixed(cmn_QtyDecDigit));
                        }
                        else {
                            clickedrow.find("#AvailableStockInBase").val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#AvailableStockInBase" + SNo).val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            /*Add by Hina Sharma on 10-03-2025 for Sales Order Export only*/
                            clickedrow.find("#ReservedStockInBase").val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ReservedStockInBase" + SNo).val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#RejectedStockInBase").val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#RejectedStockInBase" + SNo).val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ReworkableStockInBase").val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ReworkableStockInBase" + SNo).val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#TotalStock").val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#TotalStock" + SNo).val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                        }
                    }
                    else {
                        if (arr.Table.length > 0) {
                            $("#AvailableStockInBase").val(parseFloat(arr.Table[0].br_avl_stk_bs).toFixed(cmn_QtyDecDigit));
                            $("#AvailableStockInBase" + SNo).val(parseFloat(arr.Table[0].br_avl_stk_bs).toFixed(cmn_QtyDecDigit));
                            /*Add by Hina Sharma on 10-03-2025 for Sales Order Export only*/
                            clickedrow.find("#ReservedStockInBase").val(parseFloat(arr.Table[0].br_res_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ReservedStockInBase" + SNo).val(parseFloat(arr.Table[0].br_res_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#RejectedStockInBase").val(parseFloat(arr.Table[0].br_rej_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#RejectedStockInBase" + SNo).val(parseFloat(arr.Table[0].br_rej_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ReworkableStockInBase").val(parseFloat(arr.Table[0].br_rwk_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ReworkableStockInBase" + SNo).val(parseFloat(arr.Table[0].br_rwk_stk_bs).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#TotalStock").val(parseFloat(arr.Table[0].Total_stk).toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#TotalStock" + SNo).val(parseFloat(arr.Table[0].Total_stk).toFixed(cmn_QtyDecDigit));
                        }
                        else {
                            $("#AvailableStockInBase").val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            $("#AvailableStockInBase" + SNo).val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            /*Add by Hina Sharma on 10-03-2025 for Sales Order Export only*/
                            clickedrow.find("#ReservedStockInBase").val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ReservedStockInBase" + SNo).val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#RejectedStockInBase").val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#RejectedStockInBase" + SNo).val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ReworkableStockInBase").val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#ReworkableStockInBase" + SNo).val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#TotalStock").val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                            clickedrow.find("#TotalStock" + SNo).val(parseFloat("0").toFixed(cmn_QtyDecDigit));
                        }
                    }

                }
            },
        });
    } catch (err) {
    }
}

//-------Bind Account Name with Group ---------//

function Cmn_BindAccountList(AccountDDLName, RowID, TableID, SnoHiddenField, OtherFx, DocMenuID, BranchId) {
    /*-------------Added by Suraj Maurya on 04-04-2025 for TN 1800 to get accounts with same currency-----------*/
    let _DocMenuId = $("#DocumentMenuId").val();
    let gl_curr_id = 0;
    if (_DocMenuId == "105104115120" || _DocMenuId == "105104115110" || _DocMenuId == "105104115105" || _DocMenuId == "105104115115") {
        gl_curr_id = $("#curr").val();
    }
    /*-------------Added by Suraj Maurya on 04-04-2025 for TN 1800 to get accounts with same currency End------------*/
    $.ajax(
        {
            type: "POST",
            url: "/Common/Common/GetAccountList",

            data: { DocMenuID: DocMenuID, gl_curr_id: gl_curr_id, BranchId: BranchId },
            dataType: "json",
            success: function (data) {

                if (data == 'ErrorPage') {
                    Comn_ErrorPage();
                    return false;
                }
                if (data !== null && data !== "") {
                    var arr = [];
                    arr = JSON.parse(data);
                    sessionStorage.removeItem("accountList");
                    sessionStorage.setItem("accountList", JSON.stringify(arr.Table));
                    if (arr.Table.length > 0) {
                        //$(AccountDDLName + RowID).append(`<optgroup class='def-cursor' id="Textddl${RowID}" label='${$("#AccName").text()}'}'></optgroup>`); used in contra page 
                        //mODIFYED bY SHUBHAM mAURYA on 29-12-2023 for bank payment and bank recipt
                        if (DocMenuID == "105104115120" || DocMenuID == "105104115110") {
                            if (RowID != 1) {
                                $(AccountDDLName + RowID).empty();
                            }
                            $(AccountDDLName + RowID).append(`<optgroup class='def-cursor' id="Textddl${RowID}" label='${$("#AccName").text()}' data-date='${$("#span_State").text()}' data-value='${$("#span_City").text()}'}'></optgroup>`);
                            for (var i = 0; i < arr.Table.length; i++) {
                                if (arr.Table[i].stateName == null) {
                                    arr.Table[i].stateName = "";
                                }
                                if (arr.Table[i].cityNmae == null) {
                                    arr.Table[i].cityNmae = "";
                                }
                                $('#Textddl' + RowID).append(`<option data-date="${arr.Table[i].stateName}" data-value="${arr.Table[i].cityNmae}" value="${arr.Table[i].acc_id}">${arr.Table[i].acc_name}</option>`);
                                //$(AccountDDLName + RowID).append(`<option data-date="${arr.Table[i].stateName}" data-date="${arr.Table[i].cityNmae}" value="${arr.Table[i].acc_id}">${arr.Table[i].acc_name}</option>`);
                            }
                            if (OtherFx == "ResetAccount") {
                                ResetGlAccount(AccountDDLName + RowID);
                            }

                        }
                        else {
                            for (var i = 0; i < arr.Table.length; i++) {
                                //$('#Textddl' + RowID).append(`<option value="${arr.Table[i].acc_id}">${arr.Table[i].acc_name}</option>`);
                                $(AccountDDLName + RowID).append(`<option value="${arr.Table[i].acc_id}">${arr.Table[i].acc_name}</option>`);
                            }
                        }
                        var firstEmptySelect = true;
                        if (DocMenuID == "105104115120") {
                            $(AccountDDLName + RowID).select2({
                                templateResult: function (data) {
                                    var selected = $(AccountDDLName + RowID).val();
                                    var selectedBr = $("#GLbranch_" + RowID).val();
                                    if (check(data, selected, TableID, SnoHiddenField, AccountDDLName, selectedBr) == true) {
                                        var DocDate = $(data.element).data('date');
                                        var value = $(data.element).data('value');
                                        var classAttr = $(data.element).attr('class');
                                        var hasClass = typeof classAttr != 'undefined';
                                        classAttr = hasClass ? ' ' + classAttr : '';
                                        var $result = $(
                                            '<div class="row bpbr">' +
                                            '<div class="col-md-6 col-xs-6' + classAttr + '">' + data.text + '</div>' +
                                            '<div class="col-md-3 col-xs-3' + classAttr + '">' + DocDate + '</div>' +
                                            '<div class="col-md-3 col-xs-3' + classAttr + '">' + value + '</div>' +
                                            '</div>'
                                        );
                                        return $result;
                                    }
                                    firstEmptySelect = false;
                                }
                            });
                        }
                        else {
                            $(AccountDDLName + RowID).select2({
                                templateResult: function (data) {
                                    var selected = $(AccountDDLName + RowID).val();
                                    if (check(data, selected, TableID, SnoHiddenField, AccountDDLName) == true) {

                                        var classAttr = $(data.element).attr('class');
                                        var hasClass = typeof classAttr != 'undefined';
                                        classAttr = hasClass ? ' ' + classAttr : '';
                                        var $result = $(
                                            '<div' + classAttr + '">' + data.text + '</div>'
                                        );
                                        return $result;
                                    }
                                    firstEmptySelect = false;
                                }
                            });
                        }

                        if (TableID != null && TableID != "") {

                        }
                        if (OtherFx == "BindData") {
                            BindData();
                        }
                    }
                }
            },
        });
}
async function Cmn_BindAccountListAsync(AccountDDLName, RowID, TableID, SnoHiddenField, OtherFx, DocMenuID, BranchId) {
    /*-------------Added by Suraj Maurya on 04-04-2025 for TN 1800 to get accounts with same currency-----------*/
    let _DocMenuId = $("#DocumentMenuId").val();
    let gl_curr_id = 0;
    if (_DocMenuId == "105104115120" || _DocMenuId == "105104115110" || _DocMenuId == "105104115105" || _DocMenuId == "105104115115") {
        gl_curr_id = $("#curr").val();
    }
    /*-------------Added by Suraj Maurya on 04-04-2025 for TN 1800 to get accounts with same currency End------------*/
    if (_DocMenuId == "105104115101") {/*Add 105104115101 by Hina Sharma on 18-07-2025 for Journal Voucher for performence issue*/
        $(AccountDDLName + RowID).select2({

            ajax: {
                url: "/Common/Common/GetAccountList2",
                data: function (params) {
                    var queryParameters = {
                        SearchName: params.term,
                        DocMenuID: DocMenuID,
                        gl_curr_id: gl_curr_id,/*Added by Suraj Maurya on 04-04-2025*/
                        BranchId: BranchId,
                        page: params.page || 1
                    };
                    return queryParameters;
                },
                multiple: true,
                cache: true,
                processResults: function (data, params) {

                    var pageSize,
                        pageSize = 20;//50000; // or whatever pagesize
                    //results = [];
                    data = JSON.parse(data).Table;
                    var arr = [];
                    $("#JVouAccDetailsTbl >tbody >tr").each(function () {
                        var currentRow = $(this);
                        var rowid = currentRow.find("#SNohf").val();
                        var AccID = currentRow.find("#hfAccID").val();
                        var AccID = currentRow.find("#hfAccID").val();
                        //var glBrId = currentRow.find("#GLbranch_" + rowid).val();
                        if ($(AccountDDLName + RowID).val() != AccID) {
                            arr.push({ acc_id: AccID });
                        }
                    });
                    debugger;
                    //sessionStorage.removeItem("accountList");
                    //sessionStorage.setItem("accountList", JSON.stringify(arr));
                    data = data.filter(v => !arr.filter(j => j.acc_id == v.acc_id).length > 0)
                    if ($(".select2-search__field").parent().find("ul").length == 0) {
                        $(".select2-search__field").parent().append(`<ul class="select2-results__options">
<li class="select2-results__option"><strong class="">
<div class="row bpbr">
<div class="col-md-12 col-xs-12 def-cursor">${$("#AccName").text()}</div>

</div>
</strong></li></ul>`)
                    }
                    var page = params.page || 1;
                    // data = data.slice((page - 1) * pageSize, page * pageSize); /*commented by Suraj For creating scroll*/
                    Fdata = data.slice((page - 1) * pageSize, page * pageSize);
                    //if (page == 1) {
                    //    if (Fdata[0] != null) {
                    //        if (Fdata[0].Name.trim() != "---Select---") {
                    //            var select = { ID: "0_0", Name: " ---Select---" };
                    //            Fdata.unshift(select);
                    //        }
                    //    }
                    //}

                    return {
                        results: $.map(Fdata, function (val, Item) {
                            return { id: val.acc_id, text: val.acc_name };
                        }),
                        //results: data.slice((page - 1) * pageSize, page * pageSize),
                        //more: data.length >= page * pageSize,
                        pagination: {
                            more: (page * pageSize) < data.length
                        }
                    };
                },
                cache: true
            },
            templateResult: function (data) {

                var classAttr = $(data.element).attr('class');
                var hasClass = typeof classAttr != 'undefined';
                classAttr = hasClass ? ' ' + classAttr : '';
                var $result;
                $result = $(
                    '<div class="row">' +
                    '<div class="col-md-12 col-xs-12' + classAttr + '">' + data.text + '</div>' +
                    '</div>'
                );
                return $result;
                firstEmptySelect = false;
            },

        });


    }
    else {
        $(AccountDDLName + RowID).select2({

            ajax: {
                url: "/Common/Common/GetAccountList2",
                data: function (params) {
                    var queryParameters = {
                        SearchName: params.term,
                        DocMenuID: DocMenuID,
                        gl_curr_id: gl_curr_id,/*Added by Suraj Maurya on 04-04-2025*/
                        BranchId: BranchId,
                        page: params.page || 1
                    };
                    return queryParameters;
                },
                multiple: true,
                cache: true,
                processResults: function (data, params) {

                    var pageSize,
                        pageSize = 20;//50000; // or whatever pagesize
                    //results = [];
                    data = JSON.parse(data).Table;
                    var arr = [];
                    $("#BPdetailTbl >tbody >tr #hfGlBranchID[value='" + BranchId + "']").closest('tr').each(function () {
                        var currentRow = $(this);
                        var rowid = currentRow.find("#SNohf").val();
                        var AccID = currentRow.find("#hfAccID").val();
                        var glBrId = currentRow.find("#GLbranch_" + rowid).val();
                        if ($(AccountDDLName + RowID).val() != AccID) {
                            arr.push({ acc_id: AccID });
                        }
                    });

                    if (["105104115110", "105104115120"].includes(_DocMenuId)) { /* Added by Suraj Maurya on 19-08-2025 under ticket 2562,2563 */
                        let MainbankAccId = $("#ddlBankAccName").val();
                        arr.push({ acc_id: MainbankAccId });
                    }
                    // Commented by Suraj Maurya on 20-01-2026 under ticket id 3444
                    //if (["105104115120"].includes(_DocMenuId)) { /* Added by Suraj Maurya on 26-09-2025 under ticket 2826 */
                    //    let selectAcc = $(AccountDDLName + RowID).val();
                    //    let accfilter = false;

                    //    let rows = $("#BPdetailTbl >tbody >tr").filter((_, tr) => {
                    //        let type = $(tr).find("#hdAccType").val();
                    //        return type == 1 || type == 2;
                    //    });

                    //    if (rows.length) {
                    //        accfilter = !rows.find(AccountDDLName + RowID + ` option:selected[value='${selectAcc}']`).length;
                    //    }
                        
                    //    if (accfilter) {
                    //        data = data.filter(v => ![1, 2].includes(v.acc_type));//Filtering Customer And Supplier
                    //    }
                    //}
                    
                    data = data.filter(v => !arr.filter(j => j.acc_id == v.acc_id).length > 0)


                    if ($(".select2-search__field").parent().find("ul").length == 0) {
                        $(".select2-search__field").parent().append(`<ul class="select2-results__options">
<li class="select2-results__option"><strong class="">
<div class="row bpbr">
<div class="col-md-6 col-xs-6 def-cursor">${$("#AccName").text()}</div>
<div class="col-md-3 col-xs-3 def-cursor">${$("#span_State").text()}</div>
<div class="col-md-3 col-xs-3 def-cursor">${$("#span_City").text()}</div>
</div>
</strong></li></ul>`)
                    }
                    var page = params.page || 1;
                    // data = data.slice((page - 1) * pageSize, page * pageSize); /*commented by Suraj For creating scroll*/
                    Fdata = data.slice((page - 1) * pageSize, page * pageSize);
                    //if (page == 1) {
                    //    if (Fdata[0] != null) {
                    //        if (Fdata[0].Name.trim() != "---Select---") {
                    //            var select = { ID: "0_0", Name: " ---Select---" };
                    //            Fdata.unshift(select);
                    //        }
                    //    }
                    //}

                    return {
                        results: $.map(Fdata, function (val, Item) {
                            return { id: val.acc_id, text: val.acc_name, stateName: val.stateName, cityName: val.cityNmae };
                        }),
                        //results: data.slice((page - 1) * pageSize, page * pageSize),
                        //more: data.length >= page * pageSize,
                        pagination: {
                            more: (page * pageSize) < data.length
                        }
                    };
                },
                cache: true
            },
            templateResult: function (data) {

                var classAttr = $(data.element).attr('class');
                var hasClass = typeof classAttr != 'undefined';
                classAttr = hasClass ? ' ' + classAttr : '';
                var $result;
                $result = $(
                    '<div class="row">' +
                    '<div class="col-md-6 col-xs-6' + classAttr + '">' + data.text + '</div>' +
                    '<div class="col-md-3 col-xs-6' + classAttr + '">' + IsNull(data.stateName, '') + '</div>' +
                    '<div class="col-md-3 col-xs-6' + classAttr + '">' + IsNull(data.cityName, '') + '</div>' +
                    '</div>'
                );
                return $result;
                firstEmptySelect = false;
            },

        });
    }
    //await $.ajax(
    //    {
    //        type: "POST",
    //        url: "/Common/Common/GetAccountList",

    //        data: { DocMenuID: DocMenuID, BranchId: BranchId },
    //        dataType: "json",
    //        success: function (data) {
    //            
    //            if (data == 'ErrorPage') {
    //                Comn_ErrorPage();
    //                return false;
    //            }
    //            if (data !== null && data !== "") {
    //                var arr = [];
    //                arr = JSON.parse(data);
    //                sessionStorage.removeItem("accountList");
    //                sessionStorage.setItem("accountList", JSON.stringify(arr.Table));
    //                if (arr.Table.length > 0) {
    //                    //$(AccountDDLName + RowID).append(`<optgroup class='def-cursor' id="Textddl${RowID}" label='${$("#AccName").text()}'}'></optgroup>`); used in contra page 
    //                    //mODIFYED bY SHUBHAM mAURYA on 29-12-2023 for bank payment and bank recipt
    //                    if (DocMenuID == "105104115120" || DocMenuID == "105104115110") {
    //                        if (RowID != 1) {
    //                            $(AccountDDLName + RowID).empty();
    //                        }
    //                        $(AccountDDLName + RowID).append(`<optgroup class='def-cursor' id="Textddl${RowID}" label='${$("#AccName").text()}' data-date='${$("#span_State").text()}' data-value='${$("#span_City").text()}'}'></optgroup>`);
    //                        for (var i = 0; i < arr.Table.length; i++) {
    //                            if (arr.Table[i].stateName == null) {
    //                                arr.Table[i].stateName = "";
    //                            }
    //                            if (arr.Table[i].cityNmae == null) {
    //                                arr.Table[i].cityNmae = "";
    //                            }
    //                            $('#Textddl' + RowID).append(`<option data-date="${arr.Table[i].stateName}" data-value="${arr.Table[i].cityNmae}" value="${arr.Table[i].acc_id}">${arr.Table[i].acc_name}</option>`);
    //                            //$(AccountDDLName + RowID).append(`<option data-date="${arr.Table[i].stateName}" data-date="${arr.Table[i].cityNmae}" value="${arr.Table[i].acc_id}">${arr.Table[i].acc_name}</option>`);
    //                        }
    //                        if (OtherFx == "ResetAccount") {
    //                            ResetGlAccount(AccountDDLName + RowID);
    //                        }

    //                    }
    //                    else {
    //                        for (var i = 0; i < arr.Table.length; i++) {
    //                            //$('#Textddl' + RowID).append(`<option value="${arr.Table[i].acc_id}">${arr.Table[i].acc_name}</option>`);
    //                            $(AccountDDLName + RowID).append(`<option value="${arr.Table[i].acc_id}">${arr.Table[i].acc_name}</option>`);
    //                        }
    //                    }
    //                    var firstEmptySelect = true;
    //                    if (DocMenuID == "105104115120") {
    //                        $(AccountDDLName + RowID).select2({
    //                            templateResult: function (data) {
    //                                var selected = $(AccountDDLName + RowID).val();
    //                                var selectedBr = $("#GLbranch_" + RowID).val();
    //                                if (check(data, selected, TableID, SnoHiddenField, AccountDDLName, selectedBr) == true) {
    //                                    var DocDate = $(data.element).data('date');
    //                                    var value = $(data.element).data('value');
    //                                    var classAttr = $(data.element).attr('class');
    //                                    var hasClass = typeof classAttr != 'undefined';
    //                                    classAttr = hasClass ? ' ' + classAttr : '';
    //                                    var $result = $(
    //                                        '<div class="row bpbr">' +
    //                                        '<div class="col-md-6 col-xs-6' + classAttr + '">' + data.text + '</div>' +
    //                                        '<div class="col-md-3 col-xs-3' + classAttr + '">' + DocDate + '</div>' +
    //                                        '<div class="col-md-3 col-xs-3' + classAttr + '">' + value + '</div>' +
    //                                        '</div>'
    //                                    );
    //                                    return $result;
    //                                }
    //                                firstEmptySelect = false;
    //                            }
    //                        });
    //                    }
    //                    else {
    //                        $(AccountDDLName + RowID).select2({
    //                            templateResult: function (data) {
    //                                var selected = $(AccountDDLName + RowID).val();
    //                                if (check(data, selected, TableID, SnoHiddenField, AccountDDLName) == true) {

    //                                    var classAttr = $(data.element).attr('class');
    //                                    var hasClass = typeof classAttr != 'undefined';
    //                                    classAttr = hasClass ? ' ' + classAttr : '';
    //                                    var $result = $(
    //                                        '<div' + classAttr + '">' + data.text + '</div>'
    //                                    );
    //                                    return $result;
    //                                }
    //                                firstEmptySelect = false;
    //                            }
    //                        });
    //                    }
    //                    
    //                    if (TableID != null && TableID != "") {

    //                    }
    //                    if (OtherFx == "BindData") {
    //                        BindData(); 
    //                    }
    //                }
    //            }
    //        },
    //    });
}
function Cmn_BindAccountList1(AccountDDLName, RowID, TableID, SnoHiddenField, OtherFx, DocMenuID) {

    $(AccountDDLName + RowID).select2({

        ajax: {
            url: "/Common/Common/GetAccountList1",
            data: function (params) {
                var queryParameters = {
                    SearchName: params.term,
                    DocMenuID: DocMenuID,
                    //PageName: PageName,
                    page: params.page || 1
                };
                return queryParameters;
            },
            multiple: true,
            cache: true,
            processResults: function (data, params) {
                //
                var pageSize,
                    pageSize = 20;//50000; // or whatever pagesize

                var page = params.page || 1;
                // data = data.slice((page - 1) * pageSize, page * pageSize); /*commented by Suraj For creating scroll*/
                Fdata = data.slice((page - 1) * pageSize, page * pageSize);
                if (page == 1) {
                    if (Fdata[0] != null) {
                        if (DocMenuID != "105103147" && DocMenuID != "105101150" && DocMenuID != "105101145" && DocMenuID != "105103148" && DocMenuID != "105103149")/*Add BY shubham Maurya on 02-06-2025 add 105103149*//*for remove select from ddl on sale account for Sale service incoice,Purchase Invoice,Service Purchase Invoice by Hina on 05-10-2023*/ {
                            if (Fdata[0].Name.trim() != "---Select---") {
                                var select = { ID: "0", Name: " ---Select---" };
                                Fdata.unshift(select);
                            }
                        }
                    }
                }

                return {
                    results: $.map(Fdata, function (val, Item) {
                        return { id: val.ID.split("_")[0], text: val.Name };
                    }),
                    //results: data.slice((page - 1) * pageSize, page * pageSize),
                    //more: data.length >= page * pageSize,
                    pagination: {
                        more: (page * pageSize) < data.length
                    }
                };
            },
            cache: true
        },
    });
}

function Cmn_BindGroup(clickedrow, Acc_ID, SNo) {

    var Docmenuid = $("#DocumentMenuId").val();
    $.ajax(
        {
            type: "POST",
            url: "/Common/Common/GetAccountGroup",
            data: {
                Acc_ID: Acc_ID,

            },
            success: function (data) {

                if (data == 'ErrorPage') {
                    Comn_ErrorPage();
                    return false;
                }
                if (data !== null && data !== "") {
                    var arr = [];
                    arr = JSON.parse(data);

                    if (Docmenuid != "105104115125") {
                        if (clickedrow != null) {

                            if (arr.Table.length > 0) {
                                clickedrow.find("#GLGroup" + SNo).val(arr.Table[0].acc_group_name);
                                clickedrow.find("#hdGLGroupID" + SNo).val(arr.Table[0].acc_grp_id);
                                var AccGrpId = arr.Table[0].CC_Acc_Type;
                                // start For Cost Center !!_Satya_!!
                                var AccGrpval = AccGrpId;
                                clickedrow.find("#hdnAccGrpval3_4").val(AccGrpval);
                                if (AccGrpval == "3" || AccGrpval == "4") {
                                    if (Docmenuid != "105104115101") {
                                        clickedrow.find("#BtnCostCenterDetail").attr("disabled", false);
                                        clickedrow.find("#BtnCostCenterDetail").removeClass("subItmImg");
                                    }

                                }
                                else {

                                    clickedrow.find("#BtnCostCenterDetail").attr("disabled", true);
                                    clickedrow.find("#BtnCostCenterDetail").addClass("subItmImg");
                                }
                                // end For Cost Center !!_Satya_!!
                                clickedrow.find("#hdAccType").val(arr.Table[0].acc_type);
                                clickedrow.find("#hdCurrId").val(arr.Table[0].curr_id);
                                clickedrow.find("#hdConvsRateId").val(arr.Table[0].conv_rate);
                                clickedrow.find("#hd_od_allow").val(arr.Table[0].od_allow);
                                clickedrow.find("#hd_od_limit").val(arr.Table[0].od_limit);


                            }
                            else {
                                clickedrow.find("#GLGroup").val("");
                            }
                        }
                        else {
                            if (arr.Table.length > 0) {
                                $("#GLGroup" + SNo).val(arr.Table[0].acc_group_name);
                                $("#GLGroupID" + SNo).val(arr.Table[0].acc_grp_id);
                            }
                            else {
                                $("#GLGroup").val("");
                            }
                        }
                    }
                    else {
                        if (clickedrow != null) {
                            if (arr.Table.length > 0) {
                                clickedrow.find("#GLGroup" + SNo).val(arr.Table[0].acc_group_name);
                                clickedrow.find("#hdGLGroupID" + SNo).val(arr.Table[0].acc_grp_id);
                                clickedrow.find("#hdAccType").val(arr.Table[0].acc_type);
                                clickedrow.find("#Currancy").val(arr.Table[0].curr_name);
                                clickedrow.find("#hdCurrId").val(arr.Table[0].curr_id);
                                clickedrow.find("#hdForeignCurr").val(arr.Table[0].foreign_currency);
                                if (arr.Table[0].foreign_currency == "Y") {
                                    clickedrow.find("#ExRate").val(arr.Table[0].conv_rate).attr("disabled", false);
                                } else {
                                    clickedrow.find("#ExRate").val(arr.Table[0].conv_rate).attr("disabled", true);
                                }

                                clickedrow.find("#hd_od_allow").val(arr.Table[0].od_allow);
                                clickedrow.find("#hd_od_limit").val(arr.Table[0].od_limit);
                            }
                            else {
                                clickedrow.find("#GLGroup").val("");
                            }
                        }
                        else {
                            if (arr.Table.length > 0) {
                                $("#GLGroup" + SNo).val(arr.Table[0].acc_group_name);
                                $("#GLGroupID" + SNo).val(arr.Table[0].acc_grp_id);
                            }
                            else {
                                $("#GLGroup").val("");
                            }
                        }
                    }
                }

                //    if (SNo == "" || SNo == null) {
                //        if (clickedrow != null) {
                //            SNo = clickedrow.find("#SNohiddenfiled").val();
                //                               }

                //                                 }
                //    $("#HiddenRowSNo").val(SNo);

            },
        });
}
function checkACC(data, selected, TableNameID, HiddenSrNoID, AccDDlNameID) {

    var Flag = "N";
    $(TableNameID + " tbody tr").each(function () {
        var currentRow = $(this);

        var rowno = currentRow.find(HiddenSrNoID).val();
        var acountId = currentRow.find(AccDDlNameID + rowno).val();
        if (acountId != null) {
            if (acountId == data.id) {
                if (acountId == "0") {
                }
                else if (selected == acountId) {
                }
                else {
                    Flag = "Y";
                }
                return false;
            }
        }
    });

    if (Flag == "Y") {
        return false;
    }
    else {
        return true;
    }
}

function HideSelectedAccount(AccountDDLName, RowID, TableID, SnoHiddenField) {

    $(TableID + " >tbody >tr").each(function (i, row) {

        var currentRow = $(this);
        var Sno = currentRow.find(SnoHiddenField).val();
        var AcountCode;
        AcountCode = currentRow.find(AccountDDLName + Sno).val();
        if (AcountCode != '0') {
            if (Sno != "0") {
                $(TableID + " >tbody >tr").each(function (i, row) {

                    var currentRowD = $(this);
                    var SnoD = currentRowD.find(SnoHiddenField).val();
                    var AcountCodeD;
                    AcountCodeD = currentRowD.find(AccountDDLName + SnoD).val();
                    if (AcountCodeD != '0') {
                        if (currentRow.find(AccountDDLName + Sno).val() !== AcountCodeD) {
                            $(AccountDDLName + Sno + " option[value=" + AcountCodeD + "]").select2().hide();
                        }
                    }
                })
            }

        }
        else {
            $(TableID + " >tbody >tr").each(function (i, row) {

                var currentRowD = $(this);
                var SnoD = currentRowD.find(SnoHiddenField).val();
                var AcountCodeD;
                AcountCodeD = currentRowD.find(AccountDDLName + SnoD).val();
                if (AcountCodeD != '0') {
                    if (currentRow.find(AccountDDLName + Sno).val() !== AcountCodeD) {
                        $(AccountDDLName + Sno + " option[value=" + AcountCodeD + "]").select2().hide();
                    }
                }
            })
        }
    });
}

//------------------Other Charge Calculation------------------//
//----------------USE==> PQ,PO,SQ,SO,PI,SI-----------------//

function CmnAmtFloatVal(el, evt) {
    try {
        //var DocumentMenuId = $("#DocumentMenuId").val();
        //if (DocumentMenuId == "105103145105" || DocumentMenuId == "105103145110") {
        //    if (Cmn_FloatValueonly(el, evt, "#ExpImpValDigit") == false) {
        //        return false;
        //    }
        //}
        //else {
        //    if (Cmn_FloatValueonly(el, evt, "#ValDigit") == false) {
        //        return false;
        //    }
        //}

        if (Cmn_FloatValueonly(el, evt, cmn_ValDecDigit_id) == false) {
            return false;
        }
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }

}
function CmnAmtFloatValWithNegative(el, evt) {
    try {
        var DMenuId = $("#DocumentMenuId").val();
        if (DMenuId == "105101150" || DMenuId == "105101152" || DMenuId == "105101145") {
            let negtv = "Y";
            if ($("#OC_ThirdParty").is(":checked")) {
                negtv = "N";
            }
            if (Cmn_FloatValueonly(el, evt, cmn_ValDecDigit_id, negtv) == false) {
                return false;
            }
        }
        else {
            if (Cmn_FloatValueonly(el, evt, cmn_ValDecDigit_id, "Y") == false) {
                return false;
            }
        }


    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}

function OnClickOtherChargeBtn() {
    try {

        debugger;
        var conv_rate = $("#conv_rate").val();
        var CurrName = $("#ddlCurrency option:selected").text();
        var Docmenuid = $("#DocumentMenuId").val();
        if (Docmenuid == "105103145125" || Docmenuid == "105103140" || /*Docmenuid == "105103120"*//*Commented by Hina on 22-05-2025 for SQ to tax on oc*/  Docmenuid == "105103145105" || Docmenuid == "105101152" || Docmenuid == "105103147" || Docmenuid == "105102150") {//Add by shubham Maurya on 10-09-2025 "105102150"
            CurrName = $("#txtCurrency").val();
        }
        if (conv_rate == null || conv_rate == 0 || conv_rate == "") {
            $("#OCconv_rate").val(1);
        }
        else {
            $("#OCconv_rate").val(conv_rate);
        }
        if (CurrName == null || CurrName == 0 || CurrName == "") {
            $("#OCCurrency").val("INR");
        }
        else {
            $("#OCCurrency").val(CurrName);
        }

        $("#SpanOCName").css("display", "none");
        $("#OtherCharge_DDL").css("border-color", "#ced4da");
        $("#SpanOCAmt").css("display", "none");
        $("#TxtOCAmt").css("border-color", "#ced4da");
        var GAmt = 0;
        //var DecDigit = $("#ValDigit").text();
        if (Docmenuid == "105102115101") {
            GAmt = $("#grnGrossValue").val();
        }
        else if (Docmenuid == "105102150" || Docmenuid == "105103142") {//Add by shubham Maurya on 10-09-2025 "105102150"
            GAmt = $("#TotalReturnValue").val();
        }
        else {
            GAmt = $("#TxtGrossValue").val();
        }

        if (parseFloat(GAmt) > 0) {
            $("#BtnOC_Amount").attr("data-target", "#OtherChargesCalculator");

            var TOCAmt = $("#Total_OC_Amount").text();
            if (TOCAmt == "0" || TOCAmt == "" || TOCAmt == "NaN") {
                $("#Tbl_OC_Deatils #Total_OC_Amount").text(parseFloat(0).toFixed(cmn_ValDecDigit));
            }
        }
        else {
            $("#BtnOC_Amount").attr("data-target", "");
            return false;
        }
        $.ajax({
            type: "POST",
            url: "/Common/Common/GetBaseCurrency",
            data: {},
            dataType: "json",
            success: function (data) {

                var bs_curr = "";
                var CurrId = "";
                if (data !== null && data !== "") /*For Chekin Json Data is return or not */ {
                    var arr = [];
                    arr = JSON.parse(data);
                    bs_curr = arr[0].bs_curr_id

                    CurrId = $("#ddlCurrency option:selected").val();
                    if (CurrId == null) {
                        CurrId = $("#hdcurr").val();
                        if ($("#OCCurrency").val() == "INR") {
                            CurrId = 1;
                        }
                    }
                    var DMenuId = $("#DocumentMenuId").val();

                    if (DMenuId == "105102115101" || DMenuId == "105101140125" || DMenuId == "105101145" || Docmenuid == "105103147" || Docmenuid == "105108123") {
                        $("#hdbs_curr").val(bs_curr);
                        let s = `<option value="${arr[0].bs_curr_id}" selected="selected">${arr[0].curr_name}</option>`;
                        if ($("#CurrId").val() == arr[0].bs_curr_id) {
                            $("#OCCurrency").attr("disabled", true);
                        } else {
                            s += `<option value="${$("#CurrId").val()}" >${$("#Currency").val()}</option>`;
                        }
                        $("#OCCurrency").html(s).change();
                        CurrId = $("#OCCurrency").val();
                    }
                }

                if (bs_curr == CurrId) {
                    if (DMenuId == "105103125" || DMenuId == "105103120" /*add 105103120 for SQ by Hina on 22-05-2025 */ || DMenuId == "105103140" || DMenuId == "105101145" || Docmenuid == "105101152" || DMenuId == "105108123" || DMenuId == "105103147" || DMenuId == "105102150" || DMenuId == "105103142" /*|| DMenuId == "105103145125" || DMenuId == "105103145110"*//*Commented by Suraj on 07-12-2022*/) { //For OC Tax//Add by shubham Maurya on 10-09-2025 "105102150"
                        $("#Tbl_OC_Deatils > tbody > tr  #OCTaxBtnCal").attr("disabled", false);
                    } else if (DMenuId == "105102115101" || DMenuId == "105101140125" || DMenuId == "105101145" || DMenuId == "105108123") {
                        $("#Tbl_OC_Deatils > tbody > tr ").each(function () {
                            let row = $(this);
                            if (row.find("#HdnOCCurrId").text() != bs_curr) {
                                row.find("#OCTaxBtnCal").attr("disabled", true)
                            }
                        });
                    } else {
                        $("#Tbl_OC_Deatils > tbody > tr  #OCTaxBtnCal").attr("disabled", true);
                    }
                    $("#CurrencyInBase").val("Y");
                } else {
                    $("#Tbl_OC_Deatils > tbody > tr  #OCTaxBtnCal").attr("disabled", true);
                    $("#CurrencyInBase").val("N");
                }
                ResetTableDetail();
                //var DMenuId = $("#DocumentMenuId").val(); /*commented by Suraj on 07-02-2022 */
                //if (DMenuId == "105103125" || DMenuId == "105103140" || DMenuId == "105101145" || DMenuId == "105103145125" || DMenuId == "105103145110") { //For OC Tax
                //} else {
                //    $("#Tbl_OC_Deatils > tbody > tr  #OCTaxBtnCal").attr("disabled", true);
                //}

                // Bind_OCList();
                bind_oc_ddl();/*Added by Surbhi on 13/08/2025 for OC HSN Code Application*/
                $("#SaveAndExitBtn_OC").attr("data-dismiss", "modal");
                $('#Tbl_OC_Deatils tbody').on('click', '.deleteIcon', function () {
                    var child = $(this).closest('tr').nextAll();
                    child.each(function () {
                        var id = $(this).attr('id');
                        var idx = $(this).children('.row-index').children('p');
                        var dig = parseInt(id.substring(1));
                        idx.html(`Row ${dig - 1}`);
                        $(this).attr('id', `R${dig - 1}`);
                    });
                    $(this).closest('tr').remove();
                    var OC_ID = $(this).closest('tr').find("#OCValue").text();
                    //$("#OtherCharge_DDL option[value=" + OC_ID + "]").show();
                    //$('#OtherCharge_DDL').val("0").prop('selected', true);
                    Reset_OCTaxTable(OC_ID);
                    Calculate_OCAmount();
                    bind_oc_ddl();/*Added by Surbhi on 08/10/2025 for OC not showing after delete on PO*/
                });

                //if ($("#ForDisableOCDlt").val() == "Disable") {
                //    $("#Tbl_OC_Deatils >tbody >tr").each(function () {
                //        var currentRow = $(this);
                //        currentRow.find("#OCDelIcon").css("display", "none");
                //    });
                //}
                if ($("#ForDisableOCDlt").val() == "Disable") {
                    $("#Tbl_OC_Deatils >tbody >tr").each(function () {
                        var currentRow = $(this);
                        currentRow.find("#OCDelIcon").css("filter", "grayscale(100%)");
                        currentRow.find("#OCDelIcon").removeClass("deleteIcon");
                        currentRow.find("#oc_chk_roundoff").attr("disabled", true);
                        currentRow.find("#oc_p_round").attr("disabled", true);
                        currentRow.find("#oc_m_round").attr("disabled", true);
                    });
                    //$("#OC_buttons").css("display", "none");
                    $("#OC_buttons button").remove();
                    //$("#OC_buttons button").attr("disabled", true);
                    //$("#OC_buttons button").attr("onclick", "");
                    $("#AddOCDetailBtn").parent().css("display", "none");
                    $("#OtherCharge_DDL").attr("disabled", true);
                    $("#TxtOCAmt").attr("disabled", true);
                    $("#OCCurrency").attr("disabled", true);
                    $("#OcThirdPartySupp_DDL").attr("disabled", true);
                }
                else {
                    if (DMenuId == "105102150" || DMenuId == "105103142") {
                        $("#AddOCDetailBtn").parent().css("display", "block");
                    }
                }
                try {
                    OtherChargePageFuncton();
                }
                catch (ex) {

                }
            }
        });

    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}
/*Created on 04-04-2024 for Purchase Invoice*/
//async function OnClickOtherChargeBtnModel() {
//    try {

//        
//        var Cmn_OC_Detail = [];

//        $("#ht_Tbl_OC_Deatils > tbody > tr").each(function () {
//            let row = $(this);
//            let oc_name = row.find("#OC_name").text();
//            let curr_name = row.find("#OC_Curr").text();
//            let curr_id = row.find("#HdnOC_CurrId").text();
//            let supp_name = row.find("#td_OCSuppName").text();
//            let supp_id = row.find("#td_OCSuppID").text();
//            let conv_rate = row.find("#OC_Conv").text();
//            let oc_id = row.find("#OC_ID").text();
//            let oc_val = row.find("#OCAmtSp").text();
//            let OCValBs = row.find("#OCAmtBs").text();
//            let tax_amt = row.find("#OCTaxAmt").text();
//            let total_amt = row.find("#OCTotalTaxAmt").text();

//            Cmn_OC_Detail.push({
//                oc_name: oc_name, curr_name: curr_name, curr_id: curr_id, supp_name: supp_name, supp_id: supp_id
//                , conv_rate: conv_rate, oc_id: oc_id, oc_val: oc_val, OCValBs: OCValBs, tax_amt: tax_amt
//                , total_amt: total_amt
//            });
//        });
//        let Docmenuid = $("#DocumentMenuId").val();
//        let Disabled = $("#ForDisableOCDlt").val();
//        await $.ajax({
//            type: "POST",
//            url: "/Common/Common/OtherChargePopUp",
//            contentType: "application/json; charset=utf-8",
//            dataType: "json",
//            data: JSON.stringify({ OC_Detail: Cmn_OC_Detail, Doc_Id: Docmenuid, Disabled: Disabled }),
//            success: function (data) {
//                
//                $("#OtherChargesCalculatorPopUp").html(data);

//                Bind_OCList();
//            }
//        }).then((data) => { console.log(data)});


//    }
//    catch (err) {
//        ToAddJsErrorLogs(err);
//    }
//}

async function OnClickOtherChargeBtnWithSupp() {
    try {

        debugger;
        var conv_rate = CheckNullNumber($("#conv_rate").val());
        var CurrName = $("#ddlCurrency option:selected").text();
        var Docmenuid = $("#DocumentMenuId").val();
        if (Docmenuid == "105103145125") {
            $("#OC_ThirdParty").attr("disabled", true)
            $('#OC_ThirdParty').prop("checked", false);
        }
        /*Add 105103148 by hina on 31-07-2024 for scrap sale invoice*/
        if (/*Docmenuid == "105103145125" ||*/ Docmenuid == "105103140" || Docmenuid == "105103148" || Docmenuid == "105103120" || Docmenuid == "105103145105" || Docmenuid == "105101152" || Docmenuid == "105103149")/*Add BY shubham Maurya on 02-06-2025 add 105103149*/ {
            CurrName = $("#txtCurrency").val();
        }
        if (conv_rate == null || conv_rate == 0 || conv_rate == "") {
            $("#OCconv_rate").val(1);
        }
        else {
            $("#OCconv_rate").val(conv_rate);
        }
        if (CurrName == null || CurrName == 0 || CurrName == "") {
            $("#OCCurrency").val("INR");
        }
        else {
            $("#OCCurrency").val(CurrName);
        }
        $("#SpanOCName").css("display", "none");
        $("#OtherCharge_DDL").css("border-color", "#ced4da");
        $("#SpanOCAmt").css("display", "none");
        $("#TxtOCAmt").css("border-color", "#ced4da");
        $("#SpanOC_BillNumber").css("display", "none");
        $("#OC_BillNumber").css("border-color", "#ced4da");
        $("#SpanOC_BillDate").css("display", "none");
        $("#OC_BillDate").css("border-color", "#ced4da");
        var GAmt = 0;
        //var DecDigit = $("#ValDigit").text();
        if (Docmenuid == "105102115101") {
            GAmt = $("#grnGrossValue").val();
        }
        else if (Docmenuid == "105108120") {
            GAmt = $("#grnGrossSrvcValue").val();
        }
        else {
            GAmt = $("#TxtGrossValue").val();
        }

        if (parseFloat(GAmt) > 0) {
            $("#BtnOC_Amount").attr("data-target", "#OtherChargesCalculator");

            var TOCAmt = $("#Total_OC_Amount").text();
            if (TOCAmt == "0" || TOCAmt == "" || TOCAmt == "NaN") {
                $("#Tbl_OC_Deatils #Total_OC_Amount").text(parseFloat(0).toFixed(cmn_ValDecDigit));
            }
            if ($("#OC_ThirdParty").is(":checked")) {
                $("#OC_ThirdParty").click();
            }

        }
        else {
            $("#BtnOC_Amount").attr("data-target", "");
            return false;
        }
        await $.ajax({
            type: "POST",
            url: "/Common/Common/GetBaseCurrency",
            data: {},
            dataType: "json",
            success: function (data) {

                var bs_curr = "";
                var CurrId = "";
                if (data !== null && data !== "") /*For Chekin Json Data is return or not */ {
                    var arr = [];
                    arr = JSON.parse(data);
                    bs_curr = arr[0].bs_curr_id
                    $("#hdbs_curr").val(bs_curr);
                    let s = "";
                    if (Docmenuid != "105103145125") {
                        s = `<option value="${arr[0].bs_curr_id}" selected="selected">${arr[0].curr_name}</option>`;
                    }
                    if (Docmenuid == "105102115101") {
                        if ($("#CurrId").val() == arr[0].bs_curr_id) {
                            $("#OCCurrency").attr("disabled", true);
                        } else {
                            s += `<option value="${$("#CurrId").val()}" >${$("#Currency").val()}</option>`;
                        }
                    }
                    else if (Docmenuid == "105103145125") {
                        s += `<option value="${$("#hdcurr").val()}" >${$("#txtCurrency").val()}</option>`;
                    }
                    $("#OCCurrency").html(s).change();
                    CurrId = $("#OCCurrency").val();
                }
                if (bs_curr == CurrId) {
                    $("#CurrencyInBase").val("Y");
                } else {
                    $("#CurrencyInBase").val("N");
                }
                $("#Tbl_OC_Deatils > tbody > tr ").each(function () {
                    let row = $(this);
                    if (row.find("#HdnOCCurrId").text() != bs_curr) {
                        row.find("#OCTaxBtnCal").attr("disabled", true)
                    }
                });

                /*Added by Surbhi on 30/06/2025 for Supplementary Purchase Invoice(105101147) in case TP TDS Values*/
                if (Docmenuid == "105101147") {
                    $("#Hdn_OC_TDS_CalculatorTbl >tbody >tr").each(function () {
                        let row = $(this);
                        let tempStatus = row.find("#td_TDS_temp").text().trim().toLowerCase();
                        if (tempStatus === "temp") {
                            // Change temp to per
                            row.find("#td_TDS_temp").text("per");
                        }
                    });
                }
                ResetTableDetail();
                //Bind_OCList();
                bind_oc_ddl();/*Added by Surbhi on 13/08/2025 for OC HSN Code Application*/
                $("#SaveAndExitBtn_OC").attr("data-dismiss", "modal");
                $('#Tbl_OC_Deatils tbody').on('click', '.deleteIcon', function () {
                    var child = $(this).closest('tr').nextAll();
                    child.each(function () {
                        var id = $(this).attr('id');
                        var idx = $(this).children('.row-index').children('p');
                        var dig = parseInt(id.substring(1));
                        idx.html(`Row ${dig - 1}`);
                        $(this).attr('id', `R${dig - 1}`);
                    });
                    $(this).closest('tr').remove();
                    var OC_ID = $(this).closest('tr').find("#OCValue").text();
                    // $("#OtherCharge_DDL option[value=" + OC_ID + "]").show();
                    $('#OtherCharge_DDL').val("0").prop('selected', true);
                    Reset_OCTaxTable(OC_ID);
                    Delet_OC_Tds_Detail(OC_ID);
                    Calculate_OCAmount();
                    bind_oc_ddl();/*Added by Surbhi on 13/08/2025 for OC HSN Code Application*/
                });
                /*Added by Surbhi on 08/04/2025 for Supplementary Purchase Invoice(105101147)*/
                if (Docmenuid == "105101147") {
                    $("#SaveAndExitBtn_OC").show();
                    $("#DiscardAndExit_OC").show();
                    $("#OC_ExitAndDiscard").hide();
                    if ($("#ForDisableOCDlt").val() == "Disable") {
                        $("#Tbl_OC_Deatils >tbody >tr").each(function () {
                            var currentRow = $(this);
                            var OCForText = currentRow.find("#OCFor").text();
                            var OCFor = (OCForText.includes("P") ? "P" : (OCForText.includes("R") ? "R" : null));
                            //if (OCFor == "P") {
                            currentRow.find("#OCDelIcon").css("filter", "grayscale(100%)");
                            currentRow.find("#OCDelIcon").removeClass("deleteIcon");
                            currentRow.find("#oc_chk_roundoff").attr("disabled", true);
                            currentRow.find("#oc_p_round").attr("disabled", true);
                            currentRow.find("#oc_m_round").attr("disabled", true);
                            //}
                        });
                        if ($("#DisableSubItem").val() == "Y") {
                            $("#OC_buttons button").hide();
                        }
                        $("#SaveAndExitBtn_OC").hide();
                        $("#DiscardAndExit_OC").hide();
                        $("#OC_ExitAndDiscard").show();
                        $("#OC_HeaderFields").css("display", "none");
                        $("#AddOCDetailBtn").parent().css("display", "none");
                        $("#OtherCharge_DDL").attr("disabled", true);
                        $("#TxtOCAmt").attr("disabled", true);
                        $("#OCCurrency").attr("disabled", true);
                        $("#OcThirdPartySupp_DDL").attr("disabled", true);
                    }
                    else if ($("#ForDisableOCDlt").val() == "Enable") {
                        $("#Tbl_OC_Deatils >tbody >tr").each(function () {
                            var currentRow = $(this);
                            debugger;
                            var OCForText = currentRow.find("#OCFor").text();
                            var OCFor = (OCForText.includes("P") ? "P" : (OCForText.includes("R") ? "R" : null));
                            if (OCFor == "P") {
                                currentRow.find("#oc_chk_roundoff").attr("disabled", true);
                                currentRow.find("#oc_p_round").attr("disabled", true);
                                currentRow.find("#oc_m_round").attr("disabled", true);
                            }
                            else if (OCFor == "R") {
                                var disableRoundOff = true;
                                var OCSuppType = currentRow.find("#td_OCSuppType").text();
                                var OCSuppID = currentRow.find("#td_OCSuppID").text();

                                if (OCSuppID != "0" && OCSuppID != "" && OCSuppType == "2") {
                                    disableRoundOff = false;
                                }
                                currentRow.find("#oc_chk_roundoff").attr("disabled", disableRoundOff);
                                //currentRow.find("#oc_p_round").attr("disabled", disableRoundOff);
                                //currentRow.find("#oc_m_round").attr("disabled", disableRoundOff);
                            }
                        });

                        //$("#SaveAndExitBtn_OC").show();
                        //$("#DiscardAndExit_OC").show();
                        //$("#OC_ExitAndDiscard").hide();
                        if ($("#DisableSubItem").val() == "Y") {
                            $("#OC_buttons button").show();
                        }
                        $("#OC_HeaderFields").css("display", "block");
                        $("#AddOCDetailBtn").parent().css("display", "block");
                        $("#OtherCharge_DDL").attr("disabled", false);
                        $("#TxtOCAmt").attr("disabled", false);
                        $("#OCCurrency").attr("disabled", false);
                        $("#OcThirdPartySupp_DDL").attr("disabled", false);
                    }
                }
                else {
                    if ($("#ForDisableOCDlt").val() == "Disable") {
                        $("#Tbl_OC_Deatils >tbody >tr").each(function () {
                            var currentRow = $(this);
                            currentRow.find("#OCDelIcon").css("filter", "grayscale(100%)");
                            currentRow.find("#OCDelIcon").removeClass("deleteIcon");
                            if (Docmenuid == "105101145" || Docmenuid == "105108123" || Docmenuid == "105101140125") {
                                if ($("#DisableSubItem").val() == "Y" || ($("#txtdisable").val() == "Y" && Docmenuid == "105108123")) {
                                    currentRow.find("#oc_chk_roundoff").attr("disabled", true);
                                    currentRow.find("#oc_p_round").attr("disabled", true);
                                    currentRow.find("#oc_m_round").attr("disabled", true);
                                }
                            } else {
                                currentRow.find("#oc_chk_roundoff").attr("disabled", true);
                                currentRow.find("#oc_p_round").attr("disabled", true);
                                currentRow.find("#oc_m_round").attr("disabled", true);
                            }

                        });
                        if (Docmenuid == "105101145") {
                            if ($("#DisableSubItem").val() == "Y") {
                                $("#OC_buttons button").remove();
                            }
                        }
                        if (Docmenuid == "105108123") {
                            var flag = "N";
                            var mr_no = $("#src_doc_no").val();
                            $("#JOInvItmDetailsTbl >tbody >tr").each(function () {
                                var currentRow = $(this);
                                var srcDoc = currentRow.find("#src_doc_no").val();
                                if (mr_no != srcDoc) {
                                    flag = "Y";
                                }
                            });
                            if ($("#DisableOCDlt").val() == "Disable") {
                                $("#OC_buttons button").remove();
                                $("#OC_HeaderFields").css("display", "none");
                            }
                            else {
                                if (flag == "N") {
                                    $("#OC_HeaderFields").css("display", "none");
                                }
                                else {
                                    $("#AddOCDetailBtn").parent().css("display", "block");
                                    $("#OtherCharge_DDL").attr("disabled", false);
                                    $("#TxtOCAmt").attr("disabled", false);
                                    $("#OCCurrency").attr("disabled", false);
                                    $("#OcThirdPartySupp_DDL").attr("disabled", false);
                                    $("#Tbl_OC_Deatils >tbody >tr").each(function () {
                                        var currentRow = $(this);
                                        currentRow.find("#OCDelIcon").css("filter", "");
                                        currentRow.find("#OCDelIcon").addClass("deleteIcon");
                                    });
                                }
                            }
                        }
                        else {
                            if (Docmenuid == "105101145" || Docmenuid == "105101140125") {/*doc_id 105101140125 added by Suraj on 06-11-2024*/
                                if ($("#DisableSubItem").val() == "Y") {
                                    $("#OC_buttons button").remove();
                                }
                            }
                            else {
                                $("#OC_buttons button").remove();
                            }
                            $("#OC_HeaderFields").css("display", "none");
                            $("#AddOCDetailBtn").parent().css("display", "none");
                            $("#OtherCharge_DDL").attr("disabled", true);
                            $("#TxtOCAmt").attr("disabled", true);
                            $("#OCCurrency").attr("disabled", true);
                            $("#OcThirdPartySupp_DDL").attr("disabled", true);
                        }
                    }
                }
                Cmn_OnChangeOcThirdPartyToggle();
                try {
                    OtherChargePageFuncton();
                }
                catch (ex) {

                }
            }
        });
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}

function OnChangeOCCurrency() {
    try {

        let ExchangeRate = 1;
        //let ExchDigit = $("#ExchDigit").text();
        var Docmenuid = $("#DocumentMenuId").val();
        if (Docmenuid == "105103145125" || Docmenuid == "105103147" || Docmenuid == "105108123") {
            if ($("#hdcurr").val() == $("#OCCurrency").val()) {
                ExchangeRate = $("#conv_rate").val();
                $("#OCconv_rate").val(parseFloat(ExchangeRate).toFixed(cmn_ExchDecDigit));
            } else {
                $("#OCconv_rate").val(parseFloat(ExchangeRate).toFixed(cmn_ExchDecDigit));
            }
        }
        else {
            if ($("#CurrId").val() == $("#OCCurrency").val()) {
                ExchangeRate = $("#ExchangeRate").val();
                $("#OCconv_rate").val(parseFloat(ExchangeRate).toFixed(cmn_ExchDecDigit));
            } else {
                $("#OCconv_rate").val(parseFloat(ExchangeRate).toFixed(cmn_ExchDecDigit));
            }
        }
        BaseSpecOCConv();
        let OCCurrency = $("#OCCurrency").val();
        let Oc_id = $("#OtherCharge_DDL").val();
        Cmn_GetOC_ThirdParty(Oc_id, OCCurrency)
            .then((res) => {
                CmnBindTPOCSupp(res);
            });

    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}
function OnClickOtherChargeBtn1() {
    try {


        var conv_rate = $("#conv_rate").val();
        var CurrName = $("#ddlCurrency option:selected").text();
        if (conv_rate == null || conv_rate == 0 || conv_rate == "") {
            $("#OCconv_rate").val(1);
        }
        else {
            $("#OCconv_rate").val(conv_rate);
        }
        if (CurrName == null || CurrName == 0 || CurrName == "") {
            $("#OCCurrency").val("INR");
        }
        else {
            $("#OCCurrency").val(CurrName);
        }


        $("#SpanOCName").css("display", "none");
        $("#OtherCharge_DDL").css("border-color", "#ced4da");
        $("#SpanOCAmt").css("display", "none");
        $("#TxtOCAmt").css("border-color", "#ced4da");

        //var DecDigit = $("#ValDigit").text();
        var GAmt = $("#TxtGrossValue").val();
        ResetTableDetail();
        if (parseFloat(GAmt) > 0) {
            $("#BtnOC_Amount").attr("data-target", "#OtherChargesCalculator");

            var TOCAmt = $("#Total_OC_Amount").text();
            if (TOCAmt == "0" || TOCAmt == "" || TOCAmt == "NaN") {
                $("#Tbl_OC_Deatils #Total_OC_Amount").text(parseFloat(0).toFixed(cmn_ValDecDigit));
            }
        }
        else {
            $("#BtnOC_Amount").attr("data-target", "");
            return false;
        }
        Bind_OCList();
        $("#SaveAndExitBtn_OC").attr("data-dismiss", "modal");
        $('#Tbl_OC_Deatils tbody').on('click', '.deleteIcon', function () {
            var child = $(this).closest('tr').nextAll();
            // Iterating across all the rows  
            // obtained to change the index 
            child.each(function () {
                // Getting <tr> id. 
                var id = $(this).attr('id');
                // Getting the <p> inside the .row-index class. 
                var idx = $(this).children('.row-index').children('p');
                // Gets the row number from <tr> id. 
                var dig = parseInt(id.substring(1));
                // Modifying row index. 
                idx.html(`Row ${dig - 1}`);
                // Modifying row id. 
                $(this).attr('id', `R${dig - 1}`);
            });
            // Removing the current row. 
            $(this).closest('tr').remove();
            // 
            var OC_ID = $(this).closest('tr').find("#OCValue").text();
            //var ItemCode = $(this).closest('tr')[0].cells[3].children[0].children[0].value;
            $("#OtherCharge_DDL option[value=" + OC_ID + "]").show();
            $('#OtherCharge_DDL').val("0").prop('selected', true);
            Calculate_OCAmount();
        });
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}
function Calculate_OCAmount() {

    try {
        var DocumentMenuId = $("#DocumentMenuId").val();
        //if (DocumentMenuId == "105103145110" || DocumentMenuId == "105103145105" || DocumentMenuId == "105103145125") {
        //    var DecDigit = $("#ExpImpValDigit").text();
        //}
        //else {
        //   //var DecDigit = $("#ValDigit").text();
        //}
        var TotalAMount = parseFloat(0).toFixed(cmn_ValDecDigit);
        var TotalAMountBs = parseFloat(0).toFixed(cmn_ValDecDigit);
        var TotalTaxAmount = parseFloat(0).toFixed(cmn_ValDecDigit);
        var TotalAMountWTBs = parseFloat(0).toFixed(cmn_ValDecDigit);

        $("#Tbl_OC_Deatils >tbody >tr").each(function () {

            var currentRow = $(this);
            TotalAMount = (parseFloat(TotalAMount) + parseFloat(currentRow.find("#OCAmount").text())).toFixed(cmn_ValDecDigit);
            TotalAMountBs = (parseFloat(TotalAMountBs) + parseFloat(currentRow.find("#OcAmtBs").text())).toFixed(cmn_ValDecDigit);
            TotalTaxAmount = (parseFloat(TotalTaxAmount) + parseFloat(currentRow.find("#OCTaxAmt").text())).toFixed(cmn_ValDecDigit);
            TotalAMountWTBs = (parseFloat(TotalAMountWTBs) + parseFloat(currentRow.find("#OCTotalTaxAmt").text())).toFixed(cmn_ValDecDigit);
        });
        $("#Tbl_OC_Deatils #Total_OC_Amount").text(TotalAMount);
        $("#Tbl_OC_Deatils #Total_OC_AmountInBs").text(TotalAMountBs);
        $("#Tbl_OC_Deatils #Total_Oc_Tax_Amt").text(TotalTaxAmount);
        $("#Tbl_OC_Deatils #Total_Oc_Amt_with_tx").text(TotalAMountWTBs);
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
};
function Reset_OCTaxTable(OCID) {

    try {
        $("#Hdn_OCTemp_TaxCalculatorTbl > tbody tr #TaxItmCode:contains(" + OCID + ")").parent().remove();
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }


};

function Bind_OCList() {
    try {

        // 
        $.ajax({
            type: "POST",
            url: "/Common/Common/GetOtherChargeList",/*Controller=LSODetail and Fuction=GetOtherChargeList*/
            dataType: "json",
            data: {},/*Registration pass value like model*/
            success: function (data) {
                if (data == 'ErrorPage') {
                    Comn_ErrorPage();
                    return false;
                }
                /*dynamically dropdown list of all Assessment */
                if (data !== null && data !== "") /*For Chekin Json Data is return or not */ {
                    var arr = [];
                    arr = JSON.parse(data);/*this is use for json data braking in array type and put in a Array*/
                    var s = '<option value="0">---Select---</option>';
                    for (var i = 0; i < arr.Table.length; i++) {
                        s += '<option value="' + arr.Table[i].oc_id + '" text="' + arr.Table[i].oc_name + '">' + arr.Table[i].oc_name + '</option>';
                    }
                    $("#OtherCharge_DDL").html(s);

                    if ($("#Tbl_OC_Deatils >tbody >tr").length > 0) {
                        $("#Tbl_OC_Deatils >tbody >tr").each(function () {
                            var currentRow = $(this);
                            var OC_ID = currentRow.find("#OCValue").text();
                            $("#OtherCharge_DDL option[value=" + OC_ID + "]").hide();
                            $('#OtherCharge_DDL').val("0").prop('selected', true);
                        });
                    }
                }
            },
            error: function (Data) {

            }
        });
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
};
function OnClickDiscardAndExit_OC_Btn() {
    // 
    try {
        ResetTableDetail();
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }

}
function ResetTableDetail() {
    debugger;
    try {
        var rowIdx = 0;
        //var DecDigit = $("#ValDigit").text();
        var deletetext = $("#Span_Delete_Title").text();
        let DocMenuId = $("#DocumentMenuId").val();
        $('#Tbl_OC_Deatils tbody tr').remove();
        $("#ht_Tbl_OC_Deatils >tbody >tr").each(function () {
            debugger;
            var currentRow = $(this);
            var OC_name = currentRow.find("#OC_name").text();
            var OC_HSNCode = currentRow.find("#OC_HSNCode").text();
            var OC_Curr = currentRow.find("#OC_Curr").text();
            var OCSuppName = currentRow.find("#td_OCSuppName").text();
            var OCSuppID = currentRow.find("#td_OCSuppID").text();
            var OCSuppType = currentRow.find("#td_OCSuppType").text();
            var OC_CurrId = currentRow.find("#HdnOC_CurrId").text();
            var OC_Conv = currentRow.find("#OC_Conv").text();
            var OC_ID = currentRow.find("#OC_ID").text();
            var OCAmtBs = currentRow.find("#OCAmtBs").text();
            var OCAmtSp = currentRow.find("#OCAmtSp").text();
            var OCTaxAmt = currentRow.find("#OCTaxAmt").text();
            var OC_TDSAmt = currentRow.find("#OC_TDSAmt").text();
            var OCTaxTotalAmt = currentRow.find("#OCTotalTaxAmt").text();
            var OCBillNo = currentRow.find("#OCBillNo").text();
            var OCBillDate = currentRow.find("#OCBillDate").text();
            var OCBillDt = currentRow.find("#OCBillDt").text();
            var OCAccId = currentRow.find("#OCAccId").text();
            var OCSuppAccId = currentRow.find("#OCSuppAccId").text();
            var OC_RoundOff = currentRow.find("#OC_RoundOff").text();
            var OC_PM_Flag = currentRow.find("#OC_PM_Flag").text();
            var OCSuppStateCode = currentRow.find("#OCSuppStateCode").text();
            var OCFor = "";
            /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
            if (DocMenuId === "105101147") {
                OCFor = currentRow.find("#OCFor").text();
                if (/^P+$/.test(OCFor)) {
                    OCFor = "P";
                } else if (/^R+$/.test(OCFor)) {
                    OCFor = "R";
                }
                currentRow.find("#OCFor").text(OCFor);
                if ($("#ForDisableOCDlt").val() === "Disable" && OCFor !== "P") {
                    if ($("#ForOCInvstatus").val() === "Disable") {
                        return;
                    }

                }

                /*Added by Surbhi on 30/06/2025 for Supplementary Purchase Invoice(105101147) in case TP TDS Values*/

                $('#TDS_CalculatorTbl tbody tr').each(function () {
                    var tdsRow = $(this);
                    var tdsOCId = tdsRow.find('#td_TDS_OC_Id').text().trim();
                    var tdsSuppId = tdsRow.find('#td_TDS_Supp_Id').text().trim();
                    var TDS_temp = tdsRow.find('#TDS_temp').text().trim();

                    if (tdsOCId === OC_ID && tdsSuppId === OCSuppID && TDS_temp == "temp") {
                        /* if (TDS_temp == "temp") {*/
                        tdsRow.remove();
                    }
                });
                $('#Hdn_OC_TDS_CalculatorTbl tbody tr').each(function () {
                    var tdsRow = $(this);
                    var tdsOCId = tdsRow.find('#td_TDS_OC_Id').text().trim();
                    var tdsSuppId = tdsRow.find('#td_TDS_Supp_Id').text().trim();
                    var TDS_temp = tdsRow.find('#td_TDS_temp').text().trim();

                    if (tdsOCId === OC_ID && tdsSuppId === OCSuppID && TDS_temp == "temp") {
                        /*if (TDS_temp == "temp") {*/
                        tdsRow.remove();
                    }
                });
            }

            ODTableDataBind(++rowIdx, OC_name, OC_Curr, OC_Conv, OC_ID, OCAmtSp, OCAmtBs, OCTaxAmt, OCTaxTotalAmt
                , OC_CurrId, OCSuppID, OCSuppName, OCBillNo, OCBillDate, OCBillDt, OCSuppType, OCAccId, OCSuppAccId, OC_TDSAmt
                , OC_RoundOff, OC_PM_Flag, OCFor, OC_HSNCode, OCSuppStateCode);

        });

        $("#Hdn_OCTemp_TaxCalculatorTbl tbody").html($("#Hdn_OC_TaxCalculatorTbl tbody").html());
        Calculate_OCAmount();
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}
async function CMNOnClickSaveAndExit_OC_Btn(otherChargeId, NetOrderValueSpe, NetOrderValueInBase) {
    try {
        debugger;
        //var DocumentMenuId = $("#DocumentMenuId").val();
        //if (DocumentMenuId == "105103145105" || DocumentMenuId == "105103145110" || DocumentMenuId == "105103145125") {
        //    var DecDigit = $("#ExpImpValDigit").text();
        //}
        //else {
        //   var DecDigit = $("#ValDigit").text();
        //}
        var tempOc = $("#Hdn_OCTemp_TaxCalculatorTbl > tbody").html();
        $("#Hdn_OC_TaxCalculatorTbl > tbody").html(tempOc);
        var Tp_Oc = "N";
        var DocSuppTotalOC = 0;
        var DocSuppTotalOC_TP = 0;
        $('#ht_Tbl_OC_Deatils tbody tr').remove();
        var DMenuId = $("#DocumentMenuId").val();
        var CurrencyInBase = $("#CurrencyInBase").val();
        var Taxable = "N";
        if ((DMenuId == "105103125" || DMenuId == "105103120" /*add 105103120 for SQ by hina on 22-05-2025*/ || DMenuId == "105101130" /*add 105101130 for PO by hina on 09-07-2025*/ || DMenuId == "105103140" || DMenuId == "105101145" || DMenuId == "105101152"
            || DMenuId == "105101150" || DMenuId == "105103147" || DMenuId == "105108123" || DMenuId == "105102115101"
            || DMenuId == "105103148" || DMenuId == "105108120" || DMenuId == "105101154" || DMenuId == "105101147" || DMenuId == "105103149" || DMenuId == "105101153" || DMenuId == "105102150" || DMenuId == "105103142" /*DMenuId == "105103145110"*//*Commented by Suraj on 07-12-2022*/) && CurrencyInBase == "Y")/*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*//*Add BY shubham Maurya on 02-06-2025 add 105103149*/ {/*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
            Taxable = "Y";//Add by shubham Maurya on 10-09-2025 "105102150"
        }
        if (DMenuId == "105101140125" || DMenuId == "105103145125") {
            Taxable = "Y";
        }
        var TotalOCAmt = 0;
        //var OCAmt_prev = 0;
        var TotalOCAmtBs = 0;//$('#Total_Oc_Amt_with_tx').text();
        $("#Tbl_OC_Deatils >tbody >tr").each(function () {
            var currentRow = $(this);
            var OC_name = currentRow.find("#OCName").text();
            var OC_hsncode = currentRow.find("#OCHSNCode").text();
            var OC_Curr = currentRow.find("#OCCurr").text();
            var OC_CurrId = currentRow.find("#HdnOCCurrId").text();//OC_CurrId Creaetd for GRN on 13-03-2024
            var OCSuppName = currentRow.find("#td_OCSuppName").text();
            var OCSuppID = currentRow.find("#td_OCSuppID").text();
            var OCSuppType = currentRow.find("#td_OCSuppType").text();
            var OC_Conv = currentRow.find("#OCConv").text();
            var OC_ID = currentRow.find("#OCValue").text();
            var OCAmtSp = currentRow.find("#OCAmount").text();
            var OCAmtBs = currentRow.find("#OcAmtBs").text();
            var OCTaxAmt = currentRow.find("#OCTaxAmt").text();
            var OCTotalTaxAmt = currentRow.find("#OCTotalTaxAmt").text();
            var OC_TDSAmt = currentRow.find("#OC_TDSAmt").text();
            var OCBillNo = currentRow.find("#OCBillNo").text();
            var OCBillDate = currentRow.find("#OCBillDate").text();
            var OCBillDt = currentRow.find("#OCBillDt").text();
            var OCAccId = currentRow.find("#OCAccId").text();
            var OCSuppAccId = currentRow.find("#OCSuppAccId").text();
            /*Added by Surbhi on 27/08/2025 for OC HSN Code Application*/
            var OCSuppStateCode = currentRow.find("#OCSuppStateCode").text();
            /* Added by Suraj Maurya on 03-12-2024 for third party round off */
            var OC_RoundOff = currentRow.find("#oc_chk_roundoff").is(":checked") == true ? "Y" : "N";
            var OC_PM_Flag = currentRow.find("#oc_p_round").is(":checked") == true ? "P" :
                currentRow.find("#oc_m_round").is(":checked") == true ? "M" : "";
            /* Added by Suraj Maurya on 03-12-2024 for third party round off */

            /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
            var OCFor = "";
            if (DMenuId == "105101147") {
                OCFor = currentRow.find("#OCFor").text();
                if (OCFor.length > 0) {
                    if (/^P+$/.test(OCFor)) {
                        currentRow.find("#OCFor").text("P");
                    }
                    else if (/^R+$/.test(OCFor)) {
                        currentRow.find("#OCFor").text("R");
                    }
                }
            }
            var tdBill = "";//Added by Suraj on 08-04-2024
            /*doc_id 105101140125 added by Suraj on 06-11-2024 for tds on import invoice*/
            if (DMenuId == "105102115101" || DMenuId == "105103140" || DMenuId == "105101150"
                || DMenuId == "105103145125" || DMenuId == "105103147" || DMenuId == "105101152"
                || DMenuId == "105108120" || DMenuId == "105101145" || DMenuId == "105103148"
                || DMenuId == "105108123" || DMenuId == "105108123" || DMenuId == "105101140125" || DMenuId == "105101154" || DMenuId == "105101147"
                || DMenuId == "105103149" || DMenuId == "105101153") {
                /*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
                /*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                //Added 105103148 by Hina on 31-07-2024
                /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
                tdBill = `
              <td id="OC_TDSAmt">${OC_TDSAmt}</td>
              <td id="OCBillNo">${OCBillNo}</td>
              <td id="OCBillDate">${OCBillDate}</td>
              <td id="OCBillDt" hidden>${OCBillDt}</td>`;
                Tp_Oc = "Y";
            }
            var td = "";
            if (Taxable == "Y") {
                td = `<td class="num_right" id="OCTaxAmt">${OCTaxAmt}</td>
              <td class="num_right" id="OCTotalTaxAmt">${OCTotalTaxAmt}</td>
              <td id="OC_RoundOff">${OC_RoundOff}</td>
              <td id="OC_PM_Flag">${OC_PM_Flag}</td>`;
            }
            $('#ht_Tbl_OC_Deatils tbody').append(`<tr>
            <td id="OC_name">${OC_name}</td>
            <td id="OC_HSNCode">${OC_hsncode}</td>
            <td id="OC_Curr">${OC_Curr}</td>
            <td id="HdnOC_CurrId">${OC_CurrId}</td>
            <td id="td_OCSuppName">${OCSuppName}</td>
            <td id="td_OCSuppID">${OCSuppID}</td>
            <td id="td_OCSuppType">${OCSuppType}</td>
            <td id="OC_Conv">${OC_Conv}</td>
            <td hidden="hidden" id="OC_ID">${OC_ID}</td>
            <td class="num_right" id="OCAmtSp">${OCAmtSp}</td>
            <td class="num_right" id="OCAmtBs">${OCAmtBs}</td>
            `+
                td
                + tdBill + `
            <td id="OCAccId" hidden>${OCAccId}</td>
            <td id="OCSuppAccId" hidden>${OCSuppAccId}</td>
            <td id="OCSuppStateCode" hidden>${OCSuppStateCode}</td>
           <td id="OCFor" hidden>${OCFor}</td></tr>`);

            if (DMenuId == "105103145125") {
                TotalOCAmt = (parseFloat(TotalOCAmt) + parseFloat(OCAmtSp)).toFixed(cmn_ValDecDigit);
                TotalOCAmtBs = (parseFloat(TotalOCAmtBs) + parseFloat(OCAmtBs)).toFixed(cmn_ValDecDigit);
                if (OCBillNo == "") {
                    DocSuppTotalOC = (parseFloat(DocSuppTotalOC) + parseFloat(OCTotalTaxAmt)).toFixed(cmn_ValDecDigit);
                }

            }
            else {
                if (Taxable == "Y") {
                    TotalOCAmt = parseFloat(TotalOCAmt) + parseFloat(OCTotalTaxAmt);
                    if (OCBillNo == "") {
                        DocSuppTotalOC = parseFloat(DocSuppTotalOC) + parseFloat(OCTotalTaxAmt);
                    }
                    else {/*Added by Surbhi on 14/05/2025 for Supplementary Purchase Invoice(105101147)*/
                        if (DMenuId == "105101147") {/*Added by Surbhi on 14/05/2025 for Supplementary Purchase Invoice(105101147)*/
                            DocSuppTotalOC_TP = parseFloat(DocSuppTotalOC_TP) + parseFloat(OCTotalTaxAmt);
                        }
                    }
                }
                else {
                    TotalOCAmt = parseFloat(TotalOCAmt) + parseFloat(OCAmtSp);
                    if (OCBillNo == "") {
                        DocSuppTotalOC = parseFloat(DocSuppTotalOC) + parseFloat(OCAmtSp);
                    }
                    else {/*Added by Surbhi on 14/05/2025 for Supplementary Purchase Invoice(105101147)*/
                        if (DMenuId == "105101147") {
                            DocSuppTotalOC_TP = parseFloat(DocSuppTotalOC_TP) + parseFloat(OCAmtSp);
                        }
                    }
                }
            }
            /*Added by Surbhi on 14/05/2025 for Supplementary Purchase Invoice(105101147) commented on 03-06-2025 by Surbhi */
            //if (DMenuId == "105101147" && OCFor == "P") {
            //    if (OCBillNo == "") {
            //        OCAmt_prev = parseFloat(OCAmtSp) + parseFloat(OCTaxAmt);
            //    }
            //}
        });
        var NetAmtSpeci = $(NetOrderValueSpe).val();
        var NetAmtBase = $(NetOrderValueInBase).val();
        if (DMenuId == "105102150" || DMenuId == "105103142") {//Add by shubham Maurya on 10-09-2025 "105102150"
            if (parseFloat(CheckNullNumber($("#TotalInvoiceValue").val())) != 0) {
                if (parseFloat(CheckNullNumber($("#TotalInvoiceValue").val())) != parseFloat(CheckNullNumber($(NetOrderValueSpe).val()))) {
                    NetAmtSpeci = $("#TotalInvoiceValue").val();
                    NetAmtBase = $("#TotalInvoiceValue").val();
                }
            }
        }
        if (DMenuId == "105103145125") {
            var TotalNetAmtSpeci = (parseFloat(TotalOCAmt) + parseFloat(NetAmtSpeci)).toFixed(cmn_ValDecDigit);
        }
        else {
            var TotalNetAmtSpeci = (parseFloat(TotalOCAmt) + parseFloat(NetAmtSpeci)).toFixed(cmn_ValDecDigit);
        }
        var TotalNetAmtBase = (parseFloat(TotalOCAmt) + parseFloat(NetAmtBase)).toFixed(cmn_ValDecDigit);
        $(otherChargeId).val(parseFloat(TotalOCAmt).toFixed(cmn_ValDecDigit));
        $("#TxtDocSuppOtherCharges").val(parseFloat(DocSuppTotalOC).toFixed(cmn_ValDecDigit));
        if (Tp_Oc == "Y") {/*For Third Party OC Case*/
            TotalNetAmtSpeci = (parseFloat(DocSuppTotalOC) + parseFloat(NetAmtSpeci)).toFixed(cmn_ValDecDigit);
            if (DMenuId == "105103145125") {
                TotalNetAmtBase = (parseFloat(TotalOCAmtBs) + parseFloat(NetAmtBase)).toFixed(cmn_ValDecDigit);
            }
            else {
                TotalNetAmtBase = (parseFloat(DocSuppTotalOC) + parseFloat(NetAmtBase)).toFixed(cmn_ValDecDigit);
            }
            $(NetOrderValueSpe).val(parseFloat(TotalNetAmtSpeci).toFixed(cmn_ValDecDigit));
            $(NetOrderValueInBase).val(parseFloat(TotalNetAmtBase).toFixed(cmn_ValDecDigit));
            /*Added by Surbhi on 14/05/2025 for Supplementary Purchase Invoice(105101147)*/
            if (DMenuId == "105101147") {
                Calculate_OC_AmountItemWiseTP(CheckNullNumber((parseFloat(DocSuppTotalOC_TP))));
            }
        }
        else {
            $(NetOrderValueSpe).val(parseFloat(TotalNetAmtSpeci).toFixed(cmn_ValDecDigit));
            $(NetOrderValueInBase).val(parseFloat(TotalNetAmtBase).toFixed(cmn_ValDecDigit));
        }
        if (("105101140125,105101145,105101152,105101150,105103140,105103148,105103147,105101147,105103149,105101153").split(',').includes(DMenuId)) {
            /*Added by Surbhi on 11/02/2026 for Inter Branch Purchase Invoice(105101153)*/
            //Added by Suraj Maurya on 26-12-2024/*Add BY shubham Maurya on 02-06-2025 add 105103149*/
            /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
            Calculate_OC_AmountItemWise(CheckNullNumber(DocSuppTotalOC));
            /*Added by Surbhi on 13/06/2025 for Supplementary Purchase Invoice(105101147)*/
            if (DMenuId == "105101147") {
                Calculate_OC_AmountItemWiseTP(CheckNullNumber((parseFloat(DocSuppTotalOC_TP))));
            }
        }
        else {
            if (TotalOCAmt != "" && TotalOCAmt != null) {
                if (parseFloat(TotalOCAmt) > parseFloat(0)) {
                    if (DMenuId != "105102150" && DMenuId != "105103142" ) {//Add by shubham Maurya on 10-09-2025 "105102150"
                        Calculate_OC_AmountItemWise(TotalOCAmt);
                    }
                }
                else {
                    SetOtherChargeVal();
                    Calculate_OC_AmountItemWise(TotalOCAmt);
                }
            }
            else {
                SetOtherChargeVal();
                Calculate_OC_AmountItemWise(TotalOCAmt);
            }
        }
        if (DMenuId == "105103148" || DMenuId == "105103149") {/*Add BY shubham Maurya on 02-06-2025 add 105103149*/
            BindOtherChargeDeatils(null);
        } else {
            if (DMenuId != "105102150" && DMenuId != "105103142") {//Add by shubham Maurya on 10-09-2025 "105102150"
                BindOtherChargeDeatils("");
            }
        }
        //if (DMenuId == "105102115101") {
        //    var order_type = $("#order_type").val();
        //    if (order_type != "I") {
        //        var ItmTmplt_id;
        //        var array = [];
        //        $("#GRNItmDetailsTbl tbody tr").each(function () {
        //            
        //            let row1 = $(this);

        //            var AssAmount = row1.find("#TxtGrnValueInBase").val();
        //            var ItmCode = row1.find("#TxtItemId").val();
        //            ItmTmplt_id = row1.find("#ItemtaxTmplt").val();
        //            array.push({
        //                ItmCode: ItmCode, AssAmount: AssAmount, ItmTmplt_id: ItmTmplt_id
        //            })
        //        });
        //        for (const item of array) {
        //            $("#HdnTaxOn").val("Item");
        //            $("#TaxCalcItemCode").val(item.ItmCode);
        //            $("#Tax_AssessableValue").val(item.AssAmount);
        //            await OnChangeTaxTmpltDdl(item.ItmTmplt_id);
        //        }
        //    }
        //}
        if (DMenuId == "105108120") {
            var ItmTmplt_id;
            var array = [];
            $("#GRNItmDetailsTbl tbody tr").each(function () {
                let row1 = $(this);
                var AssAmount = row1.find("#TxtGrnValue").val();
                var ItmCode = row1.find("#TxtItemId").val();
                ItmTmplt_id = row1.find("#ItemtaxTmplt").val();
                array.push({
                    ItmCode: ItmCode, AssAmount: AssAmount, ItmTmplt_id: ItmTmplt_id
                })
            });
            for (const item of array) {
                $("#HdnTaxOn").val("Item");
                $("#TaxCalcItemCode").val(item.ItmCode);
                $("#Tax_AssessableValue").val(item.AssAmount);
                await OnChangeTaxTmpltDdl(item.ItmTmplt_id);
            }
        }
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}

function bind_oc_ddl() {
    debugger;
    /*Added by Surbhi on 13/08/2025 for OC HSN Code Application*/
    try {
        $.ajax({
            type: "POST",
            url: "/Common/Common/GetOtherChargeList",
            dataType: "json",
            data: {},
            success: function (data) {
                if (data == 'ErrorPage') {
                    Comn_ErrorPage();
                    return false;
                }
                debugger;
                if (data !== null && data !== "") {
                    var arr = JSON.parse(data);
                    $("#OtherCharge_DDL").empty();
                    var uniqueOptGroupId = "Textddl_" + new Date().getTime();
                  //  $('#OtherCharge_DDL').append(`<optgroup class='def-cursor' id="${uniqueOptGroupId}" label='${$("#span_OtherChargeName").text()}' data-hsn_code='${$("#Hsn").text()}'></optgroup>`);
                    $('#OtherCharge_DDL').append(`<optgroup class='def-cursor' id="${uniqueOptGroupId}" label='${$("#span_OtherChargeName").text()}' data-hsn_code="1234"></optgroup>`);
                    var a = $("#Hsn").text();
                    const hsnCode = $('#OtherCharge_DDL optgroup').data('hsn_code');
                    console.log(hsnCode);
                    // Step 1: Get existing OC_IDs from table
                    var existingOCIds = [];
                    $("#Tbl_OC_Deatils > tbody > tr").each(function () {
                        var ocId = $(this).find("#OCValue").text().trim();
                        if (ocId) existingOCIds.push(ocId);
                    });
                    // Step 2: Only append options NOT already present in table
                    for (var i = 0; i < arr.Table.length; i++) {
                        var ocId = arr.Table[i].oc_id.toString();
                        if (!existingOCIds.includes(ocId)) {
                            $('#' + uniqueOptGroupId).append(`<option data-hsn_code="${arr.Table[i].HSN_code}" value="${ocId}">${arr.Table[i].oc_name}</option>`);
                        }
                    }
                    // Step 3: Rebind Select2
                    $('#OtherCharge_DDL').select2({
                        templateResult: function (option) {
                            if (!option.id) return option.text;
                            var hsnCode = $(option.element).data('hsn_code');
                            var classAttr = $(option.element).attr('class') || '';
                            return $(
                                `<div class="row">
                            <div class="col-md-6 col-xs-6${classAttr}">${option.text}</div>
                            <div class="col-md-6 col-xs-6${classAttr}">${hsnCode || ''}</div>
                        </div>`
                            );
                        }
                    });
                    // Reset dropdown to default
                    $('#OtherCharge_DDL').val("0").trigger('change');
                    $("#SpanOCName").text("");
                    $('[aria-labelledby="select2-OtherCharge_DDL-container"]').css("border-color", "#ced4da");
                }
            },
            error: function (err) {
                console.error(err);
            }
        });
    } catch (err) {
        ToAddJsErrorLogs(err);
    }
}

function ResetOCDetail() {
    try {

        $("#TxtOCAmt").val("");
        $("#TxtOCAmtInBs").val("");
        //$("#OtherCharge_DDL option[value=" + $('#OtherCharge_DDL').val() + "]").hide();
        //$('#OtherCharge_DDL').val("0").prop('selected', true);
        /*Added by Surbhi on 13/08/2025 for OC HSN Code Application*/
        $('#OtherCharge_DDL').attr("onchange", "");
        $('#OtherCharge_DDL').val("0").trigger("change");
        bind_oc_ddl();
        // $('#OtherCharge_DDL').attr("onchange", "OnChangeOC()");
        setTimeout(function () {
            $('#OtherCharge_DDL').attr("onchange", "OnChangeOC()");
        }, 100);
        $('#OcThirdPartySupp_DDL').attr("onchange", "");
        $('#OcThirdPartySupp_DDL').val("0").trigger("change");
        $('#OcThirdPartySupp_DDL').attr("onchange", "onChangeOCSuppler()");
        //Added by Suraj on 08-04-2024
        $("#OC_BillNumber").val("");
        $("#OC_BillDate").val("");
        //Added by Suraj on 08-04-2024 End
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}
function OnChangeOC() {
    try {
        var DmenuId = $("#DocumentMenuId").val();//Add by shubham Maurya on 10-09-2025 
        if ($('#OtherCharge_DDL').val() == "0") {
            $('#SpanOCName').text($("#valueReq").text());
            $("#SpanOCName").css("display", "block");
            $("#OtherCharge_DDL").css("border-color", "red");
            $('[aria-labelledby="select2-OtherCharge_DDL-container"]').css("border-color", "red");
        }
        else {
            var Oc_id = $('#OtherCharge_DDL').val();
            $("#SpanOCName").css("display", "none");
            $("#OtherCharge_DDL").css("border-color", "#ced4da");
            $('[aria-labelledby="select2-OtherCharge_DDL-container"]').css("border-color", "#ced4da");

            $("#SpanOcThirdPartySupp").css("display", "none");
            $("#OcThirdPartySupp_DDL").css("border-color", "#ced4da");
            $('[aria-labelledby="select2-OcThirdPartySupp_DDL-container"]').css("border-color", "#ced4da");

            $.ajax({
                type: "POST",
                url: "/Common/Common/GetOCTaxTmpltDT",
                data: {
                    OC_id: Oc_id
                },
                success: function (data) {

                    if (data == 'ErrorPage') {
                        Comn_ErrorPage();
                        return false;
                    }
                    let SuppList = [];
                    SuppList.push({ id: "0", text: "---Select---" });
                    if (data !== null && data !== "") {
                        var arr = [];
                        arr = JSON.parse(data);
                        if (arr.Table.length > 0) {
                            $("#hd_tax_id").val(arr.Table[0].tax_tmplt);
                            $("#hdn_oc_acc_id").val(arr.Table[0].oc_acc_id);
                            $("#HdnTaxOn").val("OC");
                            //$("#hdn_oc_type").val(arr.Table[0].oc_type);
                            //Cmn_ResetThirdPartyFields(arr.Table[0].oc_type);
                            //if (arr.Table[0].oc_type == "T") {

                            let OCCurrency = $("#OCCurrency").val();

                            //Cmn_GetOC_ThirdParty(Oc_id, OCCurrency)
                            //    .then((res) => {
                            //        CmnBindTPOCSupp(res);
                            //    });
                            //} else {
                            //CmnBindTPOCSupp(SuppList);
                            //let DMenuId = $("#DocumentMenuId").val();
                            //if (DMenuId == "105102115101") {
                            //    let CurrId = $("#CurrId").val();
                            //    $("#OCCurrency").val(CurrId).trigger('change').attr("disabled", true);
                            //}
                            //}
                            if (DmenuId == "105102150"|| DmenuId == "105102150") {//Add by shubham Maurya on 10-09-2025 "105102150"
                                OCCurrency = $("#hdn_curr_id").val();
                            }
                            Cmn_GetOC_ThirdParty(Oc_id, OCCurrency)
                                .then((res) => {
                                    CmnBindTPOCSupp(res);
                                });
                            //OnChangeTaxTmpltDdl(arr.Table[0].tax_tmplt)
                            //$("#conv_rate").val(arr.Table[0].conv_rate);
                            //$("#conv_rate").val(parseFloat(arr.Table[0].conv_rate).toFixed(RateDecDigit));

                        } else {
                            //Cmn_ResetThirdPartyFields("");
                            //$("#hdn_oc_type").val("");
                            CmnBindTPOCSupp(SuppList);
                        }
                    } else {
                        //Cmn_ResetThirdPartyFields("");
                        //$("#hdn_oc_type").val("");
                        CmnBindTPOCSupp(SuppList);
                    }
                },
            })
        }
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}
function Cmn_OnChangeOcThirdPartyToggle() {
    var tp = "";
    if ($("#OC_ThirdParty").is(":checked")) {
        tp = "T";
    }
    $("#hdn_oc_type").val(tp);
    Cmn_ResetThirdPartyFields(tp);
    $("#SpanOC_BillNumber").css("display", "none");
    $("#SpanOC_BillNumber").css("border-color", "#ced4da");
    $('#OC_BillNumber').css("border-color", "#ced4da");

    $("#SpanOC_BillDate").css("display", "none");
    $("#SpanOC_BillDate").css("border-color", "#ced4da");
    $('#OC_BillDate').css("border-color", "#ced4da");

    $("#SpanOcThirdPartySupp").css("display", "none");
    $("#OcThirdPartySupp_DDL").css("border-color", "#ced4da");
    $('[aria-labelledby="select2-OcThirdPartySupp_DDL-container"]').css("border-color", "#ced4da");

    /*Added by Surbhi on 01/06/2025 for Supplementary Purchase Invoice(105101147)*/
    // Set OC_BillDate range to 10 years from today if type is T
    if (tp === "T") {
        //var futureDate = new Date();
        //futureDate.setFullYear(futureDate.getFullYear() + 10);
        //var maxDate = futureDate.toISOString().split('T')[0];
        let maxDate = new Date().toISOString().slice(0, 10);
        var pastDate = new Date();
        pastDate.setFullYear(pastDate.getFullYear() - 10); // 10 years back
        var minDate = pastDate.toISOString().split('T')[0];
        $('#OC_BillDate').attr('min', minDate);
        $('#OC_BillDate').attr('max', maxDate);
    } else {
        // Clear date constraints if not T
        $('#OC_BillDate').removeAttr('min');
        $('#OC_BillDate').removeAttr('max');
    }
}
function Cmn_ResetThirdPartyFields(thirdParty) {
    var docMenuId = $("#DocumentMenuId").val();
    if (thirdParty == "T") {
        $("#OcThirdPartySupp_DDL").attr("disabled", false);
        $("#OCCurrency").attr("disabled", false);
        $("#OC_BillNumber").attr("disabled", false);
        $("#OC_BillDate").attr("disabled", false);
        $("#suppStar,#billNoStar,#billDtStar").css("display", "");
    } else {
        if (docMenuId == "105102115101") {
            let CurrId = $("#CurrId").val();
            $("#OCCurrency").val(CurrId).trigger('change').attr("disabled", true);
        }

        $("#OcThirdPartySupp_DDL").attr("onchange", "");
        $("#OcThirdPartySupp_DDL").val(0).trigger('change').attr("disabled", true);
        $("#OcThirdPartySupp_DDL").attr("onchange", "onChangeOCSuppler()");
        $("#OCCurrency").attr("disabled", true);
        $("#OC_BillNumber").val('').attr("disabled", true);
        $("#OC_BillDate").val('').attr("disabled", true);
        $("#suppStar,#billNoStar,#billDtStar").css("display", "none");
    }
}
function OnChangeOCAmount() {
    try {


        if (AvoidDot($('#TxtOCAmt').val()) == false) {
            $('#TxtOCAmt').val("");
        }
        var docMenuId = $("#DocumentMenuId").val();
        if (docMenuId == "105101150" || docMenuId == "105101152" || docMenuId == "105101145" || docMenuId == "105102115101"
            || docMenuId == "105101154") {
            BaseSpecOCConv();
        } else {
            var txtocamt = $('#TxtOCAmt').val();
            if ($('#TxtOCAmt').val() == "0" || $('#TxtOCAmt').val() == "" || txtocamt <= 0) {
                $('#SpanOCAmt').text($("#valueReq").text());
                $("#SpanOCAmt").css("display", "block");
                $("#TxtOCAmt").css("border-color", "red");
                return false;
            }
            else {
                $("#SpanOCAmt").css("display", "none");
                $("#TxtOCAmt").css("border-color", "#ced4da");
                BaseSpecOCConv();
            }
        }

    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}

function AddOCDetail() {
    try {
        debugger;
        var rowIdx = 0;
        var DMenuId = $("#DocumentMenuId").val();
        var ValidInfo = "N";
        var Hdn_GstApplicable = $("#Hdn_GstApplicable").text();/*Added by Surbhi on 13/08/2025 for OC HSN Code Application*/
        if ($('#OtherCharge_DDL').val() == "0") {
            ValidInfo = "Y";
            $('#SpanOCName').text($("#valueReq").text());
            $("#SpanOCName").css("display", "block");
            $("#OtherCharge_DDL").css("border-color", "red");
            $('[aria-labelledby="select2-OtherCharge_DDL-container"]').css("border-color", "red");
        } else {
            $("#SpanOCName").css("display", "none");
            $("#OtherCharge_DDL").css("border-color", "#ced4da");
            $('[aria-labelledby="select2-OtherCharge_DDL-container"]').css("border-color", "#ced4da");
        }
        if (DMenuId == "105102115101" || DMenuId == "105101152" || DMenuId == "105103140" || DMenuId == "105103148" || DMenuId == "105101150" || DMenuId == "105103145125"
            || DMenuId == "105103147" || DMenuId == "105108120" || DMenuId == "105108123" || DMenuId == "105101154" || DMenuId == "105101147" || DMenuId == "105103149"
            || DMenuId == "105101153") {
            /*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
            /*Add BY shubham Maurya on 02-06-2025 add 105103149*/
            /*Add 105103148 By Hina on 31-07-2024 for scrap sale invoice*/
            /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
            if ($("#hdn_oc_type").val() == "T") {
                if ($('#OcThirdPartySupp_DDL').val() == "0") {
                    ValidInfo = "Y";
                    $('#SpanOcThirdPartySupp').text($("#valueReq").text());
                    $("#SpanOcThirdPartySupp").css("display", "block");
                    $("#OcThirdPartySupp_DDL").css("border-color", "red");
                    $('[aria-labelledby="select2-OcThirdPartySupp_DDL-container"]').css("border-color", "red");
                } else {
                    $("#SpanOcThirdPartySupp").css("display", "none");
                    $("#OcThirdPartySupp_DDL").css("border-color", "#ced4da");
                    $('[aria-labelledby="select2-OcThirdPartySupp_DDL-container"]').css("border-color", "#ced4da");
                }
                if (Cmn_OcBillNoChange() == "Y") {
                    ValidInfo = "Y";
                }
                if (Cmn_OcBillDateChange() == "Y") {
                    ValidInfo = "Y";
                }
            }
        }
        var taxocamount = parseFloat($('#TxtOCAmt').val());
        if ($('#TxtOCAmt').val() == "0" || $('#TxtOCAmt').val() == "" || taxocamount == 0) {
            ValidInfo = "Y";
            $('#SpanOCAmt').text($("#valueReq").text());
            $("#SpanOCAmt").css("display", "block");
            $("#TxtOCAmt").css("border-color", "red");
        } else {
            $("#SpanOCAmt").css("display", "none");
            $("#TxtOCAmt").css("border-color", "#ced4da");
        }
        if (ValidInfo == "Y") {
            return false;
        }
        let OcCurrName = $("#OCCurrency").val();
        let OcSupp_Id = $("#OcThirdPartySupp_DDL").val();
        let OcSupp_Name = $("#OcThirdPartySupp_DDL option:selected").text();
        let OcCurrId = "";
        let OcBillNo = "";
        let OcBillDate = "";
        let OcBillDtHdn = "";
        var CurrencyInBase = $("#CurrencyInBase").val();
        var supp_type = "";
        var oc_acc_id = "";
        var oc_supp_acc_id = "";
        var oc_supp_state_id = "";
        if (DMenuId == "105102115101" || DMenuId == "105101152" || DMenuId == "105103140" || DMenuId == "105103148" || DMenuId == "105101150" || DMenuId == "105103145125" ||
            DMenuId == "105103147" || DMenuId == "105108120" || DMenuId == "105108123" || DMenuId == "105101154" || DMenuId == "105101147" || DMenuId == "105103149" ||
            DMenuId == "105101153") {
            /*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
            /*Add BY shubham Maurya on 02-06-2025 add 105103149*/
            /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
            OcCurrName = $("#OCCurrency option:selected").text();
            OcCurrId = $("#OCCurrency option:selected").val();
            var hdbs_curr = $("#hdbs_curr").val();
            var hdcurr = $("#OCCurrency").val();
            if (hdbs_curr == hdcurr) {
                CurrencyInBase = "Y";
            } else {
                CurrencyInBase = "N";
            }
            //Added by Suraj on 08-04-2024 : OcBillNo, OcBillDate
            //OcBillNo = $("#OC_BillNumber").val();
            //OcBillDate = $("#OC_BillDate").val();
            //OcBillDtHdn = moment(OcBillDate).format('DD-MM-YYYY');
            OcBillNo = $("#OC_BillNumber").val();
            OcBillDtHdn = $("#OC_BillDate").val();
            if (OcBillDtHdn == "") {
                OcBillDate = "";
            }
            else {
                OcBillDate = moment(OcBillDtHdn).format('DD-MM-YYYY');
            }
            supp_type = $("#hdn_supp_type").val();
            oc_acc_id = $("#hdn_oc_acc_id").val();
            oc_supp_acc_id = $("#hdn_oc_supp_acc_id").val();
            oc_supp_state_id = $("#hdn_oc_supp_state_id").val();

        }
        if (DMenuId == "105102150" || DMenuId == "105103142") {//Add by shubham Maurya on 10-09-2025,12-09-2025 "105102150,105103142"
            oc_acc_id = $("#hdn_oc_acc_id").val();
        }
        if (oc_supp_state_id == "") {
            oc_supp_state_id = $("#Ship_StateCode").val();
        }
        debugger;
        var oc_id = $('#OtherCharge_DDL option:selected').val();
        /*Added by Surbhi on 08/04/2025 for Supplementary Purchase Invoice(105101147)*/
        /*Added $("#OtherCharge_DDL option:selected").data("hsn_code") by Surbhi on 13/08/2025 for OC HSN Code Application*/
        if (DMenuId == "105101147") {
            ODTableDataBind(++rowIdx, $('#OtherCharge_DDL option:selected').text(), OcCurrName, $("#OCconv_rate").val()
                , oc_id, $('#TxtOCAmt').val(), $('#TxtOCAmtInBs').val(), "", $('#TxtOCAmtInBs').val(), OcCurrId
                , OcSupp_Id, OcSupp_Name, OcBillNo, OcBillDate, OcBillDtHdn, supp_type, oc_acc_id, oc_supp_acc_id, "", "", "", "R", $("#OtherCharge_DDL option:selected").data("hsn_code"), oc_supp_state_id);
        } else {
            ODTableDataBind(++rowIdx, $('#OtherCharge_DDL option:selected').text(), OcCurrName, $("#OCconv_rate").val()
                , oc_id, $('#TxtOCAmt').val(), $('#TxtOCAmtInBs').val(), "", $('#TxtOCAmtInBs').val(), OcCurrId
                , OcSupp_Id, OcSupp_Name, OcBillNo, OcBillDate, OcBillDtHdn, supp_type, oc_acc_id, oc_supp_acc_id, "", "", "", "", $("#OtherCharge_DDL option:selected").data("hsn_code"), oc_supp_state_id);
        }
        if ((DMenuId == "105103125" || DMenuId == "105103120" /*Add 105103125 for SQ by Hina on 22-05-2025*/ || DMenuId == "105101130" /*Add 105101130 for PO by Hina on 09-07-2025*/
            || DMenuId == "105103140" || DMenuId == "105103148" || DMenuId == "105101145" || DMenuId == "105101152" || DMenuId == "105101150" || DMenuId == "105103147" ||
            DMenuId == "105108123" || DMenuId == "105102115101" || DMenuId == "105103148" || DMenuId == "105103145125" || DMenuId == "105108120" || DMenuId == "105101154" ||
            DMenuId == "105101147" || DMenuId == "105103149" || DMenuId == "105101153" || DMenuId == "105102150" || DMenuId == "105103142"/*|| DMenuId == "105103145125" || DMenuId == "105103145110"*//*Commented by Suraj on 07-12-2022*/) && CurrencyInBase == "Y") {//Add by shubham Maurya on 10-09-2025 "105102150"
            /*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
            /*Add BY shubham Maurya on 02-06-2025 add 105103149*/
            /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
            if (CurrencyInBase == "Y") {
                $("#HdnTaxOn").val("OC");
                $("#Tax_AssessableValue").val($('#TxtOCAmt').val());
                $("#TaxCalcItemCode").val(oc_id);
                $("#Tax_Template").val(0);
                if (DMenuId == "105108120") {
                    $("#taxTemplate").text("Template");
                }
                //OnChangeTaxTmpltDdl("");
                /*Added by Surbhi on 13/08/2025 for OC HSN Code Application*/
                if (Hdn_GstApplicable == "Y") {
                    Cmn_OCHSNTaxes(oc_id, "ADD");
                }
                else if (Hdn_GstApplicable == "N") {
                    OnChangeTaxTmpltDdl("");
                    //OnChangeTaxTmpltDdl("");
                }
            } else {
                if (DMenuId == "105102115101" || DMenuId == "105101152" || DMenuId == "105103140" || DMenuId == "105103148" || DMenuId == "105101150" || DMenuId == "105103145125" ||
                    DMenuId == "105103147" || DMenuId == "105108120" || DMenuId == "105101154" || DMenuId == "105101147" || DMenuId == "105103149" || DMenuId == "105101153") {
                    /*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
                    /*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                    /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
                    $("#Tbl_OC_Deatils > tbody > tr #OCValue:contains(" + oc_id + ")").closest("tr").find("#OCTaxBtnCal").attr("disabled", true);
                } else {
                    $("#Tbl_OC_Deatils > tbody > tr #OCTaxBtnCal").attr("disabled", true);
                }
            }
        } else {
            if (DMenuId == "105102115101" || DMenuId == "105101152" || DMenuId == "105103140" || DMenuId == "105103148" || DMenuId == "105101150" || DMenuId == "105103145125" ||
                DMenuId == "105103147" || DMenuId == "105108120" || DMenuId == "105101154" || DMenuId == "105101147" || DMenuId == "105103149") {/*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
                $("#Tbl_OC_Deatils > tbody > tr #OCValue:contains(" + oc_id + ")").closest("tr").find("#OCTaxBtnCal").attr("disabled", true);
            } else {
                $("#Tbl_OC_Deatils > tbody > tr #OCTaxBtnCal").attr("disabled", true);
            }
        }
        Calculate_OCAmount();
        ResetOCDetail();
    }
    catch (ex) {
        ToAddJsErrorLogs(ex);
    }

}
function Cmn_OcBillNoChange() {
    let ValidInfo = "N";
    if ($('#OC_BillNumber').val() == "") {
        ValidInfo = "Y";
        $('#SpanOC_BillNumber').text($("#valueReq").text());
        $("#SpanOC_BillNumber").css("display", "block");
        $("#OC_BillNumber").css("border-color", "red");
    } else {
        $("#SpanOC_BillNumber").css("display", "none");
        $("#SpanOC_BillNumber").css("border-color", "#ced4da");
        $('#OC_BillNumber').css("border-color", "#ced4da");
    }
    return ValidInfo;
}
function Cmn_OcBillDateChange() {
    let ValidInfo = "N";
    if ($('#OC_BillDate').val() == "") {
        ValidInfo = "Y";
        $('#SpanOC_BillDate').text($("#valueReq").text());
        $("#SpanOC_BillDate").css("display", "block");
        $("#OC_BillDate").css("border-color", "red");
    } else {
        $("#SpanOC_BillDate").css("display", "none");
        $("#SpanOC_BillDate").css("border-color", "#ced4da");
        $('#OC_BillDate').css("border-color", "#ced4da");
    }
    /*Added by Surbhi on 31/05/2025 Sets the date range for all document-related date fields. The range spans from 10 years prior to today's date to 10 years after today's date.*/
    let minDateStr = new Date(new Date().setFullYear(new Date().getFullYear() - 10)).toISOString().slice(0, 10);
    let maxDateStr = new Date().toISOString().slice(0, 10);
    const minDate = new Date(minDateStr + "T00:00:00");
    const maxDate = new Date(maxDateStr + "T00:00:00");
    const input = document.getElementById('OC_BillDate');
    const value = input.value;
    const enteredDate = new Date(value + "T00:00:00");
    if (enteredDate < minDate || enteredDate > maxDate) {
        $('#SpanOC_BillDate').text($("#JC_InvalidDate").text());
        $("#SpanOC_BillDate").css("display", "block");
        $("#OC_BillDate").css("border-color", "Red");
        ValidInfo = "Y";
    }
    return ValidInfo;
}
//function AddOCDetailWithSupp() {
//    try {
//        var rowIdx = 0;
//        
//       //var DecDigit = $("#ValDigit").text();
//        var DMenuId = $("#DocumentMenuId").val();
//        var ValidInfo = "N";
//        if ($('#OtherCharge_DDL').val() == "0") {
//            ValidInfo = "Y";
//            $('#SpanOCName').text($("#valueReq").text());
//            $("#SpanOCName").css("display", "block");
//            $("#OtherCharge_DDL").css("border-color", "red");
//        } else {
//            $("#SpanOCName").css("display", "none");
//            $("#OtherCharge_DDL").css("border-color", "#ced4da");
//        }
//        if (DMenuId == "105102115101") {
//            if ($("#hdn_oc_type").val() == "T") {
//                if ($('#OcThirdPartySupp_DDL').val() == "0") {
//                    ValidInfo = "Y";
//                    $('#SpanOcThirdPartySupp').text($("#valueReq").text());
//                    $("#SpanOcThirdPartySupp").css("display", "block");
//                    $("#OcThirdPartySupp_DDL").css("border-color", "red");
//                    $('[aria-labelledby="select2-OcThirdPartySupp_DDL-container"]').css("border-color", "red");
//                } else {
//                    $("#SpanOcThirdPartySupp").css("display", "none");
//                    $("#OcThirdPartySupp_DDL").css("border-color", "#ced4da");
//                    $('[aria-labelledby="select2-OcThirdPartySupp_DDL-container"]').css("border-color", "#ced4da");
//                }
//            }
//        }


//        var taxocamount = parseFloat($('#TxtOCAmt').val());
//        if ($('#TxtOCAmt').val() == "0" || $('#TxtOCAmt').val() == "" || taxocamount == 0) {
//            ValidInfo = "Y";
//            $('#SpanOCAmt').text($("#valueReq").text());
//            $("#SpanOCAmt").css("display", "block");
//            $("#TxtOCAmt").css("border-color", "red");
//        } else {
//            $("#SpanOCAmt").css("display", "none");
//            $("#TxtOCAmt").css("border-color", "#ced4da");
//        }
//        if (ValidInfo == "Y") {
//            return false;
//        }

//        let OcCurrName = $("#OCCurrency").val();
//        let OcSupp_Id = $("#OcThirdPartySupp_DDL").val();
//        let OcSupp_Name = $("#OcThirdPartySupp_DDL option:selected").text();
//        let OcCurrId = "";
//        var CurrencyInBase = $("#CurrencyInBase").val();
//        if (DMenuId == "105102115101") {
//            OcCurrName = $("#OCCurrency option:selected").text();
//            OcCurrId = $("#OCCurrency option:selected").val();
//            var hdbs_curr = $("#hdbs_curr").val();
//            var hdcurr = $("#OCCurrency").val();
//            if (hdbs_curr == hdcurr) {
//                CurrencyInBase = "Y";
//            } else {
//                CurrencyInBase = "N";
//            }
//        }
//        var oc_id = $('#OtherCharge_DDL option:selected').val();
//        ODTableDataBind(++rowIdx, $('#OtherCharge_DDL option:selected').text(), OcCurrName, $("#OCconv_rate").val()
//            , oc_id, $('#TxtOCAmt').val(), $('#TxtOCAmtInBs').val(), "", $('#TxtOCAmtInBs').val(), OcCurrId, OcSupp_Id, OcSupp_Name);


//        if ((DMenuId == "105103125" || DMenuId == "105103140" || DMenuId == "105101145" || DMenuId == "105101152" || DMenuId == "105101150" || DMenuId == "105103147" || DMenuId == "105108123" || DMenuId == "105102115101" || DMenuId == "105103148" /*|| DMenuId == "105103145125" || DMenuId == "105103145110"*//*Commented by Suraj on 07-12-2022*/) && CurrencyInBase == "Y") {

//            if (CurrencyInBase == "Y") {
//                $("#HdnTaxOn").val("OC");
//                $("#Tax_AssessableValue").val($('#TxtOCAmt').val());
//                $("#TaxCalcItemCode").val(oc_id);
//                $("#Tax_Template").val(0);
//                OnChangeTaxTmpltDdl("");
//            } else {
//                if (DMenuId == "105102115101") {
//                    $("#Tbl_OC_Deatils > tbody > tr #OCValue:contains(" + oc_id + ")").closest("tr").find("#OCTaxBtnCal").attr("disabled", true);
//                } else {
//                    $("#Tbl_OC_Deatils > tbody > tr #OCTaxBtnCal").attr("disabled", true);
//                }
//            }
//        } else {
//            if (DMenuId == "105102115101") {
//                $("#Tbl_OC_Deatils > tbody > tr #OCValue:contains(" + oc_id + ")").closest("tr").find("#OCTaxBtnCal").attr("disabled", true);
//            } else {
//                $("#Tbl_OC_Deatils > tbody > tr #OCTaxBtnCal").attr("disabled", true);
//            }
//        }
//        Calculate_OCAmount();
//        ResetOCDetail();
//    }
//    catch (ex) {
//        ToAddJsErrorLogs(ex);
//    }

//}
function onChangeOCSuppler() {
    try {
        //if ($("#hdn_oc_type").val() == "T") {
        if ($('#OcThirdPartySupp_DDL').val() == "0") {
            ValidInfo = "Y";
            $('#SpanOcThirdPartySupp').text($("#valueReq").text());
            $("#SpanOcThirdPartySupp").css("display", "block");
            $("#OcThirdPartySupp_DDL").css("border-color", "red");
            $('[aria-labelledby="select2-OcThirdPartySupp_DDL-container"]').css("border-color", "red");
            //$("#hdn_oc_type").val("");
        } else {
            debugger;
            $("#SpanOcThirdPartySupp").css("display", "none");
            $("#OcThirdPartySupp_DDL").css("border-color", "#ced4da");
            $('[aria-labelledby="select2-OcThirdPartySupp_DDL-container"]').css("border-color", "#ced4da");
            let supp_type = $("#OcThirdPartySupp_DDL option:selected").data().data.acc_type;
            let supp_acc_id = $("#OcThirdPartySupp_DDL option:selected").data().data.supp_acc_id;
            let supp_state_id = $("#OcThirdPartySupp_DDL option:selected").data().data.supp_state_id;

            $("#hdn_supp_type").val(supp_type);
            $("#hdn_oc_supp_acc_id").val(supp_acc_id);
            $("#hdn_oc_supp_state_id").val(supp_state_id);

            if (supp_type == "7") {//Added by Suraj maurya on 13-12-2024 this column length is mapped with ins_no in bank Payment
                $("#OC_BillNumber").attr("maxlength", "20");
            } else {
                $("#OC_BillNumber").attr("maxlength", "25");
            }

            //$("#hdn_oc_type").val("T");
        }
        //} else {
        //    $("#SpanOcThirdPartySupp").css("display", "none");
        //    $("#OcThirdPartySupp_DDL").css("border-color", "#ced4da");
        //    $('[aria-labelledby="select2-OcThirdPartySupp_DDL-container"]').css("border-color", "#ced4da");
        //}
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}
function ODTableDataBind(rowIdx, OCName, OCCurr, OCConv, OCValue, OCAmountsp, OcAmtBs, OCTaxAmt, OCTaxTotalAmt
    , OCCurrId, OcSupp_Id, OcSupp_Name, OcBillNo, OcBillDt, OcBillDtHdn, oc_supp_type, OCAccId, OCSuppAccId, OC_TDSAmt, Oc_RoundOff, Oc_Pm_flag, OC_For, OC_HSNCode, OCSuppStateCode) {
    var DocumentMenuId = $("#DocumentMenuId").val();
    let ShowRoundOff = ("105101150,105101145,105101152,105108123,105103148,105103147,105103140,105101140125,105101154,105101147,105103149,105101153").split(",").includes(DocumentMenuId);
    /*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
    /*Add BY shubham Maurya on 02-06-2025 add 105103149*/
    /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
    //if (DocumentMenuId == "105103145110" || DocumentMenuId == "105103145105" || DocumentMenuId == "105103145125") {
    //    //var DecDigit = $("#ExpImpValDigit").text();
    //    //var RateDigit = $("#ExpImpRateDigit").text();
    //    var RateDigit = $("#ExchDigit").text();
    //}
    //else {
    //   //var DecDigit = $("#ValDigit").text();
    //    var RateDigit = $("#RateDigit").text();
    //}
    if (DocumentMenuId == "105103145125") {
        OcAmtBs = getvalwithoutroundoff(OcAmtBs, cmn_ValDecDigit);
    }
    var deletetext = $("#Span_Delete_Title").text();
    var tax_info = $("#Span_TaxCalculator_Title").text();
    var tds_info = $("#Span_TdsCalculator_Title").text();
    var tdTax = "";
    var disableRoundOff = "disabled";
    var DMenuId = $("#DocumentMenuId").val();
    var CurrencyInBase = $("#CurrencyInBase").val();
    if (DMenuId == "105102115101" || DMenuId == "105101140125" || DMenuId == "105101145" || DMenuId == "105101152"
        || DMenuId == "105103140" || DMenuId == "105101150" || DMenuId == "105103145125" || DMenuId == "105103147"
        || DMenuId == "105108120" || DMenuId == "105103148" || DMenuId == "105108123" || DMenuId == "105101154" || DMenuId == "105101147"
        || DMenuId == "105103149" || DMenuId == "105101153") {
        /*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
        /*Add 105103148 By Hina on 31-07-2024 for scrap sale invoice*//*Add BY shubham Maurya on 02-06-2025 add 105103149*/
        /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
        var hdbs_curr = $("#hdbs_curr").val();
    }
    var disblForJO = "";
    if (DMenuId == "105108101" /*|| DMenuId == "105103147"*/ /*||  DMenuId == "105103148"*//*|| DMenuId == "105108123"*/) {
        disblForJO = "style=display:none;";
    }
    debugger;
    if (OcSupp_Id != "0" && OcSupp_Id != "" && oc_supp_type == "2") {
        disableRoundOff = "";
    }
    var displaynoneinDomestic = "";
    //var matchDoc = ("105101120,105101130,105101145,105103120,105103125,105103140,105108123").match(DMenuId);
    var matchDoc = ("105101120,105101130,105101136,105101145,105103120,105103125,105102150,105103142").split(",").includes(DMenuId);//Add by shubham Maurya on 10-09-2025 "105102150"
    displaynoneinDomestic = matchDoc ? "style='display:none;'" : "";
    if ((DMenuId == "105103125" || DMenuId == "105103120" /*Add 105103120 for SQ by Hina on 22-05-2025*/ || DMenuId == "105101130" || DMenuId == "105102150" || DMenuId == "105103142" /*Add 105101130 for PO by Hina on 09-07-2025*//*|| DMenuId == "105103140"*/ /*|| DMenuId == "105101152" || DMenuId == "105101150" || DMenuId == "105103147" *//*|| DMenuId == "105108123"*/ /*|| DMenuId == "105103148"*//*|| DMenuId == "105103145110"*//*Commented by Suraj on 07-12-2022*/) && CurrencyInBase == "Y") {//Add by shubham Maurya on 10-09-2025 "105102150"
        tdTax = `<td class="num_right">
                        <div class="col-sm-10 lpo_form" id="OCTaxAmt">${parseFloat(CheckNullNumber(OCTaxAmt)).toFixed(cmn_ValDecDigit)}</div>
                        <div class="col-md-2 col-sm-12" style="padding:0px;"><button type="button" id="OCTaxBtnCal" class="calculator" data-toggle="modal" onclick="OnClickOCTaxCalculationBtn(event)" data-target="#ItemCalculate" data-backdrop="static" data-keyboard="false"><i class="fa fa-calculator" aria-hidden="true" title="${tax_info}"></i></button></div>
                    </td>
                    <td class="num_right" id="OCTotalTaxAmt">${parseFloat(CheckNullNumber(OCTaxTotalAmt)).toFixed(cmn_ValDecDigit)}</td>
                    <td style="width:160px" ${ShowRoundOff ? "" : "hidden"}>
                        <div class="col-lg-12 no-padding spi">
                            <div class="col-lg-4 pl-3">
                                <div class="custom-control custom-switch sample_issue">
                                    <input type="checkbox"  class="custom-control-input margin-switch" ${disableRoundOff} ${Oc_RoundOff == "Y" ? "checked" : ""} onclick="Cmn_OnClickOcRoundOffCheckBox(event)" id="oc_chk_roundoff">
                                    <label class="custom-control-label" for="" style="padding: 3px 0px;"> </label>
                                </div>
                            </div>
                            <div class="col-lg-8 no-padding">
                                <div class="col-md-12 col-sm-12 no-padding">
                                    <div class="col-md-6 col-sm-12 no-padding" id="div_oc_pchkbox">
                                        <i class="fa fa-plus float-left pr-2 pt-1" aria-hidden="true"></i>
                                        <input class="float-left" type="radio" name="oc_p_round${OCValue}" id="oc_p_round"  ${Oc_RoundOff == "Y" ? "" : "disabled"} ${(Oc_RoundOff == "Y" && Oc_Pm_flag == "P") ? "checked" : ""} onchange="Cmn_click_Oc_chkroundoff(event)" value="P" style="height:20px;">
                                    </div>
                                    <div class="col-md-6 col-sm-12 no-padding" id="div_oc_mchkbox">
                                        <i class="fa fa-minus float-left pr-2 pt-1" aria-hidden="true"></i>
                                        <input class="float-left" type="radio" name="oc_p_round${OCValue}" id="oc_m_round" ${Oc_RoundOff == "Y" ? "" : "disabled"} ${(Oc_RoundOff == "Y" && Oc_Pm_flag == "M") ? "checked" : ""} onchange="Cmn_click_Oc_chkroundoff(event)" value="M" style="height:20px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>`;

    }
    else if (DMenuId == "105102115101" || DMenuId == "105101140125" || DMenuId == "105101145" || DMenuId == "105101152" || DMenuId == "105103140" || DMenuId == "105101150" || DMenuId == "105103145125" || DMenuId == "105103147" || DMenuId == "105108120" || DMenuId == "105103148" || DMenuId == "105108123" || DMenuId == "105101154" || DMenuId == "105101147" || DMenuId == "105103149" || DMenuId == "105101153") {
        /*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
        /*Add BY shubham Maurya on 02-06-2025 add 105103149*/
        /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
        let disableTds = "disabled";
        if (OcSupp_Id != "0" && OcSupp_Id != "" && oc_supp_type == "2") {
            disableTds = "";
        }
        var tds_Td = "";
        if (DMenuId == "105101150" || DMenuId == "105101152" || DMenuId == "105101145" || DMenuId == "105103147"//UnComment 105101152 by shubham Maurya on 05-09-2025
            || DMenuId == "105103140" || DMenuId == "105103148" || DMenuId == "105108123" || DMenuId == "105101140125" || DMenuId == "105101154" || DMenuId == "105101147" || DMenuId == "105103149" || DMenuId == "105101153") {
            /*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
            /*doc_id 105101140125 added by Suraj on 06-11-2024*//*Add BY shubham Maurya on 02-06-2025 add 105103149*/
            /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
            tds_Td = `<td class="num_right">
                   <div class="col-sm-10 lpo_form" id="OC_TDSAmt">${parseFloat(CheckNullNumber(OC_TDSAmt)).toFixed(cmn_ValDecDigit)}</div>
                     <div class="col-md-2 col-sm-12" style="padding:0px;">
                        <button type="button" id="OCTaxBtnCal" ${disableTds} ${hdbs_curr == OCCurrId ? "" : "disabled"} class="calculator" data-toggle="modal" onclick="OnClickTP_TDSCalculationBtn(event ${DMenuId == "105101147" ? `, '${OC_For}'` : ''})" data-target="#TDSCalculate" data-backdrop="static" data-keyboard="false"><i class="fa fa-calculator" aria-hidden="true" title="${tds_info}"></i></button>
                    </div>
                </td>`;

        }
        /*Added by Surbhi on 23/05/2025 for Supplementary Purchase Invoice(105101147) '${DMenuId == "105101147" ? `, '${OC_For}'` : ''}'*/
        tdTax = `<td class="num_right">
                    <div class="col-sm-10 lpo_form" id="OCTaxAmt">${parseFloat(CheckNullNumber(OCTaxAmt)).toFixed(cmn_ValDecDigit)}</div>
                     <div class="col-md-2 col-sm-12" style="padding:0px;">
                        <button type="button" id="OCTaxBtnCal"${hdbs_curr == OCCurrId ? "" : "disabled"} class="calculator" data-toggle="modal" onclick="OnClickOCTaxCalculationBtn(event ${DMenuId == "105101147" ? `, '${OC_For}'` : ''})" data-target="#ItemCalculate" data-backdrop="static" data-keyboard="false"><i class="fa fa-calculator" aria-hidden="true" title="${tax_info}"></i></button>
                    </div>
                </td>
                <td class="num_right" id="OCTotalTaxAmt">${parseFloat(CheckNullNumber(OCTaxTotalAmt)).toFixed(cmn_ValDecDigit)}</td>
                <td style="width:160px" ${ShowRoundOff ? "" : "hidden"}>
                    <div class="col-lg-12 no-padding spi">
                        <div class="col-lg-4 pl-3">
                            <div class="custom-control custom-switch sample_issue">
                                <input type="checkbox"  class="custom-control-input margin-switch" ${disableRoundOff} ${Oc_RoundOff == "Y" ? "checked" : ""} onclick="Cmn_OnClickOcRoundOffCheckBox(event)" id="oc_chk_roundoff">
                                <label class="custom-control-label" disabled="" for="" style="padding: 3px 0px;"> </label>
                            </div>
                        </div>
                        <div class="col-lg-8 no-padding">
                            <div class="col-md-12 col-sm-12 no-padding">
                                <div class="col-md-6 col-sm-12 no-padding" id="div_oc_pchkbox">
                                    <i class="fa fa-plus float-left pr-2 pt-1" aria-hidden="true"></i>
                                    <input class="float-left" type="radio" name="oc_p_round${OCValue}" id="oc_p_round"  ${Oc_RoundOff == "Y" ? "" : "disabled"} ${Oc_Pm_flag == "P" ? "checked" : ""} onchange="Cmn_click_Oc_chkroundoff(event)" value="P" style="height:20px;">
                                </div>
                                <div class="col-md-6 col-sm-12 no-padding" id="div_oc_mchkbox">
                                    <i class="fa fa-minus float-left pr-2 pt-1" aria-hidden="true"></i>
                                    <input class="float-left" type="radio" name="oc_p_round${OCValue}" id="oc_m_round" ${Oc_RoundOff == "Y" ? "" : "disabled"} ${Oc_Pm_flag == "M" ? "checked" : ""} onchange="Cmn_click_Oc_chkroundoff(event)" value="M" style="height:20px;">
                                </div>
                                <input id="pm_flagval" name="pmflagval" type="hidden" value="">
                            </div>
                        </div>
                    </div>
                </td>
                `+ tds_Td + `
                <td id="OCBillNo" >${OcBillNo}</td>
                <td id="OCBillDate" >${OcBillDt}</td>
                <td id="OCBillDt" hidden >${OcBillDtHdn}</td>
                <td id="OCFor" hidden>${OC_For}</td>`;


    }

    debugger;
    $('#Tbl_OC_Deatils tbody').append(`<tr id="R${rowIdx}">
<td id="deletetext" class="red center">
            ${OC_For === "P" && DMenuId === "105101147"
            ? `<i class="deleteIcon fa fa-trash" id="OCDelIcon1" aria-hidden="true" style="filter: grayscale(100%); pointer-events: none;"></i>`
            : `<i class="deleteIcon fa fa-trash" id="OCDelIcon" aria-hidden="true" title="${deletetext}" disabled></i>`
        }
        </td>
<td id="OCName" >${OCName}</td>
<td id="OCHSNCode" >${OC_HSNCode}</td>
<td id="OCCurr" class="center" ${disblForJO}>${OCCurr}</td>
<td id="HdnOCCurrId" hidden>${OCCurrId}</td>
<td id="td_OCSuppName" style="display:${(DMenuId == "105102115101" || DMenuId == "105101140125" || DMenuId == "105101145" || DMenuId == "105101152" || DMenuId == "105103140" || DMenuId == "105103148" || DMenuId == "105101150" || DMenuId == "105103145125" || DMenuId == "105103147" || DMenuId == "105108120" || DMenuId == "105108123" || DMenuId == "105101154" || DMenuId == "105101147" || DMenuId == "105103149" || DMenuId == "105101153") ? "" : "none"}">${(OcSupp_Id == "0" || OcSupp_Id == "") ? "" : OcSupp_Name}</td>
/*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
 /*Added by Surbhi on 07/04/2025 for Supplementary Purchase Invoice(105101147)*/
<td id="td_OCSuppID" hidden >${OcSupp_Id}</td>
<td id="td_OCSuppType" hidden >${oc_supp_type}</td>
<td id="OCConv" class="num_right" ${disblForJO}>${parseFloat(OCConv).toFixed(cmn_ExchDecDigit)}</td>
<td hidden="hidden" id="OCValue">${OCValue}</td>
<td class="num_right" id="OCAmount" ${displaynoneinDomestic}>${parseFloat(OCAmountsp).toFixed(cmn_ValDecDigit)}</td>
<td class="num_right" id="OcAmtBs" ${disblForJO}>${parseFloat(OcAmtBs).toFixed(cmn_ValDecDigit)}</td>
  ` + tdTax + `
<td id="OCAccId" hidden >${OCAccId}</td>
<td id="OCSuppAccId" hidden >${OCSuppAccId}</td>
<td id="OCFor" hidden>${OC_For}</td>
<td id="OCSuppStateCode" hidden >${OCSuppStateCode}</td>
</tr>`);
}

function BaseSpecOCConv() {
    //var DecDigit = "";
    var DocumentMenuId = $("#DocumentMenuId").val();
    //if (DocumentMenuId == "105103145110" || DocumentMenuId == "105103145105" || DocumentMenuId == "105103145125") {
    //    DecDigit = $("#ExpImpValDigit").text();
    //}
    //else {
    //    DecDigit = $("#ValDigit").text();
    //}
    var SpecAmt = $('#TxtOCAmt').val();
    var conv_rate = $("#OCconv_rate").val();
    var BaseAmt;
    if (DocumentMenuId == "105103145125") {
        BaseAmt = parseFloat(getvalwithoutroundoff(cmn_getmultival(SpecAmt, conv_rate), cmn_ValDecDigit)).toFixed(cmn_ValDecDigit);
    } else {
        BaseAmt = parseFloat(CheckNullNumber(SpecAmt)) * parseFloat(CheckNullNumber(conv_rate));
    }

    $('#TxtOCAmt').val(parseFloat(CheckNullNumber(SpecAmt)).toFixed(cmn_ValDecDigit));
    $('#TxtOCAmtInBs').val(parseFloat(BaseAmt).toFixed(cmn_ValDecDigit));
}
//------------------------------End------------------------------//
//------------------Tax Amount Calculation------------------//
function Cmn_TaxFloatValuePerOnly(el, evt) {
    if (Cmn_PercentageValueonly(el, evt) == false) {
        return false;
    }
    $("#SpanTaxPercent").css("display", "none");
    return true;
}

function CMNOnClickTaxCalculationBtn(e, ForSno, ItemDDLName) {
    debugger;
    debugger;
    $("#SpanTaxName").css("display", "none");
    $("#Tax_Type").css("border-color", "#ced4da");
    $("#SpanTaxPercent").css("display", "none");
    $("#Tax_Percentage").css("border-color", "#ced4da");
    $("#SpanTaxLevel").css("display", "none");
    $("#Tax_Level").css("border-color", "#ced4da");
    $("#SpanTaxAmounterr").css("display", "none");
    $("#Tax_Amount").css("border-color", "#ced4da");

    //var ValDecDigit = $("#ValDigit").text();
    var clickedrow = $(e.target).closest("tr");
    var Sno = clickedrow.find(ForSno).val();
    var UserID = $("#UserID").text();
    var ItemName = "";
    var ItemID = "";
    var QTNO = "";
    var QTDate = "";
    var AssValue = 0;
    ItemName = clickedrow.find(ItemDDLName + Sno + " option:selected").text()
    ItemID = clickedrow.find(ItemDDLName + Sno).val();
    QTNO = clickedrow.find("#QuotationNumber" + Sno).val();
    QTDate = clickedrow.find("#QuotationDate" + Sno).val();
    AssValue = clickedrow.find("#item_ass_val" + Sno).val();

    var AssAmount = parseFloat(AssValue).toFixed(cmn_ValDecDigit);
    if (AssAmount > 0) {
        $("#BtnTxtCalculation" + Sno).prop("disabled", false);
    } else {
        $("#BtnTxtCalculation" + Sno).prop("disabled", true);
    }
    if (AssAmount == "NaN" || AssAmount == "" || AssAmount == "0" || ItemName == " ---Select---") {
        $("#BtnTxtCalculation").attr("data-target", "");
        return false;
    }
    else {
        $("#BtnTxtCalculation").attr("data-target", "#ItemCalculate");
    }

    $("#Tax_ItemName").val(ItemName);
    $("#Tax_AssessableValue").val(AssAmount);
    $("#ReplicateOnAllItemsBtn").attr("data-dismiss", "modal");
    $("#SaveAndExitBtn").attr("data-dismiss", "modal");
    $("#HiddenRowSNo").val(Sno);
    $("#TaxCalcItemCode").val(ItemID);


    BindTaxList(UserID, Sno, ItemID);

    /* BindTaxTemplatelist();*/
    $("#Tax_Template").val(0);
    HideShowTaxLevel();

    var rowIdx = 0;
    var FTaxDetails = JSON.parse(sessionStorage.getItem("TaxCalcDetails"));
    if (FTaxDetails != null) {
        if (FTaxDetails.length > 0) {
            $("#TaxCalculatorTbl >tbody >tr").remove();
            $('#TotalTaxAmount').text(parseFloat(0).toFixed(cmn_ValDecDigit));
            for (i = 0; i < FTaxDetails.length; i++) {
                var TaxUserID = FTaxDetails[i].UserID;
                var TaxRowID = FTaxDetails[i].RowSNo;
                var TaxTLevel = FTaxDetails[i].TaxLevel;
                var TaxItemID = FTaxDetails[i].TaxItmCode;
                var QTnumber = FTaxDetails[i].QTNo;
                var QTdate = FTaxDetails[i].QTDate;
                var Acc_ID = FTaxDetails[i].Acc_ID;
                var Acc_name = FTaxDetails[i].Acc_name;
                //if (TaxUserID == UserID && TaxRowID == Sno && TaxItemID == ItemID && QTnumber == QTNO && QTdate == QTDate) {
                if (TaxUserID == UserID && TaxItemID == ItemID && QTnumber == QTNO && QTdate == QTDate) {
                    Reset_ReOpen_LevelVal(TaxTLevel);

                    TaxTableDataBind(++rowIdx,
                        FTaxDetails[i].TaxName, FTaxDetails[i].TaxNameID, FTaxDetails[i].TaxPercentage, FTaxDetails[i].TaxLevel,
                        FTaxDetails[i].TaxApplyOn, FTaxDetails[i].TaxAmount, FTaxDetails[i].TaxApplyOnID, FTaxDetails[i].TotalTaxAmount,
                        FTaxDetails[i].Acc_ID, FTaxDetails[i].Acc_name
                    )
                }
            }
        }
        else {
            $("#TaxCalculatorTbl >tbody >tr").remove();
            $('#TotalTaxAmount').text(parseFloat(0).toFixed(cmn_ValDecDigit));
        }
    }
    else {
        $("#TaxCalculatorTbl >tbody >tr").remove();
        $('#TotalTaxAmount').text(parseFloat(0).toFixed(cmn_ValDecDigit));
    }
}
function CMNOnClickTaxCalculationBtn1(e, ForSno, ItemDDLName) {

    $("#SpanTaxName").css("display", "none");
    $("#Tax_Type").css("border-color", "#ced4da");
    $("#SpanTaxPercent").css("display", "none");
    $("#Tax_Percentage").css("border-color", "#ced4da");
    $("#SpanTaxLevel").css("display", "none");
    $("#Tax_Level").css("border-color", "#ced4da");
    $("#SpanTaxAmounterr").css("display", "none");
    $("#Tax_Amount").css("border-color", "#ced4da");
    $("#Tax_Percentage").val("");
    $("#Tax_Amount").val("");
    //var ValDecDigit = $("#ValDigit").text();
    var clickedrow = $(e.target).closest("tr");
    var Sno = clickedrow.find(ForSno).val();
    var UserID = $("#UserID").text();
    var ItemName = "";
    var ItemID = "";
    var QTNO = "";
    var QTDate = "";
    var AssValue = 0;
    ItemName = clickedrow.find(ItemDDLName + Sno + " option:selected").text()
    ItemID = clickedrow.find(ItemDDLName + Sno).val();
    QTNO = clickedrow.find("#QuotationNumber").val();
    QTDate = clickedrow.find("#QuotationDate").val();
    AssValue = clickedrow.find("#item_ass_val").val();

    var AssAmount = parseFloat(AssValue).toFixed(cmn_ValDecDigit);
    if (AssAmount > 0) {
        clickedrow.find("#BtnTxtCalculation").prop("disabled", false);
    } else {
        clickedrow.find("#BtnTxtCalculation").prop("disabled", true);
    }
    if (AssAmount == "NaN" || AssAmount == "" || AssAmount == "0" || ItemName == " ---Select---") {
        clickedrow.find("#BtnTxtCalculation").attr("data-target", "");
        return false;
    }
    else {
        clickedrow.find("#BtnTxtCalculation").attr("data-target", "#ItemCalculate");
    }

    $("#Tax_ItemName").val(ItemName);
    $("#Tax_AssessableValue").val(AssAmount);
    $("#ReplicateOnAllItemsBtn").attr("data-dismiss", "modal");
    $("#SaveAndExitBtn").attr("data-dismiss", "modal");
    $("#HiddenRowSNo").val(Sno);
    $("#TaxCalcItemCode").val(ItemID);


    BindTaxList(UserID, Sno, ItemID);

    var GstApplicable = $("#Hdn_GstApplicable").text();
    if (GstApplicable == "Y") {
        if (clickedrow.find("#ManualGST").is(":checked")) {
            BindTaxSlablist();
        }
        else {
            BindTaxTemplatelist();
        }
    }
    else {
        BindTaxTemplatelist();
    }

    HideShowTaxLevel();

    var rowIdx = 0;
    var FTaxDetails = JSON.parse(sessionStorage.getItem("TaxCalcDetails"));
    if (FTaxDetails != null) {
        if (FTaxDetails.length > 0) {
            $("#TaxCalculatorTbl >tbody >tr").remove();
            $('#TotalTaxAmount').text(parseFloat(0).toFixed(cmn_ValDecDigit));
            for (i = 0; i < FTaxDetails.length; i++) {
                var TaxUserID = FTaxDetails[i].UserID;
                var TaxRowID = FTaxDetails[i].RowSNo;
                var TaxTLevel = FTaxDetails[i].TaxLevel;
                var TaxItemID = FTaxDetails[i].TaxItmCode;
                var QTnumber = FTaxDetails[i].QTNo;
                var QTdate = FTaxDetails[i].QTDate;
                var Acc_ID = FTaxDetails[i].Acc_ID;
                var Acc_name = FTaxDetails[i].Acc_name;
                //if (TaxUserID == UserID && TaxRowID == Sno && TaxItemID == ItemID && QTnumber == QTNO && QTdate == QTDate) {
                if (TaxUserID == UserID && TaxItemID == ItemID && QTnumber == QTNO && QTdate == QTDate) {
                    Reset_ReOpen_LevelVal(TaxTLevel);

                    TaxTableDataBind(++rowIdx,
                        FTaxDetails[i].TaxName, FTaxDetails[i].TaxNameID, FTaxDetails[i].TaxPercentage, FTaxDetails[i].TaxLevel,
                        FTaxDetails[i].TaxApplyOn, FTaxDetails[i].TaxAmount, FTaxDetails[i].TaxApplyOnID, FTaxDetails[i].TotalTaxAmount,
                        FTaxDetails[i].Acc_ID, FTaxDetails[i].Acc_name
                    )

                }
            }
        }
        else {
            $("#TaxCalculatorTbl >tbody >tr").remove();
            $('#TotalTaxAmount').text(parseFloat(0).toFixed(cmn_ValDecDigit));
        }
    }
    else {
        $("#TaxCalculatorTbl >tbody >tr").remove();
        $('#TotalTaxAmount').text(parseFloat(0).toFixed(cmn_ValDecDigit));
    }

}
// Used in Purchase order, Sales Order,job Order
function CMNOnClickTaxCalculationBtnModel(e, ForSno, ItemDDLName) {
    debugger;
    $("#SpanTax_Template").text("");
    $("#SpanTax_Template").css("display", "none");
    $("#SpanTaxName").css("display", "none");
    $("#Tax_Type").css("border-color", "#ced4da");
    $("#SpanTaxPercent").css("display", "none");
    $("#Tax_Percentage").css("border-color", "#ced4da");
    $("#SpanTaxLevel").css("display", "none");
    $("#Tax_Level").css("border-color", "#ced4da");
    $("#SpanTaxAmounterr").css("display", "none");
    $("#Tax_Amount").css("border-color", "#ced4da");
    $("#Tax_Percentage").val("");
    $("#Tax_Amount").val("");
    var DMenuId = $("#DocumentMenuId").val();
    //var ValDecDigit = $("#ValDigit").text();
    //if (DMenuId == "105103145127") {
    //    ValDecDigit = $("#ExpImpValDigit").text();
    //}
    var clickedrow = $(e.target).closest("tr");
    var Sno = clickedrow.find(ForSno).val();
    var UserID = $("#UserID").text();
    var ItemName = "";
    var ItemID = "";
    var DocNo = "";
    var DocDate = "";
    var AssValue = 0;
    var TaxExempted = "N";
    var ForDisableOCDlt = $("#ForDisableOCDlt").val();
    if (DMenuId == "105101145") {
        ForDisableOCDlt = clickedrow.find("#ForDisable").val();
    }
    var GstApplicable = $("#Hdn_GstApplicable").text();
    var matchDocIds = ("105101120,105101130,105101136,105101135,105101145,105103120,105103125,105103140,105103145127,105108101,105101152,105101150,105103147,105108123,105102115101,105103148,105108120,105101154,105103142,105102150,105103149,105101147,105101153,105101125,105103142").match(DMenuId);
    /*Added by Surbhi on 10/09/2025 for Quotation Analysis(105101125)*/
    /*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
    //Modifyed by shubham maurya on 31-03-2025 add 105103142
    /*Added by Surbhi on 27/05/2025 for Supplementary Purchase Invoice(105101147)*/
    if (matchDocIds != null) {
        if (matchDocIds == DMenuId) {
            $("#TaxableAmtLabl").text($("#Span_GrossValue").text());
        }
    } else {
        ForDisableOCDlt = "Disable";
    }
    /*Added by Surbhi on 22/05/2025 for Supplementary Purchase Invoice(105101147)*/
    if (DMenuId == "105101147") {
        if (ForSno != "OCP" && ForSno != "OCR") {
            ForDisableOCDlt = ForDisableOCDlt;
        } else {
            if (ForSno == "OCP") {
                ForDisableOCDlt = "Disable";
            }
            else if (ForSno == "OCR") {
                ForDisableOCDlt = ForDisableOCDlt;/*"Enable";*/
            }
            ForSno = "OC";
        }

    }

    if (DMenuId == "105108123") {
        var flag = "N";
        var mr_no = $("#src_doc_no").val();
        $("#JOInvItmDetailsTbl >tbody >tr").each(function () {
            var currentRow = $(this);
            var srcDoc = currentRow.find("#src_doc_no").val();
            if (mr_no != srcDoc) {
                flag = "Y";
            }
        });
        if ($("#DisableOCDlt").val() == "Disable") {
            ForDisableOCDlt = "Disable";
        }
        else {
            if (flag == "N") {
                ForDisableOCDlt = "Disable";
            }
            else {
                ForDisableOCDlt = "Enable";
            }
        }
    }
    if (ForSno != "OC"/* && DMenuId !="105103120"*/) {
        var GstApplicable = $("#Hdn_GstApplicable").text();
        if (GstApplicable == "Y") {
            ForDisableOCDlt = "Disable";
        }
    }
    if (DMenuId == "105103142" || DMenuId == "105102150") {
        var SRDisable = $("#PageDisable").val();
        if (SRDisable == "Y") {
            ForDisableOCDlt = "Disable"
        }
        else {
            ForDisableOCDlt = "Enable"
        }
    }
    debugger;
    if (ForSno == "OC") {

        $("#taxTemplate").text($("#span_Template").text());
        Sno = "";
        ItemName = clickedrow.find("#OCName").text().trim();
        ItemID = clickedrow.find("#OCValue").text().trim();
        AssValue = clickedrow.find("#OcAmtBs").text().trim();
        var StateCode = clickedrow.find("#OCSuppStateCode").text().trim();
        var SuppCode = clickedrow.find("#td_OCSuppID").text().trim();
        $("#TaxItemNameLabl").text($("#span_OtherChargeName").text());
        $("#TaxableAmtLabl").text($("#span_OtherChargesAmount").text());
        $("#HdnTaxOn").val("OC");
        $("#hdn_oc_supp_state_id_taxcal").val(StateCode);
        $("#hdn_oc_supp_id_taxcal").val(SuppCode);
        $("#SaveAndExitBtn").prop("disabled", false);
    }
    else if (ForSno == "SI") {
        Sno = "";
        ItemName = clickedrow.find(ItemDDLName).val()
        ItemID = clickedrow.find("#hfItemID").val();
        DocNo = clickedrow.find("#TxtShipmentNo").val();
        DocDate = clickedrow.find("#hfShipmentDate").val();
        AssValue = clickedrow.find("#TxtItemGrossValue").val();
        $("#TaxItemNameLabl").text($("#ItemName").text());
        $("#TaxableAmtLabl").text($("#span_AssessableValue").text());
        $("#HdnTaxOn").val("Item");
        if (DMenuId == "105103140") {
            if (GstApplicable == "Y") {
                var TaxBySlab = $("#taxTemplate").text();
                $("#Tax_ItemID").val(ItemID);
                var SlabItem = $("#Tax_ItemID").val()
                //var TaxCalcGRNNo = $("#TaxCalcGRNNo").val()
                var ItmCode = clickedrow.find("#hfItemID").val();
                //var TxtGrnNo = clickedrow.find("#TxtGrnNo").val();
                if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                    if (clickedrow.find("#TaxExempted").is(":checked")) {
                        TaxExempted = "Y";
                    }
                    if (clickedrow.find("#Txtitem_tax_amt").val() == 0) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {
                            TaxExempted = "Y";
                        }
                    }
                }
                else {
                    if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
        if (DMenuId == "105103147") {/*Add by Hina on 02-01-2025 for service sale invoice*/
            SNO = clickedrow.find("#SNohiddenfiled").val();
            ItemName = clickedrow.find(ItemDDLName + SNO + " option:selected").text();

            if (GstApplicable == "Y") {
                var TaxBySlab = $("#taxTemplate").text();
                $("#Tax_ItemID").val(ItemID);
                var SlabItem = $("#Tax_ItemID").val()
                var TaxCalcGRNNo = $("#TaxCalcGRNNo").val()
                var ItmCode = clickedrow.find("#hfItemID").val();
                var TxtGrnNo = clickedrow.find("#TxtGrnNo").val();
                AssValue = clickedrow.find("#TxtItemGrossValue").val();
                if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                    if (clickedrow.find("#TaxExempted").is(":checked")) {
                        TaxExempted = "Y";
                    }
                    if (clickedrow.find("#Txtitem_tax_amt").val() == 0) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {
                            TaxExempted = "Y";
                        }
                    }
                }
                else {
                    if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
        if (DMenuId == "105103148" || DMenuId == "105103149") {/*Add by Hina on 13-01-2025 for scrap/direct sale invoice*/
            SNO = clickedrow.find("#SNohiddenfiled").val();
            ItemName = clickedrow.find(ItemDDLName + SNO + " option:selected").text();

            if (GstApplicable == "Y") {
                var TaxBySlab = $("#taxTemplate").text();
                $("#Tax_ItemID").val(ItemID);
                var SlabItem = $("#Tax_ItemID").val()
                var TaxCalcGRNNo = $("#TaxCalcGRNNo").val()
                var ItmCode = clickedrow.find("#hfItemID").val();
                var TxtGrnNo = clickedrow.find("#TxtGrnNo").val();
                AssValue = clickedrow.find("#TxtItemGrossValue").val();
                if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                    if (clickedrow.find("#TaxExempted").is(":checked")) {
                        TaxExempted = "Y";
                    }
                    if (clickedrow.find("#Txtitem_tax_amt").val() == 0) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {
                            TaxExempted = "Y";
                        }
                    }
                }
                else {
                    if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
    }
    else if (ForSno == "CI") {
        Sno = "";
        ItemName = clickedrow.find(ItemDDLName).val()
        ItemID = clickedrow.find("#hfItemID").val();
        AssValue = clickedrow.find("#TxtAssessableValue").val();
        $("#TaxItemNameLabl").text($("#ItemName").text());
        $("#TaxableAmtLabl").text($("#span_AssessableValue").text());
        $("#HdnTaxOn").val("Item");
        /***Modifyed By Shubham Maurya on 26-10-2023 12:43 for custom invoice***/
        if (DMenuId == "105103145127") {
            if (GstApplicable == "Y") {
                var TaxBySlab = $("#taxTemplate").text();
                $("#Tax_ItemID").val(ItemID);
                var SlabItem = $("#Tax_ItemID").val()
                var ItmCode = clickedrow.find("#hfItemID").val();
                if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                    if (clickedrow.find("#TaxExempted").is(":checked")) {
                        TaxExempted = "Y";
                    }
                    if (clickedrow.find("#Txtitem_tax_amt").val() == 0) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {
                            TaxExempted = "Y";
                        }
                    }
                }
                else {
                    if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
    }
    else if (ForSno == "PI") {
        Sno = "";
        ItemName = clickedrow.find(ItemDDLName).val();
        ItemID = clickedrow.find("#hfItemID").val();
        DocNo = clickedrow.find("#TxtGrnNo").val();
        DocDate = clickedrow.find("#hfGRNDate").val();
        AssValue = clickedrow.find("#TxtItemGrossValueInBase").val();

        $("#TaxItemNameLabl").text($("#ItemName").text());
        $("#TaxableAmtLabl").text($("#span_AssessableValue").text());
        $("#HdnTaxOn").val("Item");
        if (DMenuId == "105101145") {
            if (GstApplicable == "Y") {
                var TaxBySlab = $("#taxTemplate").text();
                $("#Tax_ItemID").val(ItemID);
                var SlabItem = $("#Tax_ItemID").val()
                var TaxCalcGRNNo = $("#TaxCalcGRNNo").val()
                var ItmCode = clickedrow.find("#hfItemID").val();
                var TxtGrnNo = clickedrow.find("#TxtGrnNo").val();
                if (TaxBySlab == "GST Slab" && ItmCode == SlabItem && TxtGrnNo == TaxCalcGRNNo) {
                    if (clickedrow.find("#TaxExempted").is(":checked")) {
                        TaxExempted = "Y";
                    }
                    if (clickedrow.find("#Txtitem_tax_amt").val() == 0) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {
                            TaxExempted = "Y";
                        }
                    }
                }
                else {
                    if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
        if (DMenuId == "105101150") {
            if (GstApplicable == "Y") {
                var TaxBySlab = $("#taxTemplate").text();
                $("#Tax_ItemID").val(ItemID);
                var SlabItem = $("#Tax_ItemID").val()
                var TaxCalcGRNNo = $("#TaxCalcGRNNo").val()
                var ItmCode = clickedrow.find("#hfItemID").val();
                var TxtGrnNo = clickedrow.find("#TxtGrnNo").val();
                AssValue = clickedrow.find("#TxtItemGrossValue").val();
                if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                    if (clickedrow.find("#TaxExempted").is(":checked")) {
                        TaxExempted = "Y";
                    }
                    if (clickedrow.find("#Txtitem_tax_amt").val() == 0) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {
                            TaxExempted = "Y";
                        }
                    }
                }
                else {
                    if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
    }

    else if (DMenuId == "105101147") { /*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
        debugger;
        if (ForSno == "SUPPPI_P") {
            AssValue = clickedrow.find("#TxtItemGrossValueInBasePrev").val();
        }
        else if (ForSno == "SUPPPI_R") {
            //AssValue = clickedrow.find("#TxtItemDiffValue").val();
            AssValue = clickedrow.find("#TxtItemGrossValueInBase").val();
        }
        Sno = "";
        debugger;
        if (ForSno == "SUPPPI_P" || ForSno == "SUPPPI_R") {
            var isRowspanRow = clickedrow.prev().find('td[rowspan]').length > 0;
            if (isRowspanRow) {
                ItemName = clickedrow.prev().find("#TxtItemName").val();
            } else {
                ItemName = clickedrow.find("#TxtItemName").val();
            }
            ItemID = clickedrow.find("#hfItemID").val();
            DocNo = clickedrow.find("#TxtGrnNo").val();
            DocDate = clickedrow.find("#hfGRNDate").val();
            $("#TaxItemNameLabl").text($("#ItemName").text());
            $("#TaxableAmtLabl").text($("#span_AssessableValue").text());
            $("#HdnTaxOn").val("Item");
            if (GstApplicable == "Y") {
                var TaxBySlab = $("#taxTemplate").text();
                $("#Tax_ItemID").val(ItemID);
                var SlabItem = $("#Tax_ItemID").val()
                var TaxCalcGRNNo = $("#TaxCalcGRNNo").val()
                var ItmCode = clickedrow.find("#hfItemID").val();
                var TxtGrnNo = clickedrow.find("#TxtGrnNo").val();
                if (TaxBySlab == "GST Slab" && ItmCode == SlabItem && TxtGrnNo == TaxCalcGRNNo) {
                    if (clickedrow.find("#TaxExempted").is(":checked")) {
                        TaxExempted = "Y";
                    }
                    if (clickedrow.find("#Txtitem_tax_amt").val() == 0) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {
                            TaxExempted = "N";
                        }
                    }
                }
                else {
                    if (clickedrow.find("#TaxExempted").is(":checked")) {// || clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                    if (clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "N";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }

    }
    else if (ForSno == "JI") {
        Sno = "";
        ItemName = clickedrow.find(ItemDDLName).val()
        ItemID = clickedrow.find("#hfItemID").val();
        AssValue = clickedrow.find("#TxtItemGrossValue").val();
        DocNo = clickedrow.find("#src_doc_no").val();
        DocDate = clickedrow.find("#src_doc_dt").val();
        $("#TaxItemNameLabl").text($("#ItemName").text());
        $("#TaxableAmtLabl").text($("#span_AssessableValue").text());
        $("#HdnTaxOn").val("Item");
        if (GstApplicable == "Y") {
            var TaxBySlab = $("#taxTemplate").text();
            $("#Tax_ItemID").val(ItemID);
            var SlabItem = $("#Tax_ItemID").val()
            var TaxCalcGRNNo = $("#TaxCalcGRNNo").val()
            var ItmCode = clickedrow.find("#hfItemID").val();
            var TxtGrnNo = clickedrow.find("#src_doc_no").val();
            if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
                if (clickedrow.find("#Txtitem_tax_amt").val() == 0) {
                    if (clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
        else {
            if (clickedrow.find("#TaxExempted").is(":checked")) {
                TaxExempted = "Y";
            }
        }
    }
    else if (DMenuId == "105101154") {
        Sno = "";
        var RowSNo = clickedrow.find("#SNohiddenfiled").val();
        var ItemName = clickedrow.find("#POItemListName" + RowSNo + " option:selected").text();
        //ItemName = clickedrow.find(ItemDDLName).val();
        ItemID = clickedrow.find("#hfItemID").val();
        AssValue = clickedrow.find("#item_gr_val").val();

        $("#TaxItemNameLabl").text($("#ItemName").text());
        $("#TaxableAmtLabl").text($("#span_AssessableValue").text());
        $("#HdnTaxOn").val("Item");

        if (GstApplicable == "Y") {
            var TaxBySlab = $("#taxTemplate").text();
            $("#Tax_ItemID").val(ItemID);
            var SlabItem = $("#Tax_ItemID").val()
            var ItmCode = clickedrow.find("#hfItemID").val();
            if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
                if (clickedrow.find("#Txtitem_tax_amt").val() == 0) {
                    if (clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
        else {
            if (clickedrow.find("#TaxExempted").is(":checked")) {
                TaxExempted = "Y";
            }
        }
    }
    else if (DMenuId == "105101153") {/*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
        Sno = "";
        var RowSNo = clickedrow.find("#SNohiddenfiled").val();
        //var ItemName = clickedrow.find("#POItemListName" + RowSNo + " option:selected").text();
        var ItemName = currentRow.find("#TxtItemName" + RowSNo).val();
        //ItemName = clickedrow.find(ItemDDLName).val();
        ItemID = clickedrow.find("#hfItemID").val();
        AssValue = clickedrow.find("#item_gr_val").val();
        $("#TaxItemNameLabl").text($("#ItemName").text());
        $("#TaxableAmtLabl").text($("#span_AssessableValue").text());
        $("#HdnTaxOn").val("Item");
    }
    else if (DMenuId == "105108101") {

        ItemName = clickedrow.find(ItemDDLName + Sno + " option:selected").text()
        //ItemName = clickedrow.find(ItemDDLName).val();
        ItemID = clickedrow.find("#hfItemID").val();
        AssValue = clickedrow.find("#item_gr_val").val();
        $("#TaxItemNameLabl").text($("#ItemName").text());
        //$("#TaxableAmtLabl").text($("#span_AssessableValue").text());
        $("#HdnTaxOn").val("Item");
        if (GstApplicable == "Y") {
            var TaxBySlab = $("#taxTemplate").text();
            $("#Tax_ItemID").val(ItemID);
            var SlabItem = $("#Tax_ItemID").val()
            //var TaxCalcGRNNo = $("#TaxCalcGRNNo").val()
            var ItmCode = clickedrow.find("#hfItemID").val();
            //var TxtGrnNo = clickedrow.find("#TxtGrnNo").val();
            if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
                if (clickedrow.find("#item_tax_amt").val() == 0) {
                    if (clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
        else {
            if (clickedrow.find("#TaxExempted").is(":checked")) {
                TaxExempted = "Y";
            }
        }
    }
    else if (DMenuId == "105101152") {

        var TaxBySlab = $("#taxTemplate").text();
        var RowSNo = clickedrow.find("#SNohiddenfiled").val();
        ItemName = clickedrow.find("#TxtItemName_" + RowSNo + " option:selected").text()
        var ItmCode = clickedrow.find("#TxtItemName_" + RowSNo).val();
        if (GstApplicable == "Y") {
            ItemID = clickedrow.find(ItemDDLName + Sno).val();
            $("#Tax_ItemID").val(ItemID);
            var SlabItem = $("#Tax_ItemID").val()
            if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
                if (clickedrow.find("#item_tax_amt").val() == 0) {
                    if (clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
        else {
            $("#Tax_ItemID").val(ItmCode);
            if (clickedrow.find("#TaxExempted").is(":checked")) {
                TaxExempted = "Y";
            }
        }
        //ItemName = clickedrow.find(ItemDDLName + Sno + " option:selected").text()
        //ItemID = clickedrow.find("#hfItemID").val();
        AssValue = clickedrow.find("#item_gr_val").val();
        //$("#TaxItemNameLabl").text($("#ItemName").text());
        //$("#HdnTaxOn").val("Item");
    }
    else if (DMenuId == "105101135") {/*Added By Nitesh 05-06-2024 for Manual Gst And Tax Exempted*/

        ItemName = clickedrow.find(ItemDDLName + Sno + " option:selected").text()
        //ItemName = clickedrow.find(ItemDDLName).val();
        //clickedrow.find(ItemDDLName).val()
        ItemID = clickedrow.find("#hfItemID").val();
        AssValue = clickedrow.find("#item_gr_val").val();
        $("#TaxItemNameLabl").text($("#ItemName").text());
        //$("#TaxableAmtLabl").text($("#span_AssessableValue").text());
        $("#HdnTaxOn").val("Item");
        var RowSNo = clickedrow.find("#SNohiddenfiled").val();
        var ItmCode = clickedrow.find("#ItemListName" + RowSNo).val();
        if (GstApplicable == "Y") {
            ItemID = clickedrow.find(ItemDDLName + Sno).val();
            $("#Tax_ItemID").val(ItemID);
            var SlabItem = $("#Tax_ItemID").val()
            var TaxBySlab = $("#taxTemplate").text();
            if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
                if (clickedrow.find("#item_tax_amt").val() == 0) {
                    if (clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
        else {
            if (clickedrow.find("#TaxExempted").is(":checked")) {
                TaxExempted = "Y";
            }
        }
    }
    else if (DMenuId == "105102115101") {

        ItemName = clickedrow.find("#TxtItemName").val()
        //ItemName = clickedrow.find(ItemDDLName).val();
        //clickedrow.find(ItemDDLName).val()
        ItemID = clickedrow.find("#TxtItemId").val();
        AssValue = clickedrow.find("#TxtGrnValueInBase").val();
        $("#TaxItemNameLabl").text($("#ItemName").text());
        //$("#TaxableAmtLabl").text($("#span_AssessableValue").text());
        $("#HdnTaxOn").val("Item");
    }
    else if (DMenuId == "105108120") {

        ItemName = clickedrow.find("#TxtItemName").val()
        ItemID = clickedrow.find("#TxtItemId").val();
        AssValue = clickedrow.find("#TxtGrnValue").val();
        $("#TaxItemNameLabl").text($("#ItemName").text());
        $("#HdnTaxOn").val("Item");
    }
    else {
        if (DMenuId == "105101120") {
            var TaxBySlab = $("#taxTemplate").text();
            var RowSNo = clickedrow.find("#SNohiddenfiled").val();
            var ItmCode = clickedrow.find("#PQItemListName_" + RowSNo).val();
            if (GstApplicable == "Y") {
                ItemID = clickedrow.find(ItemDDLName + Sno).val();
                $("#Tax_ItemID").val(ItemID);
                var SlabItem = $("#Tax_ItemID").val()
                if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                    if (clickedrow.find("#TaxExempted").is(":checked")) {
                        TaxExempted = "Y";
                    }
                    if (clickedrow.find("#item_tax_amt").val() == 0) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {
                            TaxExempted = "Y";
                        }
                    }
                }
                else {
                    if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
        if (DMenuId == "105101130" || DMenuId == "105101136") {
            var TaxBySlab = $("#taxTemplate").text();
            var RowSNo = clickedrow.find("#SNohiddenfiled").val();
            var ItmCode = clickedrow.find("#POItemListName" + RowSNo).val();
            if (GstApplicable == "Y") {
                ItemID = clickedrow.find(ItemDDLName + Sno).val();
                $("#Tax_ItemID").val(ItemID);
                var SlabItem = $("#Tax_ItemID").val()
                if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                    if (clickedrow.find("#TaxExempted").is(":checked")) {
                        TaxExempted = "Y";
                    }
                    if (clickedrow.find("#item_tax_amt").val() == 0) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {
                            TaxExempted = "Y";
                        }
                    }
                }
                else {
                    if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
        //if (DMenuId == "105101154") {
        //    var TaxBySlab = $("#taxTemplate").text();
        //    var RowSNo = clickedrow.find("#SNohiddenfiled").val();
        //    var ItmCode = clickedrow.find("#POItemListName" + RowSNo).val();
        //    if (GstApplicable == "Y") {
        //        ItemID = clickedrow.find(ItemDDLName + RowSNo).val();
        //        $("#Tax_ItemID").val(ItemID);
        //        var SlabItem = $("#Tax_ItemID").val()
        //        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
        //            if (clickedrow.find("#TaxExempted").is(":checked")) {
        //                TaxExempted = "Y";
        //            }
        //            if (clickedrow.find("#item_tax_amt").val() == 0) {
        //                if (clickedrow.find("#ManualGST").is(":checked")) {
        //                    TaxExempted = "Y";
        //                }
        //            }
        //        }
        //        else {
        //            if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
        //                TaxExempted = "Y";
        //            }
        //        }
        //    }
        //    else {
        //        if (clickedrow.find("#TaxExempted").is(":checked")) {
        //            TaxExempted = "Y";
        //        }
        //    }

        //}
        if (DMenuId == "105103120") {
            if (GstApplicable == "Y") {
                var TaxBySlab = $("#taxTemplate").text();
                var RowSNo = clickedrow.find("#SNohiddenfiled").val();
                var ItmCode = clickedrow.find("#SQItemListName" + RowSNo).val();
                ItemID = clickedrow.find(ItemDDLName + Sno).val();
                $("#Tax_ItemID").val(ItemID);
                var SlabItem = $("#Tax_ItemID").val()
                if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                    if (clickedrow.find("#TaxExempted").is(":checked")) {
                        TaxExempted = "Y";
                    }
                    if (clickedrow.find("#item_tax_amt").val() == 0) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {
                            TaxExempted = "Y";
                        }
                    }
                }
                else {
                    if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
        if (DMenuId == "105103125") {
            var RowSNo = clickedrow.find("#SNohiddenfiled").val();
            var ItmCode = clickedrow.find("#SOItemListName" + RowSNo).val();
            if (GstApplicable == "Y") {
                var TaxBySlab = $("#taxTemplate").text();
                ItemID = clickedrow.find(ItemDDLName + Sno).val();
                $("#Tax_ItemID").val(ItemID);
                var SlabItem = $("#Tax_ItemID").val()
                if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                    if (clickedrow.find("#TaxExempted").is(":checked")) {
                        TaxExempted = "Y";
                    }
                    if (clickedrow.find("#item_tax_amt").val() == 0) {
                        if (clickedrow.find("#ManualGST").is(":checked")) {
                            TaxExempted = "Y";
                        }
                    }
                }
                else {
                    if (clickedrow.find("#TaxExempted").is(":checked") || clickedrow.find("#ManualGST").is(":checked")) {
                        TaxExempted = "Y";
                    }
                }
            }
            else {
                if (clickedrow.find("#TaxExempted").is(":checked")) {
                    TaxExempted = "Y";
                }
            }
        }
        ItemName = clickedrow.find(ItemDDLName + Sno + " option:selected").text()
        if (DMenuId == "105101145" || DMenuId == "105103140" || DMenuId == "105101147") {/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
            ItemID = clickedrow.find("#hfItemID").val();
        }
        else {
            ItemID = clickedrow.find(ItemDDLName + Sno).val();
        }
        DocNo = clickedrow.find("#QuotationNumber").val();
        DocDate = clickedrow.find("#QuotationDate").val();
        AssValue = clickedrow.find("#item_ass_val").val();
        $("#HdnTaxOn").val("Item");
    }
    if (DMenuId == "105101152") {
        if (ForSno != "OC") {
            ItemID = clickedrow.find(ItemDDLName + Sno).val();
        }
    }

    var AssAmount = parseFloat(CheckNullNumber(AssValue)).toFixed(cmn_ValDecDigit);
    if (AssAmount > 0) {
        clickedrow.find("#BtnTxtCalculation").prop("disabled", false);
    } else {
        clickedrow.find("#BtnTxtCalculation").prop("disabled", true);
    }
    if (AssAmount == "NaN" || AssAmount == "" || AssAmount == "0" || ItemName == " ---Select---") {
        clickedrow.find("#BtnTxtCalculation").attr("data-target", "");
        //return false;
    }
    else {
        clickedrow.find("#BtnTxtCalculation").attr("data-target", "#ItemCalculate");
    }

    $("#Tax_ItemName").val(ItemName);
    $("#Tax_ItemID").val(ItemID);
    $("#Tax_AssessableValue").val(AssAmount);
    $("#TaxCalcGRNNo").val(DocNo);
    $("#TaxCalcGRNDate").val(DocDate);
    $("#ReplicateOnAllItemsBtn").attr("data-dismiss", "modal");
    $("#SaveAndExitBtn").attr("data-dismiss", "modal");
    $("#HiddenRowSNo").val(Sno);
    $("#TaxCalcItemCode").val(ItemID);


    BindTaxListModel(UserID, Sno, ItemID);

    var GstApplicable = $("#Hdn_GstApplicable").text();
    if (GstApplicable == "Y") {
        if (clickedrow.find("#ManualGST").is(":checked")) {
            if (DMenuId == "105101147") { /*Added by Surbhi on 18/06/2025 for Supplementary Purchase Invoice(105101147)*/
                BindTaxTemplatelist();
            } else {
                BindTaxSlablist();
            }
        }
        else if (ForSno == 'OC') { BindTaxSlablist(); }/*Added by Surbhi on 25/08/2025 for OC HSN Code Application*/
        else {
            BindTaxTemplatelist();
        }
    }

    else {
        BindTaxTemplatelist();
    }



    HideShowTaxLevel();
    var rowIdx = 0;
    $("#TaxDiscard").css("display", "none");
    if (ForDisableOCDlt == "Enable") {
        //$("#TaxCalcButtons button").attr("disabled", false);
        $("#TaxCalcButtons button").css("display", "");
        //$("#TaxCalcButtons #taxBtnClose").css("display", "none");
        $("#Icon_AddNewRecord").css("display", "");
        $("#Tax_Template").attr('disabled', false);
        $("#Tax_Type").attr('disabled', false);
        $("#Tax_Percentage").prop("readonly", false);
        $("#Tax_Level").attr('disabled', false);
        $("#Tax_ApplyOn").attr('disabled', false);
        $("#TaxResetBtn").css("display", "block");
    } else {
        //$("#TaxCalcButtons button").attr("disabled", true);
        //$("#TaxCalcButtons button").remove();
        $("#TaxCalcButtons button").css("display", "none");
        //$("#TaxCalcButtons #taxBtnClose").css("display", "");
        //$("#TaxCalcButtons button").attr("onclick", "");
        $("#Icon_AddNewRecord").css("display", "none");
        $("#Tax_Template").attr('disabled', true);
        $("#Tax_Type").attr('disabled', true);
        $("#Tax_Percentage").prop("readonly", true);
        $("#Tax_Level").attr('disabled', true);
        $("#Tax_ApplyOn").attr('disabled', true);
        /*Added by Surbhi on 22/05/2025 for Supplementary Purchase Invoice(105101147)*/
        /*Added by Surbhi on 10/09/2025 for Quotation Analysis(105101125)*/
        if (DMenuId == "105101147" || DMenuId == "105101125") {
            $("#TaxCalcButtons button").show();
            $("#TaxDiscard").show();
            $("#TaxResetBtn").css("display", "none");
            $("#TaxSaveTemplate").css("display", "none");
            $("#ReplicateOnAllItemsBtn").css("display", "none");
            $("#SaveAndExitBtn").css("display", "none");
            $("#TaxExitAndDiscard").css("display", "none");
        }
    }
    var GstApplicable = $("#Hdn_GstApplicable").text();
    if (GstApplicable == "Y") {
        if (clickedrow.find("#ManualGST").is(":checked")) {
            $("#TaxCalcButtons #SaveAndExitBtn").css("display", "Block");
        }
        else {
            if (DMenuId != "105103142" && DMenuId != "105102150" && (DMenuId != "105101147") && (DMenuId != "105101153")) {
                /*Added by Surbhi on 15/07/2025 for Inter Branch Purchase Invoice(105101153)*/
                //add by shubam maurya on 26-03-2025
                /*Added by Surbhi on 17/05/2025 for Supplementary Purchase Invoice(105101147)*/
                $("#TaxCalcButtons #SaveAndExitBtn").css("display", "none");
            }
            //$("#TaxCalcButtons #SaveAndExitBtn").css("display", "none");
        }
    }
    var saveExitBtn = $("#HdnTaxOn").val()
    if (saveExitBtn == "OC") {
        if (ForDisableOCDlt == "Enable") {
            $("#TaxCalcButtons #SaveAndExitBtn").css("display", "Block");
        }
        else {
            $("#TaxCalcButtons #SaveAndExitBtn").css("display", "none");
        }
    }
    var TaxOn = $("#HdnTaxOn").val();
    var HdnTaxCalculateTable = "Hdn_TaxCalculatorTbl";
    if (TaxOn == "OC") {
        HdnTaxCalculateTable = "Hdn_OCTemp_TaxCalculatorTbl";
    }
    var FTaxDetails = $("#" + HdnTaxCalculateTable + " > tbody > tr").length;
    if (FTaxDetails != null) {
        if (FTaxDetails > 0) {
            $("#TaxCalculatorTbl >tbody >tr").remove();
            $('#TotalTaxAmount').text(parseFloat(0).toFixed(cmn_ValDecDigit));
            $("#" + HdnTaxCalculateTable + " > tbody > tr").each(function () {
                var Crow = $(this);
                //var TaxUserID = Crow.find("#UserID").text();
                //var TaxRowID = Crow.find("#RowSNo").text();
                var TaxTLevel = Crow.find("#TaxLevel").text();
                var TaxItemID = Crow.find("#TaxItmCode").text();
                var QTnumber = Crow.find("#DocNo").text();
                var QTdate = Crow.find("#DocDate").text();
                var Acc_ID = Crow.find("#Acc_ID").text();
                var Acc_name = Crow.find("#Acc_name").text();
                if (DocNo == null || DocNo == "" || DocNo == "Direct" || QTnumber == "Direct" || QTnumber == "") {
                    DocNo = ""; DocDate = ""; QTdate = ""; QTnumber = "";
                };
                if (DocDate == null) { DocDate = "" };
                if (TaxItemID == ItemID && QTnumber == DocNo && QTdate == DocDate && TaxExempted == "N") {
                    Reset_ReOpen_LevelVal(TaxTLevel);
                    var TaxName = Crow.find("#TaxName").text();
                    var TaxNameID = Crow.find("#TaxNameID").text();
                    var TaxPercentage = Crow.find("#TaxPercentage").text();
                    var TaxLevel = Crow.find("#TaxLevel").text();
                    var TaxApplyOn = Crow.find("#TaxApplyOn").text();
                    var TaxAmount = Crow.find("#TaxAmount").text();
                    var TaxApplyOnID = Crow.find("#TaxApplyOnID").text();
                    var TotalTaxAmount = Crow.find("#TotalTaxAmount").text();
                    if (HdnTaxCalculateTable == "Hdn_OCTemp_TaxCalculatorTbl") {
                        var Acc_ID = Crow.find("#TaxAccId").text();
                    }
                    else {
                        var Acc_ID = Crow.find("#Acc_ID").text();
                    }

                    var Acc_name = Crow.find("#Acc_name").text();
                    var TaxRecov = DMenuId == "105102115101" || DMenuId == "105101152" || DMenuId == "105101154" ? Crow.find("#TaxRecov").text() : "";
                    TaxTableDataBind(++rowIdx,
                        TaxName, TaxNameID, TaxPercentage, TaxLevel, TaxApplyOn, TaxAmount, TaxApplyOnID, TotalTaxAmount, Acc_ID, Acc_name, TaxRecov
                    )
                }
            });
            var GstApplicable = $("#Hdn_GstApplicable").text();
            if (GstApplicable == "Y") {
                if (clickedrow.find("#ManualGST").is(":checked")) {
                    $("#taxTemplate").text("GST Slab")
                    $("#Tax_Template").attr("disabled", false)
                }
            }
        }
        else {
            $("#TaxCalculatorTbl >tbody >tr").remove();
            $('#TotalTaxAmount').text(parseFloat(0).toFixed(cmn_ValDecDigit));
        }
    }
    else {
        $("#TaxCalculatorTbl >tbody >tr").remove();
        $('#TotalTaxAmount').text(parseFloat(0).toFixed(cmn_ValDecDigit));
    }
    /*Added by Surbhi on 14/08/2025 for OC HSN Code Application*/
    /*Added by Surbhi on 14/08/2025 for OC HSN Code Application*/
    if (GstApplicable == "Y" && ForSno == "OC") {
        //$("#TaxCalcButtons button").show();
        //$("#TaxDiscard").show();

        //$("#TaxSaveTemplate").css("display", "none");
        //$("#ReplicateOnAllItemsBtn").css("display", "none");
        //$("#SaveAndExitBtn").css("display", "none");
        //$("#TaxExitAndDiscard").css("display", "none");
        //$("#Btn_AddNew").css("display", "none");
        //$("#Icon_AddNewRecord").css("display", "none");
        //$("#TaxDiscard").css("display", "block");
        //$("#Tax_Template").attr('disabled', true);
        //$("#Tax_Type").attr('disabled', true);
        //$("#Tax_Percentage").attr('disabled', true);
        //$("#Tax_Level").attr('disabled', true);
        //$("#Tax_ApplyOn").attr('disabled', true);
        $("#taxTemplate").text("GST Slab OC");
        if (ForDisableOCDlt == "Enable") {
            $("#TaxCalcButtons button").css("display", "none");
            $("#Icon_AddNewRecord").css("display", "none");
            $("#Tax_Type").attr('disabled', true);
            $("#Tax_Percentage").prop("readonly", true);
            $("#Tax_Level").attr('disabled', true);
            $("#Tax_ApplyOn").attr('disabled', true);
            $("#TaxCalcButtons #SaveAndExitBtn").css("display", "Block");
            $("#TaxResetBtn").css("display", "Block");
            //$('#Tax_Template').attr('onchange', "OnChangeTaxTmpltDdl('OC')");\
        }
        else {
            $("#TaxCalcButtons button").css("display", "none");
            $("#Icon_AddNewRecord").css("display", "none");
            $("#Tax_Type").attr('disabled', true);
            $("#Tax_Percentage").prop("readonly", true);
            $("#Tax_Level").attr('disabled', true);
            $("#Tax_ApplyOn").attr('disabled', true);
            $("#TaxCalcButtons #SaveAndExitBtn").css("display", "none");
            $("#TaxResetBtn").css("display", "none");
            /*Added by Surbhi on 10/09/2025 for Quotation Analysis(105101125)*/
            if (DMenuId == "105101125") {
                $("#TaxCalcButtons button").show();
                $("#TaxDiscard").show();
                $("#TaxResetBtn").css("display", "none");
                $("#TaxSaveTemplate").css("display", "none");
                $("#ReplicateOnAllItemsBtn").css("display", "none");
                $("#SaveAndExitBtn").css("display", "none");
                $("#TaxExitAndDiscard").css("display", "none");
            }
        }
    }
}
function BindTaxSlablist() {

    var DocumentMenuId = $("#DocumentMenuId").val();
    $.ajax({
        type: "POST",
        url: "/Common/Common/BindTaxSlablist",
        data: {
            DocumentMenuId: DocumentMenuId
        },
        success: function (data) {


            if (data != null && data != "" && data != "{}") {
                var arr = JSON.parse(data);
                if (arr.Table.length > 0) {
                    $("#Tax_Template").attr("onchange", "OnChangeTaxTmpltDdl('')")
                    $("#Tax_Template option").remove();
                    //for (var j = 0; j < arr.Table.length; j++) {
                    // $("#Tax_Template").append(`<option value='${arr.Table[j].tmplt_id}'>${arr.Table[j].tmplt_name}</option`);
                    //}
                    var s = '<option value="0">---Select---</option>';
                    for (var i = 0; i < arr.Table.length; i++) {
                        s += '<option value="' + arr.Table[i].tmplt_id + '" text="' + arr.Table[i].tmplt_name + '">' + arr.Table[i].tmplt_name + '</option>';
                    }
                    $("#Tax_Template").html(s);
                }
                var tmplt_id = $("#hd_tax_id").val();
                if (tmplt_id == "" || tmplt_id == null) {
                    tmplt_id = "0";
                }
                //$("#Tax_Template").val(tmplt_id);
                $("#Tax_Template").select2();
            }

        }
    })
}
function BindTaxTemplatelist(Tmplt_type) {

    Tmplt_type = Tmplt_type == null ? "TAX" : Tmplt_type;
    var DocumentMenuId = $("#DocumentMenuId").val();
    $.ajax({
        type: "POST",
        url: "/Common/Common/BindTaxTemplatelist",
        data: {
            DocumentMenuId: DocumentMenuId,
            Tmplt_type: Tmplt_type
        },
        success: function (data) {

            var tmpt_Fid = "#Tax_Template";
            if (Tmplt_type == "TDS") {
                tmpt_Fid = "#TDS_Template";
            }
            if (data != null && data != "" && data != "{}") {
                var arr = JSON.parse(data);
                if (arr.Table.length > 0) {
                    $(tmpt_Fid).attr("onchange", `${Tmplt_type == "TDS" ? 'OnChangeTDSTemplate()' : 'OnChangeTaxTmpltDdl("")'}`)
                    $(tmpt_Fid + " option").remove();
                    for (var j = 0; j < arr.Table.length; j++) {
                        $(tmpt_Fid).append(`<option value='${arr.Table[j].tmplt_id}'>${arr.Table[j].tmplt_name}</option`);
                    }
                }
                var tmplt_id = $("#hd_tax_id").val();
                if (tmplt_id == "" || tmplt_id == null) {
                    tmplt_id = "0";
                }
                //$("#Tax_Template").val(tmplt_id);
                $(tmpt_Fid).select2();
            }

        }
    })
}


async function OnChangeTaxTmpltDdl(ItmTmplt_id, ItemOnchange) {

    var ErrorFlag = "N";
    var tmplt_id = $("#Tax_Template").val();
    if (tmplt_id == "0" || tmplt_id == "") {
        $("[aria-labelledby='select2-Tax_Template-container']").css("border-color", "red");
        $("#SpanTax_Template").text($("#valueReq").text());
        $("#SpanTax_Template").css("display", "block");
        ErrorFlag = "Y";
    }
    else {
        //$("#SaveAndExitBtn").attr("data-dismiss", "model");
        $("[aria-labelledby='select2-Tax_Template-container']").css("border-color", "#ced4da");
        $("#SpanTax_Template").text("");
        $("#SpanTax_Template").css("display", "none");
    }
    if (ErrorFlag == "Y") {
        $("#TaxCalculatorTbl tbody tr").remove();
        $("#TotalTaxAmount").text(parseFloat(0).toFixed(cmn_ValDecDigit))
    }
    //var TaxSlab = $("#taxTemplate").text()
    let text = $("#taxTemplate").text();    /*Added by Surbhi on 25/08/2025 for OC HSN Code Application*/
    var TaxSlab = text.replace(/\s+/g, '');
    var ItemId = $("#Tax_ItemID").val()
    var GSTNo = $("#ship_add_gstNo").val()
    if (ItmTmplt_id != "") {
        tmplt_id = ItmTmplt_id;
    }
    else {
        if (tmplt_id == "0") {
            tmplt_id = $("#hd_tax_id").val();
        }
    }
    await $.ajax({
        type: "POST",
        url: "/Common/Common/BindTaxTemplateData",
        data: {
            tmplt_id: tmplt_id, TaxSlab: TaxSlab, ItemId: ItemId, GSTNo: GSTNo
        },
        success: function (data) {
            if (data != null && data != "" && data != "{}") {
                var arr = JSON.parse(data);
                if (TaxSlab == "Template") {
                    if (arr.Table.length > 0) {
                        var lastLevel = 0;
                        lastLevel = arr.Table[arr.Table.length - 1].tax_level;
                        AddTaxByHSNCalculation(arr.Table, TaxSlab);
                        var docid = $("#DocumentMenuId").val();
                        if ($("#hd_tax_id").val() == tmplt_id) {
                            if (docid == "105101145") {
                                OnClickSaveAndExit();
                                GetAllGLID();
                            }
                            else if (docid == "105101152") {
                                if (ItemOnchange == "ItemOnchange") {
                                    OnClickSaveAndExit("");
                                }
                                else {
                                    OnClickSaveAndExit("ApplyGL");
                                }
                            }
                            else {
                                OnClickSaveAndExit();
                            }
                        }
                        else if (ItmTmplt_id == tmplt_id) {
                            if (docid == "105101145") {
                                OnClickSaveAndExit();
                                GetAllGLID();
                            }
                            else if (docid == "105101152") {
                                if (ItemOnchange == "ItemOnchange") {
                                    OnClickSaveAndExit("");
                                }
                                else {
                                    OnClickSaveAndExit("ApplyGL");
                                }
                            }
                            else {
                                OnClickSaveAndExit();
                            }

                        }
                        Reset_ReOpen_LevelVal(lastLevel);
                    }
                }
                else {
                    var DMenuId = $("#DocumentMenuId").val();
                    if (arr.Table.length > 0) {
                        //Cmn_ApplyGSTToAtable(TableID, ItemID, SNohiddenfiled, item_ass_val, arr.Table)
                        if (DMenuId == "105101120") {
                            //Cmn_ApplyGSTToAtable("PQItmDetailsTbl", "Hdn_Item_ID", "SNohiddenfiled", "item_ass_val", arr.Table, "", "TaxbySlab")
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                        }
                        if (DMenuId == "105101130" || DMenuId == "105101136") {
                            //Cmn_ApplyGSTToAtable("PoItmDetailsTbl", "hfItemID", "SNohiddenfiled", "item_ass_val", arr.Table, "", "TaxbySlab")
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                        }
                        if (DMenuId == "105101145") {
                            //ApplyGSTToAtable("TaxCalcItemCode", "TaxCalcGRNNo", "TaxCalcGRNDate", "TxtItemGrossValue", arr.Table, "Y","TaxbySlab");
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                        }
                        if (DMenuId == "105103120") {
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("QTItmDetailsTbl", "hfItemID", "SNohiddenfiled", "item_ass_val", arr.Table, "Y", "TaxbySlab");
                        }
                        if (DMenuId == "105103125") {
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("SOItmDetailsTbl", "hfItemID", "SNohiddenfiled", "item_ass_val", arr.Table, "Y", "TaxbySlab");
                        }
                        if (DMenuId == "105103140") {
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("SInvItmDetailsTbl", "hfItemID", "SNohiddenfiled", "TxtItemGrossValue", arr.Table, "Y", "TaxbySlab");
                        }
                        if (DMenuId == "105108101") {
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("JoItmDetailsTbl", "hfItemID", "SNohiddenfiled", "item_gr_val", arr.Table, "Y", "TaxbySlab");
                        }
                        if (DMenuId == "105108123") {
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("JOInvItmDetailsTbl", "hfItemID", "", "TxtItemGrossValue", arr.Table, "Y", "TaxbySlab");
                        }
                        /***Modifyed By Shubham Maurya on 26-10-2023 12:43 for custom invoice***/
                        if (DMenuId == "105103145127") {
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("JOInvItmDetailsTbl", "hfItemID", "", "TxtItemGrossValue", arr.Table, "Y", "TaxbySlab");
                        }
                        if (DMenuId == "105102115101") {
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("JOInvItmDetailsTbl", "hfItemID", "", "TxtItemGrossValue", arr.Table, "Y", "TaxbySlab");
                        }
                        if (DMenuId == "105101152") {
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("JOInvItmDetailsTbl", "hfItemID", "", "TxtItemGrossValue", arr.Table, "Y", "TaxbySlab");
                        }
                        if (DMenuId == "105101150") {
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("JOInvItmDetailsTbl", "hfItemID", "", "TxtItemGrossValue", arr.Table, "Y", "TaxbySlab");
                        }
                        if (DMenuId == "105101135") {/*Added By Nitesh 05-06-2024*/
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("JOInvItmDetailsTbl", "hfItemID", "", "TxtItemGrossValue", arr.Table, "Y", "TaxbySlab");
                        }
                        if (DMenuId == "105108120") {
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("JOInvItmDetailsTbl", "hfItemID", "", "TxtItemGrossValue", arr.Table, "Y", "TaxbySlab");
                        }
                        if (DMenuId == "105103147") {/*Add by Hina sharma on 02-01-2025 for service sale invoice*/
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("JOInvItmDetailsTbl", "hfItemID", "", "TxtItemGrossValue", arr.Table, "Y", "TaxbySlab");
                        }
                        if (DMenuId == "105103148" || DMenuId == "105103149") {/*Add BY shubham Maurya on 02-06-2025 add 105103149*//*Add by Hina sharma on 13-01-2025 for scrap/direct sale invoice*/
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("JOInvItmDetailsTbl", "hfItemID", "", "TxtItemGrossValue", arr.Table, "Y", "TaxbySlab");
                        }
                        if (DMenuId == "105101154" || DMenuId == "105101147" || DMenuId == "105101153" || DMenuId == "105102150" || DMenuId == "105103142") {//Add by shubham Maurya on 10-09-2025 "105102150"
                            /*Added 105101147, 105101153 by Surbhi on 28/08/2025 for OC HSN Code Application*/
                            /*Add by Shubham Maurya on 17-01-2025 for Direct Purchase invoice*/
                            Cmn_GstApplyOnRow("Tax_AssessableValue", arr.Table)
                            //Cmn_ApplyGSTToAtable("JOInvItmDetailsTbl", "hfItemID", "", "TxtItemGrossValue", arr.Table, "Y", "TaxbySlab");
                        }
                    }
                    else {
                        $('#TaxCalculatorTbl tbody tr').remove();
                        $("#TotalTaxAmount").text(parseFloat(0).toFixed(cmn_ValDecDigit))
                    }
                }
            }
        }
    })
}
function AddTaxByHSNCalculation(arr, TaxSlab) {
    var TotalTaxAmt = 0;
    //var DecDigit = $("#ValDigit").text();
    var docid = $("#DocumentMenuId").val();
    $('#TaxCalculatorTbl tbody tr').remove();

    for (var i = 0; i < $("#Tax_Type option").length; i++) {
        var taxId = $("#Tax_Type option")[i].value;
        $("#Tax_Type option[value=" + taxId + "]").show();
    }
    for (var i = 1; i < $("#Tax_Level option").length; i++) {
        var taxId = $("#Tax_Level option")[i].value;
        $("#Tax_Level option[value=" + taxId + "]").hide();
    }
    var lastLevel = 0;
    $("#Tax_Type option").show();
    var NewArray = [];
    var TotalTaxAmt = 0;
    for (var j = 0; j < arr.length; j++) {
        var ApplyOn = "";
        var AssessVal = $("#Tax_AssessableValue").val();
        var TaxLevel = arr[j].tax_level;
        var TaxAmount = 0;

        var tax_per = arr[j].tax_rate;//(parseFloat(tax_val) / parseFloat(base_amt)) * 100;
        if (arr[j].tax_apply_on == "I") {
            ApplyOn = "Immediate Level";
            if (TaxLevel == "1") {
                TaxAmount = ((parseFloat(AssessVal) * parseFloat(tax_per)) / 100).toFixed(cmn_ValDecDigit);
                TotalTaxAmt = (parseFloat(TotalTaxAmt) + parseFloat(TaxAmount)).toFixed(cmn_ValDecDigit);
            } else {
                var TaxAMountColIL = parseFloat(0).toFixed(cmn_ValDecDigit);
                var TaxLevelTbl = parseInt(TaxLevel) - 1;
                for (j = 0; j < NewArray.length; j++) {
                    var Level = NewArray[j].TaxLevel;
                    var TaxAmtLW = NewArray[j].TaxAmount;
                    if (TaxLevelTbl == Level) {
                        TaxAMountColIL = (parseFloat(TaxAMountColIL) + parseFloat(TaxAmtLW)).toFixed(cmn_ValDecDigit);
                    }
                }
                var FinalAssAmtIL = (parseFloat(TaxAMountColIL)).toFixed(cmn_ValDecDigit);
                TaxAmount = ((parseFloat(FinalAssAmtIL) * parseFloat(tax_per)) / 100).toFixed(cmn_ValDecDigit);
                TotalTaxAmt = (parseFloat(TotalTaxAmt) + parseFloat(TaxAmount)).toFixed(cmn_ValDecDigit);
            }
        }
        if (arr[j].tax_apply_on == "C") {
            ApplyOn = "Cummulative";
            if (TaxLevel == "1") {
                TaxAmount = ((parseFloat(AssessVal) * parseFloat(tax_per)) / 100).toFixed(cmn_ValDecDigit);
                TotalTaxAmt = (parseFloat(TotalTaxAmt) + parseFloat(TaxAmount)).toFixed(cmn_ValDecDigit);
            } else {
                var TaxAMountCol = parseFloat(0).toFixed(cmn_ValDecDigit);
                for (j = 0; j < NewArray.length; j++) {
                    var Level = NewArray[j].TaxLevel;
                    var TaxAmtLW = NewArray[j].TaxAmount;
                    if (TaxLevel != Level) {
                        TaxAMountCol = (parseFloat(TaxAMountCol) + parseFloat(TaxAmtLW)).toFixed(cmn_ValDecDigit);
                    }
                }
                var FinalAssAmt = (parseFloat(AssessVal) + parseFloat(TaxAMountCol)).toFixed(cmn_ValDecDigit);
                TaxAmount = ((parseFloat(FinalAssAmt) * parseFloat(tax_per)) / 100).toFixed(cmn_ValDecDigit);
                TotalTaxAmt = (parseFloat(TotalTaxAmt) + parseFloat(TaxAmount)).toFixed(cmn_ValDecDigit);
            }
        }
        NewArray.push({ TaxItmCode: "", TaxNameID: "", TaxLevel: TaxLevel, TaxAmount: TaxAmount })
        //var base_amt = arr[j].base_amt;
        //var tax_val = arr[j].tax_val;
        //var tax_per = (parseFloat(tax_val) / parseFloat(base_amt)) * 100;
        //var tax_per = arr[j].tax_rate;//(parseFloat(tax_val) / parseFloat(base_amt)) * 100;

        //tax_val = parseFloat(AssessVal) * (parseFloat(tax_per) / 100);
        //TotalTaxAmt = parseFloat(TotalTaxAmt) + parseFloat(tax_val);
        if (docid == "105103140" && TaxSlab != "Template") {//Added by Suraj on 19-10-2024
            var Arr = {
                ShipmentNo: null, ShipmentDate: null, TaxItmCode: null, TaxName: arr[j].tax_name, TaxNameID: arr[j].tax_id
                , TaxPercentage: String(arr[j].tax_rate), TaxLevel: arr[j].tax_level, TaxApplyOn: ApplyOn, TaxAmount: TaxAmount
                , TotalTaxAmount: TotalTaxAmt, TaxApplyOnID: arr[j].tax_apply_on, TaxAccID: arr[j].tax_acc_id
            }
            RenderToHdnTaxTables("Hdn_TaxCalculatorTbl", Arr);
            return TotalTaxAmt;
        }
        else {
            if (docid == "105101145" || docid == "105103140" || docid == "105101150" || docid == "105103145125" || docid == "105103147" || docid == "105101152" || docid == "105101154") {
                TaxTableDataBind((j + 1), arr[j].tax_name, arr[j].tax_id, String(arr[j].tax_rate), arr[j].tax_level, ApplyOn, /*tax_val*/TaxAmount, arr[j].tax_apply_on, TotalTaxAmt, arr[j].tax_acc_id, arr[j].acc_name, arr[j].tax_recov)
            }
            else {
                TaxTableDataBind((j + 1), arr[j].tax_name, arr[j].tax_id, String(arr[j].tax_rate), arr[j].tax_level, ApplyOn, /*tax_val*/TaxAmount, arr[j].tax_apply_on, TotalTaxAmt, arr[j].acc_id, arr[j].acc_name, arr[j].tax_recov)
            }

            //TaxTableDataBind((j + 1),
            //    arr[j].tax_name, arr[j].tax_id, String(arr[j].tax_rate), arr[j].tax_level,
            //    ApplyOn, /*tax_val*/TaxAmount, arr[j].tax_apply_on, TotalTaxAmt, arr[j].acc_id, arr[j].acc_name, arr[j].tax_recov
            //)
            lastLevel = arr[j].tax_level;
            $("#Tax_Type option[value=" + arr[j].tax_id + "]").hide();

            //OnClickSaveAndExit()
        }
    }
}

function AddTaxByHSNCalculation_OC(arr, TaxSlab) {
    var TotalTaxAmt = 0;
    //var DecDigit = $("#ValDigit").text();
    var docid = $("#DocumentMenuId").val();
    $('#TaxCalculatorTbl tbody tr').remove();

    for (var i = 0; i < $("#Tax_Type option").length; i++) {
        var taxId = $("#Tax_Type option")[i].value;
        $("#Tax_Type option[value=" + taxId + "]").show();
    }
    for (var i = 1; i < $("#Tax_Level option").length; i++) {
        var taxId = $("#Tax_Level option")[i].value;
        $("#Tax_Level option[value=" + taxId + "]").hide();
    }
    var lastLevel = 0;
    $("#Tax_Type option").show();
    var NewArray = [];
    var TotalTaxAmt = 0;
    for (var j = 0; j < arr.length; j++) {
        var ApplyOn = "";
        var AssessVal = $("#Tax_AssessableValue").val();
        var TaxLevel = arr[j].tax_level;
        var TaxAmount = 0;

        var tax_per = arr[j].tax_rate;//(parseFloat(tax_val) / parseFloat(base_amt)) * 100;
        if (arr[j].tax_apply_on == "I") {
            ApplyOn = "Immediate Level";
            if (TaxLevel == "1") {
                TaxAmount = ((parseFloat(AssessVal) * parseFloat(tax_per)) / 100).toFixed(cmn_ValDecDigit);
                TotalTaxAmt = (parseFloat(TotalTaxAmt) + parseFloat(TaxAmount)).toFixed(cmn_ValDecDigit);
            } else {
                var TaxAMountColIL = parseFloat(0).toFixed(cmn_ValDecDigit);
                var TaxLevelTbl = parseInt(TaxLevel) - 1;
                for (j = 0; j < NewArray.length; j++) {
                    var Level = NewArray[j].TaxLevel;
                    var TaxAmtLW = NewArray[j].TaxAmount;
                    if (TaxLevelTbl == Level) {
                        TaxAMountColIL = (parseFloat(TaxAMountColIL) + parseFloat(TaxAmtLW)).toFixed(cmn_ValDecDigit);
                    }
                }
                var FinalAssAmtIL = (parseFloat(TaxAMountColIL)).toFixed(cmn_ValDecDigit);
                TaxAmount = ((parseFloat(FinalAssAmtIL) * parseFloat(tax_per)) / 100).toFixed(cmn_ValDecDigit);
                TotalTaxAmt = (parseFloat(TotalTaxAmt) + parseFloat(TaxAmount)).toFixed(cmn_ValDecDigit);
            }
        }
        if (arr[j].tax_apply_on == "C") {
            ApplyOn = "Cummulative";
            if (TaxLevel == "1") {
                TaxAmount = ((parseFloat(AssessVal) * parseFloat(tax_per)) / 100).toFixed(cmn_ValDecDigit);
                TotalTaxAmt = (parseFloat(TotalTaxAmt) + parseFloat(TaxAmount)).toFixed(cmn_ValDecDigit);
            } else {
                var TaxAMountCol = parseFloat(0).toFixed(cmn_ValDecDigit);
                for (j = 0; j < NewArray.length; j++) {
                    var Level = NewArray[j].TaxLevel;
                    var TaxAmtLW = NewArray[j].TaxAmount;
                    if (TaxLevel != Level) {
                        TaxAMountCol = (parseFloat(TaxAMountCol) + parseFloat(TaxAmtLW)).toFixed(cmn_ValDecDigit);
                    }
                }
                var FinalAssAmt = (parseFloat(AssessVal) + parseFloat(TaxAMountCol)).toFixed(cmn_ValDecDigit);
                TaxAmount = ((parseFloat(FinalAssAmt) * parseFloat(tax_per)) / 100).toFixed(cmn_ValDecDigit);
                TotalTaxAmt = (parseFloat(TotalTaxAmt) + parseFloat(TaxAmount)).toFixed(cmn_ValDecDigit);
            }
        }
        NewArray.push({ TaxItmCode: "", TaxNameID: "", TaxLevel: TaxLevel, TaxAmount: TaxAmount })
        //var base_amt = arr[j].base_amt;
        //var tax_val = arr[j].tax_val;
        //var tax_per = (parseFloat(tax_val) / parseFloat(base_amt)) * 100;
        //var tax_per = arr[j].tax_rate;//(parseFloat(tax_val) / parseFloat(base_amt)) * 100;

        //tax_val = parseFloat(AssessVal) * (parseFloat(tax_per) / 100);
        //TotalTaxAmt = parseFloat(TotalTaxAmt) + parseFloat(tax_val);
        //if (docid == "105103140" && TaxSlab != "Template") {//Added by Suraj on 19-10-2024
        //    var Arr = {
        //        ShipmentNo: null, ShipmentDate: null, TaxItmCode: null, TaxName: arr[j].tax_name, TaxNameID: arr[j].tax_id
        //        , TaxPercentage: String(arr[j].tax_rate), TaxLevel: arr[j].tax_level, TaxApplyOn: ApplyOn, TaxAmount: TaxAmount
        //        , TotalTaxAmount: TotalTaxAmt, TaxApplyOnID: arr[j].tax_apply_on, TaxAccID: arr[j].tax_acc_id
        //    }
        //    RenderToHdnTaxTables("Hdn_OCTemp_TaxCalculatorTbl", Arr);
        //   // return TotalTaxAmt;
        //}
        //else {
            if (docid == "105101145" || docid == "105103140" || docid == "105101150" || docid == "105103145125" || docid == "105103147" || docid == "105101152" || docid == "105101154") {
                TaxTableDataBind((j + 1), arr[j].tax_name, arr[j].tax_id, String(arr[j].tax_rate), arr[j].tax_level, ApplyOn, /*tax_val*/TaxAmount, arr[j].tax_apply_on, TotalTaxAmt, arr[j].tax_acc_id, arr[j].acc_name, arr[j].tax_recov)
            }
            else {
                TaxTableDataBind((j + 1), arr[j].tax_name, arr[j].tax_id, String(arr[j].tax_rate), arr[j].tax_level, ApplyOn, /*tax_val*/TaxAmount, arr[j].tax_apply_on, TotalTaxAmt, arr[j].acc_id, arr[j].acc_name, arr[j].tax_recov)
            }

            //TaxTableDataBind((j + 1),
            //    arr[j].tax_name, arr[j].tax_id, String(arr[j].tax_rate), arr[j].tax_level,
            //    ApplyOn, /*tax_val*/TaxAmount, arr[j].tax_apply_on, TotalTaxAmt, arr[j].acc_id, arr[j].acc_name, arr[j].tax_recov
            //)
            lastLevel = arr[j].tax_level;
            $("#Tax_Type option[value=" + arr[j].tax_id + "]").hide();

            //OnClickSaveAndExit()
        /*}*/
    }
}
/*
 *Save As Template Code Shifted to Common Folder as SaveAsTemplate.js
 */
function TaxTableDataBind(rowIdx, TaxName, TaxNameID, TaxPercentage, TaxLevel, TaxApplyOn, TaxAmount
    , TaxApplyOnID, TotalTaxAmount, Acc_ID, Acc_name, tax_recov) {

    //var ValDecDigit = $("#ValDigit").text();
    //var docid = $("#DocumentMenuId").val();
    //if (docid == "105103145127") {
    //    ValDecDigit = $("#ExpImpValDigit").text();
    //}
    if (TaxName != null && TaxName != "") {
        var percent = TaxPercentage.substr(TaxPercentage.length - 1);
        if (percent != "%") {
            TaxPercentage = parseFloat(TaxPercentage).toFixed(2);
            TaxPercentage += "%";
        } else {
            TaxPercentage = TaxPercentage.replace("%", "");
            TaxPercentage = parseFloat(TaxPercentage).toFixed(2);
            TaxPercentage += "%";
        }
        $('#TaxCalculatorTbl tbody').append(`<tr id="R${rowIdx}">
            <td id="taxname" width="18%">${TaxName}</td>
            <td  hidden="hidden" id="taxid">${TaxNameID}</td>
            <td class="num_right" width="18%" id="taxrate">${TaxPercentage}</td>
            <td width="19%" class='center' id="taxlevel">${TaxLevel}</td>
            <td width="27%" id="taxapplyonname">${TaxApplyOn}</td>
            <td align="right" width="18%" id="taxval">${parseFloat(TaxAmount).toFixed(cmn_ValDecDigit)}</td>
            <td hidden="hidden" id="taxapplyon">${TaxApplyOnID}</td>
            <td hidden="hidden" id="AccID">${Acc_ID}</td>
            <td hidden="hidden" id="Acc_name">${Acc_name}</td>
            <td hidden="hidden" id="tax_recov">${tax_recov}</td>
            </tr>`);

        $('#TotalTaxAmount').text(parseFloat(TotalTaxAmount).toFixed(cmn_ValDecDigit));

    }

}

function TaxTableDataBind_Hdn(rowIdx, TaxName, TaxNameID, TaxPercentage, TaxLevel, TaxApplyOn, TaxAmount
    , TaxApplyOnID, TotalTaxAmount, ItemCode, DocNo, DocDate, AccId, AccName, Recov) {
    /*This Function is Created by Suraj Maurya on 28-11-2024 to bind tax data direct to hidden*/
    if (TaxName != null && TaxName != "") {
        var percent = TaxPercentage.substr(TaxPercentage.length - 1);
        if (percent != "%") {
            TaxPercentage = parseFloat(TaxPercentage).toFixed(2);
            TaxPercentage += "%";
        } else {
            TaxPercentage = TaxPercentage.replace("%", "");
            TaxPercentage = parseFloat(TaxPercentage).toFixed(2);
            TaxPercentage += "%";
        }

        $('#Hdn_TaxCalculatorTbl tbody').append(`<tr id="R${++rowIdx}">
            <td id="DocNo">${DocNo}</td>
            <td id="DocDate">${DocDate}</td>
            <td id="TaxItmCode">${ItemCode}</td>
            <td id="TaxName">${TaxName}</td>
            <td id="TaxNameID">${TaxNameID}</td>
            <td id="TaxPercentage">${TaxPercentage}</td>
            <td id="TaxLevel">${TaxLevel}</td>
            <td id="TaxApplyOn">${TaxApplyOn}</td>
            <td id="TaxAmount">${parseFloat(TaxAmount).toFixed(cmn_ValDecDigit)}</td>
            <td id="TotalTaxAmount">${TotalTaxAmount}</td>
            <td id="TaxApplyOnID">${TaxApplyOnID}</td>
            <td id="TaxRecov">${Recov}</td>
            <td id="TaxAccId">${AccId}</td>
                </tr>`);
    }

}
function CMNBindTaxAmountDeatils(TaxAmtDetail, ItemTaxAmountList_ID, ItemTaxAmountTotal_ID) {

    //var DecDigit = $("#ValDigit").text();
    var src_type = $("#src_type").val();
    var docid = $("#DocumentMenuId").val();
    $(ItemTaxAmountList_ID + " >tbody >tr").remove();
    $(ItemTaxAmountTotal_ID).text(parseFloat(0).toFixed(cmn_ValDecDigit));
    var ItmCode = "";/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
    if (TaxAmtDetail != null) {
        if (TaxAmtDetail.length > 0) {
            var TaxAmtDetailF = [];
            if (docid == "105101120") {
                var NewArr = [];
                $("#PQItmDetailsTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var RowSNo = currentRow.find("#SNohiddenfiled").val();
                    var ItmCode = currentRow.find("#PQItemListName_" + RowSNo).val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var ItemTaxAmt = currentRow.find("#item_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode != ItmCode) {

                                    }
                                    else {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode != ItmCode) {

                                    }
                                    else {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode != ItmCode) {

                                }
                                else {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105101145") {
                var NewArr = [];
                $("#POInvItmDetailsTbl >tbody >tr").each(function () {
                    var currentRow = $(this);

                    var ItmCode = currentRow.find("#hfItemID").val();
                    var GRNNo = currentRow.find("#TxtGrnNo").val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var TaxCalcGRNNo = $("#TaxCalcGRNNo").val()
                        var ItemTaxAmt = currentRow.find("#Txtitem_tax_amt").val()
                        var TxtGrnNo = currentRow.find("#TxtGrnNo").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        var totalTaxamt = $("#TotalTaxAmount").text()
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem && TaxCalcGRNNo == TxtGrnNo) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            //else if (data == "Y") {
                            else if (currentRow.find("#ManualGST").is(":checked") && totalTaxamt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode && TaxAmtDetail[i].DocNo == GRNNo) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {

                                    }
                                }
                            }
                            //}
                            //else {
                            //    for (i = 0; i < TaxAmtDetail.length; i++) {
                            //        if (TaxAmtDetail[i].TaxItmCode == ItmCode && TaxAmtDetail[i].DocNo == GRNNo) {
                            //            NewArr.push(TaxAmtDetail[i]);
                            //        }
                            //        else {

                            //        }
                            //    }
                            //}
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode && TaxAmtDetail[i].DocNo == GRNNo) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {

                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode && TaxAmtDetail[i].DocNo == GRNNo) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                                else {

                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105101147") {/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
                var NewArr = [];
                $("#POInvItmDetailsTbl >tbody >tr").each(function () {
                    debugger;
                    var currentRow = $(this);
                    ItmCode = currentRow.find("#hfItemID").val();
                    var GRNNo = currentRow.find("#TxtGrnNo").val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val();
                        var TaxCalcGRNNo = $("#TaxCalcGRNNo").val();
                        var ItemTaxAmt = currentRow.find("#Txtitem_tax_amt").val();
                        var TxtGrnNo = currentRow.find("#TxtGrnNo").val();
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit);
                        var totalTaxamt = $("#TotalTaxAmount").text();
                        var OCFOR = '';
                        OCFOR = ItmCode.toString().endsWith("R") ? "R" : "P";//ItmCode.EndsWith("R") ? "R" : "P";
                        if (OCFOR == "R") {
                            if (TaxBySlab == "GST Slab" && ItmCode == SlabItem && TaxCalcGRNNo == TxtGrnNo) {
                                if (currentRow.find("#TaxExempted").is(":checked")) {

                                }
                                else if (currentRow.find("#ManualGST").is(":checked") && totalTaxamt == TaxAmt) {
                                }
                                else {
                                    for (i = 0; i < TaxAmtDetail.length; i++) {
                                        if (TaxAmtDetail[i].TaxItmCode == ItmCode && TaxAmtDetail[i].DocNo == GRNNo) {
                                            NewArr.push(TaxAmtDetail[i]);
                                        }
                                        else { }
                                    }
                                }
                            }
                            else {
                                if (currentRow.find("#TaxExempted").is(":checked")) {
                                }
                                else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {
                                }
                                else {
                                    for (i = 0; i < TaxAmtDetail.length; i++) {
                                        if (TaxAmtDetail[i].TaxItmCode == ItmCode && TaxAmtDetail[i].DocNo == GRNNo) {
                                            NewArr.push(TaxAmtDetail[i]);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode && TaxAmtDetail[i].DocNo == GRNNo) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105108123") {
                var NewArr = [];
                $("#JOInvItmDetailsTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var ItmCode = currentRow.find("#hfItemID").val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var ItemTaxAmt = currentRow.find("#Txtitem_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                                else {
                                    //  NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105101150") {
                var NewArr = [];
                $("#ServicePIItemTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var RowSNo = currentRow.find("#SNohiddenfiled").val();
                    if ($("#SourceTypeV").is(":checked")) {
                        var ItmCode = currentRow.find("#hfItemID").val();
                    }
                    else {
                        var ItmCode = currentRow.find("#ServiceName" + RowSNo).val();
                    }
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var ItemTaxAmt = currentRow.find("#Txtitem_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                                else {
                                    //  NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            var TotalTaxAmountFinal = parseFloat(0).toFixed();
            if (docid == "105101145" || docid == "105101147") {/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
                for (i = 0; i < TaxAmtDetail.length; i++) {
                    debugger;
                    var TaxName = TaxAmtDetail[i].TaxName;
                    var TaxNameid = TaxAmtDetail[i].TaxNameID;
                    //var ItmCode = $("#hfItemID").val();
                    //if (ItmCode == TaxNameid) {
                    if (docid == "105101145" || docid == "105101147") {
                        var TaxRecov = TaxAmtDetail[i].TaxRecov;
                    }
                    //var Taxpercentage = TaxAmtDetail[i].TaxPercentage.replace("%", "");
                    var TaxAccId = TaxAmtDetail[i].TaxAccId;
                    var TotalTaxAmount = parseFloat(0).toFixed();

                    for (j = 0; j < TaxAmtDetail.length; j++) {
                        var TaxNamec = TaxAmtDetail[j].TaxName;
                        var TaxAmountc = TaxAmtDetail[j].TaxAmount;
                        if (TaxName == TaxNamec) {
                            TotalTaxAmount = parseFloat(TotalTaxAmount) + parseFloat(TaxAmountc);
                        }
                    }
                    //TaxAmtDetailF.push({ TaxNameId: TaxNameid, TaxName: TaxName, TotalTaxAmount: TotalTaxAmount, Taxpercentage: Taxpercentage });
                    if (docid == "105101145" || docid == "105101147") {
                        TaxAmtDetailF.push({ TaxNameId: TaxNameid, TaxName: TaxName, TaxRecov: TaxRecov, TotalTaxAmount: TotalTaxAmount, TaxAccId: TaxAccId });
                    }
                    else {
                        TaxAmtDetailF.push({ TaxNameId: TaxNameid, TaxName: TaxName, TotalTaxAmount: TotalTaxAmount, TaxAccId: TaxAccId });
                    }
                    //}
                }
                if (TaxAmtDetailF != null) {
                    if (TaxAmtDetailF.length > 0) {
                        var NewList = [];
                        var NewListTest = [];
                        $.each(TaxAmtDetailF, function (index, entry) {
                            if (!NewListTest[entry.TaxName]) {
                                NewListTest[entry.TaxName] = true;
                                NewList.push(entry);
                            }
                        });
                        $(ItemTaxAmountList_ID + " >tbody >tr").remove();
                        if (NewList != null) {
                            if (NewList.length > 0) {
                                for (k = 0; k < NewList.length; k++) {
                                    TotalTaxAmountFinal = (parseFloat(TotalTaxAmountFinal) + parseFloat(NewList[k].TotalTaxAmount)).toFixed(cmn_ValDecDigit);
                                    taxRecov = "";
                                    if (docid == "105101145" || docid == "105101147") {/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
                                        taxRecov = '<td id="taxRecov" class="center">' + (NewList[k].TaxRecov == 'Y' ? '<i class="fa fa-check text-success " aria-hidden="true"></i>' : '<i class="fa fa-times-circle text-danger" aria-hidden="true"></i>') + '</td>'
                                    }
                                    $(ItemTaxAmountList_ID + ' tbody').append(`<tr>
                                   <td id="TaxName">${NewList[k].TaxName}</td>
                                   `+ taxRecov + `
                                   <td id="TotalTaxAmount" class="num_right">${parseFloat(NewList[k].TotalTaxAmount).toFixed(cmn_ValDecDigit)}</td>
                                   <td hidden="hidden" id="taxID">${NewList[k].TaxNameId}</td>
                                   <td hidden="hidden" id="taxAccID">${NewList[k].TaxAccId}</td>
                                   </tr>`);
                                }
                            }
                        }
                        $(ItemTaxAmountTotal_ID).text(TotalTaxAmountFinal);
                    }
                }
            }
            else {
                for (i = 0; i < TaxAmtDetail.length; i++) {
                    var TaxName = TaxAmtDetail[i].TaxName;
                    var TaxNameid = TaxAmtDetail[i].TaxNameID;
                    if (docid == "105101145" || docid == "105101147") {/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
                        var TaxRecov = TaxAmtDetail[i].TaxRecov;
                    }
                    var Taxpercentage = TaxAmtDetail[i].TaxPercentage.replace("%", "");
                    var TotalTaxAmount = parseFloat(0).toFixed();

                    for (j = 0; j < TaxAmtDetail.length; j++) {
                        var TaxNamec = TaxAmtDetail[j].TaxName;
                        var TaxAmountc = TaxAmtDetail[j].TaxAmount;
                        if (TaxName == TaxNamec) {
                            TotalTaxAmount = parseFloat(TotalTaxAmount) + parseFloat(TaxAmountc);
                        }
                    }
                    if (docid == "105101145" || docid == "105101147") {
                        TaxAmtDetailF.push({ TaxNameId: TaxNameid, TaxName: TaxName, TotalTaxAmount: TotalTaxAmount, TaxRecov: TaxRecov, Taxpercentage: Taxpercentage });
                    }
                    else {
                        TaxAmtDetailF.push({ TaxNameId: TaxNameid, TaxName: TaxName, TotalTaxAmount: TotalTaxAmount, Taxpercentage: Taxpercentage });
                    }
                }
                if (TaxAmtDetailF != null) {
                    if (TaxAmtDetailF.length > 0) {
                        var NewList = [];
                        var NewListTest = [];
                        $.each(TaxAmtDetailF, function (index, entry) {
                            if (!NewListTest[entry.TaxName]) {
                                NewListTest[entry.TaxName] = true;
                                NewList.push(entry);
                            }
                        });


                        $(ItemTaxAmountList_ID + " >tbody >tr").remove();
                        if (NewList != null) {
                            if (NewList.length > 0) {
                                for (k = 0; k < NewList.length; k++) {
                                    TotalTaxAmountFinal = (parseFloat(TotalTaxAmountFinal) + parseFloat(NewList[k].TotalTaxAmount)).toFixed(cmn_ValDecDigit);
                                    taxRecov = "";
                                    if (docid == "105101145" || docid == "105101147") {/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
                                        taxRecov = '<td id="taxRecov" class="center">' + (NewList[k].TaxRecov == 'Y' ? '<i class="fa fa-check text-success " aria-hidden="true"></i>' : '<i class="fa fa-times-circle text-danger" aria-hidden="true"></i>') + '</td>'
                                    }
                                    $(ItemTaxAmountList_ID + ' tbody').append(`<tr>
                                     <td id="TaxName">${NewList[k].TaxName}</td>
                                     `+ taxRecov + `
                                     <td id="TotalTaxAmount" class="num_right">${parseFloat(NewList[k].TotalTaxAmount).toFixed(cmn_ValDecDigit)}</td>
                                     <td hidden="hidden" id="taxID">${NewList[k].TaxNameId}</td>
                                     <td hidden="hidden" id="TaxPerc">${NewList[k].Taxpercentage}</td>
                                     </tr>`);
                                }
                            }
                        }
                        $(ItemTaxAmountTotal_ID).text(TotalTaxAmountFinal);
                    }
                }
            }
        }
    }
}
function CMNBindTaxAmountDeatilsModel(TaxAmtDetail, ItemTaxAmountList_ID, ItemTaxAmountTotal_ID) {

    //var DecDigit = $("#ValDigit").text();
    var src_type = $("#src_type").val();
    var docid = $("#DocumentMenuId").val();
    //if (docid == "105103145127") {//Added by Suraj on 22-07-2024
    //    DecDigit = $("#ExpImpValDigit").text();
    //}
    $(ItemTaxAmountList_ID + " >tbody >tr").remove();
    $(ItemTaxAmountTotal_ID).text(parseFloat(0).toFixed(cmn_ValDecDigit));

    if (TaxAmtDetail != null) {
        if (TaxAmtDetail.length > 0) {
            var TaxAmtDetailF = [];
            if (docid == "105101130" || docid == "105101136") {
                var NewArr = [];
                $("#PoItmDetailsTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var RowSNo = currentRow.find("#SNohiddenfiled").val();
                    var ItmCode = currentRow.find("#POItemListName" + RowSNo).val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var ItemTaxAmt = currentRow.find("#item_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                                else {
                                    //  NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105103120") {
                var NewArr = [];
                $("#QTItmDetailsTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    //
                    var RowSNo = currentRow.find("#SNohiddenfiled").val();
                    var ItmCode = currentRow.find("#SQItemListName" + RowSNo).val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var ItemTaxAmt = currentRow.find("#item_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode != ItmCode) {

                                    }
                                    else {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode != ItmCode) {

                                    }
                                    else {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode != ItmCode) {

                                }
                                else {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105103125") {
                var NewArr = [];
                $("#SOItmDetailsTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    //
                    var RowSNo = currentRow.find("#SNohiddenfiled").val();
                    var ItmCode = currentRow.find("#SOItemListName" + RowSNo).val();
                    var QuotationNumber = currentRow.find("#QuotationNumber").val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var TaxCalcGRNNo = $("#TaxCalcGRNNo").val()
                        var ItemTaxAmt = currentRow.find("#item_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        var TaxAmt1 = "";
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem && TaxCalcGRNNo == QuotationNumber) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                if (QuotationNumber != null && QuotationNumber != "" && QuotationNumber != "Direct") {
                                    for (i = 0; i < TaxAmtDetail.length; i++) {
                                        if (TaxAmtDetail[i].TaxItmCode == ItmCode && TaxAmtDetail[i].DocNo == QuotationNumber) {
                                            NewArr.push(TaxAmtDetail[i]);
                                        }
                                        else {
                                            /* NewArr.push(TaxAmtDetail[i]);*/
                                        }
                                    }
                                }
                                else {
                                    for (i = 0; i < TaxAmtDetail.length; i++) {
                                        if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                            NewArr.push(TaxAmtDetail[i]);
                                        }
                                        else {
                                            /* NewArr.push(TaxAmtDetail[i]);*/
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt1) {

                            }
                            else {
                                if (QuotationNumber != null && QuotationNumber != "" && QuotationNumber != "Direct") {
                                    for (i = 0; i < TaxAmtDetail.length; i++) {
                                        if (TaxAmtDetail[i].TaxItmCode == ItmCode && TaxAmtDetail[i].DocNo == QuotationNumber) {
                                            NewArr.push(TaxAmtDetail[i]);
                                        }
                                        else {
                                            /* NewArr.push(TaxAmtDetail[i]);*/
                                        }
                                    }
                                }
                                else {
                                    for (i = 0; i < TaxAmtDetail.length; i++) {
                                        if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                            NewArr.push(TaxAmtDetail[i]);
                                        }
                                        else {
                                            /* NewArr.push(TaxAmtDetail[i]);*/
                                        }
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            if (QuotationNumber != null && QuotationNumber != "" && QuotationNumber != "Direct") {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode && TaxAmtDetail[i].DocNo == QuotationNumber) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        /* NewArr.push(TaxAmtDetail[i]);*/
                                    }
                                }
                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        /* NewArr.push(TaxAmtDetail[i]);*/
                                    }
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105103140") {
                var NewArr = [];
                $("#SInvItmDetailsTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var ItmCode = currentRow.find("#hfItemID").val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var ItemTaxAmt = currentRow.find("#Txtitem_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                                else {
                                    //  NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            /***Modifyed By Shubham Maurya on 26-10-2023 12:43 for custom invoice***/
            if (docid == "105103145127") {
                var NewArr = [];
                $("#SInvItmDetailsTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var ItmCode = currentRow.find("#hfItemID").val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var ItemTaxAmt = currentRow.find("#Txtitem_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if ($("#nontaxable").is(":checked")) {
                                //TotalTaxAmtF = 0;
                            }
                            else if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if ($("#nontaxable").is(":checked")) {
                                //TotalTaxAmtF = 0;
                            }
                            else if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if ($("#nontaxable").is(":checked")) {
                            //TotalTaxAmtF = 0;
                        }
                        else if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                                else {
                                    //  NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105108101") {
                var NewArr = [];
                $("#JoItmDetailsTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var RowSNo = currentRow.find("#SNohiddenfiled").val();
                    var ItmCode = currentRow.find("#JOItemListName" + RowSNo).val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var ItemTaxAmt = currentRow.find("#item_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                                else {
                                    //  NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105101152") {
                var NewArr = [];
                $("#POInvItmDetailsTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var RowSNo = currentRow.find("#SNohiddenfiled").val();
                    var ItmCode = currentRow.find("#TxtItemName_" + RowSNo).val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var ItemTaxAmt = currentRow.find("#item_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                                else {
                                    //  NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105101135") { /*Added By Nitesh 05-06-2024 for Manual Gst And Tax Exempted 105101135*/
                var NewArr = [];
                $("#SPOItmDetailsTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var RowSNo = currentRow.find("#SNohiddenfiled").val();
                    var ItmCode = currentRow.find("#ItemListName" + RowSNo).val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val();
                        var ItemTaxAmt = currentRow.find("#item_tax_amt").val();
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                                else {
                                    //  NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105103147") {/*Add By Hina Sharma on 02-01-2025  for Service Sale Invoice*/
                var NewArr = [];
                $("#ServiceSIItemTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var ItmCode = currentRow.find("#hfItemID").val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var ItemTaxAmt = currentRow.find("#Txtitem_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                                else {
                                    //  NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105103148" || docid == "105103149") {/*Add By Hina Sharma on 13-01-2025  for Direct/Scrap Sale Invoice*/
                var NewArr = [];
                $("#ScrapSIItemTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var ItmCode = currentRow.find("#hfItemID").val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var ItemTaxAmt = currentRow.find("#Txtitem_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                    else {
                                        //  NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                                else {
                                    //  NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            if (docid == "105101154") {
                var NewArr = [];
                $("#POInvItmDetailsTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var RowSNo = currentRow.find("#SNohiddenfiled").val();
                    var ItmCode = currentRow.find("#POItemListName" + RowSNo).val();
                    var GstApplicable = $("#Hdn_GstApplicable").text();
                    if (GstApplicable == "Y") {
                        var TaxBySlab = $("#taxTemplate").text();
                        var SlabItem = $("#Tax_ItemID").val()
                        var ItemTaxAmt = currentRow.find("#item_tax_amt").val()
                        var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
                        if (TaxBySlab == "GST Slab" && ItmCode == SlabItem) {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                        else {
                            if (currentRow.find("#TaxExempted").is(":checked")) {

                            }
                            else if (currentRow.find("#ManualGST").is(":checked") && ItemTaxAmt == TaxAmt) {

                            }
                            else {
                                for (i = 0; i < TaxAmtDetail.length; i++) {
                                    if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                        NewArr.push(TaxAmtDetail[i]);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        if (currentRow.find("#TaxExempted").is(":checked")) {

                        }
                        else {
                            for (i = 0; i < TaxAmtDetail.length; i++) {
                                if (TaxAmtDetail[i].TaxItmCode == ItmCode) {
                                    NewArr.push(TaxAmtDetail[i]);
                                }
                            }
                        }
                    }
                });
                TaxAmtDetail = null;
                TaxAmtDetail = [];
                TaxAmtDetail = NewArr;
            }
            var TotalTaxAmountFinal = parseFloat(0).toFixed();
            for (i = 0; i < TaxAmtDetail.length; i++) {

                var TaxName = TaxAmtDetail[i].TaxName;
                var TaxNameid = TaxAmtDetail[i].TaxNameID;
                var TaxRecov = TaxAmtDetail[i].TaxRecov;
                var TaxAccId = TaxAmtDetail[i].TaxAccId;
                var TotalTaxAmount = parseFloat(0).toFixed();

                for (j = 0; j < TaxAmtDetail.length; j++) {
                    var TaxNamec = TaxAmtDetail[j].TaxName;
                    var TaxAmountc = TaxAmtDetail[j].TaxAmount;
                    if (TaxName == TaxNamec) {
                        TotalTaxAmount = parseFloat(TotalTaxAmount) + parseFloat(TaxAmountc);
                    }
                }
                if (parseFloat(TotalTaxAmount) > 0) { // if Condition Added by Suraj on 08-08-2024 to avoid 0 in Tax & Other Charges Section 
                    TaxAmtDetailF.push({ TaxNameId: TaxNameid, TaxName: TaxName, TotalTaxAmount: TotalTaxAmount, TaxRecov: TaxRecov, TaxAccId: TaxAccId });
                }
                //TaxAmtDetailF.push({ TaxNameId: TaxNameid, TaxName: TaxName, TotalTaxAmount: TotalTaxAmount, TaxRecov: TaxRecov ,TaxAccId: TaxAccId });
            }
            if (TaxAmtDetailF != null) {
                if (TaxAmtDetailF.length > 0) {
                    var NewList = [];
                    var NewListTest = [];
                    $.each(TaxAmtDetailF, function (index, entry) {
                        if (!NewListTest[entry.TaxName]) {
                            NewListTest[entry.TaxName] = true;
                            NewList.push(entry);
                        }
                    });
                    ////

                    $(ItemTaxAmountList_ID + " >tbody >tr").remove();
                    if (NewList != null) {
                        if (NewList.length > 0) {
                            for (k = 0; k < NewList.length; k++) {
                                TotalTaxAmountFinal = (parseFloat(TotalTaxAmountFinal) + parseFloat(NewList[k].TotalTaxAmount)).toFixed(cmn_ValDecDigit);
                                var taxAccId = "";
                                var taxRecov = "";
                                if (docid == "105101152" || docid == "105103140" || docid == "105101150" || docid == "105101145" || docid == "105103147" || docid == "105103148" || docid == "105101154" || docid == "105101147" || docid == "105103149") {/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*//*Add docid == "105103147,105103148" By Hina Sharma on 02-01-2025,13-01-2025  for Service Sale Invoice,scrap sale invoice*/
                                    taxAccId = '<td hidden="hidden" id="taxAccID">' + NewList[k].TaxAccId + '</td>'
                                }
                                if (docid == "105101150" || docid == "105101152" || docid == "105101145" || docid == "105101154" || docid == "105101147") {/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
                                    taxRecov = '<td id="taxRecov" class="center">' + (NewList[k].TaxRecov == 'Y' ? '<i class="fa fa-check text-success " aria-hidden="true"></i>' : '<i class="fa fa-times-circle text-danger" aria-hidden="true"></i>') + '</td>'
                                }
                                $(ItemTaxAmountList_ID + ' tbody').append(`<tr>

<td>${NewList[k].TaxName}</td>
`+ taxRecov + `
<td id="TotalTaxAmount" class="num_right">${parseFloat(NewList[k].TotalTaxAmount).toFixed(cmn_ValDecDigit)}</td>
<td hidden="hidden" id="taxID">${NewList[k].TaxNameId}</td>
`+ taxAccId + `
</tr>`);
                            }

                        }
                    }
                    $(ItemTaxAmountTotal_ID).text(TotalTaxAmountFinal);

                }
            }
        }
    }
}
function CalTaxAmount() {
    // 
    //var DecDigit = $("#ValDigit").text();
    var TotalAMount = parseFloat(0).toFixed(cmn_ValDecDigit);

    $("#TaxCalculatorTbl >tbody >tr").each(function (i, row) {
        var currentRow = $(this);
        TotalAMount = (parseFloat(TotalAMount) + parseFloat(currentRow.find("#taxval").text())).toFixed(cmn_ValDecDigit);
    });

    $("#TaxCalculatorTbl #TotalTaxAmount").text(TotalAMount);
    var text;
};
function ResetLevelVal() {
    $("#Tax_Percentage").val("");
    $("#Tax_Amount").val("");
    $("#Tax_Type option[value=" + $('#Tax_Type').val() + "]").hide();
    $('#Tax_Type').val("0").prop('selected', true);

    if ($("#Tax_Level").val() == "1") {
        $("#Tax_Level option[value=" + 1 + "]").show();
        $("#Tax_Level option[value=" + 2 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if ($("#Tax_Level").val() == "2") {
        $("#Tax_Level option[value=" + 1 + "]").hide();
        $("#Tax_Level option[value=" + 2 + "]").show();
        $("#Tax_Level option[value=" + 3 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if ($("#Tax_Level").val() == "3") {
        $("#Tax_Level option[value=" + 2 + "]").hide();
        $("#Tax_Level option[value=" + 3 + "]").show();
        $("#Tax_Level option[value=" + 4 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if ($("#Tax_Level").val() == "4") {
        $("#Tax_Level option[value=" + 3 + "]").hide();
        $("#Tax_Level option[value=" + 4 + "]").show();
        $("#Tax_Level option[value=" + 5 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if ($("#Tax_Level").val() == "5") {
        $("#Tax_Level option[value=" + 4 + "]").hide();
        $("#Tax_Level option[value=" + 5 + "]").show();
        $("#Tax_Level option[value=" + 6 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if ($("#Tax_Level").val() == "6") {
        $("#Tax_Level option[value=" + 5 + "]").hide();
        $("#Tax_Level option[value=" + 6 + "]").show();
        $("#Tax_Level option[value=" + 7 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if ($("#Tax_Level").val() == "7") {
        $("#Tax_Level option[value=" + 6 + "]").hide();
        $("#Tax_Level option[value=" + 7 + "]").show();
        $("#Tax_Level option[value=" + 8 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if ($("#Tax_Level").val() == "8") {
        $("#Tax_Level option[value=" + 7 + "]").hide();
        $("#Tax_Level option[value=" + 8 + "]").show();
        $("#Tax_Level option[value=" + 9 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if ($("#Tax_Level").val() == "9") {
        $("#Tax_Level option[value=" + 8 + "]").hide();
        $("#Tax_Level option[value=" + 9 + "]").show();
        $("#Tax_Level option[value=" + 10 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
}
function Reset_ReOpen_LevelVal(TaxLevel) {
    $("#Tax_Percentage").val("");
    $("#Tax_Amount").val("");

    if (TaxLevel == "1") {
        $("#Tax_Level option[value=" + 1 + "]").show();
        $("#Tax_Level option[value=" + 2 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if (TaxLevel == "2") {
        $("#Tax_Level option[value=" + 1 + "]").hide();
        $("#Tax_Level option[value=" + 2 + "]").show();
        $("#Tax_Level option[value=" + 3 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if (TaxLevel == "3") {
        $("#Tax_Level option[value=" + 2 + "]").hide();
        $("#Tax_Level option[value=" + 3 + "]").show();
        $("#Tax_Level option[value=" + 4 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if (TaxLevel == "4") {
        $("#Tax_Level option[value=" + 3 + "]").hide();
        $("#Tax_Level option[value=" + 4 + "]").show();
        $("#Tax_Level option[value=" + 5 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if (TaxLevel == "5") {
        $("#Tax_Level option[value=" + 4 + "]").hide();
        $("#Tax_Level option[value=" + 5 + "]").show();
        $("#Tax_Level option[value=" + 6 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if (TaxLevel == "6") {
        $("#Tax_Level option[value=" + 5 + "]").hide();
        $("#Tax_Level option[value=" + 6 + "]").show();
        $("#Tax_Level option[value=" + 7 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if (TaxLevel == "7") {
        $("#Tax_Level option[value=" + 6 + "]").hide();
        $("#Tax_Level option[value=" + 7 + "]").show();
        $("#Tax_Level option[value=" + 8 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if (TaxLevel == "8") {
        $("#Tax_Level option[value=" + 7 + "]").hide();
        $("#Tax_Level option[value=" + 8 + "]").show();
        $("#Tax_Level option[value=" + 9 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
    if (TaxLevel == "9") {
        $("#Tax_Level option[value=" + 8 + "]").hide();
        $("#Tax_Level option[value=" + 9 + "]").show();
        $("#Tax_Level option[value=" + 10 + "]").show();
        $('#Tax_Level').val("0").prop('selected', true);
    }
}
function OnChangeTaxType() {
    if ($('#Tax_Type').val() == "0") {
        $('#SpanTaxName').text($("#valueReq").text());
        $("#SpanTaxName").css("display", "block");
        $("#Tax_Type").css("border-color", "red");
    }
    else {
        $("#SpanTaxName").css("display", "none");
        $("#Tax_Type").css("border-color", "#ced4da");
        BindTaxPercentage($('#Tax_Type').val());
    }
}
function OnChangeTaxPercentage() {
    // 
    if (AvoidDot($("#Tax_Percentage").val()) == false) {
        $("#Tax_Percentage").val("");
    }
    else {
        $("#Tax_Percentage").val($("#Tax_Percentage").val());
    }
    if ($('#Tax_Level').val() == "0") {
        //$('#SpanTaxLevel').text($("#valueReq").text());
        //$("#SpanTaxLevel").css("display", "block");
        //$("#Tax_Level").css("border-color", "red");
    }
    else {
        $("#SpanTaxLevel").css("display", "none");
        $("#Tax_Level").css("border-color", "#ced4da");
    }
    var taxpercent = parseFloat($("#Tax_Percentage").val());
    if ($('#Tax_Percentage').val() == "0" || $('#Tax_Percentage').val() == "" || taxpercent == 0) {
        $('#SpanTaxPercent').text($("#valueReq").text());
        $("#SpanTaxPercent").css("display", "block");
        $("#Tax_Percentage").css("border-color", "red");

    }
    else {
        $("#SpanTaxPercent").css("display", "none");
        $("#Tax_Percentage").css("border-color", "#ced4da");
    }

    //var ValDecDigit = $("#ValDigit").text();
    var AssAmount = $("#Tax_AssessableValue").val();
    var TaxPercentage = $("#Tax_Percentage").val();
    var AssAmtDec = parseFloat(AssAmount).toFixed(cmn_ValDecDigit);
    var TaxPercentageDec = parseFloat(TaxPercentage).toFixed(cmn_ValDecDigit);

    if ($("#Tax_ApplyOn option:selected").text() == "Immediate Level") {
        if ($("#Tax_Level").val() == "1") {
            if (AssAmtDec > 0 && TaxPercentageDec > 0) {
                var TaxAmt = AssAmtDec * TaxPercentageDec / 100;
                var FTaxAmt = parseFloat(TaxAmt).toFixed(cmn_ValDecDigit);
                $("#Tax_Amount").val(FTaxAmt);
            }
        }
        else {
            var TaxAMountColIL = parseFloat(0).toFixed(cmn_ValDecDigit);
            var TaxLevel = parseInt($("#Tax_Level").val()) - 1;
            $("#TaxCalculatorTbl >tbody >tr").each(function (i, row) {
                var currentRow = $(this);
                var Level = parseInt(currentRow.find("#taxlevel").text());
                if (TaxLevel == Level) {
                    TaxAMountColIL = (parseFloat(TaxAMountColIL) + parseFloat(currentRow.find("#taxval").text())).toFixed(cmn_ValDecDigit);
                }
            });
            if (AssAmtDec > 0 && TaxPercentageDec > 0) {
                var FinalAssAmtIL = (parseFloat(TaxAMountColIL)).toFixed(cmn_ValDecDigit);
                var TaxAmt = FinalAssAmtIL * TaxPercentageDec / 100;
                var FTaxAmt = parseFloat(TaxAmt).toFixed(cmn_ValDecDigit);
                $("#Tax_Amount").val(FTaxAmt);
            }
        }
    }
    if ($("#Tax_ApplyOn option:selected").text() == "Cummulative") {
        var Level = $("#Tax_Level").val();
        if ($("#Tax_Level").val() == "1") {
            if (AssAmtDec > 0 && TaxPercentageDec > 0) {
                var TaxAmt = AssAmtDec * TaxPercentageDec / 100;
                var FTaxAmt = parseFloat(TaxAmt).toFixed(cmn_ValDecDigit);
                $("#Tax_Amount").val(FTaxAmt);
            }
        }
        else {
            var TaxAMountCol = parseFloat(0).toFixed(cmn_ValDecDigit);
            $("#TaxCalculatorTbl >tbody >tr").each(function (i, row) {
                var currentRow = $(this);
                if (Level != currentRow.find("#taxlevel").text()) {
                    TaxAMountCol = (parseFloat(TaxAMountCol) + parseFloat(currentRow.find("#taxval").text())).toFixed(cmn_ValDecDigit);
                }
            });
            if (AssAmtDec > 0 && TaxPercentageDec > 0) {
                var FinalAssAmt = (parseFloat(AssAmtDec) + parseFloat(TaxAMountCol)).toFixed(cmn_ValDecDigit);
                var TaxAmt = FinalAssAmt * TaxPercentageDec / 100;
                var FTaxAmt = parseFloat(TaxAmt).toFixed(cmn_ValDecDigit);
                $("#Tax_Amount").val(FTaxAmt);
            }
        }
    }
    var tax_amount = parseFloat($('#Tax_Amount').val());
    if ($('#Tax_Amount').val() == "" || tax_amount <= 0) {
        //ValidInfo = "Y";
        //$('#SpanTaxAmounterr').text($("#valueReq").text());
        //$("#SpanTaxAmounterr").css("display", "block");
        //$("#Tax_Amount").css("border-color", "red");
    } else {
        $("#SpanTaxAmounterr").css("display", "none");
        $("#Tax_Amount").css("border-color", "#ced4da");
    }
}
function OnClickResetBtn() {
    ResetTaxCalculationDetails();
}
function OnClickDiscardAndExitBtn() {
    ResetTaxCalculationDetailsCrossButton();/*Added by Surbhi on 25/08/2025 for OC HSN Code Application*/
}
function ResetTaxCalculationDetailsCrossButton() {
    debugger;//
    $("#SpanTaxName").css("display", "none");
    $("#Tax_Type").css("border-color", "#ced4da");

    $("#SpanTaxPercent").css("display", "none");
    $("#Tax_Percentage").css("border-color", "#ced4da");

    $("#SpanTaxLevel").css("display", "none");
    $("#Tax_Level").css("border-color", "#ced4da");

    $("#SpanTaxAmounterr").css("display", "none");
    $("#Tax_Amount").css("border-color", "#ced4da");

    $("#TaxCalculatorTbl >tbody >tr").remove();
    $('#Tax_Type').val("0").prop('selected', true);
    $('#Tax_ApplyOn').val("I").prop('selected', true);
    $('#Tax_Percentage').val("");
    $('#Tax_Amount').val("");
    $("#Tax_Template").val(0);
    $('#TotalTaxAmount').text(parseFloat(0).toFixed(cmn_ValDecDigit));

    HideShowTaxLevel();
    BindTaxList("", "", "");
}
function ResetTaxCalculationDetails() {
    debugger;
    $("#SpanTaxName").css("display", "none");
    $("#Tax_Type").css("border-color", "#ced4da");

    $("#SpanTaxPercent").css("display", "none");
    $("#Tax_Percentage").css("border-color", "#ced4da");

    $("#SpanTaxLevel").css("display", "none");
    $("#Tax_Level").css("border-color", "#ced4da");

    $("#SpanTaxAmounterr").css("display", "none");
    $("#Tax_Amount").css("border-color", "#ced4da");

    $("#TaxCalculatorTbl >tbody >tr").remove();
    $('#Tax_Type').val("0").prop('selected', true);
    $('#Tax_ApplyOn').val("I").prop('selected', true);
    $('#Tax_Percentage').val("");
    $('#Tax_Amount').val("");
    $("#Tax_Template").val(0);
    $('#TotalTaxAmount').text(parseFloat(0).toFixed(cmn_ValDecDigit));

    HideShowTaxLevel();
    BindTaxList("", "", "");

    let text = $("#taxTemplate").text();    /*Added by Surbhi on 25/08/2025 for OC HSN Code Application*/
    var TaxSlab = text.replace(/\s+/g, '');
    if (TaxSlab == "GSTSlabOC") {
        var ocid = $("#TaxCalcItemCode").val();
        Cmn_OCHSNTaxes(ocid, "RESET");
        BindTaxSlablist();
    }
}
function OnClickAddTaxAmt() {
    var rowIdx = 0;

    var ValidInfo = "N";
    if ($('#Tax_Type').val() == "0" || $('#Tax_Type').val() == null) {
        ValidInfo = "Y";
        $('#SpanTaxName').text($("#valueReq").text());
        $("#SpanTaxName").css("display", "block");
        $("#Tax_Type").css("border-color", "red");
    } else {
        $("#SpanTaxName").css("display", "none");
        $("#Tax_Type").css("border-color", "#ced4da");
    }
    if ($('#Tax_Percentage').val() == "0" || $('#Tax_Percentage').val() == "") {
        ValidInfo = "Y";
        $('#SpanTaxPercent').text($("#valueReq").text());
        $("#SpanTaxPercent").css("display", "block");
        $("#Tax_Percentage").css("border-color", "red");
    } else {
        $("#SpanTaxPercent").css("display", "none");
        $("#Tax_Percentage").css("border-color", "#ced4da");
    }
    if ($('#Tax_Level').val() == "0") {
        ValidInfo = "Y";
        $('#SpanTaxLevel').text($("#valueReq").text());
        $("#SpanTaxLevel").css("display", "block");
        $("#Tax_Level").css("border-color", "red");
    } else {
        $("#SpanTaxLevel").css("display", "none");
        $("#Tax_Level").css("border-color", "#ced4da");
    }
    var tax_amount = parseFloat($('#Tax_Amount').val());
    if ($('#Tax_Amount').val() == "" || tax_amount <= 0) {
        ValidInfo = "Y";
        $('#SpanTaxAmounterr').text($("#valueReq").text());
        $("#SpanTaxAmounterr").css("display", "block");
        $("#Tax_Amount").css("border-color", "red");
    } else {
        $("#SpanTaxAmounterr").css("display", "none");
        $("#Tax_Amount").css("border-color", "#ced4da");
    }
    if (ValidInfo == "Y") {
        return false;
    }

    TaxTableDataBind(++rowIdx,
        $("#Tax_Type option:selected").text(), $("#Tax_Type").val(), $("#Tax_Percentage").val(), $("#Tax_Level").val(),
        $("#Tax_ApplyOn option:selected").text(), $("#Tax_Amount").val(), $("#Tax_ApplyOn").val(), 0, $('#Hdn_Tax_AccId').val(), "", $("#hdn_tax_recov").val()
    )
    CalTaxAmount();
    ResetLevelVal();
}
function HideShowTaxLevel() {
    $("#Tax_Level option[value=" + 1 + "]").show();
    $("#Tax_Level option[value=" + 2 + "]").hide();
    $("#Tax_Level option[value=" + 3 + "]").hide();
    $("#Tax_Level option[value=" + 4 + "]").hide();
    $("#Tax_Level option[value=" + 5 + "]").hide();
    $("#Tax_Level option[value=" + 6 + "]").hide();
    $("#Tax_Level option[value=" + 7 + "]").hide();
    $("#Tax_Level option[value=" + 8 + "]").hide();
    $("#Tax_Level option[value=" + 9 + "]").hide();
    $("#Tax_Level option[value=" + 10 + "]").hide();
    $('#Tax_Level').val("0").prop('selected', true);
}
function CMNAfterDeleteReset_ItemTaxDetail(ItmDetailsTbl_ID, SNohiddenfiled_ID, ItemListName_ID) {
    // 
    let NewArr = [];
    var FTaxDetails = JSON.parse(sessionStorage.getItem("TaxCalcDetails"));
    if (FTaxDetails != null) {
        if (FTaxDetails.length > 0) {
            $(ItmDetailsTbl_ID + " >tbody >tr").each(function () {
                // 
                var currentRow = $(this);
                var SNo = currentRow.find(SNohiddenfiled_ID).val();
                var ItemCode = "";
                ItemCode = currentRow.find(ItemListName_ID + SNo).val();
                for (i = 0; i < FTaxDetails.length; i++) {
                    var TaxRowID = FTaxDetails[i].RowSNo;
                    var TaxItemID = FTaxDetails[i].TaxItmCode;
                    if (TaxRowID == SNo && TaxItemID == ItemCode) {
                        NewArr.push(FTaxDetails[i]);
                    }
                }
            });
            sessionStorage.removeItem("TaxCalcDetails");
            sessionStorage.removeItem("TaxCalcDetailsQtsn");
            sessionStorage.setItem("TaxCalcDetails", JSON.stringify(NewArr));
            BindTaxAmountDeatils(NewArr);
        }
        else {
            sessionStorage.removeItem("TaxCalcDetails");
            sessionStorage.removeItem("TaxCalcDetailsQtsn");
            sessionStorage.setItem("TaxCalcDetails", JSON.stringify(NewArr));
        }
    }
    else {
        sessionStorage.removeItem("TaxCalcDetails");
        sessionStorage.removeItem("TaxCalcDetailsQtsn");
        sessionStorage.setItem("TaxCalcDetails", JSON.stringify(NewArr));
    }
}
function CMNAfterDeleteReset_ItemTaxDetailModel(ItmDetailsTbl_ID, SNohiddenfiled_ID, ItemListName_ID) {

    var DocumentMenuId = $("#DocumentMenuId").val();

    let NewArr = [];
    var FTaxDetails = $("#Hdn_TaxCalculatorTbl > tbody > tr").length;
    if (FTaxDetails > 0) {
        var array = [];
        var headers = [];
        $('#Hdn_TaxCalculatorTbl tbody tr:eq(0) td').each(function (index, item) {
            headers[index] = $(item)[0].id;//$(item).id;
        });
        $('#Hdn_TaxCalculatorTbl tbody tr').has('td').each(function () {
            var arrayItem = {};
            $('td', $(this)).each(function (index, item) {
                arrayItem[headers[index]] = $(item).html();
            });
            array.push(arrayItem);
        });

        if (array.length > 0) {
            $("#Hdn_TaxCalculatorTbl > tbody > tr").remove();
            $(ItmDetailsTbl_ID + " >tbody >tr").each(function () {
                // 
                var currentRow = $(this);
                var SNo = currentRow.find(SNohiddenfiled_ID).val();
                var ItemCode = "";
                ItemCode = currentRow.find(ItemListName_ID + SNo).val();
                var QuotationNumber = currentRow.find("#QuotationNumber").val();/*Add by hina on 04-06-2025 for multiple quotation under guidence suraj*/
                for (i = 0; i < array.length; i++) {
                    //var TaxRowID = array[i].RowSNo;
                    var TaxItemID = array[i].TaxItmCode;

                    /*Start code by hina on 04-06-2025 for multiple quotation under guidence suraj*/
                    var srcDocNo = array[i].DocNo;
                    let checkItem = false;

                    if (DocumentMenuId == "105103125") {
                        if (srcDocNo == "Direct") {//add by shubham Maurya on 13-08-2025
                            QuotationNumber = "Direct";
                        }
                        if (TaxItemID == ItemCode && srcDocNo == QuotationNumber) {
                            checkItem = true;
                        }
                    } else {
                        if (TaxItemID == ItemCode) {
                            checkItem = true;
                        }
                    }
                    /* if (*//*TaxRowID == SNo &&*//* TaxItemID == ItemCode) {*/
                    if (/*TaxRowID == SNo &&*/ /*TaxItemID == ItemCode && */checkItem) {
                        NewArr.push(array[i]);
                        $("#Hdn_TaxCalculatorTbl > tbody").append(`
                                <tr>
                                    <td id="DocNo">${array[i].DocNo}</td>
                                    <td id="DocDate">${array[i].DocDate}</td>                                
                                    <td id="TaxItmCode">${array[i].TaxItmCode}</td>
                                    <td id="TaxName">${array[i].TaxName}</td>
                                    <td id="TaxNameID">${array[i].TaxNameID}</td>
                                    <td id="TaxPercentage">${array[i].TaxPercentage}</td>
                                    <td id="TaxLevel">${array[i].TaxLevel}</td>
                                    <td id="TaxApplyOn">${array[i].TaxApplyOn}</td>
                                    <td id="TaxAmount">${array[i].TaxAmount}</td>
                                    <td id="TotalTaxAmount">${array[i].TotalTaxAmount}</td>
                                    <td id="TaxApplyOnID">${array[i].TaxApplyOnID}</td>
                                    ${(DocumentMenuId == "105102115101" || DocumentMenuId == "105101150" || DocumentMenuId == "105101152" || DocumentMenuId == "105101154") ? '<td id="TaxRecov">' + array[i].TaxRecov + '</td>' : ""}
                                    <td id="TaxAccId">${array[i].TaxAccId}</td>
                                </tr>`);
                    }
                }
            });

            BindTaxAmountDeatils(NewArr);
        }

    }

}

function CMNAfterDeleteReset_ItemTaxDetailModelForInvoices(ItmDetailsTbl_ID, SNohiddenfiled_ID, ItemListName_ID) {

    var DocumentMenuId = $("#DocumentMenuId").val();

    let NewArr = [];
    var FTaxDetails = $("#Hdn_TaxCalculatorTbl > tbody > tr").length;
    if (FTaxDetails > 0) {
        var array = [];
        var headers = [];
        $('#Hdn_TaxCalculatorTbl tbody tr:eq(0) td').each(function (index, item) {
            headers[index] = $(item)[0].id;//$(item).id;
        });
        $('#Hdn_TaxCalculatorTbl tbody tr').has('td').each(function () {
            var arrayItem = {};
            $('td', $(this)).each(function (index, item) {
                arrayItem[headers[index]] = $(item).html();
            });
            array.push(arrayItem);
        });

        if (array.length > 0) {
            $("#Hdn_TaxCalculatorTbl > tbody > tr").remove();
            $(ItmDetailsTbl_ID + " >tbody >tr").each(function () {
                // 
                var currentRow = $(this);
                var SNo = currentRow.find(SNohiddenfiled_ID).val();
                var ItemCode = "";
                ItemCode = currentRow.find(ItemListName_ID + SNo).val();

                for (i = 0; i < array.length; i++) {
                    //var TaxRowID = array[i].RowSNo;
                    var TaxItemID = array[i].TaxItmCode;
                    if (/*TaxRowID == SNo &&*/ TaxItemID == ItemCode) {
                        NewArr.push(array[i]);
                        $("#Hdn_TaxCalculatorTbl > tbody").append(`
                                <tr>
                                    <td id="DocNo">${array[i].DocNo}</td>
                                    <td id="DocDate">${array[i].DocDate}</td>                                
                                    <td id="TaxItmCode">${array[i].TaxItmCode}</td>
                                    <td id="TaxName">${array[i].TaxName}</td>
                                    <td id="TaxNameID">${array[i].TaxNameID}</td>
                                    <td id="TaxPercentage">${array[i].TaxPercentage}</td>
                                    <td id="TaxLevel">${array[i].TaxLevel}</td>
                                    <td id="TaxApplyOn">${array[i].TaxApplyOn}</td>
                                    <td id="TaxAmount">${array[i].TaxAmount}</td>
                                    <td id="TotalTaxAmount">${array[i].TotalTaxAmount}</td>
                                    <td id="TaxApplyOnID">${array[i].TaxApplyOnID}</td>
                                    ${(DocumentMenuId == "105102115101" || DocumentMenuId == "105101150") ? '<td id="TaxRecov">' + array[i].TaxRecov + '</td>' : ""}
                                    <td id="TaxAccId">${array[i].TaxAccId}</td>
                                </tr>`);
                    }
                }
            });

            BindTaxAmountDeatils(NewArr);
        }
    }
}

function BindTaxList(UserID, Sno, ItemID) {

    $.ajax({
        type: "POST",
        url: "/Common/Common/GetTaxTypeList",
        dataType: "json",
        data: {},
        success: function (data) {
            if (data == 'ErrorPage') {
                Comn_ErrorPage();
                return false;
            }

            if (data !== null && data !== "") {
                var arr = [];
                arr = JSON.parse(data);
                var s = '<option value="0">---Select---</option>';
                for (var i = 0; i < arr.Table.length; i++) {
                    s += '<option value="' + arr.Table[i].tax_id + '" text="' + arr.Table[i].tax_name + '">' + arr.Table[i].tax_name + '</option>';
                }
                $("#Tax_Type").html(s);
                // 
                var FTaxDetails = JSON.parse(sessionStorage.getItem("TaxCalcDetails"));

                if (FTaxDetails != null) {
                    if (FTaxDetails.length > 0) {
                        for (i = 0; i < FTaxDetails.length; i++) {
                            var TaxUserID = FTaxDetails[i].UserID;
                            var TaxRowID = FTaxDetails[i].RowSNo;
                            var TaxNameID = FTaxDetails[i].TaxNameID;
                            var TaxItemID = FTaxDetails[i].TaxItmCode;
                            var QTnumber = FTaxDetails[i].QTNo;
                            var QTdate = FTaxDetails[i].QTDate;
                            if (TaxUserID == UserID && TaxRowID == Sno && TaxItemID == ItemID) {
                                // if (TaxUserID == UserID && TaxItemID == ItemID) {
                                $("#Tax_Type option[value=" + TaxNameID + "]").hide();
                                $('#Tax_Type').val("0").prop('selected', true);
                            }
                        }
                    }
                }
            }
        },
        error: function (Data) {

        }
    });
};

function BindTaxListModel(UserID, Sno, ItemID) {

    $.ajax({
        type: "POST",
        url: "/Common/Common/GetTaxTypeList",
        dataType: "json",
        data: {},
        success: function (data) {
            if (data == 'ErrorPage') {
                Comn_ErrorPage();
                return false;
            }

            if (data !== null && data !== "") {
                var arr = [];
                arr = JSON.parse(data);
                var s = '<option value="0">---Select---</option>';
                for (var i = 0; i < arr.Table.length; i++) {
                    s += '<option value="' + arr.Table[i].tax_id + '" text="' + arr.Table[i].tax_name + '">' + arr.Table[i].tax_name + '</option>';
                }
                $("#Tax_Type").html(s);
                // 
                var TaxOn = $("#HdnTaxOn").val();
                var HdnTaxCalculateTable = "Hdn_TaxCalculatorTbl";
                if (TaxOn == "OC") {
                    HdnTaxCalculateTable = "Hdn_OC_TaxCalculatorTbl";
                }
                $("#TaxCalculatorTbl > tbody > tr").each(function () {
                    var Crow = $(this);
                    var TaxNameID = Crow.find("#taxid").text();
                    $("#Tax_Type option[value=" + TaxNameID + "]").hide();
                    $('#Tax_Type').val("0").prop('selected', true);
                });
                //$("#" + HdnTaxCalculateTable + " > tbody > tr").each(function () {
                //    var Crow = $(this);
                //    //var TaxUserID = Crow.find("#UserID").text();
                //    var TaxNameID = Crow.find("#TaxNameID").text();
                //    var TaxItemID = Crow.find("#TaxItmCode").text();
                //    //if (QTNO == null) { QTNO = "" };
                //    //if (QTDate == null) { QTDate = "" };
                //    if (TaxItemID == ItemID) {
                //        $("#Tax_Type option[value=" + TaxNameID + "]").hide();
                //        $('#Tax_Type').val("0").prop('selected', true);
                //    }
                //});
            }
        },
        error: function (Data) {

        }
    });
};
function BindTaxPercentage(TaxID) {

    $.ajax({
        type: "POST",
        url: "/Common/Common/GetTaxPercentList",
        dataType: "json",
        data: { TaxID: TaxID },
        success: function (data) {
            if (data == 'ErrorPage') {
                Comn_ErrorPage();
                return false;
            }
            if (data !== null && data !== "") {
                var arr = [];
                arr = JSON.parse(data);
                if (arr.Table.length > 0) {
                    $("#Tax_Percentage").val(arr.Table[0].tax_perc);
                    $("#hdn_tax_recov").val(arr.Table[0].tax_recov);
                    $("#Hdn_Tax_AccId").val(arr.Table[0].acc_id);

                    OnChangeTaxPercentage();
                }
            }
        },
        error: function (data) {

        }
    });
};

//------------------------------End------------------------------//

//------------------Terms And Condition Section------------------//
function CMNBindTermsTemplatelist(Term) {

    var DocumentMenuId = $("#DocumentMenuId").val();
    $.ajax({
        type: "POST",
        url: "/Common/Common/BindTermsTemplatelist",
        data: {
            DocumentMenuId: DocumentMenuId
        },
        success: function (data) {


            if (data != null && data != "" && data != "{}") {
                var arr = JSON.parse(data);
                if (arr.Table.length > 0) {
                    $("#TemplateTermsddl").attr("onchange", "OnChangeTermsTmpltDdl()")
                    $("#TemplateTermsddl option").remove();
                    for (var j = 0; j < arr.Table.length; j++) {
                        $("#TemplateTermsddl").append(`<option value='${arr.Table[j].tmplt_id}'>${arr.Table[j].tmplt_name}</option`);
                    }
                }
                var tmplt_id = $("#hd_terms_id").val();
                if (tmplt_id == "" || tmplt_id == null) {
                    tmplt_id = "0";
                }

                $("#TemplateTermsddl").select2();
            }
            if (Term == "Term") {
                $("#SaveAndExitBtn12").attr("data-dismiss", "modal");
            }
        }
    })
}
function OnChangeTermsTmpltDdl() {

    var tmplt_id = $("#TemplateTermsddl").val();
    if (tmplt_id == "0") {
        tmplt_id = $("#hd_terms_id").val();
    }
    $.ajax({
        type: "POST",
        url: "/Common/Common/BindTermsTemplateData",
        data: {
            tmplt_id: tmplt_id
        },
        success: function (data) {


            if (data != null && data != "" && data != "{}") {
                var arr = JSON.parse(data);
                if (arr.Table.length > 0) {
                    $('#TblTerms_Condition tbody tr').remove();
                    for (var i = 0; i < arr.Table.length; i++) {



                        var rowIdx = 0;
                        var deletetext = $("#Span_Delete_Title").text();
                        appendtermAndCondition(++rowIdx, arr.Table[i].term_desc);
                        //$('#TblTerms_Condition tbody').append(`
                        //                    <tr id="R${++rowIdx}" class="even pointer">
                        //                    <td class="red"><i class="deleteIcon fa fa-trash" id="TC_DelIcon" title="${deletetext}"></i> </td>
                        //                    <td id="term_desc">${ arr.Table[i].term_desc }</td>
                        //                    </tr>`
                        //);

                    }
                }

            }

        }
    })
}
function OnClickAddTermConditionDetail() {
    // 
    //var deletetext = $("#Span_Delete_Title").text();
    var rowIdx = 0;
    if ($('#TxtTerms_Condition').val() == "") {
        $('#SpanTerms_Condition').text($("#valueReq").text());
        $("#SpanTerms_Condition").css("display", "block");
        $("#TxtTerms_Condition").css("border-color", "red");
        return false;
    }
    if (CheckDuplicateTerm() === false) {
        $('#SpanTerms_Condition').text($("#valueduplicate").text());
        $("#SpanTerms_Condition").css("display", "block");
        $("#TxtTerms_Condition").css("border-color", "red");
        //$('#TxtTerms_Condition').val("");
        return false;
    }
    else {
        $("#SpanTerms_Condition").css("display", "none");
        $("#TxtTerms_Condition").css("border-color", "#ced4da");
    }
    appendtermAndCondition(++rowIdx, $('#TxtTerms_Condition').val());
    //    $('#TblTerms_Condition tbody').append(`<tr id="R${++rowIdx}" class="even pointer">
    //<td class="red"><i class="deleteIcon fa fa-trash" id="TC_DelIcon" title="${deletetext}"></i> </td>
    //<td id="term_desc">${$('#TxtTerms_Condition').val()}</td>

    //</tr>`);

    $("#TxtTerms_Condition").val("");
    DeleteTermCondition();
}
function appendtermAndCondition(rowIdx, TxtTerms) {
    var deletetext = $("#Span_Delete_Title").text();
    $('#TblTerms_Condition tbody').append(`<tr id="R${rowIdx}" class="even pointer">
<td class="red"><i class="deleteIcon fa fa-trash" id="TC_DelIcon" title="${deletetext}"></i> </td>
<td id="term_desc">${TxtTerms}</td>

</tr>`);
}
function CheckDuplicateTerm() {

    var TxtTerm = $('#TxtTerms_Condition').val();
    var DupliTerm = "";
    $("#TblTerms_Condition >tbody >tr").each(function () {
        // 
        var currentRow = $(this);
        var TermAndCondition = currentRow.find("#term_desc").text();
        if (TermAndCondition.toUpperCase() === TxtTerm.toUpperCase()) {
            DupliTerm = "Y";
        }
    });
    if (DupliTerm == "Y") {
        return false;
    }
    else {
        return true;
    }

}
function OnKeyPressTerm() {
    $("#SpanTerms_Condition").css("display", "none");
    $("#TxtTerms_Condition").css("border-color", "#ced4da");
}
function DeleteTermCondition() {
    $('#TblTerms_Condition tbody').on('click', '.deleteIcon', function () {
        $(this).closest('tr').remove();
    });
}
//------------------End------------------//
/* Used in : Stock Take,Opening Material Reciept */
function Cmn_RenderHtmlForBatch(rowIdx, GreyScale, SBatchQty, BatchNo, ExDate, ExDateHdn, MfgName, MfgMrp, MfgDate, MfgDateHdn) {
    //modified by Suraj Maurya on 25-11-2025 for mfg details
    $('#BatchDetailTbl tbody').append(`<tr id="R${rowIdx}">
 <td class=" red center"> <i class="fa fa-trash deleteIcon" ${GreyScale} id="BatchDeleteIcon" aria-hidden="true" title="Delete"></i></td>
<td id="BatchQty" class="num_right">${parseFloat(SBatchQty).toFixed(QtyDecDigit)}</td>
<td id="BatchNo" >${BatchNo}</td>
<td id="bt_mfg_name" >${MfgName}</td>
<td id="bt_mfg_mrp" class="num_right">${parseFloat(CheckNullNumber(MfgMrp)) == "0" ? "" : parseFloat(CheckNullNumber(MfgMrp)).toFixed(QtyDecDigit)}</td>
<td id="bt_mfg_date" >${MfgDate}</td>
<td id="bt_mfg_hdn_date" hidden="hidden">${MfgDateHdn}</td>
<td id="BatchExDate" hidden="hidden">${ExDateHdn}</td>
<td>${ExDate}</td>
</tr>`);
}
/* Used in : Stock Take,Opening Material Reciept */
function Cmn_RenderHtmlForSerial(rowIdx, GreyScale, tblSrNo, SerialNo, MfgName, MfgMrp, MfgDate, MfgDateHdn) {
    //modified by Suraj Maurya on 25-11-2025 for mfg details
    $('#SerialDetailTbl tbody').append(`<tr id="R${rowIdx}">
                    <td class=" red center"> <i class="fa fa-trash deleteIcon" ${GreyScale} aria-hidden="true" id="SerialDeleteIcon" title="${$("#Span_Delete_Title").text()}"></i></td>
<td id="SerialID" >${tblSrNo}</td>
<td id="SerialNo" >${SerialNo}</td>
<td id="sr_mfg_name" >${MfgName}</td>
<td id="sr_mfg_mrp" class="num_right" >${parseFloat(CheckNullNumber(MfgMrp)) == "0" ? "" : parseFloat(CheckNullNumber(MfgMrp)).toFixed(QtyDecDigit)}</td>
<td id="sr_mfg_date" >${MfgDate}</td>
<td id="sr_mfg_hdn_date" hidden="hidden">${MfgDateHdn}</td>
                </tr>`);
}
//---------------Batch Deatils-----------------------//
//--------USED IN -> Sample Receipt Old---------//
function Cmn_OnClickBatchDetailBtn(e, SNoID, IDItemName, hiddenfiledItemID, idUOM, hfexpiralble, ReceivedQuantity, EnableDisable, RowIdType) {

    ////var QtyDecDigit = $("#QtyDigit").text();
    ////var ValDecDigit = $("#ValDigit").text();
    //var RateDecDigit = $("#RateDigit").text();

    $("#SpanBatchQty").css("display", "none");
    $("#BatchQuantity").css("border-color", "#ced4da");

    $("#SpanBatchNo").css("display", "none");
    $("#txtBatchNumber").css("border-color", "#ced4da");

    $("#SpanBatchExDate").css("display", "none");
    $("#BatchExpiryDate").css("border-color", "#ced4da");

    Cmn_ResetBatchDetailVal();
    var clickedrow = $(e.target).closest("tr");
    var Sno = clickedrow.find(SNoID).text();
    if (Sno == "") {
        Sno = clickedrow.find(SNoID).val();
    }
    var UserID = $("#UserID").text();
    var ItemName = "";
    var ItemID = "";
    var ItemUOM = "";
    var ExpiryFlag = "";
    var ReceiveQty = 0;
    if (RowIdType == "number") {
        ItemName = clickedrow.find(IDItemName + Sno + " option:selected").text()
        if (ItemName == null || ItemName == "") {
            ItemName = clickedrow.find(IDItemName + Sno).val()
        }
        ItemID = clickedrow.find(hiddenfiledItemID + Sno).val()
        ItemUOM = clickedrow.find(idUOM + Sno).val();
        ExpiryFlag = clickedrow.find(hfexpiralble + Sno).val();
        ReceiveQty = clickedrow.find(ReceivedQuantity + Sno).val();
    } else {
        ItemName = clickedrow.find(IDItemName + Sno + " option:selected").text()
        if (ItemName == null || ItemName == "") {
            ItemName = clickedrow.find(IDItemName + Sno).val()
        }
        if (ItemName == null || ItemName == "") {
            ItemName = clickedrow.find(IDItemName + " option:selected").text();
            if (ItemName == null || ItemName == "") {
                ItemName = clickedrow.find(IDItemName).val();
            }
        }
        ItemID = clickedrow.find(hiddenfiledItemID).val();
        ItemUOM = clickedrow.find(idUOM).val();
        ExpiryFlag = clickedrow.find(hfexpiralble).val();
        ReceiveQty = clickedrow.find(ReceivedQuantity).val();
    }

    //if (AvoidDot(ReceiveQty) == false) {
    //    ReceiveQty = "0";
    //}
    var ReceQty = parseFloat(ReceiveQty).toFixed(cmn_QtyDecDigit);

    if (ReceQty == "NaN" || ReceQty == "" || ReceQty == "0") {
        //if (Sno != null && Sno != "") {
        //    $("#BtnBatchDetail" + Sno).attr("data-target", "");
        //}
        //else {
        $("#BtnBatchDetail").attr("data-target", "");
        //}
        return false;
    }
    else {
        //if (Sno != null && Sno != "") {
        //    $("#BtnBatchDetail" + Sno).attr("data-target", "#BatchNumber");
        //}
        //else {
        $("#BtnBatchDetail").attr("data-target", "#BatchNumber");
        //   }

    }

    $("#BatchItemName").val(ItemName);
    $("#batchUOM").val(ItemUOM);
    $("#BatchReceivedQuantity").val(ReceQty);
    $("#BatchSaveAndExitBtn").attr("data-dismiss", "");
    $("#hfItemSNo").val(Sno);
    $("#hfItemID").val(ItemID);
    $("#hfexpiryflag").val(ExpiryFlag);
    if (ExpiryFlag != "Y") {
        $("#spanexpiryrequire").css("display", "none");
    }
    else {
        $("#spanexpiryrequire").css("display", "");
    }

    var rowIdx = 0;
    var FBatchDetails = JSON.parse(sessionStorage.getItem("BatchDetailSession"));
    if (FBatchDetails != null) {
        if (FBatchDetails.length > 0) {
            $("#BatchDetailTbl >tbody >tr").remove();
            //$('#BatchQtyTotal').text(parseFloat(0).toFixed(cmn_ValDecDigit));
            for (i = 0; i < FBatchDetails.length; i++) {
                var SUserID = FBatchDetails[i].UserID;
                var SRowID = FBatchDetails[i].RowSNo;
                var SItemID = FBatchDetails[i].ItemID;
                if (Sno != null && Sno != "") {

                    if (SRowID == Sno && SItemID == ItemID) {
                        $('#BatchDetailTbl tbody').append(`<tr id="R${++rowIdx}">
 <td class=" red center"> <i class="fa fa-trash deleteIcon" id="BatchDeleteIcon" aria-hidden="true" title="Delete"></i></td>
<td id="BatchQty" class="num_right">${parseFloat(FBatchDetails[i].BatchQty).toFixed(cmn_QtyDecDigit)}</td>
<td id="BatchNo" >${FBatchDetails[i].BatchNo}</td>
<td id="BatchExDate" >${FBatchDetails[i].BatchExDate}</td>
</tr>`);
                    }
                }
                else {

                    if (SItemID == ItemID) {
                        $('#BatchDetailTbl tbody').append(`<tr id="R${++rowIdx}">
 <td class=" red center"> <i class="fa fa-trash deleteIcon" id="BatchDeleteIcon" aria-hidden="true" title="Delete"></i></td>
<td id="BatchQty" class="num_right">${parseFloat(FBatchDetails[i].BatchQty).toFixed(cmn_QtyDecDigit)}</td>
<td id="BatchNo" >${FBatchDetails[i].BatchNo}</td>
<td id="BatchExDate" >${FBatchDetails[i].BatchExDate}</td>
</tr>`);
                    }
                }

            }
            CalculateBatchQtyTbl();

            var EDStatus = sessionStorage.getItem(EnableDisable);
            if (EDStatus == "Disabled") {
                $("#BatchDetailTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    currentRow.find("#BatchDeleteIcon").css("display", "none");
                });
            }
        }
    }
    OnClickDeleteIcon();
}
/* Used in : Opening Material Reciept */
function Cmn_OnClickBatchDetailBtn_New(e, SNoID, IDItemName, hiddenfiledItemID, idUOM, hfexpiralble, ReceivedQuantity, EnableDisable, RowIdType) {
    //modified by Suraj Maurya on 25-11-2025 for mfg details
    $("#SpanBatchQty").css("display", "none");
    $("#BatchQuantity").css("border-color", "#ced4da");

    $("#SpanBatchNo").css("display", "none");
    $("#txtBatchNumber").css("border-color", "#ced4da");

    $("#SpanBatchExDate").css("display", "none");
    $("#BatchExpiryDate").css("border-color", "#ced4da");

    Cmn_ResetBatchDetailVal();
    var clickedrow = $(e.target).closest("tr");
    var Sno = clickedrow.find(SNoID).text();
    if (Sno == "") {
        Sno = clickedrow.find(SNoID).val();
    }
    var UserID = $("#UserID").text();
    var ItemName = "";
    var ItemID = "";
    var ItemUOM = "";
    var ExpiryFlag = "";
    var ReceiveQty = 0;
    if (RowIdType == "number") {
        ItemName = clickedrow.find(IDItemName + Sno + " option:selected").text()
        if (ItemName == null || ItemName == "") {
            ItemName = clickedrow.find(IDItemName + Sno).val()
        }
        ItemID = clickedrow.find(hiddenfiledItemID + Sno).val()
        ItemUOM = clickedrow.find(idUOM + Sno).val();
        ExpiryFlag = clickedrow.find(hfexpiralble + Sno).val();
        ReceiveQty = clickedrow.find(ReceivedQuantity + Sno).val();
    } else {
        ItemName = clickedrow.find(IDItemName + Sno + " option:selected").text()
        if (ItemName == null || ItemName == "") {
            ItemName = clickedrow.find(IDItemName + Sno).val()
        }
        if (ItemName == null || ItemName == "") {
            ItemName = clickedrow.find(IDItemName + " option:selected").text();
            if (ItemName == null || ItemName == "") {
                ItemName = clickedrow.find(IDItemName).val();
            }
        }
        ItemID = clickedrow.find(hiddenfiledItemID).val();
        ItemUOM = clickedrow.find(idUOM).val();
        ExpiryFlag = clickedrow.find(hfexpiralble).val();
        ReceiveQty = clickedrow.find(ReceivedQuantity).val();
    }

    //if (AvoidDot(ReceiveQty) == false) {
    //    ReceiveQty = "0";
    //}
    var ReceQty = parseFloat(ReceiveQty).toFixed(cmn_QtyDecDigit);

    if (ReceQty == "NaN" || ReceQty == "" || ReceQty == "0") {
        //if (Sno != null && Sno != "") {
        //    $("#BtnBatchDetail" + Sno).attr("data-target", "");
        //}
        //else {
        $("#BtnBatchDetail").attr("data-target", "");
        //}
        return false;
    }
    else {
        //if (Sno != null && Sno != "") {
        //    $("#BtnBatchDetail" + Sno).attr("data-target", "#BatchNumber");
        //}
        //else {
        $("#BtnBatchDetail").attr("data-target", "#BatchNumber");
        //   }

    }

    $("#BatchItemName").val(ItemName);
    $("#batchUOM").val(ItemUOM);
    $("#BatchReceivedQuantity").val(ReceQty);
    $("#BatchSaveAndExitBtn").attr("data-dismiss", "");
    $("#hfItemSNo").val(Sno);
    $("#hfItemID").val(ItemID);
    $("#hfexpiryflag").val(ExpiryFlag);
    if (ExpiryFlag != "Y") {
        $("#spanexpiryrequire").css("display", "none");
    }
    else {
        $("#spanexpiryrequire").css("display", "");
    }

    var rowIdx = 0;
    var FBatchDetails = JSON.parse(sessionStorage.getItem("BatchDetailSession"));
    if (FBatchDetails != null) {
        if (FBatchDetails.length > 0) {
            $("#BatchDetailTbl >tbody >tr").remove();
            //$('#BatchQtyTotal').text(parseFloat(0).toFixed(cmn_ValDecDigit));
            for (i = 0; i < FBatchDetails.length; i++) {
                var SUserID = FBatchDetails[i].UserID;
                var SRowID = FBatchDetails[i].RowSNo;
                var SItemID = FBatchDetails[i].ItemID;
                var mfg_name = FBatchDetails[i].mfg_name;
                var mfg_mrp = FBatchDetails[i].mfg_mrp;
                var mfg_date = FBatchDetails[i].mfg_date;
                var exp_date = FBatchDetails[i].BatchExDate;
                var mfgdate = Cmn_FormatDate_ddmmyyyy(FBatchDetails[i].mfg_date);
                if (Sno != null && Sno != "") {

                    if (SRowID == Sno && SItemID == ItemID) {
                        Cmn_RenderHtmlForBatch(++rowIdx, "", FBatchDetails[i].BatchQty, FBatchDetails[i].BatchNo, exp_date, FBatchDetails[i].BatchExDate, mfg_name, mfg_mrp, mfgdate, mfg_date);
                    }
                }
                else {

                    if (SItemID == ItemID) {
                        Cmn_RenderHtmlForBatch(++rowIdx, "", FBatchDetails[i].BatchQty, FBatchDetails[i].BatchNo, exp_date, FBatchDetails[i].BatchExDate, mfg_name, mfg_mrp, mfgdate, mfg_date);
                    }
                }

            }
            CalculateBatchQtyTbl();

            var EDStatus = sessionStorage.getItem(EnableDisable);
            if (EDStatus == "Disabled") {
                $("#BatchDetailTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    currentRow.find("#BatchDeleteIcon").css("display", "none");
                });
            }
        }
    }
    OnClickDeleteIcon();
}
/* Used In GRN(SC), batch partial */
function OnClickAddNewBatchDetail() {
    var rowIdx = 0;

    var ValidInfo = "N";
    //var QtyDecDigit = $("#QtyDigit").text();

    if ($('#BatchQuantity').val() == "0" || $('#BatchQuantity').val() == "") {
        ValidInfo = "Y";
        $("#BatchQuantity").css("border-color", "Red");
        $('#SpanBatchQty').text($("#valueReq").text());
        $("#SpanBatchQty").css("display", "block");
    }
    else {
        $("#SpanBatchQty").css("display", "none");
        $("#BatchQuantity").css("border-color", "#ced4da");
        var BQty = parseFloat($('#BatchQuantity').val()).toFixed(cmn_QtyDecDigit);
        var ReceiQty = parseFloat($('#BatchReceivedQuantity').val()).toFixed(cmn_QtyDecDigit);

        var TotalReceiQty = parseFloat(0).toFixed(cmn_QtyDecDigit);

        $("#BatchDetailTbl >tbody >tr").each(function () {
            var currentRow = $(this);

            var tblQty = parseFloat(currentRow.find("#BatchQty").text()).toFixed(cmn_QtyDecDigit);
            if (tblQty == null || tblQty == "") {
                tblQty = 0;
            }
            TotalReceiQty = (parseFloat(TotalReceiQty) + parseFloat(tblQty)).toFixed(cmn_QtyDecDigit);
        });

        TotalReceiQty = (parseFloat(TotalReceiQty) + parseFloat(BQty)).toFixed(cmn_QtyDecDigit);
        //Math.fround(ItmRate) > Math.fround(DisAmt)
        if (parseFloat(ReceiQty) < parseFloat(TotalReceiQty)) {
            //$('#BatchQuantity').val("");
            $("#BatchQuantity").css("border-color", "Red");
            $('#SpanBatchQty').text($("#BatchQuantityExceeds").text());
            $("#SpanBatchQty").css("display", "block");
            return false;
        }
        else {
            $('#BatchQuantity').val(parseFloat($('#BatchQuantity').val()).toFixed(cmn_QtyDecDigit));
        }
    }
    if ($('#txtBatchNumber').val() == "") {
        ValidInfo = "Y";
        $("#txtBatchNumber").css("border-color", "Red");
        $('#SpanBatchNo').text($("#valueReq").text());
        $("#SpanBatchNo").css("display", "block");
    }
    else {
        var BatchNo = $('#txtBatchNumber').val().toUpperCase();
        $("#BatchDetailTbl >tbody >tr").each(function () {
            var currentRow = $(this);

            var tblBtachNo = currentRow.find("#BatchNo").text().toUpperCase();
            if (tblBtachNo == BatchNo) {
                $('#SpanBatchNo').text($("#valueduplicate").text());
                $("#SpanBatchNo").css("display", "block");
                $("#txtBatchNumber").css("border-color", "Red");
                ValidInfo = "Y";
                return false;
            }
        });
    }

    if ($('#BatchExpiryDate').val() == "") {
        if ($("#hfexpiryflag").val() == 'Y') {
            ValidInfo = "Y";
            $("#BatchExpiryDate").css("border-color", "Red");
            $('#SpanBatchExDate').text($("#valueReq").text());
            $("#SpanBatchExDate").css("display", "block");
        }
    }
    var ExDate = $('#BatchExpiryDate').val().split('-');
    if ($('#BatchExpiryDate').val() != "") {
        if (ExDate[0].length > 4) {
            ValidInfo = "Y";
            $("#BatchExpiryDate").css("border-color", "Red");
            $('#SpanBatchExDate').text($("#JC_InvalidDate").text());
            $("#SpanBatchExDate").css("display", "block");
        }
        var currentdate = moment().format('YYYY-MM-DD');
        if ($('#BatchExpiryDate').val() < currentdate) {
            ValidInfo = "Y";
            $("#BatchExpiryDate").css("border-color", "Red");
            $('#SpanBatchExDate').text($("#JC_InvalidDate").text());
            $("#SpanBatchExDate").css("display", "block");
        }
    }

    if (ValidInfo == "Y") {
        return false;
    }

    $('#BatchDetailTbl tbody').append(`<tr id="R${++rowIdx}">
 <td class=" red center"> <i class="fa fa-trash deleteIcon" id="BatchDeleteIcon" aria-hidden="true" title="Delete"></i></td>
<td id="BatchQty" class="num_right">${parseFloat($("#BatchQuantity").val()).toFixed(cmn_QtyDecDigit)}</td>
<td id="BatchNo" >${$("#txtBatchNumber").val()}</td>
<td id="BatchExDate" >${$("#BatchExpiryDate").val()}</td>
</tr>`);

    ResetBatchDetailVal();
    CalculateBatchQtyTbl();
    OnClickDeleteIcon();
}
/* Used in : Stock Take, Opening Material Reciept */
function Cmn_OnClickAddNewBatchDetail() {//modified by Suraj Maurya on 25-11-2025 for mfg details
    var rowIdx = 0;
    var ValidInfo = "N";

    if ($('#BatchQuantity').val() == "0" || $('#BatchQuantity').val() == "") {
        ValidInfo = "Y";
        $("#BatchQuantity").css("border-color", "Red");
        $('#SpanBatchQty').text($("#valueReq").text());
        $("#SpanBatchQty").css("display", "block");
    }
    else {
        $("#SpanBatchQty").css("display", "none");
        $("#BatchQuantity").css("border-color", "#ced4da");
        var BQty = parseFloat($('#BatchQuantity').val()).toFixed(cmn_QtyDecDigit);
        var ReceiQty = parseFloat($('#BatchReceivedQuantity').val()).toFixed(cmn_QtyDecDigit);

        var TotalReceiQty = parseFloat(0).toFixed(cmn_QtyDecDigit);

        $("#BatchDetailTbl >tbody >tr").each(function () {
            var currentRow = $(this);

            var tblQty = parseFloat(currentRow.find("#BatchQty").text()).toFixed(cmn_QtyDecDigit);
            if (tblQty == null || tblQty == "") {
                tblQty = 0;
            }
            TotalReceiQty = (parseFloat(TotalReceiQty) + parseFloat(tblQty)).toFixed(cmn_QtyDecDigit);
        });

        TotalReceiQty = (parseFloat(TotalReceiQty) + parseFloat(BQty)).toFixed(cmn_QtyDecDigit);
        if (parseFloat(ReceiQty) < parseFloat(TotalReceiQty)) {
            $("#BatchQuantity").css("border-color", "Red");
            $('#SpanBatchQty').text($("#BatchQuantityExceeds").text());
            $("#SpanBatchQty").css("display", "block");
            return false;
        }
        else {
            $('#BatchQuantity').val(parseFloat($('#BatchQuantity').val()).toFixed(cmn_QtyDecDigit));
        }
    }
    if ($('#txtBatchNumber').val() == "") {
        ValidInfo = "Y";
        $("#txtBatchNumber").css("border-color", "Red");
        $('#SpanBatchNo').text($("#valueReq").text());
        $("#SpanBatchNo").css("display", "block");
    }
    else {
        var BatchNo = $('#txtBatchNumber').val().toUpperCase();
        $("#BatchDetailTbl >tbody >tr").each(function () {
            var currentRow = $(this);

            var tblBtachNo = currentRow.find("#BatchNo").text().toUpperCase();
            if (tblBtachNo == BatchNo) {
                $('#SpanBatchNo').text($("#valueduplicate").text());
                $("#SpanBatchNo").css("display", "block");
                $("#txtBatchNumber").css("border-color", "Red");
                ValidInfo = "Y";
                return false;
            }
        });
    }

    if ($('#BatchExpiryDate').val() == "") {
        if ($("#hfexpiryflag").val() == 'Y') {
            ValidInfo = "Y";
            $("#BatchExpiryDate").css("border-color", "Red");
            $('#SpanBatchExDate').text($("#valueReq").text());
            $("#SpanBatchExDate").css("display", "block");
        }
    }
    var ExDate = $('#BatchExpiryDate').val().split('-');
    if ($('#BatchExpiryDate').val() != "") {
        if (ExDate[0].length > 4) {
            ValidInfo = "Y";
            $("#BatchExpiryDate").css("border-color", "Red");
            $('#SpanBatchExDate').text($("#JC_InvalidDate").text());
            $("#SpanBatchExDate").css("display", "block");
        }
        var currentdate = moment().format('YYYY-MM-DD');
        if ($('#BatchExpiryDate').val() < currentdate) {
            ValidInfo = "Y";
            $("#BatchExpiryDate").css("border-color", "Red");
            $('#SpanBatchExDate').text($("#JC_InvalidDate").text());
            $("#SpanBatchExDate").css("display", "block");
        }
    }

    if (ValidInfo == "Y") {
        return false;
    }
    var mfg_date = $("#txtBtMfgDate").val();
    if (mfg_date != null && mfg_date != "") {
        mfg_date = moment(mfg_date).format('DD-MM-YYYY');
    }
    else {
        mfg_date = "";
    }
    Cmn_RenderHtmlForBatch(++rowIdx, "", $("#BatchQuantity").val(), $("#txtBatchNumber").val(), Cmn_FormatDate_ddmmyyyy($("#BatchExpiryDate").val()), $("#BatchExpiryDate").val(), $("#txtBtMfgName").val(), $("#txtBtMfgMRP").val(), mfg_date, $("#txtBtMfgDate").val());
//    $('#BatchDetailTbl tbody').append(`<tr id="R${++rowIdx}">
// <td class=" red center"> <i class="fa fa-trash deleteIcon" id="BatchDeleteIcon" aria-hidden="true" title="Delete"></i></td>
//<td id="BatchQty" class="num_right">${parseFloat($("#BatchQuantity").val()).toFixed(cmn_QtyDecDigit)}</td>
//<td id="BatchNo" >${$("#txtBatchNumber").val()}</td>
//<td id="bt_mfg_name" >${$("#txtBtMfgName").val()}</td>
//<td id="bt_mfg_mrp" class="num_right">${parseFloat(CheckNullNumber($("#txtBtMfgMRP").val())).toFixed(QtyDecDigit)}</td>
//<td id="bt_mfg_date" >${mfg_date}</td>
//<td id="bt_mfg_hdn_date" hidden="hidden">${$("#txtBtMfgDate").val()}</td>
//<td id="BatchExDate" >${$("#BatchExpiryDate").val()}</td>
//</tr>`);

    Cmn_ResetBatchDetailVal("Mfg_DoNotReset");
    Cmn_CalculateBatchQtyTbl();
    Cmn_OnClickDeleteIcon();
}

function ResetBatchDetailVal() {
    $('#BatchQuantity').val("");
    $('#txtBatchNumber').val("");
    $('#BatchExpiryDate').val("");
}
function Cmn_ResetBatchDetailVal(flag) {//modified by Suraj Maurya on 25-11-2025 for mfg details
    $('#BatchQuantity').val("");
    $("#SpanBatchQty").css("display", "none");
    $("#BatchQuantity").css("border-color", "#ced4da");
    $('#txtBatchNumber').val("");
    $('#BatchExpiryDate').val("");
    if (flag != "Mfg_DoNotReset") {
        $('#txtBtMfgName').val("");
        $('#txtBtMfgMRP').val("");
        $('#txtBtMfgDate').val("");
    }
}
function Cmn_OnChangeBatchQty() {

    //var QtyDecDigit = $("#QtyDigit").text();
    $("#BatchQuantity").css("border-color", "#ced4da");
    if ($('#BatchQuantity').val() != "0" && $('#BatchQuantity').val() != "" && $('#BatchQuantity').val() != "0" && $('#BatchQuantity').val() != parseFloat(0)  /**Added By Hina 02-03-2024 to parse Float show Blank Instead Of Zero**/) {
        $("#SpanBatchQty").css("display", "none");
        var BQty = parseFloat($('#BatchQuantity').val()).toFixed(cmn_QtyDecDigit);
        var ReceiQty = parseFloat($('#BatchReceivedQuantity').val()).toFixed(cmn_QtyDecDigit);

        var TotalReceiQty = parseFloat(0).toFixed(cmn_QtyDecDigit);

        $("#BatchDetailTbl >tbody >tr").each(function () {
            var currentRow = $(this);
            var tblQty = parseFloat(currentRow.find("#BatchQty").text()).toFixed(cmn_QtyDecDigit);
            if (tblQty == null || tblQty == "") {
                tblQty = 0;
            }
            TotalReceiQty = (parseFloat(TotalReceiQty) + parseFloat(tblQty)).toFixed(cmn_QtyDecDigit);
        });

        TotalReceiQty = (parseFloat(TotalReceiQty) + parseFloat(BQty)).toFixed(cmn_QtyDecDigit);
        //Math.fround(ItmRate) > Math.fround(DisAmt)
        if (parseFloat(ReceiQty) < parseFloat(TotalReceiQty)) {
            //$('#BatchQuantity').val("");
            $("#BatchQuantity").css("border-color", "Red");
            $('#SpanBatchQty').text($("#BatchQuantityExceeds").text());
            $("#SpanBatchQty").css("display", "block");
            return false;
        }
        else {
            $('#BatchQuantity').val(parseFloat($('#BatchQuantity').val()).toFixed(cmn_QtyDecDigit));
        }
    }
    else {
        $('#BatchQuantity').val(""); /**Added By Hina 02-03-2024 to show Blank Instead Of Zero**/
        $("#BatchQuantity").css("border-color", "Red");
        $('#SpanBatchQty').text($("#valueReq").text());
        $("#SpanBatchQty").css("display", "block");
    }
}
function OnKeyPressBatchNo() {
    $("#SpanBatchNo").css("display", "none");
    $("#txtBatchNumber").css("border-color", "#ced4da");
}
function OnChangeBatchExpiryDate() {
    if ($('#BatchExpiryDate').val() != "") {
        $("#SpanBatchExDate").css("display", "none");
        $("#BatchExpiryDate").css("border-color", "#ced4da");
    }
    else {
        if ($("#hfexpiryflag").val() == 'Y') {
            $("#BatchExpiryDate").css("border-color", "Red");
            $('#SpanBatchExDate').text($("#valueReq").text());
            $("#SpanBatchExDate").css("display", "block");
        }
    }
}
function CalculateBatchQtyTbl() {

    //var QtyDecDigit = $("#QtyDigit").text();
    var TotalReceiQty = parseFloat(0).toFixed(cmn_QtyDecDigit);
    $("#BatchDetailTbl >tbody >tr").each(function () {
        var currentRow = $(this);

        var tblQty = parseFloat(currentRow.find("#BatchQty").text()).toFixed(cmn_QtyDecDigit);
        if (tblQty == null || tblQty == "") {
            tblQty = 0;
        }
        TotalReceiQty = (parseFloat(TotalReceiQty) + parseFloat(tblQty)).toFixed(cmn_QtyDecDigit);
    });

    $('#BatchQtyTotal').text(parseFloat(TotalReceiQty).toFixed(cmn_QtyDecDigit));
}
/* Used in : Stock Take, Opening Material Reciept */
function Cmn_CalculateBatchQtyTbl() { //Created by Suraj Maurya on 25-11-2025
    var TotalReceiQty = parseFloat(0).toFixed(cmn_QtyDecDigit);
    $("#BatchDetailTbl >tbody >tr").each(function () {
        var currentRow = $(this);
        var tblQty = parseFloat(currentRow.find("#BatchQty").text()).toFixed(cmn_QtyDecDigit);
        if (tblQty == null || tblQty == "") {
            tblQty = 0;
        }
        TotalReceiQty = (parseFloat(TotalReceiQty) + parseFloat(tblQty)).toFixed(QtyDecDigit);
    });
    $('#BatchQtyTotal').text(parseFloat(TotalReceiQty).toFixed(QtyDecDigit));
}
function OnClickBatchResetBtn() {
    //var QtyDecDigit = $("#QtyDigit").text();
    ResetBatchDetailVal();
    $('#BatchDetailTbl tbody tr').remove();
    $('#BatchQtyTotal').text(parseFloat(0).toFixed(cmn_QtyDecDigit));

    $("#SpanBatchQty").css("display", "none");
    $("#BatchQuantity").css("border-color", "#ced4da");
    $("#SpanBatchNo").css("display", "none");
    $("#txtBatchNumber").css("border-color", "#ced4da");
    $("#SpanBatchExDate").css("display", "none");
    $("#BatchExpiryDate").css("border-color", "#ced4da");
}
function OnClickDeleteIcon() {
    $('#BatchDetailTbl tbody').on('click', '.deleteIcon', function () {

        // Getting all the rows next to the row 
        // containing the clicked button 
        var child = $(this).closest('tr').nextAll();
        // Iterating across all the rows  
        // obtained to change the index 
        child.each(function () {
            // Getting <tr> id. 
            var id = $(this).attr('id');
            // Getting the <p> inside the .row-index class. 
            var idx = $(this).children('.row-index').children('p');
            // Gets the row number from <tr> id. 
            var dig = parseInt(id.substring(1));
            // Modifying row index. 
            idx.html(`Row ${dig - 1}`);
            // Modifying row id. 
            $(this).attr('id', `R${dig - 1}`);
        });
        // Removing the current row. 
        $(this).closest('tr').remove();

        //var SNo = $(this).closest('tr')[0].cells[2].children[0].value;
        //var ItemCode = $(this).closest('tr')[0].cells[3].children[0].children[0].value;
        CalculateBatchQtyTbl();

    });
}
/* Used in : Stock Take, Opening Material Reciept */
function Cmn_OnClickDeleteIcon() {//modified by Suraj Maurya on 25-11-2025 for mfg details
    $('#BatchDetailTbl tbody').on('click', '.deleteIcon', function () {
        var child = $(this).closest('tr').nextAll();
        child.each(function () {
            var id = $(this).attr('id');
            var idx = $(this).children('.row-index').children('p');
            var dig = parseInt(id.substring(1));
            idx.html(`Row ${dig - 1}`);
            $(this).attr('id', `R${dig - 1}`);
        });
        $(this).closest('tr').remove();
        CalculateBatchQtyTbl();
    });
}

function OnClickDiscardAndExit() {
    OnClickBatchResetBtn();
}
function Cmn_OnClickSaveAndClose(ItmDetailsTbl, hiddenfiledItemID) {

    //var QtyDecDigit = $("#QtyDigit").text();
    var DocId = $("#DocumentMenuId").val();

    var ItemID = $('#hfItemID').val();
    var RowSNo = $("#hfItemSNo").val();
    var UserID = $("#UserID").text();

    var ReceiBQty = parseFloat($("#BatchReceivedQuantity").val()).toFixed(cmn_QtyDecDigit);
    var TotalBQty = parseFloat($("#BatchQtyTotal").text()).toFixed(cmn_QtyDecDigit);

    if (parseFloat(ReceiBQty) == parseFloat(TotalBQty)) {

        $("#BatchSaveAndExitBtn").attr("data-dismiss", "modal");

        let NewArr = [];
        var FBatchDetails = JSON.parse(sessionStorage.getItem("BatchDetailSession"));
        if (FBatchDetails != null) {
            if (FBatchDetails.length > 0) {
                for (i = 0; i < FBatchDetails.length; i++) {
                    var SUserID = FBatchDetails[i].UserID;
                    var SRowID = FBatchDetails[i].RowSNo;
                    var SItemID = FBatchDetails[i].ItemID;
                    if (SItemID == ItemID) {

                    }
                    else {
                        NewArr.push(FBatchDetails[i]);
                    }
                }
                $("#BatchDetailTbl >tbody >tr").each(function () {

                    var currentRow = $(this);
                    var BatchQty = currentRow.find("#BatchQty").text();
                    var BatchNo = currentRow.find("#BatchNo").text();
                    var BatchExDate = currentRow.find("#BatchExDate").text();
                    var mfg_name = currentRow.find("#bt_mfg_name").text();
                    var mfg_mrp = currentRow.find("#bt_mfg_mrp").text();
                    var mfg_date = currentRow.find("#bt_mfg_hdn_date").text();
                    NewArr.push({
                        UserID: UserID, RowSNo: RowSNo, ItemID: ItemID, BatchQty: BatchQty, BatchNo: BatchNo, BatchExDate: BatchExDate
                        , mfg_name: mfg_name, mfg_mrp: mfg_mrp, mfg_date: mfg_date
                    })
                });
                sessionStorage.removeItem("BatchDetailSession");
                sessionStorage.setItem("BatchDetailSession", JSON.stringify(NewArr));
            }
            else {
                var BatchDetailList = [];
                $("#BatchDetailTbl >tbody >tr").each(function () {

                    var currentRow = $(this);
                    var BatchQty = currentRow.find("#BatchQty").text();
                    var BatchNo = currentRow.find("#BatchNo").text();
                    var BatchExDate = currentRow.find("#BatchExDate").text();
                    var mfg_name = currentRow.find("#bt_mfg_name").text();
                    var mfg_mrp = currentRow.find("#bt_mfg_mrp").text();
                    var mfg_date = currentRow.find("#bt_mfg_hdn_date").text();

                    BatchDetailList.push({
                        UserID: UserID, RowSNo: RowSNo, ItemID: ItemID, BatchQty: BatchQty, BatchNo: BatchNo, BatchExDate: BatchExDate
                        , mfg_name: mfg_name, mfg_mrp: mfg_mrp, mfg_date: mfg_date
                    })
                });
                sessionStorage.setItem("BatchDetailSession", JSON.stringify(BatchDetailList));
            }
        }
        else {
            var BatchDetailList = [];
            $("#BatchDetailTbl >tbody >tr").each(function () {

                var currentRow = $(this);
                var BatchQty = currentRow.find("#BatchQty").text();
                var BatchNo = currentRow.find("#BatchNo").text();
                var BatchExDate = currentRow.find("#BatchExDate").text();
                var mfg_name = currentRow.find("#bt_mfg_name").text();
                var mfg_mrp = currentRow.find("#bt_mfg_mrp").text();
                var mfg_date = currentRow.find("#bt_mfg_hdn_date").text();

                BatchDetailList.push({
                    UserID: UserID, RowSNo: RowSNo, ItemID: ItemID, BatchQty: BatchQty, BatchNo: BatchNo, BatchExDate: BatchExDate
                    , mfg_name: mfg_name, mfg_mrp: mfg_mrp, mfg_date: mfg_date
                })
            });
            sessionStorage.setItem("BatchDetailSession", JSON.stringify(BatchDetailList));
        }

        $(ItmDetailsTbl + ">tbody >tr").each(function () {

            var clickedrow = $(this);
            var Sno = clickedrow.find("#SNo").text();
            var GRN_ItemID = clickedrow.find(hiddenfiledItemID + Sno).val();

            if (GRN_ItemID == ItemID) {
                clickedrow.find("#BtnBatchDetail" + Sno).css("border-color", "#007bff");
                /*Add by Hina on 05-02-2024 to validate Eye color for opening material receipt detail*/
                if (DocId == "105102115120") {
                    ValidateEyeColor(clickedrow, "BtnBatchDetail", "N");
                }

            }
        });
    }
    else {
        swal("", $("#Batchqtydoesnotmatchwithreceivedqty").text(), "warning");
    }

}

//------=========------------===========------------==========------------===========----------

function BindItemBatchDetail() {
    var batchrowcount = $('#SaveItemBatchTbl tbody tr').length;
    if (batchrowcount > 0) {
        var ItemBatchList = new Array();
        $("#SaveItemBatchTbl TBODY TR").each(function () {
            var row = $(this)
            if (parseFloat(CheckNullNumber(row.find('#mi_lineBatchIssueQty').val())) > 0) {
                var batchList = {};
                batchList.LotNo = row.find('#mi_lineBatchLotNo').val();
                batchList.ItemId = row.find('#mi_lineBatchItemId').val();
                batchList.UOMId = row.find('#mi_lineBatchUOMId').val();
                batchList.BatchNo = row.find('#mi_lineBatchBatchNo').val();
                batchList.IssueQty = row.find('#mi_lineBatchIssueQty').val();
                batchList.ExpiryDate = row.find('#mi_lineBatchExpiryDate').val();
                batchList.avl_batch_qty = row.find('#mi_lineBatchavl_batch_qty').val();
                batchList.mfg_name = row.find('#mi_lineBatchMfgName').text() || '';
                batchList.mfg_mrp = row.find('#mi_lineBatchMfgMrp').val() || '';
                batchList.mfg_date = row.find('#mi_lineBatchMfgDate').val() || '';
                ItemBatchList.push(batchList);
            }


        });
        var str1 = JSON.stringify(ItemBatchList);
        $("#HDSelectedBatchwise").val(str1);
    }
}
function Comn_BindItemBatchDetail() {
    var batchrowcount = $('#SaveItemBatchTbl tbody tr').length;
    if (batchrowcount > 0) {
        var ItemBatchList = new Array();
        $("#SaveItemBatchTbl TBODY TR").each(function () {
            var row = $(this)
            if (parseFloat(CheckNullNumber(row.find('#Batch_Qty').val())) > 0) {
                var batchList = {};
                batchList.LotNo = row.find('#Batch_LotNo').val();
                batchList.ItemId = row.find('#Batch_ItemId').val();
                batchList.UOMId = row.find('#Batch_UOMId').val();
                batchList.BatchNo = row.find('#Batch_BatchNo').val();
                batchList.IssueQty = row.find('#Batch_Qty').val();
                batchList.ExpiryDate = row.find('#Batch_ExpiryDate').val();
                batchList.avl_batch_qty = row.find('#Batch_AvlBatchQty').val();
                batchList.mfg_name = row.find('#Batch_MfgName').text() || '';
                batchList.mfg_mrp = row.find('#Batch_MfgMrp').val() || '';
                batchList.mfg_date = row.find('#Batch_MfgDate').val() || '';
                ItemBatchList.push(batchList);
            }


        });
        var str1 = JSON.stringify(ItemBatchList);
        $("#HDSelectedBatchwise").val(str1);
    }
}
function BindItemSerialDetail() {
    var serialrowcount = $('#SaveItemSerialTbl tbody tr').length;
    if (serialrowcount > 0) {
        var ItemSerialList = new Array();
        $("#SaveItemSerialTbl TBODY TR").each(function () {
            var row = $(this)
            var SerialList = {};
            SerialList.ItemId = row.find("#mi_lineSerialItemId").val();
            SerialList.UOMId = row.find("#mi_lineSerialUOMId").val();
            SerialList.LOTId = row.find("#mi_lineSerialLOTNo").val();
            SerialList.IssuedQuantity = row.find("#mi_lineSerialIssueQty").val();
            SerialList.SerialNO = row.find("#mi_lineSerialSerialNO").val();
            SerialList.mfg_name = row.find('#mi_lineSerialMfgName').val() || '';
            SerialList.mfg_mrp = row.find('#mi_lineSerialMfgMrp').val() || '';
            SerialList.mfg_date = row.find('#mi_lineSerialMfgDate').val() || '';
            ItemSerialList.push(SerialList);

        });
        var str2 = JSON.stringify(ItemSerialList);
        $("#HDSelectedSerialwise").val(str2);

    }

}
function Comn_BindItemSerialDetail() {
    var serialrowcount = $('#SaveItemSerialTbl tbody tr').length;
    if (serialrowcount > 0) {
        var ItemSerialList = new Array();
        $("#SaveItemSerialTbl TBODY TR").each(function () {
            var row = $(this)
            var SerialList = {};
            SerialList.ItemId = row.find("#Serial_ItemId").val();
            SerialList.UOMId = row.find("#Serial_UOMId").val();
            SerialList.LOTId = row.find("#Serial_LOTNo").val();
            SerialList.IssuedQuantity = row.find("#Serial_Qty").val();
            SerialList.SerialNO = row.find("#Serial_SerialNo").val();
            SerialList.mfg_name = row.find('#Serial_MfgName').val() || '';
            SerialList.mfg_mrp = row.find('#Serial_MfgMrp').val() || '';
            SerialList.mfg_date = row.find('#Serial_MfgDate').val() || '';
            ItemSerialList.push(SerialList);

        });
        var str2 = JSON.stringify(ItemSerialList);
        $("#HDSelectedSerialwise").val(str2);

    }

}
function onclickbtnItemBatchReset() {
    $("#MI_ItemBatchTbl TBODY TR").each(function () {
        var row = $(this);
        row.find("#IssuedQuantity").val("");
    });
    $("#MI_TotalIssuedQuantity").val("");
}
function Cmn_ItemStockBatchWise(evt, ItemNameID, UOMID, ReceiptQuantityID, hdItemId) {
    try {

        //var QtyDecDigit = $("#QtyDigit").text();///Quantity
        var clickedrow = $(evt.target).closest("tr");
        var IssueQuantity = clickedrow.find("#IssuedQuantity").val();
        var ItemName = clickedrow.find(ItemNameID).val();
        var UOMName = clickedrow.find(UOMID).val();
        var ReceiptQuantity = clickedrow.find(ReceiptQuantityID).val();
        var ItemId = clickedrow.find(hdItemId).val();
        //var UOMId = clickedrow.find("#hdUOMId").val();
        //var TRFType = $('#TransferType').val();      
        //var MINo = $('#ddlMI_No option:selected').text();
        //var MIDate = $('#txtMI_Date').val();
        //var frombranch = $("#Fr_branch").val();
        $("#ItemNameBatchWise").val(ItemName);
        $("#UOMBatchWise").val(UOMName);
        $("#BatchReceivedQuantity").val(ReceiptQuantity);
        if (parseFloat(IssueQuantity) == "0" || parseFloat(IssueQuantity) == "") {
            $("#BatchNumber").css("display", "block");
            clickedrow.find("#IssuedQuantity_Error").text($("#FillQuantity").text());
            clickedrow.find("#IssuedQuantity_Error").css("display", "block");
            clickedrow.find("#IssuedQuantity").css("border-color", "red");
        }
        else {
            var Mrs_IssueType = $("#TransferType").val();
            var FBatchDetails = JSON.parse(sessionStorage.getItem("BatchDetailSession"));
            if (FBatchDetails != null) {
                if (FBatchDetails.length > 0) {
                    $("#BatchDetailTbl >tbody >tr").remove();
                    for (i = 0; i < FBatchDetails.length; i++) {
                        var SItemID = FBatchDetails[i].ItemID;
                        if (SItemID == ItemId) {
                            $('#BatchDetailTbl tbody').append(`<tr> 
<input type="hidden" id="hdItemId" value="${FBatchDetails[i].ItemID}" style="display: none;"/>
<td id="BatchQty1" class="num_right">${parseFloat(FBatchDetails[i].BatchQty).toFixed(cmn_QtyDecDigit)}</td>
<td id="BatchNo1" >${FBatchDetails[i].BatchNo}</td>
<td>${FBatchDetails[i].BatchExpDate}</td>
<input type="hidden" id="hfExDate" value="${FBatchDetails[i].BatchExpDate}"/>

</tr>`);
                        }
                    }
                }
                else {
                    var BatchDetailList = [];
                    $("#BatchDetailTbl >tbody >tr").each(function () {

                        var currentRow = $(this);
                        var ItemID = currentRow.find("#hdItemId").val();
                        var BatchQty = currentRow.find("#BatchQty1").text();
                        var BatchNo = currentRow.find("#BatchNo1").text();
                        var BatchExpDate = currentRow.find("#hfExDate").val();
                        if (BatchExpDate == "null") {
                            BatchExpDate = "01-Jan-1900"
                        }

                        BatchDetailList.push({ ItemID: ItemID, BatchQty: BatchQty, BatchNo: BatchNo, BatchExpDate: BatchExpDate })
                    });
                    sessionStorage.removeItem("BatchDetailSession");
                    sessionStorage.setItem("BatchDetailSession", JSON.stringify(BatchDetailList));

                    var FBatchDetails = JSON.parse(sessionStorage.getItem("BatchDetailSession"));
                    if (FBatchDetails != null) {
                        if (FBatchDetails.length > 0) {
                            $("#BatchDetailTbl >tbody >tr").remove();
                            for (i = 0; i < FBatchDetails.length; i++) {
                                var SItemID = FBatchDetails[i].ItemID;
                                if (SItemID == ItemId) {
                                    $('#BatchDetailTbl tbody').append(`<tr> 
<input type="hidden" id="hdItemId" value="${FBatchDetails[i].ItemID}" style="display: none;"/>
<td id="BatchQty1" class="num_right">${parseFloat(FBatchDetails[i].BatchQty).toFixed(cmn_QtyDecDigit)}</td>
<td id="BatchNo1" >${FBatchDetails[i].BatchNo}</td>
<td>${FBatchDetails[i].BatchExDate}</td>
<input type="hidden" id="hfExDate" value="${FBatchDetails[i].BatchExpDate}"/>

</tr>`);
                                }
                            }
                        }
                    }
                }
            }
            else {
                var BatchDetailList = [];
                $("#BatchDetailTbl >tbody >tr").each(function () {

                    var currentRow = $(this);
                    var ItemID = currentRow.find("#hdItemId").val();
                    var BatchQty = currentRow.find("#BatchQty1").text();
                    var BatchNo = currentRow.find("#BatchNo1").text();
                    var BatchExpDate = currentRow.find("#hfExDate").val();
                    if (BatchExpDate == "null") {
                        BatchExpDate = "01-Jan-1900"
                    }

                    BatchDetailList.push({ ItemID: ItemID, BatchQty: BatchQty, BatchNo: BatchNo, BatchExpDate: BatchExpDate })
                });
                sessionStorage.removeItem("BatchDetailSession");
                sessionStorage.setItem("BatchDetailSession", JSON.stringify(BatchDetailList));

                var FBatchDetails = JSON.parse(sessionStorage.getItem("BatchDetailSession"));
                if (FBatchDetails != null) {
                    if (FBatchDetails.length > 0) {
                        $("#BatchDetailTbl >tbody >tr").remove();
                        for (i = 0; i < FBatchDetails.length; i++) {
                            var SItemID = FBatchDetails[i].ItemID;
                            if (SItemID == ItemId) {
                                $('#BatchDetailTbl tbody').append(`<tr> 
<input type="hidden" id="hdItemId" value="${FBatchDetails[i].ItemID}" style="display: none;"/>
<td id="BatchQty1" class="num_right">${parseFloat(FBatchDetails[i].BatchQty).toFixed(cmn_QtyDecDigit)}</td>
<td id="BatchNo1" >${FBatchDetails[i].BatchNo}</td>
<td>${FBatchDetails[i].BatchExDate}</td>
<input type="hidden" id="hfExDate" value="${FBatchDetails[i].BatchExpDate}"/>

</tr>`);
                            }
                        }
                    }
                }
            }

        }
    } catch (err) {
        console.log("UserValidate Error : " + err.message);
    }
}

//------=========------------===========------------==========------------===========----------

//----------------------End-----------------------//

//-------------------Serial Deatils-----------------------//
//--------USED IN -> SR,----------//

function Cmn_OnClickSerialDetailBtn(e, SNo, IDItemName, hiddenfiledItemID, idUOM, ReceivedQuantity, EnableDisable, RowIdType) {

    //var QtyDecDigit = $("#QtyDigit").text();
    var clickedrow = $(e.target).closest("tr");

    var Sno = clickedrow.find(SNo).text();
    if (Sno == "") {
        Sno = clickedrow.find(SNo).val();
    }
    var UserID = $("#UserID").text();
    var ItemName = "";
    var ItemID = "";
    var ItemUOM = "";
    //var ExpiryFlag = "";
    var ReceiveQty = 0;

    if (RowIdType == "number") {
        ItemName = clickedrow.find(IDItemName + Sno + " option:selected").text()
        if (ItemName == null || ItemName == "") {
            ItemName = clickedrow.find(IDItemName + Sno).val()
        }
        ItemID = clickedrow.find(hiddenfiledItemID + Sno).val()
        ItemUOM = clickedrow.find(idUOM + Sno).val();
        // ExpiryFlag = clickedrow.find(hfexpiralble + Sno).val();
        ReceiveQty = clickedrow.find(ReceivedQuantity + Sno).val();
    } else {
        ItemName = clickedrow.find(IDItemName + Sno + " option:selected").text()
        if (ItemName == null || ItemName == "") {
            ItemName = clickedrow.find(IDItemName + Sno).val()
        }
        if (ItemName == null || ItemName == "") {
            ItemName = clickedrow.find(IDItemName + " option:selected").text()
            if (ItemName == null || ItemName == "") {
                ItemName = clickedrow.find(IDItemName).val()
            }
        }
        ItemID = clickedrow.find(hiddenfiledItemID).val();
        ItemUOM = clickedrow.find(idUOM).val();
        //  ExpiryFlag = clickedrow.find(hfexpiralble).val();
        ReceiveQty = clickedrow.find(ReceivedQuantity).val();
    }

    //ItemName = clickedrow.find(IDItemName + Sno).val()
    //ItemID = clickedrow.find(hiddenfiledItemID + Sno).val()
    //ItemUOM = clickedrow.find(idUOM + Sno).val();
    ////ExpiryFlag = clickedrow.find("#hfexpiralble" + Sno).val();
    //ReceiveQty = clickedrow.find("#ReceivedQuantity" + Sno).val();

    var ReceQty = parseFloat(ReceiveQty).toFixed(cmn_QtyDecDigit);

    if (ReceQty == "NaN" || ReceQty == "" || ReceQty == "0") {
        //if (Sno != null && Sno != "") {
        //    $("#BtnSerialDetail" + Sno).attr("data-target", "");
        //}
        //else {
        $("#BtnSerialDetail").attr("data-target", "");
        //  }

        return false;
    }
    else {
        //if (Sno != null && Sno != "") {
        //    $("#BtnSerialDetail" + Sno).attr("data-target", "#SerialDetail");
        //}
        //else {
        $("#BtnSerialDetail").attr("data-target", "#SerialDetail");
        //  }
        //$("#BtnSerialDetail" + Sno).attr("data-target", "#SerialDetail");
    }


    $("#SerialItemName").val(ItemName);
    $("#serialUOM").val(ItemUOM);
    $("#SerialReceivedQuantity").val(ReceQty);
    //$("#SerialSaveAndExitBtn").attr("data-dismiss", "modal");
    $("#hfSItemSNo").val(Sno);
    $("#hfSItemID").val(ItemID);

    var rowIdx = 0;
    var FSerialDetails = JSON.parse(sessionStorage.getItem("SerialDetailSession"));
    if (FSerialDetails != null) {
        if (FSerialDetails.length > 0) {
            $("#SerialDetailTbl >tbody >tr").remove();
            for (i = 0; i < FSerialDetails.length; i++) {
                var SUserID = FSerialDetails[i].UserID;
                var SRowID = FSerialDetails[i].RowSNo;
                var SItemID = FSerialDetails[i].ItemID;
                if (SNo != null && SNo != "") {
                    if (SRowID == Sno && SItemID == ItemID) {/*id="TblLen" is added by Suraj on 07-10-2024*/
                        $('#SerialDetailTbl tbody').append(`<tr id="R${++rowIdx}">
 <td class=" red center"> <i class="fa fa-trash deleteIcon" aria-hidden="true" id="SerialDeleteIcon" title="Delete"></i></td>
<td id="TblLen">${rowIdx}</td>
<td id="SerialNo1" >${FSerialDetails[i].SerialNo}</td>
</tr>`);
                    }
                    else {
                        if (SItemID == ItemID) {/*id="TblLen" is added by Suraj on 07-10-2024*/
                            $('#SerialDetailTbl tbody').append(`<tr id="R${++rowIdx}">
 <td class=" red center"> <i class="fa fa-trash deleteIcon" aria-hidden="true" id="SerialDeleteIcon" title="Delete"></i></td>
<td id="TblLen">${rowIdx}</td>
<td id="SerialNo1" >${FSerialDetails[i].SerialNo}</td>
</tr>`);
                        }
                    }
                }


            }
            var EDStatus = sessionStorage.getItem(EnableDisable);
            if (EDStatus == "Disabled") {
                $("#SerialDetailTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    currentRow.find("#SerialDeleteIcon").css("display", "none");
                });
            }
        }
        else {
            $("#SerialDetailTbl >tbody >tr").remove();
        }
    }
    else {
        $("#SerialDetailTbl >tbody >tr").remove();
    }
    OnClickSerialDeleteIcon();
}
/* Used in : Opening Material Reciept */
function Cmn_OnClickSerialDetailBtn_New(e, SNo, IDItemName, hiddenfiledItemID, idUOM, ReceivedQuantity, EnableDisable, RowIdType) {
    //modified by Suraj Maurya on 25-11-2025 for mfg details
    var clickedrow = $(e.target).closest("tr");

    var Sno = clickedrow.find(SNo).text();
    if (Sno == "") {
        Sno = clickedrow.find(SNo).val();
    }
    var UserID = $("#UserID").text();
    var ItemName = "";
    var ItemID = "";
    var ItemUOM = "";
    var ReceiveQty = 0;

    if (RowIdType == "number") {
        ItemName = clickedrow.find(IDItemName + Sno + " option:selected").text()
        if (ItemName == null || ItemName == "") {
            ItemName = clickedrow.find(IDItemName + Sno).val()
        }
        ItemID = clickedrow.find(hiddenfiledItemID + Sno).val()
        ItemUOM = clickedrow.find(idUOM + Sno).val();
        ReceiveQty = clickedrow.find(ReceivedQuantity + Sno).val();
    } else {
        ItemName = clickedrow.find(IDItemName + Sno + " option:selected").text()
        if (ItemName == null || ItemName == "") {
            ItemName = clickedrow.find(IDItemName + Sno).val()
        }
        if (ItemName == null || ItemName == "") {
            ItemName = clickedrow.find(IDItemName + " option:selected").text()
            if (ItemName == null || ItemName == "") {
                ItemName = clickedrow.find(IDItemName).val()
            }
        }
        ItemID = clickedrow.find(hiddenfiledItemID).val();
        ItemUOM = clickedrow.find(idUOM).val();
        ReceiveQty = clickedrow.find(ReceivedQuantity).val();
    }

    var ReceQty = parseFloat(CheckNullNumber(ReceiveQty)).toFixed(cmn_QtyDecDigit);

    if (ReceQty == "NaN" || ReceQty == "" || ReceQty == "0") {
        $("#BtnSerialDetail").attr("data-target", "");
        return false;
    }
    else {
        $("#BtnSerialDetail").attr("data-target", "#SerialDetail");
    }


    $("#SerialItemName").val(ItemName);
    $("#serialUOM").val(ItemUOM);
    $("#SerialReceivedQuantity").val(ReceQty);
    $("#hfSItemSNo").val(Sno);
    $("#hfSItemID").val(ItemID);

    var rowIdx = 0;
    var FSerialDetails = JSON.parse(sessionStorage.getItem("SerialDetailSession"));
    if (FSerialDetails != null) {
        if (FSerialDetails.length > 0) {
            $("#SerialDetailTbl >tbody >tr").remove();
            for (i = 0; i < FSerialDetails.length; i++) {
                var SItemID = FSerialDetails[i].ItemID;
                var SerialNo = FSerialDetails[i].SerialNo;
                var MfgName = FSerialDetails[i].MfgName;
                var MfgMrp = FSerialDetails[i].MfgMrp;
                var MfgDate = FSerialDetails[i].MfgDate;
                var mfg_date = MfgDate;
                if (mfg_date != null && mfg_date != "") {
                    mfg_date = moment(mfg_date).format('DD-MM-YYYY');
                }
                else {
                    mfg_date = "";
                }
                var TblLen = $('#SerialDetailTbl tbody tr').length;
                if (SNo != null && SNo != "") {
                    if ((SItemID == ItemID)) {
                        Cmn_RenderHtmlForSerial(++rowIdx, "", (TblLen + 1), SerialNo, MfgName, MfgMrp, mfg_date, MfgDate);
                    }
                }
            }
            var EDStatus = sessionStorage.getItem(EnableDisable);
            if (EDStatus == "Disabled") {
                $("#SerialDetailTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    currentRow.find("#SerialDeleteIcon").css("display", "none");
                });
            }
        }
        else {
            $("#SerialDetailTbl >tbody >tr").remove();
        }
    }
    else {
        $("#SerialDetailTbl >tbody >tr").remove();
    }
    Cmn_OnClickSerialDeleteIcon();
}

function OnClickAddNewSerialDetail() {
    //var QtyDecDigit = $("#QtyDigit").text();
    var rowIdx = 0;

    var ValidInfo = "N";

    var ReceiSQty = parseFloat($("#SerialReceivedQuantity").val()).toFixed(cmn_QtyDecDigit);
    var TotalSQty = parseFloat($("#SerialDetailTbl >tbody >tr").length).toFixed(cmn_QtyDecDigit);
    if (parseFloat(ReceiSQty) == parseFloat(TotalSQty)) {
        ValidInfo = "Y";
    }
    if ($('#SerialNo').val() == "") {
        ValidInfo = "Y";
        $("#SerialNo").css("border-color", "Red");
        $('#SpanSerialNo').text($("#valueReq").text());
        $("#SpanSerialNo").css("display", "block");
    }
    else {
        $("#SpanSerialNo").css("display", "none");
        $("#SerialNo").css("border-color", "#ced4da");

        var SerialNo = $('#SerialNo').val().toUpperCase();
        $("#SerialDetailTbl >tbody >tr").each(function () {
            var currentRow = $(this);
            var tblSerialNo = currentRow.find("#SerialNo1").text().toUpperCase();
            if (tblSerialNo == SerialNo) {
                $('#SpanSerialNo').text($("#valueduplicate").text());
                $("#SpanSerialNo").css("display", "block");
                //$('#SerialNo').val("");
                $("#SerialNo").css("border-color", "Red");
                ValidInfo = "Y";
                return false;
            }
        });
    }
    if (ValidInfo == "Y") {
        return false;
    }
    else {
        var TblLen = $('#SerialDetailTbl tbody tr').length;
        $('#SerialDetailTbl tbody').append(`<tr id="R${++rowIdx}">
 <td class=" red center"> <i class="fa fa-trash deleteIcon" aria-hidden="true" id="SerialDeleteIcon" title="Delete"></i></td>
<td id="TblLen" >${TblLen + 1}</td>
<td id="SerialNo1" >${$("#SerialNo").val()}</td>
</tr>`);

        $('#SerialNo').val("");
        OnClickSerialDeleteIcon();
    }
}
/* Used in : Stock Take, Opening Material Reciept */
function Cmn_OnClickAddNewSerialDetail() {
    
    var rowIdx = 0;
    debugger;
    var ValidInfo = "N";
    var ReceiSQty = parseFloat($("#SerialReceivedQuantity").val()).toFixed(cmn_QtyDecDigit);
    var AcceptLength = parseInt(0);
    var ItemID = $("#hfSItemID").val()
    $("#SerialDetailTbl >tbody >tr").each(function () {
        var currentRow = $(this);
        AcceptLength = parseInt(AcceptLength) + 1;
    });

    if ($('#SerialNo').val() == "") {
        ValidInfo = "Y";
        $("#SerialNo").css("border-color", "Red");
        $('#SpanSerialNo').text($("#valueReq").text());
        $("#SpanSerialNo").css("display", "block");
    }
    else {
        $("#SpanSerialNo").css("display", "none");
        $("#SerialNo").css("border-color", "#ced4da");

        var SerialNo = $('#SerialNo').val().toUpperCase();
        $("#SerialDetailTbl >tbody >tr").each(function () {
            var currentRow = $(this);
            var tblSerialNo = currentRow.find("#SerialNo").text().toUpperCase();
            if (tblSerialNo == SerialNo) {
                $('#SpanSerialNo').text($("#valueduplicate").text());
                $("#SpanSerialNo").css("display", "block");
                //$('#SerialNo').val("");
                $("#SerialNo").css("border-color", "Red");
                ValidInfo = "Y";
                return false;
            }
        });
    }
    if (ValidInfo == "Y") {
        return false;
    }
    else {

        if (parseInt(AcceptLength) != parseInt(ReceiSQty)) {
            var mfg_date = $("#txtSrMfgDate").val();
            if (mfg_date != null && mfg_date != "") {
                mfg_date = moment(mfg_date).format('DD-MM-YYYY');
            }
            else {
                mfg_date = "";
            }
            var TblLen = $('#SerialDetailTbl tbody tr').length;
            $('#SerialDetailTbl tbody').append(`<tr id="R${++rowIdx}">
                    <td class=" red center"> <i class="fa fa-trash deleteIcon" aria-hidden="true" id="SerialDeleteIcon" title="${$("#Span_Delete_Title").text()}"></i></td>
<td id="SerialID" >${TblLen + 1}</td>
<td id="SerialNo" >${$("#SerialNo").val()}</td>
<td id="sr_mfg_name" >${$("#txtSrMfgName").val()}</td>
<td id="sr_mfg_mrp" class="num_right" >${parseFloat(CheckNullNumber($("#txtSrMfgMRP").val())).toFixed(cmn_QtyDecDigit)}</td>
<td id="sr_mfg_date" >${mfg_date}</td>
<td id="sr_mfg_hdn_date" hidden="hidden">${$("#txtSrMfgDate").val()}</td>
                </tr>`);

            $('#SerialNo').val("");
            Cmn_OnClickSerialDeleteIcon();
        }

    }
}

function OnKeyPressSerialNo() {
    $("#SpanSerialNo").css("display", "none");
    $("#SerialNo").css("border-color", "#ced4da");
}
function OnClickSerialDeleteIcon() {
    $('#SerialDetailTbl tbody').on('click', '.deleteIcon', function () {
        var child = $(this).closest('tr').nextAll();
        child.each(function () {
            // Getting <tr> id. 
            var id = $(this).attr('id');
            // Getting the <p> inside the .row-index class. 
            var idx = $(this).children('.row-index').children('p');
            // Gets the row number from <tr> id. 
            var dig = parseInt(id.substring(1));
            // Modifying row index. 
            idx.html(`Row ${dig - 1}`);
            // Modifying row id. 
            $(this).attr('id', `R${dig - 1}`);
        });
        $(this).closest('tr').remove();

        ResetSerialNoAfterDelete();
    });
}
/* Used in : Stock Take, Opening Material Reciept */
function Cmn_OnClickSerialDeleteIcon() {//modified by Suraj Maurya on 25-11-2025 for mfg details
    $('#SerialDetailTbl tbody').on('click', '.deleteIcon', function () {
        var child = $(this).closest('tr').nextAll();
        child.each(function () {
            // Getting <tr> id. 
            var id = $(this).attr('id');
            // Getting the <p> inside the .row-index class. 
            var idx = $(this).children('.row-index').children('p');
            // Gets the row number from <tr> id. 
            var dig = parseInt(id.substring(1));
            // Modifying row index. 
            idx.html(`Row ${dig - 1}`);
            // Modifying row id. 
            $(this).attr('id', `R${dig - 1}`);
        });
        $(this).closest('tr').remove();
        debugger;
        var ItemID = $("#hfItemID").val();
        var RowSNo = $("#hfSItemSNo").val();
        //$("#hdn_SerialDetailTbl tbody tr td #hdnSrl_SerialNo[value=" + RowSNo + "]").closest("tr").remove();
        //$("#SerialDetailTbl tbody tr td #SerialNo[value=" + RowSNo + "]").closest("tr").remove();
        Cmn_ResetSerialNoAfterDelete();
    });
}

function ResetSerialNoAfterDelete() {
    var rowIdx = 0;

    $("#SerialDetailTbl >tbody >tr").each(function () {
        var currentRow = $(this);
        currentRow.find("#TblLen").text(++rowIdx);
    });
}
/* Used in : Stock Take, Opening Material Reciept */
function Cmn_ResetSerialNoAfterDelete() {//modified by Suraj Maurya on 25-11-2025 for mfg details
    var rowIdx = 0;
    $("#SerialDetailTbl >tbody >tr").each(function () {
        var currentRow = $(this);
        currentRow.find("#SerialID").text(++rowIdx);
    });
}
function OnClickSerialResetBtn() {
    $('#SerialNo').val("");
    $('#SerialDetailTbl tbody tr').remove();
    $("#SpanSerialNo").css("display", "none");
    $("#SerialNo").css("border-color", "#ced4da");
}
/* Used in : Stock Take, Opening Material Reciept */
function Cmn_OnClickSerialResetBtn() {//modified by Suraj Maurya on 25-11-2025 for mfg details
    $('#SerialNo').val("");
    $('#txtSrMfgName').val("");
    $('#txtSrMfgMRP').val("");
    $('#txtSrMfgDate').val("");
    $('#SerialDetailTbl tbody tr').remove();
    $("#SpanSerialNo").css("display", "none");
    $("#SerialNo").css("border-color", "#ced4da");
}
function OnClickSerialDiscardAndExit() {
    OnClickSerialResetBtn();
}
/* Used in : Stock Take, Opening Material Reciept */
function Cmn_OnClickSerialDiscardAndExit() {
    Cmn_OnClickSerialResetBtn();
}
function OnClickSerialSaveAndClose() {

    //var QtyDecDigit = $("#QtyDigit").text();

    var ItemID = $('#hfSItemID').val();
    var RowSNo = $("#hfSItemSNo").val();
    var UserID = $("#UserID").text();

    var ReceiSQty = parseFloat($("#SerialReceivedQuantity").val()).toFixed(cmn_QtyDecDigit);
    var TotalSQty = parseFloat($("#SerialDetailTbl >tbody >tr").length).toFixed(cmn_QtyDecDigit);
    if (parseFloat(ReceiSQty) == parseFloat(TotalSQty)) {

        $("#SerialSaveAndExitBtn").attr("data-dismiss", "modal");

        let NewArr = [];
        //OnClickSerialSaveAndClose
        //sessionStorage.removeItem("SerialDetailSession");
        var FSerialDetails = JSON.parse(sessionStorage.getItem("SerialDetailSession"));
        if (FSerialDetails != null) {
            if (FSerialDetails.length > 0) {
                for (i = 0; i < FSerialDetails.length; i++) {
                    var SUserID = FSerialDetails[i].UserID;
                    //var SRowID = FSerialDetails[i].RowSNo;
                    var SItemID = FSerialDetails[i].ItemID;
                    //if (SRowID == RowSNo && SItemID == ItemID) {
                    //}
                    if (SItemID == ItemID) {
                    }
                    else {
                        NewArr.push(FSerialDetails[i]);
                    }
                }
                $("#SerialDetailTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var SerialNo = currentRow.find("#SerialNo1").text();
                    NewArr.push({ UserID: UserID, RowSNo: RowSNo, ItemID: ItemID, SerialNo: SerialNo })
                });
                sessionStorage.removeItem("SerialDetailSession");
                sessionStorage.setItem("SerialDetailSession", JSON.stringify(NewArr));
            }
            else {
                var SerialDetailList = [];
                $("#SerialDetailTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var SerialNo = currentRow.find("#SerialNo1").text();

                    SerialDetailList.push({ UserID: UserID, RowSNo: RowSNo, ItemID: ItemID, SerialNo: SerialNo })
                });
                sessionStorage.setItem("SerialDetailSession", JSON.stringify(SerialDetailList));
            }
        }
        else {
            var SerialDetailList = [];
            $("#SerialDetailTbl >tbody >tr").each(function () {
                var currentRow = $(this);
                var SerialNo = currentRow.find("#SerialNo1").text();

                SerialDetailList.push({ UserID: UserID, RowSNo: RowSNo, ItemID: ItemID, SerialNo: SerialNo })
            });
            sessionStorage.setItem("SerialDetailSession", JSON.stringify(SerialDetailList));
        }
    }
    else {
        swal("", $("#Serialqtydoesnotmatchwithreceivedqty").text(), "warning");
    }

}
/* Used in : Opening Material Reciept */
function Cmn_OnClickSerialSaveAndClose() {//modified by Suraj Maurya on 25-11-2025 for mfg details
    
    var ItemID = $('#hfSItemID').val();
    var RowSNo = $("#hfSItemSNo").val();
    var UserID = $("#UserID").text();

    var ReceiSQty = parseFloat($("#SerialReceivedQuantity").val()).toFixed(cmn_QtyDecDigit);
    var TotalSQty = parseFloat($("#SerialDetailTbl >tbody >tr").length).toFixed(cmn_QtyDecDigit);
    if (parseFloat(ReceiSQty) == parseFloat(TotalSQty)) {

        $("#SerialSaveAndExitBtn").attr("data-dismiss", "modal");

        let NewArr = [];
        var FSerialDetails = JSON.parse(sessionStorage.getItem("SerialDetailSession"));
        if (FSerialDetails != null) {
            if (FSerialDetails.length > 0) {
                for (i = 0; i < FSerialDetails.length; i++) {
                    var SItemID = FSerialDetails[i].ItemID;

                    if (SItemID == ItemID) {
                    }
                    else {
                        NewArr.push(FSerialDetails[i]);
                    }
                }
                $("#SerialDetailTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var SerialNo = currentRow.find("#SerialNo").text();
                    var MfgName = currentRow.find("#sr_mfg_name").text();
                    var MfgMrp = currentRow.find("#sr_mfg_mrp").text();
                    var MfgDate = currentRow.find("#sr_mfg_hdn_date").text();
                    NewArr.push({
                        UserID: UserID, RowSNo: RowSNo, ItemID: ItemID, SerialNo: SerialNo
                        , MfgName: MfgName, MfgMrp: IsNull(MfgMrp, "") == "" ? "0" : MfgMrp, MfgDate: MfgDate
                    })
                });
                sessionStorage.removeItem("SerialDetailSession");
                sessionStorage.setItem("SerialDetailSession", JSON.stringify(NewArr));
            }
            else {
                var SerialDetailList = [];
                $("#SerialDetailTbl >tbody >tr").each(function () {
                    var currentRow = $(this);
                    var SerialNo = currentRow.find("#SerialNo").text();
                    var MfgName = currentRow.find("#sr_mfg_name").text();
                    var MfgMrp = currentRow.find("#sr_mfg_mrp").text();
                    var MfgDate = currentRow.find("#sr_mfg_hdn_date").text();

                    SerialDetailList.push({
                        UserID: UserID, RowSNo: RowSNo, ItemID: ItemID, SerialNo: SerialNo
                        , MfgName: MfgName, MfgMrp: IsNull(MfgMrp, "") == "" ? "0" : MfgMrp, MfgDate: MfgDate
                    })
                });
                sessionStorage.setItem("SerialDetailSession", JSON.stringify(SerialDetailList));
            }
        }
        else {
            var SerialDetailList = [];
            $("#SerialDetailTbl >tbody >tr").each(function () {
                var currentRow = $(this);
                var SerialNo = currentRow.find("#SerialNo").text();
                var MfgName = currentRow.find("#sr_mfg_name").text();
                var MfgMrp = currentRow.find("#sr_mfg_mrp").text();
                var MfgDate = currentRow.find("#sr_mfg_hdn_date").text();

                SerialDetailList.push({
                    UserID: UserID, RowSNo: RowSNo, ItemID: ItemID, SerialNo: SerialNo
                    , MfgName: MfgName, MfgMrp: IsNull(MfgMrp, "") == "" ? "0" : MfgMrp, MfgDate: MfgDate
                })
            });
            sessionStorage.setItem("SerialDetailSession", JSON.stringify(SerialDetailList));
        }
    }
    else {
        swal("", $("#Serialqtydoesnotmatchwithreceivedqty").text(), "warning");
    }
}

//------------------------End--------------------------//


// ------------Function For Shorting Options in Dropdown On behalf of There text--------------------------------//
// -------------calling method--------------------
//var Options = $("#ddl_name")[0];
//
//ShortItemDDLList(Options);
// -------------calling method end--------------------
function ShortItemDDLList(Options) {
    var switching, i, x, y, shouldSwitch;
    switching = true;
    while (switching) {
        switching = false;
        for (i = 0; i < (Options.length - 1); i++) {
            shouldSwitch = false;
            x = Options[i].text;
            y = Options[i + 1].text;
            if (x > y) {
                shouldSwitch = true;
                break;
            }
        }
        if (shouldSwitch) {
            Options[i].parentNode.insertBefore(Options[i + 1], Options[i]);
            switching = true;
        }
    }
}
// ------------Function For Shorting Options in Dropdown On behalf of There text end--------------------------------//

// ------------Function For Shorting Table On behalf of Item DropDown selected text--------------------------------//
function sortTableOnBehalfDdlItem(TableId, RowNo) {
    var table, rows, switching, i, x, y, x1, y1, shouldSwitch;
    table = document.getElementById(TableId);
    switching = true;
    while (switching) {
        switching = false;
        rows = table.tBodies[0].rows;
        for (i = 0; i < (rows.length - 1); i++) {
            shouldSwitch = false;
            //x = rows[i].getElementsByTagName("TD")[6];
            x = $(rows[i].getElementsByTagName("TD")[RowNo]).find("select option:selected").text().trim();
            //y = rows[i + 1].getElementsByTagName("TD")[6];
            y = $(rows[i + 1].getElementsByTagName("TD")[RowNo]).find("select option:selected").text().trim();
            if (x > y) {
                shouldSwitch = true;
                break;
            }
        }
        if (shouldSwitch) {
            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
            switching = true;
        }
    }
}

// ------------Function For Shorting Table On behalf of Item DropDown selected text End--------------------------------//

//-------------------------------Delivery Schedule ---------------------------------------//


function Cmn_OnChangeDelSchItm(ItmDetailsTbl, RowSerialed, SNohiddenfiled, ItemDDl_ID, ItemQty_ID) {

    var DocMenuId = $("#DocumentMenuId").val();
    //var QtyDecDigit = $("#QtyDigit").text();
    if ($('#DeliverySchItemDDL').val() == "0") {
        ValidInfo = "Y";
        $('#SpanDelSchItemName').text($("#valueReq").text());
        $("#SpanDelSchItemName").css("display", "block");
        $("#DeliverySchItemDDL").css("border-color", "red");
        $("#DeliveryDate").val("");
        $('#DeliverySchQty').val("");
        $("#SpanDeliSchDeliDate").css("display", "none");
        $("#DeliveryDate").css("border-color", "#ced4da");
        $("#DeliverySchQty").css("border-color", "#ced4da");
        $("#SpanDelSchItemQty").css("display", "none");
    }
    else {
        $("#SpanDelSchItemName").css("display", "none");
        $("#DeliverySchItemDDL").css("border-color", "#ced4da");
        var DelSchItem = $('#DeliverySchItemDDL').val();
        var POItmQtyF = parseFloat(0).toFixed(cmn_QtyDecDigit);
        var AllDelSchQty = parseFloat(0).toFixed(cmn_QtyDecDigit);
        $("#" + ItmDetailsTbl + " >tbody >tr").each(function () {
            var currentRow = $(this);
            var Sno = currentRow.find("#" + SNohiddenfiled).val();
            var POItemQty = parseFloat(0).toFixed(cmn_QtyDecDigit);
            var POItemID = "";
            var DocMenuId = $("#DocumentMenuId").val();
            if (DocMenuId == '105108101') {/*For Job Order(SC) only */
                var BrkNameID = ItemDDl_ID.split('-');
                var ItemID = BrkNameID[1];
                var ItmtypID = BrkNameID[2];

                var ItmTyp_Id = currentRow.find("#" + ItmtypID).val();
                if (ItmTyp_Id == "OF" || ItmTyp_Id == "OW") {
                    POItemID = currentRow.find("#" + ItemID).val();
                }
                else {
                    return;
                }
            }
            else {
                POItemID = currentRow.find("#" + ItemDDl_ID + Sno).val();
            }

            POItemQty = parseFloat(CheckNullNumber(currentRow.find("#" + ItemQty_ID).val())).toFixed(cmn_QtyDecDigit);
            if (RowSerialed == "Y") {
                POItemQty = parseFloat(currentRow.find("#" + ItemQty_ID + Sno).val()).toFixed(cmn_QtyDecDigit);
            }
            if (DocMenuId == '105108101') {/*For Job Order(SC) only */
                POItemQty = parseFloat(currentRow.find("#" + ItemQty_ID).text()).toFixed(cmn_QtyDecDigit);
            }

            //if (DocMenuId == '105103125') {/* Added by Suraj Maurya on 13-01-2026 */
            //    POItemQty = (parseFloat(POItemQty)
            //        + parseFloat(CheckNullNumber(currentRow.find("#foc_qty").val()))).toFixed(cmn_QtyDecDigit);
            //}

            if (POItemID === DelSchItem) {
                POItmQtyF = parseFloat(POItmQtyF) + parseFloat(POItemQty);
            }
        });
        $("#DeliverySchTble >tbody >tr").each(function () {

            var currentRowDS = $(this);
            var DelSchItemtbl = currentRowDS.find("#Hd_ItemIdFrDS").text();

            var DelSchQtyTbl = currentRowDS.find("#delv_qty").text();
            if (DelSchItem == DelSchItemtbl) {
                AllDelSchQty = (parseFloat(AllDelSchQty) + parseFloat(DelSchQtyTbl)).toFixed(cmn_QtyDecDigit);
            }
        });
        var Date12 = moment().format('YYYY-MM-DD');
        $("#DeliveryDate").val(Date12);
        $("#SpanDeliSchDeliDate").css("display", "none");
        $("#DeliveryDate").css("border-color", "#ced4da");
        $('#DeliverySchQty').val((parseFloat(POItmQtyF) - parseFloat(AllDelSchQty)).toFixed(cmn_QtyDecDigit));
        OnChangeDeliveryQty();
    }

}

function Cmn_OnChangeDeliveryDate(DeliveryDate) {

    var DeliDate = DeliveryDate.value;

    var DelSchItemddl = $('#DeliverySchItemDDL').val();
    $('#DeliveryDate').css("border-color", "#ced4da");
    $("#SpanDeliSchDeliDate").css("display", "none");

    $("#DeliverySchTble >tbody >tr").each(function () {

        var currentRow = $(this);
        var DelSchItem = currentRow.find("#Hd_ItemIdFrDS").text();
        var DelSchDateTbl = currentRow.find("#sch_date").text();
        if (DelSchItemddl == DelSchItem && DeliDate == DelSchDateTbl) {
            $('#DeliveryDate').css("border-color", "red");
            $('#SpanDeliSchDeliDate').text($("#valueduplicate").text());
            $("#SpanDeliSchDeliDate").css("display", "block");
            $("#DeliveryDate").val("")
            return false;
        }
    });

}


function Cmn_OnClickAddDeliveryDetail(ItmDetailsTbl, RowSerialed, SNohiddenfiled, ItemDDl_ID, ItemQty_ID) {
    var rowIdx = 0;

    // //var QtyDecDigit = $("#QtyDigit").text();

    var ValidInfo = "N";
    if ($('#DeliverySchItemDDL').val() == "0") {
        ValidInfo = "Y";
        $('#SpanDelSchItemName').text($("#valueReq").text());
        $("#SpanDelSchItemName").css("display", "block");
        $("#DeliverySchItemDDL").css("border-color", "red");
    }
    else {
        $("#SpanDelSchItemName").css("display", "none");
        $("#DeliverySchItemDDL").css("border-color", "#ced4da");
    }
    if ($('#DeliverySchQty').val() == "0" || $('#DeliverySchQty').val() == "") {
        ValidInfo = "Y";
        $('#SpanDelSchItemQty').text($("#valueReq").text());
        $("#SpanDelSchItemQty").css("display", "block");
        $("#DeliverySchQty").css("border-color", "red");
    }
    else {
        $("#SpanDelSchItemQty").css("display", "none");
        $("#DeliverySchQty").css("border-color", "#ced4da");
    }
    var DelDate = $('#DeliveryDate').val();
    var someDate = new Date(DelDate);
    var Dyear = someDate.getUTCFullYear();
    var Maxyear = parseInt(moment().format("YYYY")) + 20;
    if (DelDate == "") {
        ValidInfo = "Y";
        $('#SpanDeliSchDeliDate').text($("#valueReq").text());
        $("#SpanDeliSchDeliDate").css("display", "block");
        $("#DeliveryDate").css("border-color", "red");
    }
    else {
        if (parseInt(Dyear) > parseInt(Maxyear)) {
            ValidInfo = "Y";
            $('#SpanDeliSchDeliDate').text($("#JC_InvalidDate").text());
            $("#SpanDeliSchDeliDate").css("display", "block");
            $("#DeliveryDate").css("border-color", "red");
        } else {
            $("#SpanDeliSchDeliDate").css("display", "none");
            $("#DeliveryDate").css("border-color", "#ced4da");
        }

    }
    var DelItem = $('#DeliverySchItemDDL').val();
    $("#DeliverySchTble >tbody >tr #Hd_ItemIdFrDS:contains(" + DelItem + ")").parent().each(function () {

        var currentRowDS = $(this);
        var DelSchItemtbl = currentRowDS.find("#Hd_ItemIdFrDS").text();
        var sch_date = currentRowDS.find("#sch_date").text();
        if (DelItem == DelSchItemtbl && sch_date == DelDate) {
            ValidInfo = "Y";
            $('#SpanDeliSchDeliDate').text($("#valueduplicate").text());
            $("#SpanDeliSchDeliDate").css("display", "block");
            $("#DeliveryDate").css("border-color", "red");
        }
    });
    if (ValidInfo == "Y") {
        return false;
    }
    else {
        if (Cmn_CalculateDeliverySchQty(ItmDetailsTbl, RowSerialed, SNohiddenfiled, ItemDDl_ID, ItemQty_ID) === false) {
            $('#SpanDelSchItemQty').text($("#SchReqQtyEqualTo").text());
            $("#SpanDelSchItemQty").css("display", "block");
            $("#DeliverySchQty").css("border-color", "red");
            return false;
        }
        else {
            $("#DeliverySchQty").css("border-color", "#ced4da");
            $("#SpanDelSchItemQty").css("display", "none");

            Cmn_appendDeleveryschedule(++rowIdx, $('#DeliverySchItemDDL option:selected').text(), $('#DeliverySchItemDDL').val(),
                $('#DeliveryDate').val(), $('#DeliverySchQty').val(), 0, $('#DeliverySchQty').val(), 0);
            Cmn_BindDelivertSchItemList(ItmDetailsTbl, RowSerialed, SNohiddenfiled, ItemDDl_ID, ItemQty_ID)
            $("#DeliveryDate").val("");
        }
    }
}

function Cmn_BindDelivertSchItemList(ItmDetailsTbl, RowSerialed, SNohiddenfiled, ItemDDl_ID, ItemQty_ID) {

    var DocMenuId = $("#DocumentMenuId").val();
    //var QtyDecDigit = $("#QtyDigit").text();
    var delitem = $('#DeliverySchItemDDL').val();
    var PQItemQty1 = 0;
    var s = '<option value="0">---Select---</option>';
    $("#" + ItmDetailsTbl + " >tbody >tr").each(function () {

        var currentRow = $(this);
        var Sno = currentRow.find("#" + SNohiddenfiled).val();
        var PQItemName = "";
        var PQItemQty = parseFloat(0);
        var PQItemID = "";
        if (DocMenuId == '105108101') {/*For Job Order(SC) only */

            var BrkNameID = ItemDDl_ID.split('-');
            var ItemName = BrkNameID[0];
            var ItemID = BrkNameID[1];
            var ItmTypID = BrkNameID[2];
            ItemType_Id = currentRow.find("#" + ItmTypID).val();
            if (ItemType_Id == "OF" || ItemType_Id == "OW") {
                PQItemName = currentRow.find("#" + ItemName).text().trim();
                PQItemID = currentRow.find("#" + ItemID).val();
                PQItemQty = parseFloat(currentRow.find("#" + ItemQty_ID).text());
            }
            else {
                Flag = "Y";
                return;
            }
        }
        else {
            PQItemName = currentRow.find("#" + ItemDDl_ID + Sno + " option:selected").text();
            PQItemID = currentRow.find("#" + ItemDDl_ID + Sno).val();
            if (RowSerialed == "Y") {
                PQItemQty = parseFloat(currentRow.find("#" + ItemQty_ID + Sno).val());
            }
            else {
                PQItemQty = parseFloat(currentRow.find("#" + ItemQty_ID).val());
            }
        }


        if (delitem == PQItemID) {
            PQItemQty1 = parseFloat(PQItemQty1) + parseFloat(PQItemQty);
        }

        if (PQItemID != "0" && PQItemID != "" && PQItemQty > 0) {
            var Flag = "N";
            $(s).each(function () {
                if (this.value == PQItemID) {
                    Flag = "Y";
                }
            });
            if (Flag == "N") {
                s += '<option value="' + PQItemID + '" text="' + PQItemName + '">' + PQItemName + '</option>';
            }
        }
    });

    $("#DeliverySchItemDDL").html(s);

    $("#" + ItmDetailsTbl + " >tbody >tr").each(function () {

        var currentRow = $(this);
        var Sno = currentRow.find("#" + SNohiddenfiled).val();
        var DSItemID = "";
        var PQItemQty = parseFloat(0);
        var DSItemQty = parseFloat(0);
        var PQItemID = "";

        if (DocMenuId == '105108101') {/*For Job Order(SC) only */
            var BrkNameID = ItemDDl_ID.split('-');
            var ItemID = BrkNameID[1];
            var ItmTypID = BrkNameID[2];
            var ItemType_Id = currentRow.find("#" + ItmTypID).val();
            if (ItemType_Id == "OF" || ItemType_Id == "OW") {
                PQItemID = currentRow.find("#" + ItemID).val();
                PQItemQty = parseFloat(currentRow.find("#" + ItemQty_ID).text());
            }
            else {
                return;
            }
        } else {
            if (RowSerialed == "Y") {
                PQItemQty = parseFloat(currentRow.find("#" + ItemQty_ID + Sno).val());
            }
            else {
                PQItemQty = parseFloat(currentRow.find("#" + ItemQty_ID).val());
            }
            PQItemID = currentRow.find("#" + ItemDDl_ID + Sno).val();
        }

        if ($("#DeliverySchTble >tbody >tr").length > 0) {
            $("#DeliverySchTble >tbody >tr").each(function () {
                //
                var currentRowDel = $(this);
                var DSchItemID = currentRowDel.find("#Hd_ItemIdFrDS").text();
                var DSQty = currentRowDel.find("#delv_qty").text();

                if (PQItemID === DSchItemID) {
                    DSItemID = DSchItemID;
                    DSItemQty = (parseFloat(DSItemQty) + parseFloat(DSQty));
                }
            });
        }
        //$("#SOItmDetailsTbl tbody tr #SOItemListName1 option:selected[value=ITM0001503]").closest("tr")
        if (ItmDetailsTbl == "SOItmDetailsTbl") {
            PQItemQty = 0;
            $("#SOItmDetailsTbl tbody tr #hfItemID[value=" + PQItemID + "]").closest("tr").each(function () {
                var currentRow1 = $(this);
                PQItemQty = parseFloat(PQItemQty) + parseFloat(currentRow1.find("#" + ItemQty_ID).val());
            });
        }

        if (DSItemID === PQItemID && parseFloat(DSItemQty).toFixed(cmn_QtyDecDigit) === parseFloat(PQItemQty).toFixed(cmn_QtyDecDigit)) {
            $("#DeliverySchItemDDL option[value=" + DSItemID + "]").hide();
            $('#DeliverySchItemDDL').val("0").prop('selected', true);
        }
    });
    var DSItemQty = 0;
    if ($("#DeliverySchTble >tbody >tr").length > 0) {
        $("#DeliverySchTble >tbody >tr").each(function () {

            var currentRowDel = $(this);
            var DSchItemID = currentRowDel.find("#Hd_ItemIdFrDS").text();
            var DSQty = currentRowDel.find("#delv_qty").text();

            if (delitem === DSchItemID) {
                // DSItemID = DSchItemID;
                DSItemQty = (parseFloat(DSItemQty) + parseFloat(DSQty));
            }
        });
    }
    if (PQItemQty1 > DSItemQty) {
        $('#DeliverySchItemDDL').val(delitem).prop('selected', true);
        $("#DeliverySchQty").val(parseFloat(PQItemQty1 - DSItemQty).toFixed(cmn_QtyDecDigit));
    } else {
        $("#DeliverySchQty").val(""/*parseFloat(0).toFixed(cmn_QtyDecDigit)*/);
    }

};

function Cmn_CalculateDeliverySchQty(ItmDetailsTbl, RowSerialed, SNohiddenfiled, ItemDDl_ID, ItemQty_ID) {

    //var QtyDecDigit = $("#QtyDigit").text();
    var DocMenuId = $("#DocumentMenuId").val();
    //if (DocMenuId == "105103145110") {
    //    QtyDecDigit = $("#ExpImpQtyDigit").text();
    //}
    var DocMenuId = $("#DocumentMenuId").val();
    var DelSchItem = $('#DeliverySchItemDDL').val();
    var POItemQty = parseFloat(0).toFixed(cmn_QtyDecDigit);
    var DelSchQty = parseFloat($('#DeliverySchQty').val()).toFixed(cmn_QtyDecDigit);
    var AllDelSchQty = parseFloat(0).toFixed(cmn_QtyDecDigit);
    $("#" + ItmDetailsTbl + " >tbody >tr").each(function () {

        var currentRow = $(this);
        var Sno = currentRow.find("#" + SNohiddenfiled).val();
        var POItemID = "";
        var ItemQty = parseFloat(0).toFixed(cmn_QtyDecDigit);


        if (DocMenuId == '105108101') {
            var BrkNameID = ItemDDl_ID.split('-');
            //var ItemName = BrkNameID[0];
            var ItemID = BrkNameID[1];
            var ItmTypId = BrkNameID[2];
            var ItmTyp_ID = currentRow.find("#" + ItmTypId).val();
            // PQItemName = currentRow.find("#" + ItemName).val();
            if (ItmTyp_ID == "OF" || ItmTyp_ID == "OW") {
                POItemID = currentRow.find("#" + ItemID).val();
            }
            else {
                return;
            }
        }
        else {
            POItemID = currentRow.find("#" + ItemDDl_ID + Sno).val();
        }

        ItemQty = parseFloat(currentRow.find("#" + ItemQty_ID).val()).toFixed(cmn_QtyDecDigit);
        if (RowSerialed == "Y") {
            ItemQty = parseFloat(currentRow.find("#" + ItemQty_ID + Sno).val()).toFixed(cmn_QtyDecDigit);
        }
        if (DocMenuId == '105108101') {/*For Job Order(SC) only */
            ItemQty = parseFloat(currentRow.find("#" + ItemQty_ID).text()).toFixed(cmn_QtyDecDigit);
        }

        //if (DocMenuId == '105103125') {/* Added by Suraj Maurya on 13-01-2026 */
        //    ItemQty = (parseFloat(ItemQty)
        //        + parseFloat(CheckNullNumber(currentRow.find("#foc_qty").val()))).toFixed(cmn_QtyDecDigit);
        //}
        if (POItemID === DelSchItem) {
            POItemQty = parseFloat(POItemQty) + parseFloat(ItemQty);
        }
    });
    $("#DeliverySchTble >tbody >tr").each(function () {
        //
        var currentRow = $(this);
        var DelSchItemtbl = currentRow.find("#Hd_ItemIdFrDS").text();
        var DelSchQtyTbl = currentRow.find("#delv_qty").text();
        if (DelSchItem == DelSchItemtbl) {
            AllDelSchQty = (parseFloat(AllDelSchQty) + parseFloat(DelSchQtyTbl)).toFixed(cmn_QtyDecDigit);
        }
    });
    AllDelSchQty = (parseFloat(AllDelSchQty) + parseFloat(DelSchQty)).toFixed(cmn_QtyDecDigit);
    if (parseFloat(POItemQty) >= parseFloat(AllDelSchQty)) {
        return true;
    }
    else {
        return false;
    }
}
function Cmn_appendDeleveryschedule(rowIdx, item_name, item_id, sch_date, delv_qty, sr_qty, pending_qty, overduedays, SrvcItemType) {

    if (item_name != "---Select---") {
        var DocMenuId = $("#DocumentMenuId").val();
        //var QtyDecDigit = $("#QtyDigit").text();
        //if (DocMenuId == "105103145110") {
        //    QtyDecDigit = $("#ExpImpQtyDigit").text();
        //}

        var deletetext = $("#Span_Delete_Title").text();
        var rowCount = $('#DeliverySchTble tbody tr').length;

        if (SrvcItemType != "Y") {
            $('#DeliverySchTble tbody').append(`<tr id="R${rowIdx}" class="even pointer">
 <td class=" red center"> <i class="deleteIcon fa fa-trash" aria-hidden="true" id="DeliveryDelIconBtn" title="${deletetext}"></i></td>
 <td id="cmn_srno">${++rowCount}</td>
 <td class="" hidden="hidden" id="Hd_ItemIdFrDS">${item_id}</td>
 <td class="a-center " id="Hd_ItemNameFrDS">${item_name}</td>
 <td class="">${moment(sch_date).format('DD-MM-YYYY')}</td>
 <td class="num_right" id="delv_qty">${parseFloat(delv_qty).toFixed(cmn_QtyDecDigit)}</td>
 <td style="display:none;" id="sch_date">${sch_date}</td>


<td id="SRQty" class="num_right">${parseFloat(sr_qty).toFixed(cmn_QtyDecDigit)}</td>
<td id="PenQty" class="num_right">${parseFloat(pending_qty).toFixed(cmn_QtyDecDigit)}</td>
<td id="OdDays" class="num_right">${parseInt(overduedays)}</td>
                            </tr>`);
        }
    }
    Cmn_DeleteDeliverySch();
    Cmn_ResetSerialNoInDelShcdl()
}
function Cmn_OnChangeDeliveryQty(ItmDetailsTbl, RowSerialed, SNohiddenfiled, ItemDDl_ID, ItemQty_ID) {

    var DocMenuId = $("#DocumentMenuId").val();
    //var QtyDecDigit = $("#QtyDigit").text();
    //if (DocMenuId == "105103145110") {
    //    QtyDecDigit = $("#ExpImpQtyDigit").text();
    //}
    var DelQty = $('#DeliverySchQty').val();
    if (AvoidDot(DelQty) == false) {
        DelQty = "";
        $('#DeliverySchQty').val("");
    }
    if ($('#DeliverySchQty').val() == "0" || $('#DeliverySchQty').val() == "") {
        ValidInfo = "Y";
        $('#DeliverySchQty').css("border-color", "red");
        $('#SpanDelSchItemQty').text($("#valueReq").text());
        $("#SpanDelSchItemQty").css("display", "block");
    }
    else {
        $('#DeliverySchQty').css("border-color", "#ced4da");
        $("#SpanDelSchItemQty").css("display", "none");
        $('#DeliverySchQty').val(parseFloat(DelQty).toFixed(cmn_QtyDecDigit));
        if (Cmn_CalculateDeliverySchQty(ItmDetailsTbl, RowSerialed, SNohiddenfiled, ItemDDl_ID, ItemQty_ID) === false) {
            $('#DeliverySchQty').css("border-color", "red");
            $('#SpanDelSchItemQty').text($("#SchReqQtyEqualTo").text());
            $("#SpanDelSchItemQty").css("display", "block");
            //$('#DeliverySchQty').val("");
            return false;
        }
        else {
            $('#DeliverySchQty').css("border-color", "#ced4da");
            $("#SpanDelSchItemQty").css("display", "none");
        }
    }
}

function Cmn_DelDeliSchAfterDelItem(ItemID, ItmDetailsTbl, RowSerialed, SNohiddenfiled, ItemDDl_ID, ItemQty_ID) {

    $("#DeliverySchTble >tbody >tr").each(function () {

        var currentRow = $(this);
        var DelSchItem = currentRow.find("#Hd_ItemIdFrDS").text();
        if (ItemID == DelSchItem) {
            currentRow.remove();
        }
    });
    $("#DeliverySchQty").val("");
    $("#DeliveryDate").val("");
    Cmn_BindDelivertSchItemList(ItmDetailsTbl, RowSerialed, SNohiddenfiled, ItemDDl_ID, ItemQty_ID);
    Cmn_ResetSerialNoInDelShcdl();
}
function Cmn_DeleteDeliverySch() {
    $('#DeliverySchTble tbody').on('click', '.deleteIcon', function () {
        var child = $(this).closest('tr').nextAll();
        child.each(function () {
            var id = $(this).attr('id');
            var idx = $(this).children('.row-index').children('p');
            var dig = parseInt(id.substring(1));
            idx.html(`Row ${dig - 1}`);
            $(this).attr('id', `R${dig - 1}`);
        });

        $(this).closest('tr').remove();
        var ItemID = $(this).closest('tr')[0].cells[2].innerHTML;
        Cmn_ResetSerialNoInDelShcdl();
        BindDelivertSchItemList();
        //$("#DeliverySchItemDDL option[value=" + ItemID + "]").show();
        //$('#DeliverySchItemDDL').val("0").prop('selected', true);
    });
}
function Cmn_ResetSerialNoInDelShcdl() {
    var SrNo = 0;
    $('#DeliverySchTble tbody tr').each(function () {
        $(this).find("#cmn_srno").text(++SrNo);
    })

}
/* For Check Deliver schedule quantity with item quantity - Used in RFQ,PQ,PO,SO,JO,Cstm Invoice                    */



function Cmn_taxVallidation(tableID, item_tax_amt, ItemDDlId, Hdn_TaxCalculatorTbl, SNoHfId) {

    var flag = "N";
    var DMenuId = $("#DocumentMenuId").val();
    //var DecDigit = $("#ValDigit").text();
    //if (DMenuId == "105103145127") {
    //    DecDigit = $("#ExpImpValDigit").text();
    //}
    //else {
    //    DecDigit = $("#ValDigit").text();
    //}

    $("#" + tableID + " > tbody > tr ").each(function () {
        var currentRow = $(this);
        var SNohf = currentRow.find("#" + SNoHfId).val();
        var FOCFlag = "N";
        if (DMenuId == "105103125" || DMenuId == "105103148" || DMenuId == "105103140" || DMenuId == "105103120") {//add by shubham maurya on 13-08-2025 for FOC item
            if (DMenuId == "105103125") { //Added by Suraj Maurya on 13-01-2026
                let ordQty = currentRow.find("#ord_qty_spec").val();
                let focQty = currentRow.find("#foc_qty").val();
                if (currentRow.find("#FOC").is(":checked") || (parseFloat(CheckNullNumber(ordQty)) == 0 && parseFloat(CheckNullNumber(focQty)) > 0)) {
                    FOCFlag = "Y";
                }
            }
            if (DMenuId == "105103140") { //Added by Suraj Maurya on 19-01-2026
                let ordQty = currentRow.find("#TxtReceivedQuantity").val();
                let focQty = currentRow.find("#TxtFocQuantity").val();
                if (currentRow.find("#FOC").is(":checked") || (parseFloat(CheckNullNumber(ordQty)) == 0 && parseFloat(CheckNullNumber(focQty)) > 0)) {
                    FOCFlag = "Y";
                }
            } else {
                if (currentRow.find("#FOC").is(":checked")) {
                    FOCFlag = "Y";
                }
            }
        }
        if (DMenuId == "105101145") {
            var ItemId = currentRow.find("#" + ItemDDlId).val();
            var ItemName = currentRow.find("#" + SNoHfId).val();
        }
        else if (DMenuId == "105103140") {
            var ItemId = currentRow.find("#" + ItemDDlId).val();
            var ItemName = currentRow.find("#" + SNoHfId).val();
        }
        else if (DMenuId == "105103148" || DMenuId == "105103149") {/*Add BY shubham Maurya on 02-06-2025 add 105103149*//*Add By Hina on 31-07-2024 for scrap sale invoice */
            var ItemId = currentRow.find("#" + ItemDDlId).val();
            var ItemName = currentRow.find("#" + SNoHfId).val();
        }
        else if (DMenuId == "105103145127") {
            var ItemId = currentRow.find("#" + ItemDDlId).val();
            var ItemName = currentRow.find("#" + SNoHfId).val();
        }
        else if (DMenuId == "105108123") {
            var ItemId = currentRow.find("#" + ItemDDlId).val();
            var ItemName = currentRow.find("#" + SNoHfId).val();
        }
        else if (DMenuId == "105102115101") {
            var ItemId = currentRow.find("#" + ItemDDlId).val();
            var ItemName = currentRow.find("#" + SNoHfId).val();
        }
        else if (DMenuId == "105101152" || DMenuId == "105103142" || DMenuId == "105102150") {//Add by shubham Maurya on 26-03-2025 add "105103142"
            var sno = currentRow.find("#SNohiddenfiled").val();
            var ItemId = currentRow.find("#" + ItemDDlId).val();
            var ItemName = currentRow.find("#" + SNoHfId + sno + " option:selected").text();
        }
        else if (DMenuId == "105101150") {
            var sno = currentRow.find("#SNohiddenfiled").val();
            var ItemId = currentRow.find("#" + ItemDDlId).val();
            if ($("#SourceTypeV").is(":checked")) {
                var ItemName = currentRow.find("#" + SNoHfId).val();
            }
            else {
                var ItemName = currentRow.find("#" + SNoHfId + sno + " option:selected").text();
            }
        }
        else if (DMenuId == "105108120") {
            var ItemId = currentRow.find("#" + ItemDDlId).val();
            var ItemName = currentRow.find("#" + SNoHfId).val();
        }
        else if (DMenuId == "105103147" || DMenuId == "105101154") {/*Add by Hina sharma on 02-01-2025 for tax exmpted and manual gst*/
            var sno = currentRow.find("#SNohiddenfiled").val();
            var ItemId = currentRow.find("#" + ItemDDlId).val();
            var ItemName = currentRow.find("#" + SNoHfId + sno + " option:selected").text();
        }
        else if (DMenuId == "105101147") {/*Added by Surbhi on 29/05/2025 for Supplementary Purchase Invoice(105101147)*/
            var sno = currentRow.find("#SNohiddenfiled").val();
            var ItemId = currentRow.find("#" + ItemDDlId).val();
            var ItemName = currentRow.find("#" + SNoHfId).val();
        }
        else {
            var ItemId = currentRow.find("#" + ItemDDlId + SNohf).val();
            var ItemName = currentRow.find("#" + ItemDDlId + SNohf + " option:selected").text();
        }
        //if (DMenuId != "105103148") {/*Add By Hina on 31-07-2024 for scrap sale invoice has no TaxExempted column */
        //    if (currentRow.find("#TaxExempted").is(":checked")) {

        //    }
        //}
        if (currentRow.find("#TaxExempted").is(":checked")) {

        }
        else {
            var TaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
            var ItemTaxAmt = currentRow.find("#" + item_tax_amt).val();
            if (ItemTaxAmt == "") {
                ItemTaxAmt = parseFloat(0).toFixed(cmn_ValDecDigit)
            }
            if (DMenuId == "105101150" || DMenuId == "105103148" || DMenuId == "105103147" || DMenuId == "105103142" || DMenuId == "105102150" || DMenuId == "105103149") {/*Add 105103148,105103147 on 02-01-2025 By Hina on 31-07-2024 for scrap sale invoice,SSI */
                if (currentRow.find("#HsnNo").val() == "" || currentRow.find("#HsnNo").val() == null || currentRow.find("#HsnNo").val() == "0") {
                    swal("", $("#HSNNotDefinedFor").text() + ' ' + ItemName, "warning");
                    flag = "Y";
                    return false
                }
                else if (parseFloat(ItemTaxAmt).toFixed(cmn_ValDecDigit) == parseFloat(TaxAmt).toFixed(cmn_ValDecDigit)) {
                    if (DMenuId == "105103148") {//add by shubham maurya on 13-08-2025 for FOC item
                        if (FOCFlag != "Y") {
                            swal("", $("#TaxNotAppliedFor").text() + ' ' + ItemName, "warning");
                            $("#" + tableID + " > tbody > tr ").each(function () {
                                var currentRw = $(this);
                                var ItemTaxAmt1 = parseFloat(CheckNullNumber(currentRw.find("#" + item_tax_amt).val())).toFixed(cmn_ValDecDigit);//Modified by Suraj Maurya on 04-11-2024
                                //if (ItemTaxAmt1 == "") {
                                //ItemTaxAmt1 = parseFloat(CheckNullNumber(ItemTaxAmt1)).toFixed(cmn_ValDecDigit);
                                //}
                                if (ItemTaxAmt1 == TaxAmt) {
                                    if (currentRw.find("#TaxExempted").is(":checked")) {

                                    }
                                    else {
                                        currentRw.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                                    }
                                }
                            });
                            flag = "Y";
                            return false
                        }

                    }
                    else {
                        swal("", $("#TaxNotAppliedFor").text() + ' ' + ItemName, "warning");
                        $("#" + tableID + " > tbody > tr ").each(function () {
                            var currentRw = $(this);
                            var ItemTaxAmt1 = parseFloat(CheckNullNumber(currentRw.find("#" + item_tax_amt).val())).toFixed(cmn_ValDecDigit);//Modified by Suraj Maurya on 04-11-2024
                            //if (ItemTaxAmt1 == "") {
                            //ItemTaxAmt1 = parseFloat(CheckNullNumber(ItemTaxAmt1)).toFixed(cmn_ValDecDigit);
                            //}
                            if (ItemTaxAmt1 == TaxAmt) {
                                if (currentRw.find("#TaxExempted").is(":checked")) {

                                }
                                else {
                                    currentRw.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                                }
                            }
                        });
                        flag = "Y";
                        return false
                    }

                    //swal("", $("#TaxNotAppliedFor").text() + ' ' + ItemName, "warning");
                    //$("#" + tableID + " > tbody > tr ").each(function () {
                    //    var currentRw = $(this);
                    //    var ItemTaxAmt1 = parseFloat(CheckNullNumber(currentRw.find("#" + item_tax_amt).val())).toFixed(cmn_ValDecDigit);//Modified by Suraj Maurya on 04-11-2024
                    //    //if (ItemTaxAmt1 == "") {//commented by Suraj Maurya on 04-11-2024
                    //    //    ItemTaxAmt1 = parseFloat(0).toFixed(cmn_ValDecDigit)
                    //    //}
                    //    if (ItemTaxAmt1 == TaxAmt) {
                    //        //if (DMenuId != "105103148") {/*Add By Hina on 31-07-2024 for scrap sale invoice has no TaxExempted column */

                    //        //    if (currentRw.find("#TaxExempted").is(":checked")) {

                    //        //    }
                    //        //}
                    //        if (currentRw.find("#TaxExempted").is(":checked")) {

                    //        }
                    //        else {
                    //            currentRw.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                    //        }
                    //    }
                    //});
                    //flag = "Y";
                    //return false
                }
                else {
                    var ItemTaxLen = $("#" + Hdn_TaxCalculatorTbl + " > tbody > tr #TaxItmCode:contains('" + ItemId + "')").length
                    if (ItemTaxLen == 0) {
                        if (DMenuId == "105103125" || DMenuId == "105103148" || DMenuId == "105103120") {//add by shubham maurya on 21-08-2025
                            if (FOCFlag != "Y") {
                                swal("", $("#TaxNotAppliedFor").text() + ' ' + ItemName, "warning");
                                $("#" + tableID + " > tbody > tr ").each(function () {
                                    var currentR = $(this);
                                    var ItemTaxAmt2 = parseFloat(CheckNullNumber(currentR.find("#" + item_tax_amt).val())).toFixed(cmn_ValDecDigit);//Modified by Suraj Maurya on 04-11-2024
                                    var foc = "N";
                                    if (currentRw.find("#FOC").is(":checked")) {
                                        foc = "Y";
                                    }
                                    if (ItemTaxAmt2 == TaxAmt) {
                                        if (currentR.find("#TaxExempted").is(":checked")) {

                                        }
                                        else {
                                            if (foc != "Y") {
                                                currentR.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                                            }
                                        }
                                    }
                                });
                                //currentRow.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                                flag = "Y";
                                return false
                            }
                        }
                        else {
                            swal("", $("#TaxNotAppliedFor").text() + ' ' + ItemName, "warning");
                            $("#" + tableID + " > tbody > tr ").each(function () {
                                var currentR = $(this);
                                var ItemTaxAmt2 = parseFloat(CheckNullNumber(currentR.find("#" + item_tax_amt).val())).toFixed(cmn_ValDecDigit);//Modified by Suraj Maurya on 04-11-2024
                                if (ItemTaxAmt2 == TaxAmt) {
                                    if (currentR.find("#TaxExempted").is(":checked")) {

                                    }
                                    else {
                                        currentR.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                                    }
                                }
                            });
                            //currentRow.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                            flag = "Y";
                            return false
                        }
                        //swal("", $("#TaxNotAppliedFor").text() + ' ' + ItemName, "warning");
                        //$("#" + tableID + " > tbody > tr ").each(function () {
                        //    var currentR = $(this);
                        //    var ItemTaxAmt2 = parseFloat(CheckNullNumber(currentR.find("#" + item_tax_amt).val())).toFixed(cmn_ValDecDigit);//Modified by Suraj Maurya on 04-11-2024
                        //    if (ItemTaxAmt2 == TaxAmt) {
                        //        //if (DMenuId != "105103148") {/*Add By Hina on 31-07-2024 for scrap sale invoice has no TaxExempted column */

                        //        //    if (currentR.find("#TaxExempted").is(":checked")) {

                        //        //    }
                        //        //}
                        //        if (currentR.find("#TaxExempted").is(":checked")) {

                        //        }
                        //        else {
                        //            currentR.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                        //        }
                        //    }
                        //});
                        ////currentRow.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                        //flag = "Y";
                        //return false
                    }
                }
            }
            else if (DMenuId == "105101147")/*Added by Surbhi on 17/05/2025 for Supplementary Purchase Invoice(105101147)*/ {

            }
            else if (currentRow.find("#ItemHsnCode").val() == "" || currentRow.find("#ItemHsnCode").val() == null || currentRow.find("#ItemHsnCode").val() == "0") {
                swal("", $("#HSNNotDefinedFor").text() + ' ' + ItemName, "warning");
                flag = "Y";
                return false
            }
            //else if (ItemTaxAmt == TaxAmt) {
            else if (parseFloat(ItemTaxAmt).toFixed(cmn_ValDecDigit) == parseFloat(TaxAmt).toFixed(cmn_ValDecDigit)) {
                if (DMenuId == "105103125" || DMenuId == "105103140" || DMenuId == "105103120") {//add by shubham maurya on 21-08-2025
                    if (FOCFlag != "Y") {
                        swal("", $("#TaxNotAppliedFor").text() + ' ' + ItemName, "warning");
                        $("#" + tableID + " > tbody > tr ").each(function () {
                            var currentRw = $(this);
                            var ItemTaxAmt1 = parseFloat(CheckNullNumber(currentRw.find("#" + item_tax_amt).val())).toFixed(cmn_ValDecDigit);//Modified by Suraj Maurya on 04-11-2024
                            //if (ItemTaxAmt1 == "") {
                            //ItemTaxAmt1 = parseFloat(CheckNullNumber(ItemTaxAmt1)).toFixed(cmn_ValDecDigit);
                            //}
                            var foc = "N";
                            if (currentRw.find("#FOC").is(":checked")) {
                                foc = "Y";
                            }
                            if (ItemTaxAmt1 == TaxAmt) {
                                if (currentRw.find("#TaxExempted").is(":checked")) {

                                }
                                else {
                                    if (foc != "Y") {
                                        currentRw.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                                    }
                                }
                            }
                        });
                        flag = "Y";
                        return false
                    }
                }
                else {
                    swal("", $("#TaxNotAppliedFor").text() + ' ' + ItemName, "warning");
                    $("#" + tableID + " > tbody > tr ").each(function () {
                        var currentRw = $(this);
                        var ItemTaxAmt1 = parseFloat(CheckNullNumber(currentRw.find("#" + item_tax_amt).val())).toFixed(cmn_ValDecDigit);//Modified by Suraj Maurya on 04-11-2024
                        //if (ItemTaxAmt1 == "") {
                        //ItemTaxAmt1 = parseFloat(CheckNullNumber(ItemTaxAmt1)).toFixed(cmn_ValDecDigit);
                        //}
                        if (ItemTaxAmt1 == TaxAmt) {
                            if (currentRw.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                currentRw.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                            }
                        }
                    });
                    flag = "Y";
                    return false
                }


            }
            else {
                var ItemTaxLen = $("#" + Hdn_TaxCalculatorTbl + " > tbody > tr #TaxItmCode:contains('" + ItemId + "')").length
                if (ItemTaxLen == 0) {
                    swal("", $("#TaxNotAppliedFor").text() + ' ' + ItemName, "warning");
                    $("#" + tableID + " > tbody > tr ").each(function () {
                        var currentR = $(this);
                        var ItemTaxAmt2 = parseFloat(CheckNullNumber(currentR.find("#" + item_tax_amt).val())).toFixed(cmn_ValDecDigit);//Modified by Suraj Maurya on 04-11-2024
                        if (ItemTaxAmt2 == TaxAmt) {
                            if (currentR.find("#TaxExempted").is(":checked")) {

                            }
                            else {
                                currentR.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                            }
                        }
                    });
                    //currentRow.find('#BtnTxtCalculation').css('border', 'solid 1px red');
                    flag = "Y";
                    return false
                }
            }
        }
        if (DMenuId == "105101150" || DMenuId == "105103148" || DMenuId == "105103147" || DMenuId == "105103142" || DMenuId == "105102150" || DMenuId == "105103149") {/*Add 105103148,105103147 on 02-01-2025 By Hina on 31-07-2024 for scrap sale invoice,SSI */
            if (currentRow.find("#HsnNo").val() == "" || currentRow.find("#HsnNo").val() == null) {
                swal("", $("#HSNNotDefinedFor").text() + ' ' + ItemName, "warning");
                flag = "Y";
                return false
            }
        }
        else if (DMenuId == "105101147")/*Added by Surbhi on 17/05/2025 for Supplementary Purchase Invoice(105101147)*/ {

        }
        else if (currentRow.find("#ItemHsnCode").val() == "" || currentRow.find("#ItemHsnCode").val() == null || currentRow.find("#ItemHsnCode").val() == "0") {
            swal("", $("#HSNNotDefinedFor").text() + ' ' + ItemName, "warning");
            flag = "Y";
            return false
        }
    });
    if (flag != "N") {
        return false;
    }
}
function Cmn_CheckDeliverySchdlValidations(tableID, ItemInputId, ItemDDlId, ItemQtyId, SNoHfId) {


    //var QtyDecDigit = $("#QtyDigit").text();
    var DocMenuId = $("#DocumentMenuId").val();
    var flag = "N";
    $("#" + tableID + " > tbody > tr ").each(function () {
        var row = $(this);
        var SNohf = row.find("#" + SNoHfId).val();

        var ItemID = row.find("#" + ItemInputId).val();
        var ItmQty = row.find("#" + ItemQtyId).val();
        var itemFoc = "N";
        if (DocMenuId == "105103125") {
            ItmQty = (parseFloat(CheckNullNumber(ItmQty))/* + parseFloat(CheckNullNumber(row.find("#foc_qty").val()))*/).toFixed(cmn_QtyDecDigit);
            if (parseFloat(CheckNullNumber(ItmQty)) == 0 && parseFloat(CheckNullNumber(row.find("#foc_qty").val())) > 0 ) {
                itemFoc = "Y";
            }
        }
        if (ItmQty == "" || ItmQty == null) {
            ItmQty = row.find("#" + ItemQtyId + SNohf).val();
        }
        var ItemName = row.find("#" + ItemDDlId + SNohf + " option:selected").text();
        if (DocMenuId == '105108101') {
            var BrkNameID = ItemDDlId.split('-');
            var ItemNamejo = BrkNameID[0];
            var itmtypeid = BrkNameID[1];
            var ItmType_Id = row.find("#" + itmtypeid).val();

            if (ItmType_Id == "OF" || ItmType_Id == "OW") {
                ItmQty = row.find("#" + ItemQtyId).text();
                ItemName = row.find("#" + ItemNamejo).text().trim();
            } else {
                return;
            }
        }
        if (tableID == "SOItmDetailsTbl") {
            ItmQty = 0;
            $("#SOItmDetailsTbl tbody tr #hfItemID[value=" + ItemID + "]").closest("tr").each(function () {
                var currentRow1 = $(this);
                ItmQty = parseFloat(ItmQty) + parseFloat(CheckNullNumber(currentRow1.find("#" + ItemQtyId).val()));
                    /*+ parseFloat(CheckNullNumber(currentRow1.find("#foc_qty").val()));*/
            });
        }
        else if (tableID == "PoItmDetailsTbl") {
            ItmQty = 0;
            $("#PoItmDetailsTbl tbody tr #hfItemID[value=" + ItemID + "]").closest("tr").each(function () {
                var currentRow1 = $(this);
                ItmQty = parseFloat(ItmQty) + parseFloat(currentRow1.find("#" + ItemQtyId).val());
            });
        }
        else if (tableID == "SPOItmDetailsTbl") {
            ItmQty = 0;
            $("#SPOItmDetailsTbl tbody tr #hfItemID[value=" + ItemID + "]").closest("tr").each(function () {
                var currentRow1 = $(this);
                ItmQty = parseFloat(ItmQty) + parseFloat(currentRow1.find("#" + ItemQtyId).val());
            });
        }
        else if (tableID == "RFQItmDetailsTbl") { /*Added by NItesh 15072025 For Add Request for Quoatation*/
            ItmQty = 0;
            $("#RFQItmDetailsTbl tbody tr #hfItemID[value=" + ItemID + "]").closest("tr").each(function () {
                var currentRow1 = $(this);
                ItmQty = parseFloat(ItmQty) + parseFloat(currentRow1.find("#" + ItemQtyId).val());
            });
        }
        else {
            var DelSchdlQty = $("#DeliverySchTble > tbody > tr").length;
            if (DelSchdlQty == 0) {
                swal("", $("#DeliveryScheduleQuantityDoesNotMatchWithItemQuantityFor").text() + " " + ItemName, "warning");
                flag = "Y";
                return false;
            }
        }
        var ItemQTYDS = 0;

        if (DocMenuId == "105101130" || DocMenuId == "105101140101" || DocMenuId == "105101136" || DocMenuId == "105101135") {
            if ($("#DeliverySchTble > tbody > tr #Hd_ItemIdFrDS:contains(" + ItemID + ")").length > 0) {
                $("#DeliverySchTble > tbody > tr #Hd_ItemIdFrDS:contains(" + ItemID + ")").each(function () {
                    var delv_qty = $(this).closest('tr').find("#delv_qty").text();
                    ItemQTYDS = parseFloat(ItemQTYDS) + parseFloat(CheckNullNumber(delv_qty));
                });
                if (parseFloat(CheckNullNumber(ItmQty)).toFixed(cmn_QtyDecDigit) != parseFloat(CheckNullNumber(ItemQTYDS)).toFixed(cmn_QtyDecDigit)) {
                    swal("", $("#DeliveryScheduleQuantityDoesNotMatchWithItemQuantityFor").text() + " " + ItemName, "warning");
                    flag = "Y";
                    return false;
                }
            }
            else {
                swal("", $("#DeliveryScheduleQuantityDoesNotMatchWithItemQuantityFor").text() + " " + ItemName, "warning");
                flag = "Y";
                return false;
            }
        }
        if (DocMenuId == "105103125") {
            // 105103125
            var SrvcItemType = row.find("#ItemType").val();
            var ItemQTYDS = 0;
            //var DelSchdlQty = $("#DeliverySchTble > tbody > tr").length;
            //if (DelSchdlQty == 0) {
            //    swal("", $("#DeliveryScheduleQuantityDoesNotMatchWithItemQuantityFor").text() + " " + ItemName, "warning");
            //    flag = "Y";
            //    return false;
            //}
            /* // if (SrvcItemType == "N") { this line Commented by NItesh 24112025 For Now Service Item Add So this Line Commented */
            if (itemFoc != "Y") {
                if ($("#DeliverySchTble > tbody > tr #Hd_ItemIdFrDS:contains(" + ItemID + ")").length > 0) {
                    $("#DeliverySchTble > tbody > tr #Hd_ItemIdFrDS:contains(" + ItemID + ")").each(function () {
                        var delv_qty = $(this).closest('tr').find("#delv_qty").text();
                        ItemQTYDS = parseFloat(ItemQTYDS) + parseFloat(CheckNullNumber(delv_qty));
                    });
                    if (parseFloat(CheckNullNumber(ItmQty)).toFixed(cmn_QtyDecDigit) != parseFloat(CheckNullNumber(ItemQTYDS)).toFixed(cmn_QtyDecDigit)) {
                        swal("", $("#DeliveryScheduleQuantityDoesNotMatchWithItemQuantityFor").text() + " " + ItemName, "warning");
                        flag = "Y";
                        return false;
                    }
                }
                else {
                    swal("", $("#DeliveryScheduleQuantityDoesNotMatchWithItemQuantityFor").text() + " " + ItemName, "warning");
                    flag = "Y";
                    return false;
                }
            }
            
            //  }
        }
        if (DocMenuId == "105103145110") {
            var ItemQTYDS = 0;
            if ($("#DeliverySchTble > tbody > tr #Hd_ItemIdFrDS:contains(" + ItemID + ")").length > 0) {
                $("#DeliverySchTble > tbody > tr #Hd_ItemIdFrDS:contains(" + ItemID + ")").each(function () {
                    var delv_qty = $(this).closest('tr').find("#delv_qty").text();
                    ItemQTYDS = parseFloat(ItemQTYDS) + parseFloat(CheckNullNumber(delv_qty));
                });
                if (parseFloat(CheckNullNumber(ItmQty)).toFixed(cmn_QtyDecDigit) != parseFloat(CheckNullNumber(ItemQTYDS)).toFixed(cmn_QtyDecDigit)) {
                    swal("", $("#DeliveryScheduleQuantityDoesNotMatchWithItemQuantityFor").text() + " " + ItemName, "warning");
                    flag = "Y";
                    return false;
                }
            }
            else {
                swal("", $("#DeliveryScheduleQuantityDoesNotMatchWithItemQuantityFor").text() + " " + ItemName, "warning");
                flag = "Y";
                return false;
            }
        }
        if (DocMenuId == "105101115") { /*Added By NItesh 14072025 For Add Request For Quatation*/
            var ItemQTYDS = 0;
            if ($("#DeliverySchTble > tbody > tr #Hd_ItemIdFrDS:contains(" + ItemID + ")").length > 0) {
                $("#DeliverySchTble > tbody > tr #Hd_ItemIdFrDS:contains(" + ItemID + ")").each(function () {
                    var delv_qty = $(this).closest('tr').find("#delv_qty").text();
                    ItemQTYDS = parseFloat(ItemQTYDS) + parseFloat(CheckNullNumber(delv_qty));
                });
                if (parseFloat(CheckNullNumber(ItmQty)).toFixed(cmn_QtyDecDigit) != parseFloat(CheckNullNumber(ItemQTYDS)).toFixed(cmn_QtyDecDigit)) {
                    swal("", $("#DeliveryScheduleQuantityDoesNotMatchWithItemQuantityFor").text() + " " + ItemName, "warning");
                    flag = "Y";
                    return false;
                }
            }
            else {
                swal("", $("#DeliveryScheduleQuantityDoesNotMatchWithItemQuantityFor").text() + " " + ItemName, "warning");
                flag = "Y";
                return false;
            }
        }
    });
    if (flag == "Y") {
        return false;
    }
}
function Cmn_VoucherDateValidation(VouDt) {
    debugger;

    var VouDate = $(VouDt).val();
    //$("#hdFromdate").val(FromDate)
    if ((VouDate != null || VouDate == "")) {
        var date = VouDate.split('-');
        var dt1 = date[0];
        var dt2 = parseInt(dt1)
        var len = dt2.toString().length;
        if (len == 4) {
            var now = new Date();
            var month = (now.getMonth() + 1);
            var day = now.getDate();
            if (month < 10)
                month = "0" + month;
            if (day < 10)
                day = "0" + day;
            var today = now.getFullYear() + '-' + month + '-' + day;
            //$("#txtTodate").val(today);
            if (VouDate > today) {

                //var fromDate = new Date($("#hdFromdate").val());

                //var month = (fromDate.getMonth() + 1);
                //var day = fromDate.getDate();
                //if (month < 10)
                //    month = "0" + month;
                //if (day < 10)
                //    day = "0" + day;
                //var today = fromDate.getFullYear() + '-' + month + '-' + day;
                $(VouDt).val(today);
                swal("", $("#VoucherDateCannotGrthenCurrDate").text(), "warning");
            }
            if (VouDate < today) {
                /*start Add by Hina on 24-03-2025 to chk Financial year exist or not*/
                var compId = $("#CompID").text();
                var brId = $("#BrId").text();
                //var Voudt = $("#txtJVDate").val();
                $.ajax({
                    type: "POST",
                    url: "/Common/Common/Fin_CheckFinancialYear",
                    data: {
                        compId: compId,
                        brId: brId,
                        Voudt: VouDate
                    },
                    success: function (data) {
                        if (data == "FY Exist") { /*End to chk Financial year exist or not*/

                        }
                        else {/* to chk Financial year exist or not*/
                            if (data == "FY Not Exist") {
                                //var today = new Date();
                                swal("", $("#FinancialYearDoesNotExistTransactionCanNotBeDone").text(), "warning");
                                $("#txtJVDate").val(today);
                                $("#BPDate").val(today);
                                $("#VouDate").val(today);
                                $("#CNDate").val(today);
                                $("#DNDate").val(today);
                                $("#PVDate").val(today);
                                $("#SVDate").val(today);
                                $("#Exp_Date").val(today);
                            }
                            else {
                                swal("", $("#BooksAreClosedEntryCanNotBeMadeInThisFinancialYear").text(), "warning");
                                $("#txtJVDate").val(today);
                                $("#BPDate").val(today);
                                $("#VouDate").val(today);
                                $("#CNDate").val(today);
                                $("#DNDate").val(today);
                                $("#PVDate").val(today);
                                $("#SVDate").val(today);
                                $("#Exp_Date").val(today);
                            }
                        }
                    }
                });
                /*End to chk Financial year exist or not*/
                //return false;
            }
        }
    }


}

function Cmn_OnClickReplicateDeliveryShdul(ItmDetailsTbl, RowSerialed, SNohiddenfiled, ItemDDl_ID, ItemQty_ID) {

    var rowIdx = 0;
    var ValidInfo = "N";
    var DocumentMenuId = $("#DocumentMenuId").val();
    //var QtyDecDigit = $("#QtyDigit").text();
    //if (DocumentMenuId == "105103145110") {
    //    QtyDecDigit = $("#ExpImpQtyDigit").text();
    //}


    var DelDate = $('#DeliveryDate').val();
    var DocMenuId = $("#DocumentMenuId").val();
    var someDate = new Date(DelDate);
    var Dyear = someDate.getUTCFullYear();
    var Maxyear = parseInt(moment().format("YYYY")) + 20;
    if (DelDate == "") {
        ValidInfo = "Y";
        $('#SpanDeliSchDeliDate').text($("#valueReq").text());
        $("#SpanDeliSchDeliDate").css("display", "block");
        $("#DeliveryDate").css("border-color", "red");
    }
    else {
        if (parseInt(Dyear) > parseInt(Maxyear)) {
            ValidInfo = "Y";
            $('#SpanDeliSchDeliDate').text($("#JC_InvalidDate").text());
            $("#SpanDeliSchDeliDate").css("display", "block");
            $("#DeliveryDate").css("border-color", "red");
        } else {
            $("#SpanDeliSchDeliDate").css("display", "none");
            $("#DeliveryDate").css("border-color", "#ced4da");
        }
    }
    if (ValidInfo == "Y") {
        return false;
    }
    $("#SpanDelSchItemName").css("display", "none");
    $("#DeliverySchItemDDL").css("border-color", "#ced4da");
    $("#DeliverySchQty").css("border-color", "#ced4da");
    $("#SpanDelSchItemQty").css("display", "none");

    $('#DeliverySchTble >tbody >tr').remove();
    $("#" + ItmDetailsTbl + " >tbody >tr").each(function () {
        var currentRow = $(this);

        var Sno = currentRow.find("#" + SNohiddenfiled).val();
        var DelItem = currentRow.find("#" + ItemDDl_ID + Sno).val();
        var PQItemName = currentRow.find("#" + ItemDDl_ID + Sno + " option:selected").text();
        var POItemQty = parseFloat(CheckNullNumber(currentRow.find("#" + ItemQty_ID).val())).toFixed(cmn_QtyDecDigit);
        //if (DocMenuId == "105103125") {
        //    POItemQty = (parseFloat(POItemQty) + parseFloat(CheckNullNumber(currentRow.find("#foc_qty").val()))).toFixed(cmn_QtyDecDigit);
        //}
        if (parseFloat(CheckNullNumber(POItemQty)) > 0) {//Added by Suraj Maurya on 15-01-2026 as discussed with vishal sir, free quantity will not be add in delivery schedule.
            $("#DeliverySchTble >tbody >tr").each(function () {

                var currentRowDS = $(this);
                var DelSchItemtbl = currentRowDS.find("#Hd_ItemIdFrDS").text();
                var DelSchQtyTbl = currentRowDS.find("#delv_qty").text();
                if (DelSchItemtbl == DelItem) {
                    $("#DeliverySchTble >tbody >tr #Hd_ItemIdFrDS:contains(" + DelItem + ")").parent().remove();
                    POItemQty = (parseFloat(POItemQty) + parseFloat(DelSchQtyTbl)).toFixed(cmn_QtyDecDigit);
                }
            });
            var SrvcItemType = "N";
            if (DocMenuId == "105103125") {

                SrvcItemType = currentRow.find("#ItemType").val();
                if (SrvcItemType == "Y") /*Add this by NItesh 19-12-2025 For Sales Order now Service Item Delevery */ {
                    SrvcItemType = "N";
                }
            }

            Cmn_appendDeleveryschedule(++rowIdx, PQItemName, DelItem, $('#DeliveryDate').val(), POItemQty, 0, POItemQty, 0, SrvcItemType);
            Cmn_BindDelivertSchItemList(ItmDetailsTbl, RowSerialed, SNohiddenfiled, ItemDDl_ID, ItemQty_ID)
        }
        
    });
    $("#DeliveryDate").val("");
}


//-------------------------------Delivery Schedule End ---------------------------------------//


/*------------------------------------------Attatchment start-------------------------------------------*/
function Cmn_InsertAttatchmentDetails() {


    var AttchList = [];
    $("#hdn_attatchment_list> tbody> tr").each(function () {

        var currentRow = $(this);
        var item_id = currentRow.find("#attch_Id").val();
        var file_name = currentRow.find("#attch_fileName").val();
        var file_path = currentRow.find("#attch_filePath").val();
        var file_def = currentRow.find("#attch_fileDef").val();

        AttchList.push({ item_id: item_id, file_name: file_name, file_path: file_path, file_def: file_def })
    });

    return AttchList;
}
async function RemoveAttatchFile(e, attchname) {/*For removing Saved files*/
    var DocumentMenuId = $("#DocumentMenuId").val();
    var TotalFileCount = 5;

    if (("105101145,105101152,105101154,105101150,105101147,105101140125,105103125").split(',').includes(DocumentMenuId)) { /* Added by Suraj Maurya on 27-05-2025 to increase file limit */
        TotalFileCount = 20;
    }
    if (DocumentMenuId == "103105") {
        var currentdoc = $(e.target).closest(".file-preview-thumbnails");//
        await $.ajax({
            type: "POST",
            url: "/BusinessLayer/ItemDetail/DeleteFileFromTemp",
            data: { file_name: attchname },
            success: function (data) {
                debugger;
                $("#hdn_attatchment_list tbody >tr").find(" td #attch_fileName[value='" + attchname + "']").closest("tr").remove()
                currentdoc.remove();
                var Count = $("#hdn_attatchment_list tbody >tr").length;
                if (Count < TotalFileCount) {
                    $("#file-1").attr('disabled', false);
                    $("#FilesUpload").css("display", "");
                }
                console.log(data);
            }


        })
    } else {
        var currentdoc = $(e.target).closest(".file-preview-thumbnails");//
        $("#hdn_attatchment_list tbody >tr").find(" td #attch_fileName[value='" + attchname + "']").closest("tr").remove()
        currentdoc.remove();
        var Count = $("#hdn_attatchment_list tbody >tr").length;
        if (Count < TotalFileCount) {
            $("#file-1").attr('disabled', false);
            $("#FilesUpload").css("display", "");
        }
    }

}





function readURL(img) { /*For inserting Files in to folder*/

    var files = img;
    if (files) {
        var Selected = files.length;
        var UploadedImage = $("#hdn_attatchment_list> tbody > tr").length;

        var fileCount = parseInt(Selected) + parseInt(UploadedImage);

        if (fileCount > 0) {

            var datalist = new FormData();
            for (var i = 0; i < files.length; i++) {

                if (files[i] != null) {
                    var flagA = "N";
                    $("#hdn_attatchment_list> tbody > tr").each(function () {
                        var RWImgNm = $(this).find("#attch_fileName").val();
                        RWImgNm = RWImgNm.substring(RWImgNm.split('_')[0].length + 1);
                        var RWImgNm1 = RWImgNm;
                        if ($(this).find("#attch_filePath").val() == "") {
                            RWImgNm1 = RWImgNm.substring(RWImgNm.split('_')[0].length + 1);
                        }
                        if (RWImgNm1 == files[i].name) {
                            flagA = "Y";
                        }

                    });
                    if (flagA == "N") {
                        var itemid = $("#item_id").val();
                        if (itemid == "" || itemid == null) {
                            itemid = "0";
                        }
                        datalist.append(files[i].name, files[i]);
                    }
                }
            }

            var DocNo = $("#HdnDocNo_ForAttach").val()
            var title = $("#hdn_title").val();
            var TransType = $("#hdn_TransType").val();
            var PName = window.location.pathname.split('/')
            var addr = '/' + PName[1] + '/' + PName[2]
            var xhr = new XMLHttpRequest();
            xhr.open('POST', addr + '/Upload?title=' + title + '&&DocNo=' + DocNo + '&&TransType=' + TransType);
            xhr.send(datalist);
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var DocId = $("#DocumentMenuId").val(); /*Add by Hina Sharma on 19-02-2025 for Import tracking page*/
                    if (DocId != null) {
                        debugger
                        if (DocId == "105101140130") {
                            GetDataPreviewImages(xhr.responseText);
                            //(xhr.responseText)
                        }
                    }
                    //alert(xhr.responseText);
                }
            }
        }
    }
}
function CheckSavedDuplicateImage(file) { /*To Check Duplicate files Use In fileinput.js*/

    var duplicate = "N";
    $("#hdn_attatchment_list> tbody > tr").each(function () {
        var row = $(this);
        var FileName = row.find("#attch_fileName").val();
        FileName = FileName.substring(FileName.split('_')[0].length + 1);
        if (file.name == FileName) {
            duplicate = "Y";
            return false;
        }
    });
    if (duplicate == "Y") {
        return false;
    }
    else {
        return true;
    }

}
function Cmn_EnableDeleteAttatchFiles() {
    $("#PartialImageBind .file-preview .file-preview-thumbnails").each(function () {
        var Current = $(this);
        var filename = Current.find(".file-caption-info")[0].innerText;
        Current.find("#RemoveAttatchbtn").attr("onclick", "RemoveAttatchFile(event,'" + filename + "')");
    });
}
function Cmn_ClickToDefaultImg(Flag, attchname) {

    if (Flag == 'Direct') {
        $("#hdn_Attatchment_Default_details").val(attchname);
    } else {
        attchname = attchname.substring(attchname.split('_')[0].length + 1);
        $("#hdn_Attatchment_Default_details").val(attchname);
    }

}
//function Cmn_OnchangeFileInput() {

//    $("#FilesUpload .kv-preview-thumb .file-footer-buttons #radiospan").remove();
//    $("#FilesUpload .kv-preview-thumb .file-footer-buttons").append(`<span class="btn btn-kv btn-default btn-outline-secondary" id="radiospan" title="Set as default">
//<input type="radio" name="default" onclick="" title="Set as default" style="width: 20px;height: 15px;margin-top: 6px;">
//</span>`)
//    $(".kv-file-content").each(function () {
//        var CurrFile = $(this);
//        if (CurrFile[0].children[0].localName != "img") {
//            CurrFile.parent().find("#radiospan").remove()
//        }
//    })
//    $("#FilesUpload .kv-preview-thumb .file-footer-buttons").each(function () {
//        var currentRow = $(this);
//        var name = currentRow.parent().parent().find(".file-caption-info").text();
//        currentRow.find("#radiospan input").attr("onclick", "Cmn_ClickToDefaultImg('Direct','" + name + "')");
//        //        currentRow[0].innerHTML = (`
//        //<button type="button" class="kv-file-remove btn btn-kv btn-default btn-outline-secondary" title="Remove file"><i class="glyphicon glyphicon-trash"></i></button>
//        //<button type="button" class="kv-file-zoom btn btn-kv btn-default btn-outline-secondary" title="View Details"><i class="glyphicon glyphicon-zoom-in"></i></button>
//        //<span class="btn btn-kv btn-default btn-outline-secondary" title="Set as default">
//        //<input type="radio" name="default" checked onclick="Cmn_ClickToDefaultImg(${name})" title="Set as default" style="width: 20px;height: 15px;margin-top: 6px;">
//        //</span>`)

//        //        $(".file-footer-buttons").append(`<span class="btn btn-kv btn-default btn-outline-secondary" title="Set as default">
//        //<input type="radio" name="default" checked onclick="Cmn_ClickToDefaultImg(${name})" title="Set as default" style="width: 20px;height: 15px;margin-top: 6px;">
//        //</span>`)

//    });

//}

function Cmn_OnchangeFileInput() {

    $("#FilesUpload .kv-preview-thumb .file-footer-buttons #radiospan").remove();
    $("#FilesUpload .kv-preview-thumb .file-footer-buttons").append(`<span class="btn btn-kv btn-default btn-outline-secondary" id="radiospan" title="Set as default">
<input type="radio" name="default" onclick="" title="Set as default" style="width: 20px;height: 15px;margin-top: 6px;">
</span>`)
    $(".kv-file-content").each(function () {
        var CurrFile = $(this);
        if (CurrFile[0].children[0].localName != "img") {
            CurrFile.parent().find("#radiospan").remove()
        }
    })
    let fileStack = $('input[type=file]').fileinput('getFileStack');
    let index = 0
    $("#FilesUpload .kv-preview-thumb .file-footer-buttons").each(function () {
        var currentRow = $(this);

        var name = currentRow.parent().parent().find(".file-caption-info").text();
        currentRow.find("#radiospan input").attr("onclick", "Cmn_ClickToDefaultImg('Direct','" + fileStack[index].name + "')");
        index++;
        //        currentRow[0].innerHTML = (`
        //<button type="button" class="kv-file-remove btn btn-kv btn-default btn-outline-secondary" title="Remove file"><i class="glyphicon glyphicon-trash"></i></button>
        //<button type="button" class="kv-file-zoom btn btn-kv btn-default btn-outline-secondary" title="View Details"><i class="glyphicon glyphicon-zoom-in"></i></button>
        //<span class="btn btn-kv btn-default btn-outline-secondary" title="Set as default">
        //<input type="radio" name="default" checked onclick="Cmn_ClickToDefaultImg(${name})" title="Set as default" style="width: 20px;height: 15px;margin-top: 6px;">
        //</span>`)

        //        $(".file-footer-buttons").append(`<span class="btn btn-kv btn-default btn-outline-secondary" title="Set as default">
        //<input type="radio" name="default" checked onclick="Cmn_ClickToDefaultImg(${name})" title="Set as default" style="width: 20px;height: 15px;margin-top: 6px;">
        //</span>`)

    });

}


/*------------------------------------------Attatchment end-------------------------------------------*/

/*------------------------------------------Data table-------------------------------------------*/
function cmn_delete_datatable(tbl_id) {
    $(tbl_id).dataTable().fnClearTable();
    $(tbl_id).dataTable().fnDestroy();
}
//function cmn_apply_datatable(tbl_id) {
//    $(tbl_id).DataTable({
//        dom: 'l B f p',
//        buttons: ['csv','pdf']
//    });
//}
function cmn_apply_datatable(tbl_id, CSVAction) {
    $(tbl_id).DataTable({
        dom: 'l B f "bottom"ip',
        "pageLength": 50,
        //dom:'l f b r i p',
        //buttons: ['csv', 'pdf'],commented by shubham Maurya on 07-08-2025 for REplace commas
        buttons: [
            {
                extend: 'csv',
                exportOptions: {
                    columns: ':visible', //add by shubham Maurya on 27-10-2025 
                    format: {
                        body: function (data, row, column, node) {
                            // Remove HTML tags
                            var text = $('<div>').html(data).text();

                            // Remove line breaks, extra spaces, and commas
                            text = text.replace(/\n/g, '').replace(/\s+/g, ' ').trim();
                            text = text.replace(/,/g, '');

                            // Optional: if cell has repeated total like "123.45   123.45", take only the first
                            let parts = text.split(' ');
                            if (parts.length > 1 && parts[0] === parts[parts.length - 1]) {
                                text = parts[0];
                            }

                            return text;
                        }
                    }
                },
                action: CSVAction /*Add by Hina Sharma on 25-09-2025 for DailyProductionPlan MIS under supervision of suraj*/
            }
            ,
            {
                extend: 'pdf'
            }
        ]
    });
}
/*----------------------------------------------end---------------------------------------------*/



/***--------------------------------Sub Item Section-----------------------------------------***/

function Cmn_SaveAndExitSubItem(flag) {

    var itemId = $("#Sub_ProductlId").val();
    var Quantity = $("#Sub_Quantity").val();
    var SrcDocNo = $("#Sub_SrcDocNo").val();
    var SrcDocDt = $("#Sub_SrcDocDate").val();
    var DocumentMenuId = $("#DocumentMenuId").val();
    //var QtyDecDigit = $("#QtyDigit").text();
    //if (DocumentMenuId == "105103145105" || DocumentMenuId == "105103145110" || DocumentMenuId == "105103145115" || DocumentMenuId == "105103145120" || DocumentMenuId == "105103145125") {
    //    QtyDecDigit = $("#ExpImpQtyDigit").text();
    //}
    /*Modify by Hina on 25-04-2024 to add Job Order Type*/
    var Josrctyp = $("#Hdn_JOSrcType").val();
    var JobOrdtyp = $("#hdnJobOrdTyp").val();
    var Sub_Quantity = 0;
    //var Sub_AccQuantity = 0;
    //var Sub_RejQuantity = 0;
    //var Sub_RewQuantity = 0;
    var ErrorFlag = "N";
    //   var matrialtype = $("#hdnMatrialtypeForCunsume").val();
    $("#Sub_ItemDetailTbl tbody tr").each(function () {
        var Crow = $(this).closest("tr");
        var e = $(this);
        if (flag == "QCAccQty") {
            var subItemAccQty = Crow.find("#subItemAccQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemAccQty));
            if (Cmn_OnchangeQCsubitemQty(e, flag, Crow) == false) {
                ErrorFlag = "Y";
            }
        } else if (flag == "QCRejQty") {
            var subItemRejQty = Crow.find("#subItemRejQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemRejQty));
            if (Cmn_OnchangeQCsubitemQty(e, flag, Crow) == false) {
                ErrorFlag = "Y";
            }
        }
        else if (flag == "QCRewQty") {
            var subItemRewQty = Crow.find("#subItemRewQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemRewQty));
            if (Cmn_OnchangeQCsubitemQty(e, flag, Crow) == false) {
                ErrorFlag = "Y";
            }
        } else if (flag == "QCShortQty") {
            var subItemShortQty = Crow.find("#subItemShortQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemShortQty));
            if (Cmn_OnchangeQCsubitemQty(e, flag, Crow) == false) {
                ErrorFlag = "Y";
            }
        } else if (flag == "QCSampleQty") {
            var subItemSampleQty = Crow.find("#subItemSampleQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemSampleQty));
            if (Cmn_OnchangeQCsubitemQty(e, flag, Crow) == false) {
                ErrorFlag = "Y";
            }
        }
        else if (flag == "SwapQty") {
            var subItemRewQty = Crow.find("#subItemQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemRewQty));
            if (Cmn_OnChangeSubItemQty(e, Crow) == false) {
                ErrorFlag = "Y";
            }
        }
        else if (flag == "ExterRec_qty") {
            var subItemQty = Crow.find("#subItemQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));
            if (Cmn_OnChangeSubItemQty(e, Crow) == false) {
                ErrorFlag = "Y";
            }
        }
        /*Modify by Hina on 07-10-2023  to add flag DNBillQty,DNRecQty for delivery note*/
        else if (flag == "DNBillQty" || flag == "DNSCBillQty") {/*Add by HINA on 28-11-2023 for DNSC Page*/
            var subItemBillQty = Crow.find("#subItemBillQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemBillQty));
            if (Cmn_OnChangeDNSubItemQty(e, flag, Crow) == false) {
                ErrorFlag = "Y";
            }
        }
        else if (flag == "DNRecQty" || flag == "DNSCRecQty") {
            var subItemReceiveQty = Crow.find("#subItemReceiveQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemReceiveQty));
            if (Cmn_OnChangeDNSubItemQty(e, flag, Crow) == false) {
                ErrorFlag = "Y";
            }
        }
        else if (flag == "Scrap") {
            var subItemRewQty = Crow.find("#subItemQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemRewQty));
            if (Cmn_OnChangeSubItemQty(e, Crow) == false) {
                ErrorFlag = "Y";
            }
        }
        else if (flag == "AssemblyKitINput") {
            var subItemQty = Crow.find("#subItemQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));
            if (Cmn_OnChangeSubItemQty(e, Crow) == false) {
                ErrorFlag = "Y";
            }
        }
        else if (flag == "CM_ConsumeQty" && DocumentMenuId == "105105128") {

            var subItemQty = Crow.find("#subItemQty").val();
            if (Cmn_OnChangeSubItemQty(e, Crow) == false) {
                ErrorFlag = "Y";
            }
            Sub_Quantity = (parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty))).toFixed(cmn_QtyDecDigit);
        }
        else if (flag == "SRTReturnQty") {
            var subItemAvlStk = Crow.find("#subItemAvlStk").val();
            var subItemQty = Crow.find("#subItemQty").val();

            if (parseFloat(CheckNullNumber(subItemAvlStk)) < parseFloat(CheckNullNumber(subItemQty))) {
                var errMessage = $("#ExceedingQty").text();
                Crow.find("#subItemQty").css("border-color", "red");
                Crow.find("#subItemQty_Error").text(errMessage);
                Crow.find("#subItemQty_Error").css("display", "block");
                ErrorFlag = "Y";
            } else {
                Crow.find("#subItemQty").css("border-color", "#ced4da");
                Crow.find("#subItemQty_Error").text("");
                Crow.find("#subItemQty_Error").css("display", "none");
                //return true;
                Sub_Quantity = (parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty))).toFixed(cmn_QtyDecDigit);
            }

        }
        else if (flag == "AdSRTReturnQty") {//add by shubham maurya on 26-03-2025
            var subItemQty = Crow.find("#subItemQty").val();
            Sub_Quantity = (parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty))).toFixed(cmn_QtyDecDigit);
        }
        else if (flag == "PRTReturnQty" || flag == "AdPRTReturnQty") {
            var subItemAvlStk = Crow.find("#subItemAvlStk").val();
            var subItemQty = Crow.find("#subItemQty").val();

            if (parseFloat(CheckNullNumber(subItemAvlStk)) < parseFloat(CheckNullNumber(subItemQty))) {
                var errMessage = $("#ExceedingQty").text();
                Crow.find("#subItemQty").css("border-color", "red");
                Crow.find("#subItemQty_Error").text(errMessage);
                Crow.find("#subItemQty_Error").css("display", "block");
                ErrorFlag = "Y";
            } else {
                Crow.find("#subItemQty").css("border-color", "#ced4da");
                Crow.find("#subItemQty_Error").text("");
                Crow.find("#subItemQty_Error").css("display", "none");
                //return true;
                Sub_Quantity = (parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty))).toFixed(cmn_QtyDecDigit);
            }

        }
        else if (flag == "PRDProduceQty") {
            var subItemQty = Crow.find("#subItemQcsQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));
            if (Cmn_OnChangeSubItemQty(e, Crow) == false) {
                ErrorFlag = "Y";
            }
        }
        else if (flag == "StkResTotalResQty") {
            var subItemAvlStk = Crow.find("#subItemAvlQty").val();
            if ($("#TransType").val() == "U") {//Added by Suraj Maurya on 06-12-2025
                subItemAvlStk = Crow.find("#subItemPendQty").val();
            }
            var subItemQty = Crow.find("#subItemQty").val();

            if (parseFloat(CheckNullNumber(subItemAvlStk)) < parseFloat(CheckNullNumber(subItemQty))) {
                var errMessage = $("#ExceedingQty").text();
                Crow.find("#subItemQty").css("border-color", "red");
                Crow.find("#subItemQty_Error").text(errMessage);
                Crow.find("#subItemQty_Error").css("display", "block");
                ErrorFlag = "Y";
            } else {
                Crow.find("#subItemQty").css("border-color", "#ced4da");
                Crow.find("#subItemQty_Error").text("");
                Crow.find("#subItemQty_Error").css("display", "none");
                //return true;
                Sub_Quantity = (parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty))).toFixed(cmn_QtyDecDigit);
            }

        }
        else {
            var subItemQty = Crow.find("#subItemQty").val();
            if (flag == "IssueQty" || flag == "PackList" || (flag == "MDDispQty" /*&& JobOrdtyp != "Direct"*/) || (flag == "MDIssueQty" /*&& JobOrdtyp != "Direct"*/) || flag == "PackResTotalQty" || flag == "RJO_RewrkQuantity" || flag == "SRAgnst_Issue" || flag == "PC_ConsumeQuantity" || (flag == "ProduceQty" && DocumentMenuId == "105102120"/*For RQC*/) || flag == "Quantity" || flag == "FocQuantity" || flag == "OrdrToPrecurQuantity" || flag == "Input") {
                if (Cmn_OnChangeSubItemQty(e, Crow) == false) {
                    ErrorFlag = "Y";
                }
            }
            Sub_Quantity = (parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty))).toFixed(cmn_QtyDecDigit);
        }
    });
    if (ErrorFlag == "Y") {
        $("#SerialSaveAndExitBtn").attr("data-dismiss", "");
        return false;
    }
    if (DocumentMenuId == "105102165") {
        if ($("#ItemOrderType").is(":checked")) {
            if (parseFloat(CheckNullNumber(Quantity)) != parseFloat(Sub_Quantity)) {
                swal("", $("#SubItemQuantityDoesNotMatchWithItemQuantity").text(), "warning");
                $("#SerialSaveAndExitBtn").attr("data-dismiss", "");
            }
            else {
                Cmn_ApendToHdnSubItemTable(flag);
                $("#SubItemSaveAndExitBtn").attr("data-dismiss", "modal");
            }
        }
        else if ($("#UOMItemOrderType").is(":checked")) {
            if ($("#SwapSrcType").val() != "DestSwapQty") {
                if (parseFloat(CheckNullNumber(Quantity)) != parseFloat(Sub_Quantity)) {
                    swal("", $("#SubItemQuantityDoesNotMatchWithItemQuantity").text(), "warning");
                    $("#SerialSaveAndExitBtn").attr("data-dismiss", "");
                }
                else {
                    Cmn_ApendToHdnSubItemTable(flag);
                    $("#SubItemSaveAndExitBtn").attr("data-dismiss", "modal");
                }
            }
            else {
                Cmn_ApendToHdnSubItemTable(flag);
                $("#SubItemSaveAndExitBtn").attr("data-dismiss", "modal");
            }
        }
        else {
            var subItmAvlStkTotal = $("#subItmAvlStkTotal").text();
            var SubItemTotalQty = $("#SubItemTotalQty").text();
            if (subItmAvlStkTotal != SubItemTotalQty) {
                swal("", $("#SubItemQuantityDoesNotMatchWithItemQuantity").text(), "warning");
                $("#SerialSaveAndExitBtn").attr("data-dismiss", "");
            }
            else {
                Cmn_ApendToHdnSubItemTable(flag);
                $("#SubItemSaveAndExitBtn").attr("data-dismiss", "modal");
            }
        }

        //$("#SubItemSaveAndExitBtn").attr("data-dismiss", "modal");

        if (flag == "PackResTotalQty") {
            $("#SubItemBatchPopupQty").css("border", "#ced4da");
        } else if (flag == "PackResQuantity") {
            var srcdocno = $("#Sub_SrcDocNo").val();
            $("#OrderReservedStockSubItemTbl tbody tr #tblorderno[value='" + srcdocno + "']").closest('tr').find("#SubItemPackResDetailQty").css("border", "#ced4da")
        } else if (flag == "BYPSRecvQty") {/*Add By Hina on 30-11-2023 for DNSC page*/
            DNSCByPrdctScrpResetWorningBorderColor();
        }
        else if (flag == "PopUpStk_Qty")/*Add By Hina on 24-07-2024 for Stock take New Popup*/ {
            StokTakeResetWorningBorderColor();
        }
        else if (flag == "OrdrToPrecurQuantity")/*Add By shubham maurya on 19-10-2024 for Stock take New Popup*/ {
            ResetWorningBorderColorProc();
        }
        else {
            ResetWorningBorderColor();
        }
    }
    else if (parseFloat(CheckNullNumber(Quantity)) != parseFloat(Sub_Quantity)) {
        swal("", $("#SubItemQuantityDoesNotMatchWithItemQuantity").text(), "warning");
        $("#SerialSaveAndExitBtn").attr("data-dismiss", "");
    }
    else {
        //$("#hdn_Sub_ItemDetailTbl >tbody >tr td #ItemId[value=" + itemId + "]").closest('tr').remove();
        if (flag == "IssueQty") {//for material transfer issue due to extra fields
            try {
                fn_CustomReSetSubItemData(itemId);
            }
            catch (ex) {
                console.log(ex);
            }

        }
        /*Modify by Hina on 07-10-2023  to add flag DNBillQty,DNRecQty for delivery note*/
        else if (flag == "DNBillQty" || flag == "DNRecQty") {//for material transfer issue due to extra fields
            try {
                fn_DNCustomReSetSubItemData(itemId);
            }
            catch (ex) {
                console.log(ex);
            }

        }
        /*Modify by Hina on 23-11-2023  to add flag DNSCBillQty,DNSCRecQty for delivery note SC*/
        else if (flag == "DNSCBillQty" || flag == "DNSCRecQty") {
            try {
                fn_DNSCCustomReSetSubItemData(itemId, flag);
            }
            catch (ex) {
                console.log(ex);
            }

        }
        else if (flag == "SRTReturnQty" || flag == "AdSRTReturnQty"/*Add by Suraj for Sales Return*/) {//Add by Hina for Purchase Return
            try {//add by shubham maurya on 31-03-2025 add "AdSRTReturnQty"
                fn_PRTCustomReSetSubItemData(itemId);
            }
            catch (ex) {
                console.log(ex);
            }
        }
        else if (flag == "PRTReturnQty" || flag == "AdPRTReturnQty"/*Add by Suraj for Sales Return*/) {//Add by Hina for Purchase Return
            try {
                fn_PRTCustomReSetSubItemData1(itemId);
            }
            catch (ex) {
                console.log(ex);
            }
        }
        else if (flag == "RJO_RewrkQuantity" || flag == "RM_RequireQty" || flag == "CM_ConsumeQty" || flag == "Service_RM_RequireQty") {//for material transfer issue due to extra fields
            try {

                var SubItmType = "";
                if (flag == "RJO_RewrkQuantity") {
                    SubItmType = "SubHedr";
                }
                else if (flag == "RM_RequireQty" || flag == "Service_RM_RequireQty") { /*Added (flag =Service_RM_RequireQty) By Nitesh 17-07-2024 For Service Item */
                    SubItmType = "SubRM";
                }
                else {
                    SubItmType = "SubCM";
                }
                fn_CustomReSetRewrkSubItemData(itemId, SubItmType);
            }
            catch (ex) {
                console.log(ex);
            }

        }
        /*Modify by Hina on 23-04-2024  to add flag JO_HdrOrdQty for Dircet case for Job Order SC*/
        else if ((flag == "JO_HdrOrdQty" && Josrctyp == "Direct") || (flag == "JOReqQty" && Josrctyp == "Direct")) {//for material transfer issue due to extra fields
            try {

                var SubItmType = "";
                if (flag == "JO_HdrOrdQty") {
                    SubItmType = "SubHedr";
                }
                else {
                    SubItmType = "SubRM";
                }
                fn_CustomJOSubItemDataForDirect(itemId, SubItmType);
            }
            catch (ex) {
                console.log(ex);
            }

        }
        /*Modify by Hina on 25-04-2024 to add flag MDDispQty,MDIssueQty for Material Dispatch against of Direct Job Order SC*/

        else if ((flag == "MDDispQty" && JobOrdtyp == "Direct") || (flag == "MDIssueQty" && JobOrdtyp == "Direct")) {//for material transfer issue due to extra fields
            try {

                var SubItmType = "";
                if (flag == "MDDispQty") {
                    SubItmType = "SubHedr";
                }
                else {
                    SubItmType = "SubItm";
                }
                fn_CustmMDSubItemDataAgainstDirectJO(itemId, SubItmType);
            }
            catch (ex) {
                console.log(ex);
            }

        }




        else {
            Cmn_ApendToHdnSubItemTable(flag);

        }

        $("#SubItemSaveAndExitBtn").attr("data-dismiss", "modal");

        if (flag == "PackResTotalQty") {
            $("#SubItemBatchPopupQty").css("border", "#ced4da");
        }
        else if (flag == "PackResQuantity") {
            var srcdocno = $("#Sub_SrcDocNo").val();
            $("#OrderReservedStockSubItemTbl tbody tr #tblorderno[value='" + srcdocno + "']").closest('tr').find("#SubItemPackResDetailQty").css("border", "#ced4da")
        }
        else if (flag == "BYPSRecvQty")/*Add By Hina on 30-11-2023 for DNSC page*/ {
            DNSCByPrdctScrpResetWorningBorderColor();
        }
        else if (flag == "PopUpStk_Qty")/*Add By Hina on 24-07-2024 for Stock take New Popup*/ {
            StokTakeResetWorningBorderColor();
        }
        else if (flag == "OrdrToPrecurQuantity" && DocumentMenuId != "105105117")/*Add By shubham maurya on 19-10-2024 for Stock take New Popup*/ {
            ResetWorningBorderColorProc();
        }
        else {
            ResetWorningBorderColor();
        }
    }
}
function Cmn_ApendToHdnSubItemTable(flag) {
    var QCSrcType = $("#hdQCtype").val();
    var itemId = $("#Sub_ProductlId").val();
    var Quantity = $("#Sub_Quantity").val();
    var SrcDocNo = $("#Sub_SrcDocNo").val();
    var SrcDocDt = $("#Sub_SrcDocDate").val();
    var SwapSrcType = $("#SwapSrcType").val();
    var DocumentMenuId = $("#DocumentMenuId").val();
    let ItemType = "";//Used in case of MRP;
    if (flag != "OrdrToPrecurQuantity" && DocumentMenuId == "105105117") {/*Added by Suraj Maurya on 18-11-2024*/

        if (flag == "OrdrToProduceQuantity") {
            ItemType = "SF";
        }
        if (flag == "Quantity") {
            ItemType = "FG";
        }
        if (flag == "RMOrdrToPrecurQuantity") {
            ItemType = "RM";
        }

        $("#hdn_Sub_ItemDetailTbl >tbody #ItemId[value='" + itemId + "']").closest('tr').find("#ItemType[value='" + ItemType + "']")
            .closest('tr').remove();

    }
    $("#Sub_ItemDetailTbl > tbody > tr").each(function () {

        var Crow = $(this).closest("tr");
        var subItemId = Crow.find("#subItemId").val();
        if (flag == "SwapQty") {
            var subItemQty = Crow.find("#subItemQty").val();
        }
        else {
            var subItemQty = Crow.find("#subItemQty").val();
        }
        var subItemSrcNo = $("#Sub_SrcDocNo").val();
        var subItemSrcDate = $("#Sub_SrcDocDate").val();
        var subItemPackOrdQty = Crow.find("#subItemOrdQty").val();
        var subItemPackPenQty = Crow.find("#subItemPendQty").val();
        if (flag == "MDDispQty") {
            var subItemOrdQty = Crow.find("#subItemOrdQty").val();
        }
        if (DocumentMenuId == "105105116") {
            var PPLPendingQty = Crow.find("#PPLPendingQty").val();
        }

        var len = 0;
        if (DocumentMenuId == "105103130" || DocumentMenuId == "105103145115") {
            var flagSrcMatch = "N";
            if (flag == "PackResQuantity") {
                len = $("#hdn_Sub_ItemResDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').length;
                $("#hdn_Sub_ItemResDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').each(function () {
                    var Crow1 = $(this);
                    var subItemSrcNo1 = Crow1.find("#subItemSrcDocNo").val();
                    if (subItemSrcNo == subItemSrcNo1) {
                        flagSrcMatch = "Y";
                    }
                });
                if (flagSrcMatch == "Y") {
                    len = 1;
                } else {
                    len = 0;
                }
            }
            else if (flag == "PackResTotalQty") {
                len = $("#hdn_Sub_ItemPackResDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').length;

            }
            else {
                len = $("#hdn_Sub_ItemDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').length;
                $("#hdn_Sub_ItemDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').each(function () {
                    var Crow1 = $(this);
                    var subItemSrcNo1 = Crow1.find("#subItemSrcDocNo").val();
                    if (subItemSrcNo == subItemSrcNo1) {
                        flagSrcMatch = "Y";
                    }
                });
                if (flagSrcMatch == "Y") {
                    len = 1;
                } else {
                    len = 0;
                }
            }

        }
        else if (flag == "BYPSRecvQty")/*Add by Hina on 29-11-2023 for ByProductScrap Detail on Delivery Note SC*/ {
            len = $("#hdn_Sub_ItemByProductScrapDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').length;
        }
        else if (flag == "OrdrToPrecurQuantity" && DocumentMenuId == "105105117")/*Add by Nitesh on 16-05-2024 for MRP Order TO Pecure*/ {
            len = $("#hdn_SubItemDetailTblMRPSF_Procure >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').length;
        }
        else if (flag == "OrdrToPrecurQuantity" && DocumentMenuId == "105105116")/*Add by Shubham maurya on 17-10-2024 for PP TO Pecure*/ {
            len = $("#hdn_SubItemDetailTblPP_Procure >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').length;
        }
        else if (flag == "PopUpStk_Qty")/*Added by Hina on 28-05-2024 for Stock Take  Add New Popup sub-item */ {
            len = $("#hdn_PopUpStkSub_ItemDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').length;
        }
        else if (flag == "Input")/*Added by NItesh 26-06-2024  For Finish Good Recipt Add New Popup sub-item */ {
            len = $("#hdn_ConsumeSub_ItemDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').length;
        }
        else if (flag == "ExterRec_qty")/*Added by NItesh 03-11-2025  For External Recipt Add New Popup sub-item */ {
            len = $("#hdn_Sub_ItemDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').length;
        }
        else if (flag != "OrdrToPrecurQuantity" && DocumentMenuId == "105105117") {/*Add by Suraj on 18-11-2024 for for MRP other then Order TO Pecure*/
            len = 0;
        }
        else {
            len = $("#hdn_Sub_ItemDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').length;
        }

        if (len > 0) {
            if (flag == "PackResQuantity") {
                $("#hdn_Sub_ItemResDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').each(function () {
                    var InnerCrow = $(this).closest("tr");
                    //var ItemId = InnerCrow.find("#ItemId").val();
                    var subItemId1 = InnerCrow.find("#subItemId").val();
                    var SrcDocNo = InnerCrow.find("#subItemSrcDocNo").val();
                    if (DocumentMenuId == "105103130" || DocumentMenuId == "105103145115") {
                        if (SrcDocNo == subItemSrcNo) {
                            InnerCrow.find("#subItemQty").val(subItemQty);
                        }
                    }
                });
            }
            else if (flag == "PackResTotalQty") {
                $("#hdn_Sub_ItemPackResDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').each(function () {
                    var InnerCrow = $(this).closest("tr");
                    InnerCrow.find("#subItemQty").val(CheckNullNumber(subItemQty));
                });
            }
            else if (flag == "BYPSRecvQty") {/*Add by Hina on 29-11-2023 for ByProductScrap Detail on Delivery Note SC*/
                $("#hdn_Sub_ItemByProductScrapDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').each(function () {
                    var InnerCrow = $(this).closest("tr");
                    InnerCrow.find("#subItemQty").val(CheckNullNumber(subItemQty));
                });
            }
            else if (flag == "ExterRec_qty") { /*Added by NItesh 03-11-2025  For External Recipt Add New Popup sub-item */
                $("#hdn_Sub_ItemDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').each(function () {
                    var InnerCrow = $(this).closest("tr");
                    InnerCrow.find("#subItemQty").val(CheckNullNumber(subItemQty));
                });
            }
            else if (flag == "OrdrToPrecurQuantity" && DocumentMenuId == "105105117") {/*Add by Nitesh on 16-05-2024 for for MRP Order TO Pecure*/
                $("#hdn_SubItemDetailTblMRPSF_Procure >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').each(function () {
                    var InnerCrow = $(this).closest("tr");
                    InnerCrow.find("#subItemQty").val(CheckNullNumber(subItemQty));
                });
            }
            else if (flag == "OrdrToPrecurQuantity" && DocumentMenuId == "105105116") {/*Add by Shubham Maurya on 17-10-2024 for for PP TO Pecure*/
                $("#hdn_SubItemDetailTblPP_Procure >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').each(function () {
                    var InnerCrow = $(this).closest("tr");
                    InnerCrow.find("#subItemQty").val(CheckNullNumber(subItemQty));
                });
            }
            /*Added by Hina on 28-05-2024 for Stock Take  Add New Popup sub-item */
            else if (flag == "PopUpStk_Qty") {
                $("#hdn_PopUpStkSub_ItemDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').each(function () {
                    var InnerCrow = $(this).closest("tr");
                    InnerCrow.find("#subItemQty").val(CheckNullNumber(subItemQty));
                });
            }
            else if (flag == "Input") { /*Modified By Nitesh 02-07-2024 ('FGR-')*/
                $("#hdn_ConsumeSub_ItemDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').each(function () {
                    var InnerCrow = $(this).closest("tr");
                    InnerCrow.find("#subItemQty").val(CheckNullNumber(subItemQty));
                });
            }
            else {
                $("#hdn_Sub_ItemDetailTbl >tbody >tr td #subItemId[value=" + subItemId + "]").closest('tr').each(function () {
                    var InnerCrow = $(this).closest("tr");
                    //var ItemId = InnerCrow.find("#ItemId").val();
                    var subItemId1 = InnerCrow.find("#subItemId").val();
                    var SrcDocNo = InnerCrow.find("#subItemSrcDocNo").val();
                    if (DocumentMenuId == "105103130" || DocumentMenuId == "105103145115") {
                        if (SrcDocNo == subItemSrcNo) {
                            if (flag == "FocPackList") {//Added by Suraj Maurya on 16-01-2026
                                InnerCrow.find("#subItemFocQty").val(subItemQty);
                                InnerCrow.find("#subItemOrdFocQty").val(subItemPackOrdQty);
                                InnerCrow.find("#subItemPendFocQty").val(subItemPackPenQty);
                            }
                            else {
                                InnerCrow.find("#subItemQty").val(subItemQty);
                                InnerCrow.find("#subItemOrdQty").val(subItemPackOrdQty);
                                InnerCrow.find("#subItemPendQty").val(subItemPackPenQty);
                            }
                        }
                    }
                    else {
                        if (flag == "QCAccQty" && subItemId1 == subItemId) {
                            subItemQty = Crow.find("#subItemAccQty").val();
                            InnerCrow.find("#subItemAccQty").val(subItemQty);
                        }
                        else if (flag == "QCRejQty" && subItemId1 == subItemId) {
                            subItemQty = Crow.find("#subItemRejQty").val();
                            InnerCrow.find("#subItemRejQty").val(subItemQty);
                        }
                        else if (flag == "QCRewQty" && subItemId1 == subItemId) {
                            subItemQty = Crow.find("#subItemRewQty").val();
                            InnerCrow.find("#subItemRewQty").val(subItemQty);
                        }
                        else if (flag == "QCShortQty" && subItemId1 == subItemId) {
                            subItemQty = Crow.find("#subItemShortQty").val();
                            InnerCrow.find("#subItemShortQty").val(subItemQty);
                        }
                        else if (flag == "QCSampleQty" && subItemId1 == subItemId) {
                            subItemQty = Crow.find("#subItemSampleQty").val();
                            InnerCrow.find("#subItemSampleQty").val(subItemQty);
                        }
                        else if (flag == "PRDProduceQty" && subItemId1 == subItemId) {
                            subItemQty = Crow.find("#subItemQcsQty").val();
                            InnerCrow.find("#subItemQcsQty").val(subItemQty);
                        }

                        //else if (QCSrcType == "RWK" && subItemId1 == subItemId) {
                        //    subItem_AvailStkQty = Crow.find("#subItemAvlStk").val();
                        //    InnerCrow.find("#subItemAvlStk").val(subItem_AvailStkQty);
                        //}
                        else {
                            if (DocumentMenuId == "105102155") {
                                subItemAvlQty = Crow.find("#subItemAvlQty").val();
                                subItemShortQty = Crow.find("#subItemShortQty").val();
                                subItemSurplusQty = Crow.find("#subItemSurplusQty").val();

                                InnerCrow.find("#subItemQty").val(subItemQty);
                                InnerCrow.find("#subItemAvlQty").val(subItemAvlQty);
                                InnerCrow.find("#subItemShortQty").val(subItemShortQty);
                                InnerCrow.find("#subItemSurplusQty").val(subItemSurplusQty);
                            }
                            /*-----Added by Hina on 20-11-2023 10:19 for Material Dispatch SC*/
                            else if (DocumentMenuId == "105108105") {

                                if (flag == "MDDispQty") {
                                    subItemQty = Crow.find("#subItemQty").val();
                                    InnerCrow.find("#subItemQty").val(subItemQty);

                                }
                                else {
                                    subItemQty = Crow.find("#subItemQty").val();
                                    InnerCrow.find("#subItemQty").val(subItemQty);
                                    subItemAvlQty = Crow.find("#subItemAvlStk").val();
                                    InnerCrow.find("#subItemAvlQty").val(subItemAvlQty);
                                }
                            }
                            else if (DocumentMenuId == "105103125") { // Added by Suraj Maurya on 13-01-2026 for SO.
                                if (flag == "FocQuantity") {
                                    InnerCrow.find("#subItemFocQty").val(subItemQty);
                                } else {
                                    InnerCrow.find("#subItemQty").val(subItemQty);
                                }
                            }
                            else {
                                if (DocumentMenuId == "105105116") {
                                    InnerCrow.find("#SubItemPPLPendingQty").val(PPLPendingQty);
                                }

                                InnerCrow.find("#subItemQty").val(subItemQty);
                            }
                        }
                    }
                });
            }
        }
        else {

            var subItemAccQty = 0;
            var subItemRejQty = 0;
            var subItemRewQty = 0;
            var subItemShortQty = 0;
            var subItemSampleQty = 0;
            //var subItemOrdQty = 0;
            var subItemOrdQty = 0;
            var subItemProdQty = 0;
            var subItempendQty = 0;
            var subItemqcQty = 0;

            var SubItmType = "";
            if (flag == "QCAccQty") {
                subItemAccQty = Crow.find("#subItemAccQty").val();
            }
            if (flag == "QCRejQty") {
                subItemRejQty = Crow.find("#subItemRejQty").val();
            }
            if (flag == "QCRewQty") {
                subItemRewQty = Crow.find("#subItemRewQty").val();
            }
            if (flag == "QCShortQty") {
                subItemShortQty = Crow.find("#subItemShortQty").val();
            }
            if (flag == "QCSampleQty") {
                subItemSampleQty = Crow.find("#subItemSampleQty").val();
            }
            if (flag == "PRDProduceQty") {
                //subItemProdQty = Crow.find("#subItemProdQty").val();
                subItemProdQty = Crow.find("#subItemOrdQty").val();
                subItempendQty = Crow.find("#subItemPendQty").val();
                subItemqcQty = Crow.find("#subItemQcsQty").val();
            }
            //if (flag == "MDDispQty") {
            //    subItemOrdQty = Crow.find("#subItemOrdQty").val();
            //}
            /*Added by Hina on 20-11-2023 for Material Dispatch*/
            if (DocumentMenuId == "105108105") {
                if (flag == "MDIssueQty") {
                    var subItemAvlQty = Crow.find("#subItemAvlStk").val();
                    SubItmType = "SubItm";
                    subItemOrdQty = ""
                    subItemPendQty = "";
                }
                else {
                    var subItemAvlQty = "";
                    SubItmType = "SubHedr";
                    var subItemPendQty = Crow.find("#subItemPendQty").val();
                    subItemOrdQty = Crow.find("#subItemOrdQty").val();
                }

            }
            if (DocumentMenuId == "105105135" || DocumentMenuId == "105102120" || DocumentMenuId == "105108115") {/*Add doc_id=105108115 for SCQC by Hina on 02-12-2023 */

                //let Qc_Type = $("#qc_type").val();

                //if (Qc_Type == "PUR" || Qc_Type == "RQC") {

                //}

                $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${subItemQty}'></td>
                            <td><input type="text" id="subItemAccQty" value='${subItemAccQty}'></td>
                            <td><input type="text" id="subItemRejQty" value='${subItemRejQty}'></td>
                            <td><input type="text" id="subItemRewQty" value='${subItemRewQty}'></td>
                            <td><input type="text" id="subItemShortQty" value='${subItemShortQty}'></td>
                            <td><input type="text" id="subItemSampleQty" value='${subItemSampleQty}'></td>
                            <td><input type="text" id="subItemOrdQty" value='${subItemProdQty}'></td>
                            <td><input type="text" id="subItemPendQty" value='${subItempendQty}'></td>
                            <td><input type="text" id="subItemQcsQty" value='${subItemqcQty}'></td>
                        </tr>`);

            }
            else if (DocumentMenuId == "105103125") {
                $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                                <td><input type="text" id="ItemId" value='${itemId}'></td>
                                <td><input type="text" id="subItemId" value='${subItemId}'></td>
                                <td><input type="text" id="subItemQty" value='${flag == "FocQuantity" ? "" : subItemQty}'></td>
                                <td><input type="text" id="subItemSrcDocNo" value='${subItemSrcNo}'></td>
                                <td><input type="text" id="subItemSrcDocDate" value='${subItemSrcDate}'></td>
                                <td><input type="text" id="subItemFocQty" value='${flag == "FocQuantity" ? subItemQty : ""}'></td>
                            </tr>`);
            }
            else if (DocumentMenuId == "105103145110") {
                $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                                <td><input type="text" id="ItemId" value='${itemId}'></td>
                                <td><input type="text" id="subItemId" value='${subItemId}'></td>
                                <td><input type="text" id="subItemQty" value='${subItemQty}'></td>
                                <td><input type="text" id="subItemSrcDocNo" value='${subItemSrcNo}'></td>
                                <td><input type="text" id="subItemSrcDocDate" value='${subItemSrcDate}'></td>
                            </tr>`);
            }
            else if (DocumentMenuId == "105103130" || DocumentMenuId == "105103145115") {
                if (flag == "PackResQuantity") {
                    var subItemResQty = Crow.find("#subItemResQty").val();
                    $("#hdn_Sub_ItemResDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                            <td><input type="text" id="subItemSrcDocNo" value='${SrcDocNo}'></td>
                            <td><input type="text" id="subItemSrcDocDate" value='${SrcDocDt}'></td>
                            <td><input type="text" id="subItemResQty" value='${CheckNullNumber(subItemResQty)}'></td>
                         </tr>`);
                } else if (flag == "PackResTotalQty") {
                    var subItemOrdPackQty = Crow.find("#subItemOrderPackQty").val();
                    $("#hdn_Sub_ItemPackResDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)} '></td>
                            <td><input type="text" id="subItemOrdPackQty" value='${CheckNullNumber(subItemOrdPackQty)}'></td>
                         </tr>`);
                } else {
                    let subItemFocQty = 0
                    let subItemPackOrdFocQty = 0
                    let subItemPackPenFocQty = 0
                    if (flag == "FocPackList") {
                        subItemFocQty = subItemQty;
                        subItemPackOrdFocQty = subItemPackOrdQty;
                        subItemPackPenFocQty = subItemPackPenQty;
                        subItemQty = 0;
                        subItemPackOrdQty = 0;
                        subItemPackPenQty = 0;
                    }
                    $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                            <td><input type="text" id="subItemSrcDocNo" value='${SrcDocNo}'></td>
                            <td><input type="text" id="subItemSrcDocDate" value='${SrcDocDt}'></td>
                            <td><input type="text" id="subItemOrdQty" value='${CheckNullNumber(subItemPackOrdQty)}'></td>
                            <td><input type="text" id="subItemPendQty" value='${CheckNullNumber(subItemPackPenQty)}'></td>
                            <td><input type="text" id="subItemFocQty" value='${CheckNullNumber(subItemFocQty)}'></td>
                            <td><input type="text" id="subItemOrdFocQty" value='${CheckNullNumber(subItemPackOrdFocQty)}'></td>
                            <td><input type="text" id="subItemPendFocQty" value='${CheckNullNumber(subItemPackPenFocQty)}'></td>
                         </tr>`);
                }
            }
            /*Added by Hina on 28-05-2024 for Stock Take  Add New Popup sub-item */
            else if (DocumentMenuId == "105102155" && flag == "PopUpStk_Qty") {
                $("#hdn_PopUpStkSub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                        </tr>`);
            }

            else if (DocumentMenuId == "105102155") {
                subItemAvlQty = Crow.find("#subItemAvlQty").val();
                subItemShortQty = Crow.find("#subItemShortQty").val();
                subItemSurplusQty = Crow.find("#subItemSurplusQty").val();
                $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                            <td><input type="text" id="subItemAvlQty" value='${CheckNullNumber(subItemAvlQty)}'></td>
                            <td><input type="text" id="subItemShortQty" value='${CheckNullNumber(subItemShortQty)}'></td>
                            <td><input type="text" id="subItemSurplusQty" value='${CheckNullNumber(subItemSurplusQty)}'></td>
                        </tr>`);
            }
            //else if (DocumentMenuId == "105105116") {
            else if (DocumentMenuId == "105105116" && flag == "Quantity") {

                var srctype = $("#hdn_ddl_src_type").val();
                if (srctype == "F" || srctype == "O") {
                    subItemSrcDocQuantity = Crow.find("#SrcDocQty").val();
                    $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                             <td><input type="text" id="SubItemPPLPendingQty" value='${CheckNullNumber(PPLPendingQty)}'></t
                            <td><input type="text" id="SrcDocQty" value='${CheckNullNumber(subItemSrcDocQuantity)}'></td>
                         </tr>`);
                }
                else {
                    $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                             </tr>`);
                }
            }
            else if (DocumentMenuId == "105105116" && flag == "ForeCastandSOQtyforPPL1") {

                var srctype = $("#hdn_ddl_src_type").val();
                if (srctype == "F" || srctype == "O") {
                    subItemSrcDocQuantity = Crow.find("#SrcDocQty").val();
                    $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                             <td><input type="text" id="SubItemPPLPendingQty" value='${CheckNullNumber(PPLPendingQty)}'></t
                            <td><input type="text" id="SrcDocQty" value='${CheckNullNumber(subItemSrcDocQuantity)}'></td>
                         </tr>`);
                }
                else {
                    $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                             </tr>`);
                }
            }
            else if (DocumentMenuId == "105105116" && flag == "ForeCastandSOQtyforPPL") {

                var srctype = $("#hdn_ddl_src_type").val();
                if (srctype == "F" || srctype == "O") {
                    subItemSrcDocQuantity = Crow.find("#SrcDocQty").val();
                    $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                             <td><input type="text" id="SubItemPPLPendingQty" value='${CheckNullNumber(PPLPendingQty)}'></t
                            <td><input type="text" id="SrcDocQty" value='${CheckNullNumber(subItemSrcDocQuantity)}'></td>
                         </tr>`);
                }
                else {
                    $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                             </tr>`);
                }
            }
            /*Added by Hina on 20-11-2023 for Material Dispatch sub-item */
            else if (DocumentMenuId == "105108105") {


                //if (flag == "MDIssueQty")
                //{
                //    $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                //            <td><input type="text" id="ItemId" value='${itemId}'></td>
                //            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                //            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                //            <td><input type="text" id="subItemAvlQty" value='${CheckNullNumber(subItemAvlQty)}'></td>
                //            <td><input type="text" id="subItemType" value='${SubItmType}'></td>
                //            <td><input type="text" id="subItemOrdQty" value='${subItemOrdQty}'></td>
                //            <td><input type="text" id="subItemPendQty" value='${subItemPendQty}'></td>
                //   </tr>`);
                //}
                //else {
                $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                            <td><input type="text" id="subItemAvlQty" value='${CheckNullNumber(subItemAvlQty)}'></td>
                            <td><input type="text" id="subItemType" value='${SubItmType}'></td>
                            <td><input type="text" id="subItemOrdQty" value='${subItemOrdQty}'></td>
                            <td><input type="text" id="subItemPendQty" value='${subItemPendQty}'></td>
                             </tr>`);
                //    }
            }
            else if (DocumentMenuId == "105102165") {/*modified by Shubham on 05-10-2023*/
                var subItemAvlQty = Crow.find("#subItemAvlQty").val();
                var subItemQty = Crow.find("#subItemQty").val();
                //if (SwapSrcType == "SrcSwapQty") {
                var srcItm = $("#ddlItemName").val();
                //}
                //if (SwapSrcType == "DestSwapQty") {
                var destItm = $("#ddlItemNameDest").val();
                //}
                $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="src_Item_id" value='${srcItm}'></td>
                            <td><input type="text" id="dest_Item_id" value='${destItm}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>                           
                            <td><input type="text" id="subItemAvlQty" value='${CheckNullNumber(subItemAvlQty)}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                            <td><input type="text" id="SwapType" value='${SwapSrcType}'></td>
                        </tr>`);
            }
            else if (DocumentMenuId == "105108110" && flag == "BYPSRecvQty") {/*Add by Hina on 29-11-2023 for ByProductScrap Detail on Delivery Note SC*/
                /* if (flag == "Quantity") {*/
                $("#hdn_Sub_ItemByProductScrapDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                        </tr>`);
                /*  }*/

            }
            else if (DocumentMenuId == "105103148" || DocumentMenuId == "105103149") {/*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                var avl_qty = Crow.find("#subItemAvlStk").val();
                $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="avlqty" value='${CheckNullNumber(avl_qty)}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                            
                        </tr>`);
            }
            else if (flag == "OrdrToPrecurQuantity" && DocumentMenuId == "105105117"/*DocMenuId Added by Suraj Maurya on 18-11-2024*/) /*Add by Nitesh on 16-05-2024 for for MRP Order TO Pecure*/ {
                $("#hdn_SubItemDetailTblMRPSF_Procure >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                        </tr>`);
            }
            else if (flag == "OrdrToPrecurQuantity" && DocumentMenuId == "105105116") /*Add by Shubham maurya on 17-10-2024 for for PP TO Pecure*/ {
                $("#hdn_SubItemDetailTblPP_Procure >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                        </tr>`);
            }
            else if (flag == "Input" && DocumentMenuId == "105102115105") /*Add by Nitesh on 26-06-2024 for for Finish Good Recipt*/ {
                $("#hdn_ConsumeSub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                        </tr>`);
            }
            else if (flag != "OrdrToPrecurQuantity" && DocumentMenuId == "105105117") {/*Added by Suraj Maurya on 18-11-2024*/

                $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                            <td><input type="text" id="ItemType" value='${ItemType}'></td>
                        </tr>`);
            }
            else {
                $("#hdn_Sub_ItemDetailTbl >tbody").append(`<tr>
                            <td><input type="text" id="ItemId" value='${itemId}'></td>
                            <td><input type="text" id="subItemId" value='${subItemId}'></td>
                            <td><input type="text" id="subItemQty" value='${CheckNullNumber(subItemQty)}'></td>
                        </tr>`);
            }
        }
        //if (DocumentMenuId == "105105130") {
        //Crow.find("#SubItemConsumeQuantity").css("border", "#ced4da");
        //}
    });
}
function Cmn_ResetSubItems(flag) {
    $("#Sub_ItemDetailTbl tbody tr").each(function () {
        var Crow = $(this).closest("tr");
        if (flag == "QCAccQty") {
            Crow.find("#subItemAccQty").val("");
            Crow.find("#subItemAccQty").css("border-color", "#ced4da");
            Crow.find("#subItemAccQty_Error").text("");
            Crow.find("#subItemAccQty_Error").css("display", "none");
        } else if (flag == "QCRejQty") {
            Crow.find("#subItemRejQty").val("");
            Crow.find("#subItemRejQty").css("border-color", "#ced4da");
            Crow.find("#subItemRejQty_Error").text("");
            Crow.find("#subItemRejQty_Error").css("display", "none");
        } else if (flag == "QCRewQty") {
            Crow.find("#subItemRewQty").val("");
            Crow.find("#subItemRewQty").css("border-color", "#ced4da");
            Crow.find("#subItemRewQty_Error").text("");
            Crow.find("#subItemRewQty_Error").css("display", "none");
            /*modified by Shubham on 05-10-2023*/
        } else if (flag == "SwapQty") {
            Crow.find("#subItemQty").css("border-color", "#ced4da");
            Crow.find("#subItemQty_Error").text("");
            Crow.find("#subItemQty_Error").css("display", "none");
            Crow.find("#subItemQty").val("");
        }
        /*Modify by Hina on 07-10-2023  to add flag DNBillQty,DNRecQty for delivery note*/
        else if (flag == "DNBillQty" || flag == "DNSCBillQty") {
            Crow.find("#subItemBillQty").val("");
        }
        else if (flag == "DNRecQty" || flag == "DNSCRecQty") {
            Crow.find("#subItemReceiveQty").val("");
        }
        /*Added By Nitesh Nitesh 02-03-2024 For Resset Qty*/
        else if (flag == "QCShortQty") {
            Crow.find("#subItemShortQty").val("");

        } else if (flag == "QCSampleQty") {
            Crow.find("#subItemSampleQty").val("");

        }
        else if (flag == "PRDProduceQty") {
            Crow.find("#subItemQcsQty").val("");
            Crow.find("#subItemQcsQty").css("border-color", "#ced4da");
            Crow.find("#subItemQcsQty_Error").text("");
            Crow.find("#subItemQcsQty_Error").css("display", "none");
        }
        /*End*/
        else {
            Crow.find("#subItemQty").val("");
            Crow.find("#subItemQty").css("border-color", "#ced4da");
            Crow.find("#subItemQty_Error").text("");
            Crow.find("#subItemQty_Error").css("display", "none");
        }

    });
    Cmn_CalCSubItemTotal(flag);
}
function Cmn_SubItemList() {

    var NewArr = new Array();
    var docid = $("#DocumentMenuId").val();
    //var hdnStockTakeFlagPopup = $("#hdnPopupFlag").val();
    if (docid == "105103125" || docid == "105103145110") {
        var src_type = $("#src_type").val();
        if (src_type == "D") {
            //QuotationNumber = "Direct";
            //QuotationDate = "Direct";
            //var today = new Date();
            //var currentdate = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
            $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
                var row = $(this);
                if ((parseFloat(CheckNullNumber(row.find('#subItemQty').val())) + parseFloat(CheckNullNumber(row.find('#subItemFocQty').val()))) > 0) {
                    var List = {};
                    List.item_id = row.find("#ItemId").val();
                    List.sub_item_id = row.find('#subItemId').val();
                    List.qty = row.find('#subItemQty').val();
                    List.QuotationNumber = "Direct";
                    List.QuotationDate = "Direct";
                    List.foc_qty = row.find('#subItemFocQty').val() || "0";
                    NewArr.push(List);
                }
            });
        }
        else {
            $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
                var row = $(this);
                if ((parseFloat(CheckNullNumber(row.find('#subItemQty').val())) + parseFloat(CheckNullNumber(row.find('#subItemFocQty').val()))) > 0) {
                    var List = {};
                    List.item_id = row.find("#ItemId").val();
                    List.sub_item_id = row.find('#subItemId').val();
                    List.qty = row.find('#subItemQty').val();
                    List.QuotationNumber = row.find('#subItemSrcDocNo').val();
                    List.QuotationDate = row.find('#subItemSrcDocDate').val();
                    List.foc_qty = row.find('#subItemFocQty').val() || "0";
                    NewArr.push(List);
                }
            });
        }
        return NewArr;
    }
    else if (docid == "105103130" || docid == "105103145115") {

        $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
            var row = $(this);
            if ((parseFloat(CheckNullNumber(row.find('#subItemQty').val())) + parseFloat(CheckNullNumber(row.find('#subItemFocQty').val()))) > 0) {

                var List = {};
                List.item_id = row.find("#ItemId").val();
                List.sub_item_id = row.find('#subItemId').val();
                List.qty = row.find('#subItemQty').val();
                List.subItemSrcNo = row.find('#subItemSrcDocNo').val();
                List.subItemSrcDate = row.find('#subItemSrcDocDate').val();
                List.subItemPackOrdQty = row.find('#subItemOrdQty').val();
                List.subItemPackPenQty = row.find('#subItemPendQty').val();
                List.foc_qty = row.find('#subItemFocQty').val() || "0";
                List.subItemPackOrdfocQty = row.find('#subItemOrdFocQty').val() || "0";
                List.subItemPackPenfocQty = row.find('#subItemPendFocQty').val() || "0";
                NewArr.push(List);
            }
        });

        return NewArr;
    }
    else if (docid == "105102115120") {
        var newTableArr = $('#datatable-buttons').DataTable().rows().data().toArray();//Added by suraj on 05-10-2024
        newTableArr.map((item) => {
            $("#hdn_Sub_ItemDetailTbl tbody tr #ItemId[value=" + item[1] + "]").closest('tr').each(function () {
                var row = $(this);
                if (parseFloat(CheckNullNumber(row.find('#subItemQty').val())) > 0) {
                    var List = {};
                    List.item_id = row.find("#ItemId").val();
                    List.sub_item_id = row.find('#subItemId').val();
                    List.qty = row.find('#subItemQty').val();
                    NewArr.push(List);
                }
            });
        })
        //$("#datatable-buttons > #OpeningItemDetail tr").each(function () {//commmented by suraj on 05-10-2024
        //    var OpRow = $(this);
        //    var itemId = OpRow.find("#tblhdn_item_id").val();
        //    if (itemId != null && itemId != "") {
        //        $("#hdn_Sub_ItemDetailTbl tbody tr #ItemId[value=" + itemId + "]").closest('tr').each(function () {
        //            var row = $(this);
        //            if (parseFloat(CheckNullNumber(row.find('#subItemQty').val())) > 0) {
        //                var List = {};
        //                List.item_id = row.find("#ItemId").val();
        //                List.sub_item_id = row.find('#subItemId').val();
        //                List.qty = row.find('#subItemQty').val();
        //                NewArr.push(List);
        //            }
        //        });
        //    }

        //});

        return NewArr;
    }
    //else if (docid == "105102155" && hdnStockTakeFlagPopup == "PopUpStk_Qty") {
    //    $("#hdn_PopUpStkSub_ItemDetailTbl tbody tr").each(function () {
    //        var row = $(this);
    //        if (parseFloat(CheckNullNumber(row.find('#subItemQty').val())) > 0 || parseFloat(CheckNullNumber(row.find('#subItemShortQty').val())) > 0 || parseFloat(CheckNullNumber(row.find('#subItemSurplusQty').val())) > 0) {
    //            var List = {};
    //            List.item_id = row.find("#ItemId").val();
    //            List.sub_item_id = row.find('#subItemId').val();
    //            List.qty = row.find('#subItemQty').val();
    //            NewArr.push(List);
    //        }
    //    });
    //    return NewArr;
    //}
    else if (docid == "105102155") {
        $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
            var row = $(this);
            if (parseFloat(CheckNullNumber(row.find('#subItemQty').val())) > 0 || parseFloat(CheckNullNumber(row.find('#subItemShortQty').val())) > 0 || parseFloat(CheckNullNumber(row.find('#subItemSurplusQty').val())) > 0) {
                var List = {};
                List.item_id = row.find("#ItemId").val();
                List.sub_item_id = row.find('#subItemId').val();
                List.qty = row.find('#subItemQty').val();
                List.avl_stk = row.find('#subItemAvlQty').val();
                List.short_qty = row.find('#subItemShortQty').val();
                List.surplus_qty = row.find('#subItemSurplusQty').val();
                NewArr.push(List);
            }
        });
        return NewArr;
    }
    else if (docid == "105105116") {
        var src_type = $("#ddl_src_type").val();
        if (src_type == "F" || src_type == "O") {
            $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
                var row = $(this);
                var item_id = row.find("#ItemId").val();
                if ($("#ProductPlanItemDetailsTbl tbody tr #hfproductID[value='" + item_id + "']").length > 0) {
                    if (parseFloat(CheckNullNumber(row.find('#subItemQty').val())) > 0) {
                        var List = {};
                        List.item_id = item_id;//row.find("#ItemId").val();
                        List.sub_item_id = row.find('#subItemId').val();
                        List.qty = row.find('#subItemQty').val();
                        List.SrcDocQuantity = row.find('#SrcDocQty').val();
                        List.SubItemPPLPendingQty = row.find('#SubItemPPLPendingQty').val();
                        NewArr.push(List);
                    }
                }
            });
        }
        else {
            $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
                var row = $(this);
                if (parseFloat(CheckNullNumber(row.find('#subItemQty').val())) > 0) {
                    var List = {};
                    List.item_id = row.find("#ItemId").val();
                    List.sub_item_id = row.find('#subItemId').val();
                    List.qty = row.find('#subItemQty').val();
                    NewArr.push(List);
                }
            });
        }
        return NewArr;

    }
    else if (docid == "105105130") {
        $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
            var row = $(this);
            if (parseFloat(CheckNullNumber(row.find('#subItemQty').val())) > 0) {

                var item_id = row.find("#ItemId").val();
                if ($("#OutputItmDetailsTbl tbody tr #hdn_opitem[value='" + item_id + "']").length > 0) {
                    var List = {};
                    List.item_id = row.find("#ItemId").val();
                    List.sub_item_id = row.find('#subItemId').val();
                    List.qty = row.find('#subItemQty').val();
                    NewArr.push(List);
                }
                if ($("#ConsumptionItmDetailsTbl tbody tr #hdn_citem[value='" + item_id + "']").length > 0) {
                    var List = {};
                    List.item_id = row.find("#ItemId").val();
                    List.sub_item_id = row.find('#subItemId').val();
                    List.qty = row.find('#subItemQty').val();
                    NewArr.push(List);
                }

            }
        });
        return NewArr;
    }
    else if (docid == "105102115125") {
        $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
            var row = $(this);
            if (parseFloat(CheckNullNumber(row.find('#subItemQty').val())) > 0) {
                var List = {};
                List.item_id = row.find("#ItemId").val();
                List.sub_item_id = row.find('#subItemId').val();
                List.qty = row.find('#subItemQty').val();
                List.issued_qty = row.find('#subItemissuedQty').val();
                //List.pend_qty = row.find('#subItemPendQty').val();
                NewArr.push(List);
            }

        });
        return NewArr;
    }
    /*Added by Hina on 20-11-2023 for Material Dispatch sub-item */
    else if (docid == "105108105") {
        var HdnFlag = $("#HdnFlag").val();

        $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
            var row = $(this);
            var SubItmTyp = row.find('#subItemType').val();
            if (parseFloat(CheckNullNumber(row.find('#subItemQty').val())) > 0) {
                var List = {};
                List.item_id = row.find("#ItemId").val();
                List.sub_item_id = row.find('#subItemId').val();
                List.qty = row.find('#subItemQty').val();
                List.avl_stk = row.find('#subItemAvlQty').val();
                List.SubItmType = row.find('#subItemType').val();
                /*if (SubItmTyp == "SubHedr") {*/
                List.OrderQty = row.find('#subItemOrdQty').val();
                List.PendQty = row.find('#subItemPendQty').val();
                /*}*/

                NewArr.push(List);
            }
        });
        return NewArr;
    }

    //else if (docid == "105102115101") {/*Added by Suraj on 05-10-2023 for GRN sub-item */
    //    $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
    //        var row = $(this);
    //        var TotalQty = parseFloat(CheckNullNumber(row.find('#subItemAccQty').val())) + parseFloat(CheckNullNumber(row.find('#subItemRejQty').val())) + parseFloat(CheckNullNumber(row.find('#subItemRewQty').val()));
    //        if (TotalQty > 0) {
    //            var List = {};
    //            List.item_id = row.find("#ItemId").val();
    //            List.sub_item_id = row.find('#subItemId').val();
    //            List.AccQty = row.find('#subItemAccQty').val();
    //            List.RejQty = row.find('#subItemRejQty').val();
    //            List.RewQty = row.find('#subItemRewQty').val();
    //            NewArr.push(List);
    //        }

    //    });
    //    return NewArr;
    //}
    //else if (docid == "105101145" || docid == "105101140125") {/*Added by Suraj on 06-10-2023 for Purchase Invoice sub-item */
    //    $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
    //        var row = $(this);
    //        var TotalQty = parseFloat(CheckNullNumber(row.find('#subItemAccQty').val())) + parseFloat(CheckNullNumber(row.find('#subItemRejQty').val())) + parseFloat(CheckNullNumber(row.find('#subItemRewQty').val()));
    //        if (TotalQty > 0) {
    //            var List = {};
    //            List.item_id = row.find("#ItemId").val();
    //            List.sub_item_id = row.find('#subItemId').val();
    //            //List.sub_item_name = row.find('#subItemName').val();
    //            List.Qty = row.find('#subItemQty').val();
    //            List.src_doc_number = row.find('#subItemSrcDocNo').val();
    //            List.src_doc_date = row.find('#src_doc_date').val();
    //            NewArr.push(List);
    //        }

    //    });
    //    return NewArr;
    //}

    /*Added by Suraj on 05-10-2023 for GRN sub-item */
    else if (docid == "105102115101") {
        $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
            var row = $(this);
            var TotalQty = parseFloat(CheckNullNumber(row.find('#subItemAccQty').val())) + parseFloat(CheckNullNumber(row.find('#subItemRejQty').val())) + parseFloat(CheckNullNumber(row.find('#subItemRewQty').val()));
            if (TotalQty > 0) {
                var List = {};
                List.item_id = row.find("#ItemId").val();
                List.sub_item_id = row.find('#subItemId').val();
                /*Added by Hina 22-01-2024 sub item name for chk source document after cancel not save next documnet */
                List.sub_item_name = row.find('#subItemName').val();
                List.AccQty = row.find('#subItemAccQty').val();
                List.RejQty = row.find('#subItemRejQty').val();
                List.RewQty = row.find('#subItemRewQty').val();
                List.ShortQty = row.find('#subItemShortQty').val();
                List.SampleQty = row.find('#subItemSampleQty').val();
                NewArr.push(List);
            }

        });
        return NewArr;
    }

    /*Added by Hina on 05-12-2023 for GRNSC sub-item */
    else if (docid == "105108120") {

        $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
            var row = $(this);
            //var TotalQty = parseFloat(CheckNullNumber(row.find('#subItemAccQty').val())) + parseFloat(CheckNullNumber(row.find('#subItemRejQty').val())) + parseFloat(CheckNullNumber(row.find('#subItemRewQty').val()));
            //if (TotalQty > 0) {
            var List = {};
            List.item_id = row.find("#ItemId").val();
            List.sub_item_id = row.find('#subItemId').val();
            /*Add by Hina on 25-01-2024 to add sub_item_name for chk src doc on cancel next doc should not save */
            List.sub_item_name = row.find('#subItemName').val();
            List.AccQty = row.find('#subItemAccQty').val();
            List.RejQty = row.find('#subItemRejQty').val();
            List.RewQty = row.find('#subItemRewQty').val();
            List.Issue_Qty = row.find('#subItemIssueQty').val();
            List.Consumed_Qty = row.find('#subItemConsQty').val();
            List.Qty = row.find('#subItemRecevQty').val();
            List.SubItmTyp = row.find('#subItemType').val();
            NewArr.push(List);
            /* }*/

        });
        return NewArr;
    }
    /*Added by Suraj on 06-10-2023 for Purchase Invoice sub-item */
    else if (docid == "105101145" || docid == "105101140125") {
        $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
            var row = $(this);
            var TotalQty = parseFloat(CheckNullNumber(row.find('#subItemQty').val()));
            if (TotalQty > 0) {
                var List = {};
                List.item_id = row.find("#ItemId").val();
                List.sub_item_id = row.find('#subItemId').val();
                //List.sub_item_name = row.find('#subItemName').val();
                List.Qty = row.find('#subItemQty').val();
                List.src_doc_number = row.find('#subItemSrcDocNo').val();
                List.src_doc_date = row.find('#subItemSrcDocDate').val();
                NewArr.push(List);
            }

        });
        return NewArr;
    }
    else if (docid == "105101154") {//add by shubham Maurya on 24-01-2025 for DPI
        $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
            var row = $(this);
            var TotalQty = parseFloat(CheckNullNumber(row.find('#subItemQty').val()));
            if (TotalQty > 0) {
                var List = {};
                List.item_id = row.find("#ItemId").val();
                List.sub_item_id = row.find('#subItemId').val();
                List.Qty = row.find('#subItemQty').val();
                NewArr.push(List);
            }
        });
        return NewArr;
    }
    else if (docid == "105102115130")  /*Modified by NItesh 03112025 For External rcpt*/ {
        var SourceType = $("#ddlSourceType").val();
        if (SourceType == "A") {
            $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
                var row = $(this);
                if (parseFloat(CheckNullNumber(row.find('#subItemQty').val())) > 0) {

                    var List = {};
                    List.item_id = row.find("#ItemId").val();
                    List.sub_item_id = row.find('#subItemId').val();
                    List.issued_qty = row.find('#subItemIssueQty').val();
                    List.pending_qty = row.find('#subItemPendQty').val();
                    List.qty = row.find('#subItemQty').val();

                    NewArr.push(List);
                }
            });
        }
        else {
            $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
                var row = $(this);
                if (parseFloat(CheckNullNumber(row.find('#subItemQty').val())) > 0) {

                    var List = {};
                    List.item_id = row.find("#ItemId").val();
                    List.sub_item_id = row.find('#subItemId').val();
                    List.issued_qty = "0";
                    List.pending_qty = "0";
                    List.qty = row.find('#subItemQty').val();

                    NewArr.push(List);
                }
            });
        }

        return NewArr;
    }
    else {
        $("#hdn_Sub_ItemDetailTbl tbody tr").each(function () {
            var row = $(this);
            var Qty = row.find('#subItemQty').val() || "0";
            var focQty = row.find('#subItemFocQty').val() || "0";
            if ((parseFloat(CheckNullNumber(Qty)) + parseFloat(CheckNullNumber(focQty))) > 0) {

                var List = {};
                List.item_id = row.find("#ItemId").val();
                List.sub_item_id = row.find('#subItemId').val();
                if (docid == "105101120" || docid == "105101115") {
                    var src_type = $("#ddlSourceType").val();
                    if (src_type == "Q" || src_type == "R" || src_type == "P") {
                        List.sub_item_name = row.find('#subItemName').val();
                    }
                }
                if (docid == "105103148" || docid == "105103149") {/*Add BY shubham Maurya on 02-06-2025 add 105103149*/
                    List.avl_stk = row.find('#avlqty').val();
                }
                List.qty = row.find('#subItemQty').val();
                List.foc_qty = row.find('#subItemFocQty').val()||"0";
                if (docid == "105105117") {//Added by Suraj Maurya on 19-11-2024 
                    List.ItemType = row.find('#ItemType').val();
                }
                NewArr.push(List);
            }
        });
        return NewArr;
    }

}
function Cmn_CalCSubItemTotal(flag) {
    debugger;
    var Sub_Quantity = 0;
    var Sub_AccQuantity = 0;
    var Sub_RejQuantity = 0;
    var Sub_RewQuantity = 0;
    var Sub_ShortQuantity = 0;
    var Sub_SampleQuantity = 0;

    var decimalAllowed = $("#decimalAllowed").val();
    var QtyDigit = 0;
    if (decimalAllowed == "Y") {
        //var DocumentMenuId = $("#DocumentMenuId").val();
        //if (DocumentMenuId == "105103145110" || DocumentMenuId == "105103145105" || DocumentMenuId == "105103145115") {
        //    QtyDigit = $("#ExpImpQtyDigit").text();
        //}
        //else {
        //    QtyDigit = $("#QtyDigit").text();
        //}
        QtyDigit = cmn_QtyDecDigit;
    }
    var docid = $("#DocumentMenuId").val();
    $("#Sub_ItemDetailTbl tbody tr").each(function () {
        var Crow = $(this).closest("tr");
        //var subItemId = Crow.find("#subItemId").val();

        if (flag == "QCAccQty") {
            var subItemAccQty = Crow.find("#subItemAccQty").val();
            Sub_AccQuantity = parseFloat(Sub_AccQuantity) + parseFloat(CheckNullNumber(subItemAccQty));
        } else if (flag == "QCRejQty") {
            var subItemRejQty = Crow.find("#subItemRejQty").val();
            Sub_RejQuantity = parseFloat(Sub_RejQuantity) + parseFloat(CheckNullNumber(subItemRejQty));
        } else if (flag == "QCRewQty") {
            var subItemRewQty = Crow.find("#subItemRewQty").val();
            Sub_RewQuantity = parseFloat(Sub_RewQuantity) + parseFloat(CheckNullNumber(subItemRewQty));
        } else if (flag == "QCShortQty") {
            var subItemShortQty = Crow.find("#subItemShortQty").val();
            Sub_ShortQuantity = parseFloat(Sub_ShortQuantity) + parseFloat(CheckNullNumber(subItemShortQty));
        } else if (flag == "QCSampleQty") {
            var subItemSampleQty = Crow.find("#subItemSampleQty").val();
            Sub_SampleQuantity = parseFloat(Sub_SampleQuantity) + parseFloat(CheckNullNumber(subItemSampleQty));
        }
        else if (flag == "SwapQty") {
            var subItemRewQty = Crow.find("#subItemQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemRewQty));
        }
        /*Modify by Hina on 07-10-2023  to add flag DNBillQty,DNRecQty for delivery note*/
        else if (flag == "DNBillQty" || flag == "DNSCBillQty") {
            var subItemDNBillQty = Crow.find("#subItemBillQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemDNBillQty));
        }
        else if (flag == "DNRecQty" || flag == "DNSCRecQty") {
            var subItemDnReceivQty = Crow.find("#subItemReceiveQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemDnReceivQty));
        }
        else if (flag == "Scrap") {
            var subItemQty = Crow.find("#subItemQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));
        }
        else if (flag == "PRDProduceQty") {
            var subItemQty = Crow.find("#subItemQcsQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));
        }
       
        else {
            var subItemQty = Crow.find("#subItemQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));

        }
    });
    if (flag == "QCAccQty") {
        $("#SubItemTotalAccQty").text(parseFloat(Sub_AccQuantity).toFixed(QtyDigit));
    }
    else if (flag == "QCRejQty") {
        $("#SubItemTotalRejQty").text(parseFloat(Sub_RejQuantity).toFixed(QtyDigit));
    }
    else if (flag == "QCRewQty") {
        $("#SubItemTotalRewQty").text(parseFloat(Sub_RewQuantity).toFixed(QtyDigit));
    }
    else if (flag == "QCShortQty") {
        $("#SubItemTotalShortQty").text(parseFloat(Sub_ShortQuantity).toFixed(QtyDigit));
    }
    else if (flag == "QCSampleQty") {
        $("#SubItemTotalSampleQty").text(parseFloat(Sub_SampleQuantity).toFixed(QtyDigit));
    }
    else if (flag == "SwapQty") {
        $("#SubItemTotalQty").text(parseFloat(Sub_Quantity).toFixed(QtyDigit));
    }
    /*Modify by Hina on 07-10-2023  to add flag DNBillQty,DNRecQty for delivery note*/
    else if (flag == "DNBillQty" || flag == "DNSCBillQty") {
        $("#SubItemTotalBillQty").text(parseFloat(Sub_Quantity).toFixed(QtyDigit));
    }
    else if (flag == "DNRecQty" || flag == "DNSCRecQty") {
        $("#SubItemTotalReceivQty").text(parseFloat(Sub_Quantity).toFixed(QtyDigit));
    }
    else if (flag == "Scrap") {
        $("#SubItemTotalinvQty").text(parseFloat(Sub_Quantity).toFixed(QtyDigit));
    }
    else if (flag == "PRDProduceQty") {
        $("#SubItemTotalQcQty").text(parseFloat(Sub_Quantity).toFixed(QtyDigit));
    }
    else if (flag == "Quantity" && docid =="105102125") {   /*Added by NItesh 31122025 1002 For MRs Page*/
        $("#SubItem_TotalQty").text(parseFloat(Sub_Quantity).toFixed(QtyDigit));
       
    }
    else {
        $("#SubItemTotalQty").text(parseFloat(Sub_Quantity).toFixed(QtyDigit));
    }
}

function Cmn_OnChangeDNSubItemQty(e, flag, CurrRow) {

    var Status = "N";
    var Crow = $(e.target).closest("tr");
    //var Crow = $(e.target).closest('tr');
    var docid = $("#DocumentMenuId").val();
    var flag = $("#hdn_subitmFlag").val();

    if (CurrRow != null) {
        Crow = CurrRow;
    }
    var decimalAllowed = $("#decimalAllowed").val();
    var QtyDigit = 0;
    if (decimalAllowed == "Y") {
        QtyDigit = cmn_QtyDecDigit;//$("#QtyDigit").text();
    }
    if (docid == "105102110" || docid == "105108110") {/*Add by HIna on 28-11-2023 for DNSC Page*/
        if (flag == "DNBillQty" || flag == "DNSCBillQty") {
            var subItemQty = Crow.find("#subItemBillQty").val();
            // Addded By Nitesh 29-02-2024 For Placeholder
            if (((parseFloat(subItemQty).toFixed(QtyDigit) == parseFloat(0).toFixed(QtyDigit)) || (subItemQty == "") || (subItemQty == null)) && (docid == "105102110" && flag == "DNBillQty")) {  /**Added by Nitesh 01032024 For Delivery Not Set Palceholder**/
                Crow.find("#subItemBillQty").val("");
            }
            else {
                if (subItemQty == "" || subItemQty == null || subItemQty == "0" || subItemQty == (parseFloat(0))) {/*Added by Hina on 02-03-2024 For Delivery Note SC */
                    Crow.find("#subItemBillQty").val("");
                }
                else {
                    Crow.find("#subItemBillQty").val(parseFloat(CheckNullNumber(subItemQty)).toFixed(QtyDigit));
                }
                /*Commented by Hina on 01-03-2024 to add above condition*/
                //Crow.find("#subItemBillQty").val(parseFloat(CheckNullNumber(subItemQty)).toFixed(QtyDigit));
            }

        }
        else {
            if (flag == "DNRecQty" && docid == "105102110") {    /**Added by Nitesh 01032024 For Delivery Not Set Palceholder**/
                var subItemQty = Crow.find("#subItemReceiveQty").val();
                if ((parseFloat(subItemQty).toFixed(QtyDigit) == parseFloat(0).toFixed(QtyDigit)) || (subItemQty == "") || (subItemQty == null)) {
                    Crow.find("#subItemReceiveQty").val("");
                }
                else {
                    Crow.find("#subItemReceiveQty").val(parseFloat(CheckNullNumber(subItemQty)).toFixed(QtyDigit));
                }
            }
            else {
                var subItemQty = Crow.find("#subItemReceiveQty").val();
                if (subItemQty == "" || subItemQty == null) {/*Added by Hina on 01-03-2024 For Delivery Note SC */
                    Crow.find("#subItemReceiveQty").val("");
                }
                else {
                    Crow.find("#subItemReceiveQty").val(parseFloat(CheckNullNumber(subItemQty)).toFixed(QtyDigit));
                }
                /*Commented by Hina on 01-03-2024 to add above condition*/
                //Crow.find("#subItemReceiveQty").val(parseFloat(CheckNullNumber(subItemQty)).toFixed(QtyDigit));
            }

        }

    }
    var subItemPendQty = Crow.find("#subItemPendQty").val();
    if (docid == "105102110") {
        if (subItemPendQty != null) {
            //if (parseFloat(CheckNullNumber(subItemPendQty)) < parseFloat(CheckNullNumber(subItemQty))) {
            //    var errMessage = $("#ExceedingQty").text();
            //    if (flag == "DNBillQty") {
            //        Crow.find("#subItemBillQty").css("border-color", "red");
            //        Crow.find("#subItemBillQty_Error").text(errMessage);
            //        Crow.find("#subItemBillQty_Error").css("display", "block");
            //        return false;
            //    }
            //    else {
            //        Crow.find("#subItemReceiveQty").css("border-color", "red");
            //        Crow.find("#subItemReceivQty_Error").text(errMessage);
            //        Crow.find("#subItemReceivQty_Error").css("display", "block");
            //        return false;
            //    }


            //}
            //else {
            if (flag == "DNBillQty" || flag == "DNSCBillQty") {
                Crow.find("#subItemBillQty").css("border-color", "#ced4da");
                Crow.find("#subItemBillQty_Error").text("");
                Crow.find("#subItemBillQty_Error").css("display", "none");
                return true;
            }
            else {
                Crow.find("#subItemReceiveQty").css("border-color", "#ced4da");
                Crow.find("#subItemReceivQty_Error").text("");
                Crow.find("#subItemReceivQty_Error").css("display", "none");
                return true;
            }
            /*}*/
        }
    }
    if (docid == "105108110") {/*Add by Hina on 08-12-2023 for DNSC Page for PendingQty Validate*/
        if (subItemPendQty != null) {
            if (parseFloat(CheckNullNumber(subItemPendQty)) < parseFloat(CheckNullNumber(subItemQty))) {
                var errMessage = $("#ExceedingQty").text();
                if (flag == "DNSCBillQty") {
                    Crow.find("#subItemBillQty").css("border-color", "red");
                    Crow.find("#subItemBillQty_Error").text(errMessage);
                    Crow.find("#subItemBillQty_Error").css("display", "block");
                    Crow.find("#subItemReceiveQty").css("border-color", "#ced4da");
                    Crow.find("#subItemReceivQty_Error").text("");
                    Crow.find("#subItemReceivQty_Error").css("display", "none");
                    return false;
                }
                else {
                    Crow.find("#subItemBillQty").css("border-color", "#ced4da");
                    Crow.find("#subItemBillQty_Error").text("");
                    Crow.find("#subItemBillQty_Error").css("display", "none");
                    Crow.find("#subItemReceiveQty").css("border-color", "red");
                    Crow.find("#subItemReceivQty_Error").text(errMessage);
                    Crow.find("#subItemReceivQty_Error").css("display", "block");
                    return false;
                }

            }
            else {
                /*if (flag == "DNSCBillQty") {*/
                Crow.find("#subItemBillQty").css("border-color", "#ced4da");
                Crow.find("#subItemBillQty_Error").text("");
                Crow.find("#subItemBillQty_Error").css("display", "none");
                //}
                //else {
                Crow.find("#subItemReceiveQty").css("border-color", "#ced4da");
                Crow.find("#subItemReceivQty_Error").text("");
                Crow.find("#subItemReceivQty_Error").css("display", "none");
                return true;
                /*}*/
            }
        }
    }
}
function CheckValidations_forSingleItem_SubItems(item_id, item_Qty, sub_item, SubItemButton) {
    var Sub_Quantity = 0;
    if (sub_item == "Y") {
        //var flag = "N";
        $("#hdn_Sub_ItemDetailTbl tbody tr #ItemId[value=" + item_id + "]").closest('tr').each(function () {
            var Crow = $(this).closest("tr");
            var subItemQty = Crow.find("#subItemQty").val();
            Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));
        });
        if (parseFloat(item_Qty) != parseFloat(Sub_Quantity)) {
            //flag = "Y";
            $("#" + SubItemButton).css("border", "1px solid red");
            swal("", $("#SubItemQuantityDoesNotMatchWithItemQuantity").text(), "warning");
            return false;
        } else {
            $("#" + SubItemButton).css("border", "");
            return true;
        }
    }
}
function Cmn_CheckValidations_forSubItems(Main_table, Row_Id, Item_field_id, Item_Qty_field_id, SubItemButton, ShowMessage) {

    //var QtyDecDigit = $("#QtyDigit").text();
    var docid = $("#DocumentMenuId").val();
    //if (docid == "105103145105" || docid == "105103145110" || docid == "105103145115" || docid == "105103145120" || docid == "105103145125") {
    //    QtyDecDigit = $("#ExpImpQtyDigit").text();
    //}

    var docSrcTypid = $("#hdSrcTyp").val();
    //var hdnPopUpFlagStk = $("#hdnPopupFlag").val();
    var flag = "N";
    $("#" + Main_table + " tbody tr").each(function () {
        var PPItemRow = $(this);
        var item_id;
        if (Row_Id != "" && Row_Id != null) {
            var Sno = PPItemRow.find("#" + Row_Id).val();
            item_id = PPItemRow.find("#" + Item_field_id + Sno).val();
        } else {
            if (docid == "105103130" || docid == "105103145115") {
                item_id = $("#" + Item_field_id).val();
            }
            else {
                item_id = PPItemRow.find("#" + Item_field_id).val();
            }

        }

        var item_PrdQty = CheckNullNumber(PPItemRow.find("#" + Item_Qty_field_id).val());
        if (docid == "105103130" || docid == "105103145115") {
            var sub_item = $("#Packingsub_item").val();
            var OrdrSrcDocNo = PPItemRow.find("#OrderQtyDocNo").val();
        }
        else if (docid == "105103125" || docid == "105103145110") {

            var srctypeSO = $("#src_type").val();
            if (srctypeSO == "D") {
                var sub_item = PPItemRow.find("#sub_item").val();
            }
            else {
                var sub_item = PPItemRow.find("#sub_item").val();
                var OrdrSrcDocNo = PPItemRow.find("#QuotationNumber").val();
            }

        }
        else if (docSrcTypid == "105105127" || docSrcTypid == "105105128") { /*Added docid By Nitesh 25042024 (105105128)*/
            var HdRwkFlag = PPItemRow.find('#hdn_RwkJobOrderFlag').val();
            if (HdRwkFlag == "RWK" || HdRwkFlag == "PJO") {
                var sub_item = PPItemRow.find("#sub_item").val();
            }
            else {
                var sub_item = PPItemRow.find("#sub_item").val();
                if (sub_item == "Y") {
                    sub_item = "N"
                }
                else {
                    sub_item = "N"
                }
            }

        }
        //else if (docid == "105102155" && hdnPopUpFlagStk == "PopUpStk_Qty") {
        //    var sub_item = PPItemRow.find("#PopUp_subitem").val();
        //}
        else if (docid == "105102115105" && Main_table == "ConsumptionItmDetailsTbl") { /*Added By Nitesh 26-06-2024 ("FGR") for Finish Good Recipt*/
            var sub_item = PPItemRow.find("#Consumesub_item").val();
        }
        else if (docid == "105102160") {
            var sub_item = PPItemRow.find("#hdnsub_item").val();
        }
        else {
            var sub_item = PPItemRow.find("#sub_item").val();
        }

        /*var sub_item = PPItemRow.find("#sub_item").val();*/

        var Sub_Quantity = 0;

        var SumitemTableName = "";
        if (SubItemButton == "SubItemOrdrToPrecurQty" && docid == "105105117") {      /**Modified By Nitesh 16-05-2024 For MRP Order to Percure Subitem**/
            $("#hdn_SubItemDetailTblMRPSF_Procure tbody tr #ItemId[value=" + item_id + "]").closest('tr').each(function () {

                var Crow = $(this).closest("tr");
                var subItemQty = Crow.find("#subItemQty").val();
                var subItemSrcDocNo = Crow.find("#subItemSrcDocNo").val();
                Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));
            });
        }
        else if (Item_Qty_field_id == "OrderToProcureQuantity" && docid == "105105116") {      /**Modified By Nitesh 16-05-2024 For MRP Order to Percure Subitem**/
            $("#hdn_SubItemDetailTblPP_Procure tbody tr #ItemId[value=" + item_id + "]").closest('tr').each(function () {

                var Crow = $(this).closest("tr");
                var subItemQty = Crow.find("#subItemQty").val();
                var subItemSrcDocNo = Crow.find("#subItemSrcDocNo").val();
                Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));
            });
        }
        //else if (docid == "105102155" && hdnPopUpFlagStk == "PopUpStk_Qty") {
        //    $("#hdn_PopUpStkSub_ItemDetailTbl tbody tr #ItemId[value=" + item_id + "]").closest('tr').each(function () {
        //        
        //        var Crow = $(this).closest("tr");
        //        var subItemQty = Crow.find("#subItemQty").val();
        //        Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));
        //    });
        //}
        else if (docid == "105102115105" && Main_table == "ConsumptionItmDetailsTbl") { /*Added By Nitesh 26-06-2024 ("FGR") for Finish Good Recipt*/
            $("#hdn_ConsumeSub_ItemDetailTbl tbody tr #ItemId[value=" + item_id + "]").closest('tr').each(function () {

                var Crow = $(this).closest("tr");
                var subItemQty = Crow.find("#subItemQty").val();
                Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));
            });
        }
        else {
            $("#hdn_Sub_ItemDetailTbl tbody tr #ItemId[value=" + item_id + "]").closest('tr').each(function () {

                var Crow = $(this).closest("tr");
                //var subItemId = Crow.find("#subItemId").val();
                var subItemQty = Crow.find("#subItemQty").val();
                if (docid == "105103125" && Item_Qty_field_id == "foc_qty") {//Added by Suraj Maurya on 13-01-2026
                    subItemQty = Crow.find("#subItemFocQty").val();
                }
                var subItemSrcDocNo = Crow.find("#subItemSrcDocNo").val();
                if (docid == "105103130" || docid == "105103145115") {
                    if (subItemSrcDocNo == OrdrSrcDocNo) {
                        Sub_Quantity = (parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty))).toFixed(cmn_QtyDecDigit);
                    }
                }
                else {
                    Sub_Quantity = (parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty))).toFixed(cmn_QtyDecDigit);
                }
                //Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));
            });
        }

        if (sub_item == "Y") {
            if (parseFloat(item_PrdQty) != parseFloat(Sub_Quantity)) {
                flag = "Y";
                PPItemRow.find("#" + SubItemButton).css("border", "1px solid red");
            } else {
                PPItemRow.find("#" + SubItemButton).css("border", "");
            }
        }
    });

    if (flag == "Y") {
        if (ShowMessage == "Y") {

            swal("", $("#SubItemQuantityDoesNotMatchWithItemQuantity").text(), "warning");
        }

        return false;
    }
    else {
        return true;
    }
}


function Cmn_CheckValidations_forSubItemsNonTable(Item_field_id, Item_Qty_field_id, Button_id, ShowMessage) {

    var flag = "N";
    var item_id = $("#" + Item_field_id).val();
    var item_PrdQty = $("#" + Item_Qty_field_id).val();
    if (item_PrdQty == null || item_PrdQty == "") {
        item_PrdQty = $("#" + Item_Qty_field_id).text();
    }
    var sub_item = $("#sub_item").val();
    var Sub_Quantity = 0;
    $("#hdn_Sub_ItemDetailTbl tbody tr #ItemId[value=" + item_id + "]").closest('tr').each(function () {
        var Crow = $(this).closest("tr");
        //var subItemId = Crow.find("#subItemId").val();
        var subItemQty = Crow.find("#subItemQty").val();
        Sub_Quantity = parseFloat(Sub_Quantity) + parseFloat(CheckNullNumber(subItemQty));
    });
    if (sub_item == "Y") {
        if (item_PrdQty != Sub_Quantity) {
            flag = "Y";
            $("#" + Button_id).css("border", "1px solid red");
        } else {
            $("#" + Button_id).css("border", "");
        }
    }
    if (flag == "Y") {
        if (ShowMessage == "Y") {
            swal("", $("#SubItemQuantityDoesNotMatchWithItemQuantity").text(), "warning");
        }
        return false;

    }

    else {

        return true;

    }
}

function Cmn_OnChangeSubItemQty(e, CurrRow) {
    debugger;
    var Crow = $(e.target).closest("tr");
    //var Crow = $(e.target).closest('tr');
    var docid = $("#DocumentMenuId").val();
    var flag = $("#hdn_subitmFlag").val();
    var flagShowStk = $("#hdn_subitmShowStkFlag").val();
    var matrialtype = $("#hdnMatrialtypeForCunsume").val();
    if (CurrRow != null) {
        Crow = CurrRow;
    }
    var decimalAllowed = $("#decimalAllowed").val();
    var QtyDigit = 0;
    if (decimalAllowed == "Y") {
        //var DocumentMenuId = $("#DocumentMenuId").val();
        //if (DocumentMenuId == "105103145105" || DocumentMenuId == "105103145110" || DocumentMenuId == "105103145115") {
        //    QtyDigit = $("#ExpImpQtyDigit").text();
        //}
        //else {
        //    QtyDigit = $("#QtyDigit").text();
        //}
        QtyDigit = cmn_QtyDecDigit;
    }
    var subItemQty = Crow.find("#subItemQty").val();

    var subItemPendQty = "";
    var flagpackqty = "N";
    if (flag == "Quantity") {
        subItemPendQty = $("#Sub_Quantity").val();
    }
    if (docid == "105103145115" || docid == "105103130") {
        var checkprameterinpackingqty = $("#hdn_checkpreameter").val();
        if (checkprameterinpackingqty == "Y" && flag == "PackList") {
            //subItemPendQty = Crow.find("#subItemPendQty").val();
            //if (parseFloat(CheckNullNumber(subItemPendQty)) < parseFloat(CheckNullNumber(subItemQty)))
            //{
            flagpackqty = "Y";
            //  }
        }
        else {
            subItemPendQty = Crow.find("#subItemPendQty").val();
        }

    }
    else {
        subItemPendQty = Crow.find("#subItemPendQty").val();
    }

    if (flag == "PackResQuantity") {
        subItemPendQty = Crow.find("#subItemResQty").val();
    }
    else if (flag == "PackResTotalQty") {
        subItemPendQty = Crow.find("#subItemAvlQty").val();
    }
    else if (flag == "MDIssueQty") {
        subItemPendQty = Crow.find("#subItemAvlStk").val();
    }
    if (docid != "105101130" && docid != "105101140101") {
        if (flagShowStk == "Y" && flag == "Quantity") {
            subItemPendQty = Crow.find("#subItemAvlStk").val();
        }
    }

    if (flag == "RJO_RewrkQuantity" || flag == "PC_ConsumeQuantity") {
        subItemPendQty = Crow.find("#subItemAvlQty").val();
    }
    if (flag == "SRAgnst_Issue") {
        subItemPendQty = Crow.find("#subItem_pendQty").val();
    }

    if (flag == "ProduceQty" && docid == "105102120"/*For RQC*/) {
        subItemPendQty = Crow.find("#subItemAvlStk").val();
    }
    if (flag == "Scrap") {
        subItemPendQty = Crow.find("#subItemAvlQty").val();
    }
    if (flag == "Input") { /*Added By NItesh 25-06-2024 "FGR"*/
        subItemPendQty = Crow.find("#subItemAvlQty").val();
    }
    if (flag == "AssemblyKitINput") { /*Added By NItesh 09-01-2025 For AssemblyKit*/
        subItemPendQty = Crow.find("#subItemAvlQty").val();
    }
    if (flag == "CM_ConsumeQty" && docid == "105105128") { /*Added By Nitesh 18-07-2024 For Packing Job Oder Consumption Subitm*/
        if (matrialtype == "SR") {
            //subItemPendQty = Crow.find("#subItemReqQty").val();
        }
        else {
            subItemPendQty = Crow.find("#subItemAvlQty").val();
        }
    }
    if (flag == "AssemblyKitINput") {
        var subItemQty = Crow.find("#subItemQty").val();
        var subItemAvlStk = Crow.find("#subItemAvlStk").val();
        if (parseFloat(CheckNullNumber(subItemAvlStk)) > parseFloat(CheckNullNumber(subItemQty))) {
            var errMessage = $("#ExceedingQty").text();
            Crow.find("#subItemQty").css("border-color", "red");
            Crow.find("#subItemQty_Error").text(errMessage);
            Crow.find("#subItemQty_Error").css("display", "block");
            return false;
        } else {
            Crow.find("#subItemQty").css("border-color", "#ced4da");
            Crow.find("#subItemQty_Error").text("");
            Crow.find("#subItemQty_Error").css("display", "none");
            //return true;
        }

    }
    if (flag == "ExterRec_qty") {
     
        if (parseFloat(CheckNullNumber(subItemQty)) > parseFloat(CheckNullNumber(subItemPendQty))) {
            var errMessage = $("#ExceedingQty").text();
            Crow.find("#subItemQty").css("border-color", "red");
            Crow.find("#subItemQty_Error").text(errMessage);
            Crow.find("#subItemQty_Error").css("display", "block");
            return false;
        } else {
            Crow.find("#subItemQty").css("border-color", "#ced4da");
            Crow.find("#subItemQty_Error").text("");
            Crow.find("#subItemQty_Error").css("display", "none");
            
            //return true;
        }

    }
   
    if (flag == "SRTReturnQty") {
        var subItemQty = Crow.find("#subItemQty").val();
        var subItemAvlStk = Crow.find("#subItemAvlStk").val();
        if (parseFloat(CheckNullNumber(subItemAvlStk)) < parseFloat(CheckNullNumber(subItemQty))) {
            var errMessage = $("#ExceedingQty").text();
            Crow.find("#subItemQty").css("border-color", "red");
            Crow.find("#subItemQty_Error").text(errMessage);
            Crow.find("#subItemQty_Error").css("display", "block");
            return false;
        } else {
            Crow.find("#subItemQty").css("border-color", "#ced4da");
            Crow.find("#subItemQty_Error").text("");
            Crow.find("#subItemQty_Error").css("display", "none");
            //return true;
        }

    }
    if (flag == "PRTReturnQty" || flag == "AdPRTReturnQty") {
        var subItemQty = Crow.find("#subItemQty").val();
        var subItemAvlStk = Crow.find("#subItemAvlStk").val();
        if (parseFloat(CheckNullNumber(subItemAvlStk)) < parseFloat(CheckNullNumber(subItemQty))) {
            var errMessage = $("#ExceedingQty").text();
            Crow.find("#subItemQty").css("border-color", "red");
            Crow.find("#subItemQty_Error").text(errMessage);
            Crow.find("#subItemQty_Error").css("display", "block");
            return false;
        } else {
            Crow.find("#subItemQty").css("border-color", "#ced4da");
            Crow.find("#subItemQty_Error").text("");
            Crow.find("#subItemQty_Error").css("display", "none");
            //return true;
        }
    }
    if (flag == "PRDProduceQty") {
        var subItemQty = Crow.find("#subItemQcsQty").val();
        var subItemAvlStk = Crow.find("#subItemPendQty").val();
        if (parseFloat(CheckNullNumber(subItemQty)) > parseFloat(CheckNullNumber(subItemAvlStk))) {
            var errMessage = $("#ExceedingQty").text();
            Crow.find("#subItemQcsQty").css("border-color", "red");
            Crow.find("#subItemQcsQty_Error").text(errMessage);
            Crow.find("#subItemQcsQty_Error").css("display", "block");
            return false;
        } else {
            Crow.find("#subItemQcsQty").css("border-color", "#ced4da");
            Crow.find("#subItemQcsQty_Error").text("");
            Crow.find("#subItemQcsQty_Error").css("display", "none");
            //return true;
            Crow.find("#subItemAccQty").css("border-color", "#ced4da");
        }
    }
    /*Code add and commented by Hina on 01-03-2024 to show blank instaed of 0 in sub item qty */
    /**Added Subitem Parse Float BY Nitesh 02-03-2024**/
    if ((subItemQty == "") || (parseInt(subItemQty) == null) || (parseFloat(subItemQty).toFixed(QtyDigit) == parseFloat(0).toFixed(QtyDigit))) {
        Crow.find("#subItemQty").val("");
    }
    else {
        Crow.find("#subItemQty").val(parseFloat(CheckNullNumber(subItemQty)).toFixed(QtyDigit));
    }
    //Crow.find("#subItemQty").val(parseFloat(CheckNullNumber(subItemQty)).toFixed(QtyDigit));

    /*modified by Shubham on 05-10-2023*/
    if (docid == "105102165") {
        if ($("#SwapSrcType").val() != "DestSwapQty") {
            var avlstk = Crow.find("#subItemAvlQty").val();
            var ItmQty = Crow.find("#subItemQty").val();
            if ($("#ItemOrderType").is(":checked")) {
                if (parseFloat(CheckNullNumber(avlstk)) < parseFloat(CheckNullNumber(ItmQty))) {
                    var errMessage = $("#ExceedingQty").text();
                    Crow.find("#subItemQty").css("border-color", "red");
                    Crow.find("#subItemQty_Error").text(errMessage);
                    Crow.find("#subItemQty_Error").css("display", "block");
                    return false;
                }
                else {
                    Crow.find("#subItemQty").css("border-color", "#ced4da");
                    Crow.find("#subItemQty_Error").text("");
                    Crow.find("#subItemQty_Error").css("display", "none");
                }
            }
            //else {
            //    var  subItmAvlStkTotal = $("#subItmAvlStkTotal").text();
            //    var SubItemTotalQty = $("#SubItemTotalQty").text();
            //    if (parseFloat(subItmAvlStkTotal) < parseFloat(SubItemTotalQty)) {
            //        var errMessage = $("#ExceedingQty").text();
            //        Crow.find("#subItemQty").css("border-color", "red");
            //        Crow.find("#subItemQty_Error").text(errMessage);
            //        Crow.find("#subItemQty_Error").css("display", "block");
            //        return false;
            //    }
            //    else {
            //        Crow.find("#subItemQty").css("border-color", "#ced4da");
            //        Crow.find("#subItemQty_Error").text("");
            //        Crow.find("#subItemQty_Error").css("display", "none");
            //    }
            //}         
        }
        else {

        }
    }

    if (subItemPendQty != null) {
        if (flag == "PackResTotalQty") {
            var subItemOrderPackQty = Crow.find("#subItemOrderPackQty").val();
            var subItemPendQty = Crow.find("#subItemTotalAvlQty").val();
            if (parseFloat(CheckNullNumber(subItemOrderPackQty)) < parseFloat(CheckNullNumber(subItemQty))) {
                var errMessage = $("#ExceedingQty").text();
                Crow.find("#subItemQty").css("border-color", "red");
                Crow.find("#subItemQty_Error").text(errMessage);
                Crow.find("#subItemQty_Error").css("display", "block");
                return false;
            } else {
                Crow.find("#subItemQty").css("border-color", "#ced4da");
                Crow.find("#subItemQty_Error").text("");
                Crow.find("#subItemQty_Error").css("display", "none");
                //return true;
            }

        }
        if ((parseFloat(CheckNullNumber(subItemPendQty)) < parseFloat(CheckNullNumber(subItemQty))) && flagpackqty != "Y") {
            if (docid == "105105128" && flag == "RM_RequireQty") { /*Added By Nitesh 15-07-2024 For Add Pkaging Job Order*/
                Crow.find("#subItemQty").css("border-color", "#ced4da");
                Crow.find("#subItemQty_Error").text("");
                Crow.find("#subItemQty_Error").css("display", "none");
            }
            else {
                var errMessage = $("#ExceedingQty").text();
                Crow.find("#subItemQty").css("border-color", "red");
                Crow.find("#subItemQty_Error").text(errMessage);
                Crow.find("#subItemQty_Error").css("display", "block");
                return false;
            }
        }
        else {

            if (docid == "105102130103" || docid == "105102130101" || docid == "105102153"
                || docid == "105105127" || docid == "105105130" || docid == "105105128") { /*Added docid By Nitesh 25042024 (105105128)*/
                subItemAvlQty = Crow.find("#subItemAvlQty").val();
                if (docid == "105102153") {
                    if ($("#TransType").val() == "U") {//Added by Suraj Maurya on 06-12-2025
                        subItemAvlQty = Crow.find("#subItemPendQty").val();
                    }
                }
                //if (subItemAvlQty != null && parseFloat(subItemAvlQty) != parseFloat(0)) { //Commented by Suraj on 11-09-2024 for issue comming on Internal Issue (Not validating available Qty for '0')
                if (parseFloat(CheckNullNumber(subItemAvlQty)) < parseFloat(CheckNullNumber(subItemQty))) {
                    var errMessage = $("#ExceedingQty").text();
                    Crow.find("#subItemQty").css("border-color", "red");
                    Crow.find("#subItemQty_Error").text(errMessage);
                    Crow.find("#subItemQty_Error").css("display", "block");
                    return false;
                } else {
                    Crow.find("#subItemQty").css("border-color", "#ced4da");
                    Crow.find("#subItemQty_Error").text("");
                    Crow.find("#subItemQty_Error").css("display", "none");
                    return true;
                }
                //}


            }
            Crow.find("#subItemQty").css("border-color", "#ced4da");
            Crow.find("#subItemQty_Error").text("");
            Crow.find("#subItemQty_Error").css("display", "none");
            return true;
        }
    }


}
function Cmn_DeleteSubItemQtyDetail(item_id) {

    if (item_id != null && item_id != "") {
        if ($("#hdn_Sub_ItemDetailTbl >tbody >tr").length > 0) {
            if ($("#hdn_Sub_ItemDetailTbl >tbody >tr td #ItemId[value=" + item_id + "]").length > 0) {
                $("#hdn_Sub_ItemDetailTbl >tbody >tr td #ItemId[value=" + item_id + "]").closest('tr').remove();
            }
        }
    }
}

function Cmn_OnchangeQCsubitemQty(e, flag, CurrRow) {

    var QCSrcType = $("#hdQCtype").val();
    var currentRow = $(e.target).closest('tr');
    if (CurrRow != null) {
        currentRow = CurrRow;
    }
    var docid = $("#DocumentMenuId").val();
    var subItemQty = currentRow.find("#subItemQty").val();
    var subItemAccQty = currentRow.find("#subItemAccQty").val();
    var subItemRejQty = currentRow.find("#subItemRejQty").val();
    var subItemRewQty = currentRow.find("#subItemRewQty").val();
    var subItemShortQty = currentRow.find("#subItemShortQty").val();
    var subItemSampleQty = currentRow.find("#subItemSampleQty").val();
    var subItemAvailStkQty = currentRow.find("#subItemAvlStk").val();
    // parseFloat(CheckNullNumber(subItemAvailStkQty)) < parseFloat(sumOfAccRejRewQty)
    var sumOfAccRejRewQty = parseFloat(CheckNullNumber(subItemAccQty)) + parseFloat(CheckNullNumber(subItemRejQty))
        + parseFloat(CheckNullNumber(subItemRewQty)) + parseFloat(CheckNullNumber(subItemShortQty))
        + parseFloat(CheckNullNumber(subItemSampleQty))

    var Erflag = 'N';
    if (parseFloat(CheckNullNumber(subItemQty)) < parseFloat(sumOfAccRejRewQty)) {
        Erflag = 'Y';
    }
    if (QCSrcType == "RWK" || QCSrcType == "PJO") {
        if (parseFloat(CheckNullNumber(subItemAvailStkQty)) < parseFloat(sumOfAccRejRewQty)) {
            Erflag = 'Y';
        }
    }



    if (Erflag == "Y") {

        var errMessage = $("#ExceedingQty").text();
        if (flag == "QCAccQty") {
            if (docid == "105102120") { /***Added This Conditon By Nitesh 02-03-2024 For Change Palceholder***/
                var SubAcceptQty = currentRow.find("#subItemAccQty").val();
                if (parseFloat(SubAcceptQty).toFixed(cmn_QtyDecDigit) == parseFloat(0).toFixed(cmn_QtyDecDigit) || SubAcceptQty == "" || SubAcceptQty == null) {
                    currentRow.find("#subItemAccQty").val("");
                }
                else {
                    currentRow.find("#subItemAccQty").val(parseFloat(SubAcceptQty).toFixed(cmn_QtyDecDigit))
                }
            }
            currentRow.find("#subItemAccQty").css("border-color", "red");
            currentRow.find("#subItemAccQty_Error").text(errMessage);
            currentRow.find("#subItemAccQty_Error").css("display", "block");
        }
        if (flag == "QCRejQty") {
            if (docid == "105102120") { /***Added This Conditon By Nitesh 02-03-2024 For Change Palceholder***/
                var SubRejQty = currentRow.find("#subItemRejQty").val();
                if (parseFloat(SubRejQty).toFixed(cmn_QtyDecDigit) == parseFloat(0).toFixed(cmn_QtyDecDigit) || SubRejQty == "" || SubRejQty == null || SubRejQty == NaN) {
                    currentRow.find("#subItemRejQty").val("");
                }
                else {
                    currentRow.find("#subItemRejQty").val(parseFloat(SubRejQty).toFixed(cmn_QtyDecDigit))
                }
            }
            currentRow.find("#subItemRejQty").css("border-color", "red");
            currentRow.find("#subItemRejQty_Error").text(errMessage);
            currentRow.find("#subItemRejQty_Error").css("display", "block");
        }
        if (flag == "QCRewQty") {
            if (docid == "105102120") { /***Added This Conditon By Nitesh 02-03-2024 For Change Palceholder***/
                var SubRewQty = currentRow.find("#subItemRewQty").val();
                if (parseFloat(SubRewQty).toFixed(cmn_QtyDecDigit) == parseFloat(0).toFixed(cmn_QtyDecDigit) || SubRewQty == "" || SubRewQty == null || SubRewQty == NaN) {
                    currentRow.find("#subItemRewQty").val("");
                }
                else {
                    currentRow.find("#subItemRewQty").val(parseFloat(SubRewQty).toFixed(cmn_QtyDecDigit))
                }
            }
            currentRow.find("#subItemRewQty").css("border-color", "red");
            currentRow.find("#subItemRewQty_Error").text(errMessage);
            currentRow.find("#subItemRewQty_Error").css("display", "block");
        }
        if (flag == "QCShortQty") {
            if (docid == "105102120") { /***Added This Conditon By Nitesh 02-03-2024 For Change Palceholder***/
                var SubShortQty = currentRow.find("#subItemShortQty").val();
                if (parseFloat(SubShortQty).toFixed(cmn_QtyDecDigit) == parseFloat(0).toFixed(cmn_QtyDecDigit) || SubShortQty == "" || SubShortQty == null || SubShortQty == NaN) {
                    currentRow.find("#subItemShortQty").val("");
                }
                else {
                    currentRow.find("#subItemShortQty").val(parseFloat(SubShortQty).toFixed(cmn_QtyDecDigit))
                }
            }
            currentRow.find("#subItemShortQty").css("border-color", "red");
            currentRow.find("#subItemShortQty_Error").text(errMessage);
            currentRow.find("#subItemShortQty_Error").css("display", "block");
        }
        if (flag == "QCSampleQty") {
            if (docid == "105102120") { /***Added This Conditon By Nitesh 02-03-2024 For Change Palceholder***/
                var SubSampleQty = currentRow.find("#subItemSampleQty").val();
                if (parseFloat(SubSampleQty).toFixed(cmn_QtyDecDigit) == parseFloat(0).toFixed(cmn_QtyDecDigit) || SubSampleQty == "" || SubSampleQty == null || SubSampleQty == NaN) {
                    currentRow.find("#subItemSampleQty").val("");
                }
                else {
                    currentRow.find("#subItemSampleQty").val(parseFloat(SubSampleQty).toFixed(cmn_QtyDecDigit))
                }
            }
            currentRow.find("#subItemSampleQty").css("border-color", "red");
            currentRow.find("#subItemSampleQty_Error").text(errMessage);
            currentRow.find("#subItemSampleQty_Error").css("display", "block");
        }
        if (flag == "SwapQty") {
            currentRow.find("#subItemQty").css("border-color", "red");
            currentRow.find("#subItemQty_Error").text(errMessage);
            currentRow.find("#subItemQty_Error").css("display", "block");
        }
        return false;
    } else {
        if (flag == "QCAccQty") {
            if (docid == "105102120") { /***Added This Conditon By Nitesh 02-03-2024 For Change Palceholder***/
                var SubAcceptQty = currentRow.find("#subItemAccQty").val();
                if (parseFloat(SubAcceptQty).toFixed(cmn_QtyDecDigit) == parseFloat(0).toFixed(cmn_QtyDecDigit) || SubAcceptQty == "" || SubAcceptQty == null || SubAcceptQty == NaN) {
                    currentRow.find("#subItemAccQty").val("");
                }
                else {
                    currentRow.find("#subItemAccQty").val(parseFloat(SubAcceptQty).toFixed(cmn_QtyDecDigit))
                }
            }
            currentRow.find("#subItemAccQty").css("border-color", "#ced4da");
            currentRow.find("#subItemAccQty_Error").text("");
            currentRow.find("#subItemAccQty_Error").css("display", "none");
        }
        if (flag == "QCRejQty") {
            if (docid == "105102120") { /***Added This Conditon By Nitesh 02-03-2024 For Change Palceholder***/
                var SubRejtQty = currentRow.find("#subItemRejQty").val();
                if (parseFloat(SubRejtQty).toFixed(cmn_QtyDecDigit) == parseFloat(0).toFixed(cmn_QtyDecDigit) || SubRejtQty == "" || SubRejtQty == null || SubRejtQty == NaN) {
                    currentRow.find("#subItemRejQty").val("");
                }
                else {
                    currentRow.find("#subItemRejQty").val(parseFloat(SubRejtQty).toFixed(cmn_QtyDecDigit))
                }
            }
            currentRow.find("#subItemRejQty").css("border-color", "#ced4da");
            currentRow.find("#subItemRejQty_Error").text("");
            currentRow.find("#subItemRejQty_Error").css("display", "none");
        }
        if (flag == "QCRewQty") {
            if (docid == "105102120") { /***Added This Conditon By Nitesh 02-03-2024 For Change Palceholder***/
                var SubRewQty = currentRow.find("#subItemRewQty").val();
                if (parseFloat(SubRewQty).toFixed(cmn_QtyDecDigit) == parseFloat(0).toFixed(cmn_QtyDecDigit) || SubRewQty == "" || SubRewQty == null || SubRewQty == NaN) {
                    currentRow.find("#subItemRewQty").val("");
                }
                else {
                    currentRow.find("#subItemRewQty").val(parseFloat(SubRewQty).toFixed(cmn_QtyDecDigit))
                }
            }
            currentRow.find("#subItemRewQty").css("border-color", "#ced4da");
            currentRow.find("#subItemRewQty_Error").text("");
            currentRow.find("#subItemRewQty_Error").css("display", "none");
        }
        if (flag == "QCShortQty") {
            if (docid == "105102120") { /***Added This Conditon By Nitesh 02-03-2024 For Change Palceholder***/
                var SubShortQty = currentRow.find("#subItemShortQty").val();
                if (parseFloat(SubShortQty).toFixed(cmn_QtyDecDigit) == parseFloat(0).toFixed(cmn_QtyDecDigit) || SubShortQty == "" || SubShortQty == null || SubShortQty == NaN) {
                    currentRow.find("#subItemShortQty").val("");
                }
                else {
                    currentRow.find("#subItemShortQty").val(parseFloat(SubShortQty).toFixed(cmn_QtyDecDigit))
                }
            }
            currentRow.find("#subItemShortQty").css("border-color", "#ced4da");
            currentRow.find("#subItemShortQty_Error").text("");
            currentRow.find("#subItemShortQty_Error").css("display", "none");
        }
        if (flag == "QCSampleQty") {
            if (docid == "105102120") { /***Added This Conditon By Nitesh 02-03-2024 For Change Palceholder***/
                var SubSampleQty = currentRow.find("#subItemSampleQty").val();
                if (parseFloat(SubSampleQty).toFixed(cmn_QtyDecDigit) == parseFloat(0).toFixed(cmn_QtyDecDigit) || SubSampleQty == "" || SubSampleQty == null || SubSampleQty == NaN) {
                    currentRow.find("#subItemSampleQty").val("");
                }
                else {
                    currentRow.find("#subItemSampleQty").val(parseFloat(SubSampleQty).toFixed(cmn_QtyDecDigit))
                }
            }
            currentRow.find("#subItemSampleQty").css("border-color", "#ced4da");
            currentRow.find("#subItemSampleQty_Error").text("");
            currentRow.find("#subItemSampleQty_Error").css("display", "none");
        }
        if (flag == "SwapQty") {
            currentRow.find("#subItemQty").css("border-color", "#ced4da");
            currentRow.find("#subItemQty_Error").text("");
            currentRow.find("#subItemQty_Error").css("display", "none");
        }
        return true;
    }

}

function Cmn_SubItemShopfloorAvlStock(ProductNm, ProductId, UOM, SourceShopfloor, ItemQty, stkType/*AC,RJ,RW*/) {
    $.ajax({
        type: "POST",
        url: "/Common/Common/GetSubItemShflAvlstockDetails",
        data: {
            shfl_id: SourceShopfloor,
            Item_id: ProductId,
            stkType: stkType
        },
        success: function (data) {

            $("#SubItemStockPopUp").html(data);
            $("#Stk_Sub_ProductlName").val(ProductNm);
            $("#Stk_Sub_ProductlId").val(ProductId);
            $("#Stk_Sub_serialUOM").val(UOM);
            $("#Stk_Sub_Quantity").val(ItemQty);
        }

    });
}

function Cmn_SubItemWIPAvlStock(ProductNm, ProductId, UOM, SourceShopfloor, ItemQty) {
    $.ajax({
        type: "POST",
        url: "/Common/Common/GetSubItemWIPstockDetails",
        data: {
            shfl_id: SourceShopfloor,
            Item_id: ProductId
        },
        success: function (data) {

            $("#SubItemStockPopUp").html(data);
            $("#Stk_Sub_ProductlName").val(ProductNm);
            $("#Stk_Sub_ProductlId").val(ProductId);
            $("#Stk_Sub_serialUOM").val(UOM);
            $("#Stk_Sub_Quantity").val(ItemQty);
        }

    });
}

function Cmn_SubItemWareHouseAvlStock(ProductNm, ProductId, UOM, Wh_id, ItemQty, flag, UomId, br_id) {

    var DocumentMenuId = $("#DocumentMenuId").val();
    $.ajax({
        type: "POST",
        url: "/Common/Common/GetSubItemWhAvlstockDetails",
        data: {
            Wh_id: Wh_id,
            Item_id: ProductId,
            flag: flag,
            DocumentMenuId: DocumentMenuId,
            UomId: UomId, /*Added by Suraj on 12-01-2024*/
            br_id: br_id /*Added by Shubham Maurya on 05-08-2024*/
        },
        success: function (data) {

            $("#SubItemStockPopUp").html(data);
            $("#Stk_Sub_ProductlName").val(ProductNm);
            $("#Stk_Sub_ProductlId").val(ProductId);
            $("#Stk_Sub_serialUOM").val(UOM);
            $("#Stk_Sub_Quantity").val(ItemQty);
        }

    });
}


/***--------------------------------Sub Item Section End-----------------------------------------***/
/*** ------------------------Cost Center Start-----------------------------------------------***/
//var ValDigit = $("#ValDigit").text();
function Cmc_CC_BndName() {

    try {
        var CC_Id = $("#ddl_CC_Type").val();
        if (CC_Id != "0") {
            $("#spn_CCType").css("display", "none");
            $("#ddl_CC_Type").css("border-color", "#ced4da");
        }
        $.ajax({
            type: "POST",
            url: "/ApplicationLayer/JournalVoucher/GetCstCntrName",
            data: {
                CCtypeid: CC_Id
            },
            success: function (data) {

                var arr = [];
                arr = JSON.parse(data);
                if (CC_Id != "0") {
                    if (arr.Table.length > 0) {
                        var s = '<option value="0">---Select---</option>';
                        for (var i = 0; i < arr.Table.length; i++) {
                            var len = $("#tbl_" + CC_Id + " tbody tr #hdntbl_CCName_Id[value=" + arr.Table[i].cc_val_id + "] ").length;
                            if (len > 0) {
                            }
                            else {
                                s += '<option value="' + arr.Table[i].cc_val_id + '">' + arr.Table[i].cc_val_name + '</option>';
                            }
                        }
                        $("#ddl_CC_Name").html(s);
                    }
                }
                else {
                    var s = '<option value="0">----Select-----</option>';
                    $("#ddl_CC_Name").html(s);
                }
            },
            error: function OnError(xhr, errorType, exception) {

            }
        });
    }
    catch (err) {
        console.log("MRS Error : " + err.message);
    }
}
function Cmn_AddNewRowCC(ddl_CC_Type, ddl_Type_Id, ddl_CC_Name, CCAmount, ddl_Name_Id, flag_check_op_id) {
    debugger
    var ccrows = "";
    var CCAmount1 = cmn_addCommas(CCAmount);
    /*start code add by Hina Sharma on 04-07-2025 to show total amount*/
    var len = $("#tbladd_body tr").length;
    if (len == 0) {
        var FCCAmount1 = parseFloat(0);
    }
    /*end code add by Hina Sharma on 04-07-2025 to show total amount*/
    var Span_Delete_Title = $("#Span_Delete_Title").text();
    if (flag_check_op_id == 'N') {
        ccrows += `<tr id='tr_${ddl_Type_Id}'>
                  <td width="20" class="red center bom_width_td"> <i class="fa fa-trash"  aria-hidden="true" title="${Span_Delete_Title}" onclick="Cmn_CC_DeleteParent(this,event,${ddl_Type_Id})"></i></td>
                  <td id="CCtype_Name">${ddl_CC_Type}</td>
                  <td hidden='hidden'><input type='hidden' id='hdn_ddl_Type_Id' value="${ddl_Type_Id}" /></td>
                    <td hidden='hidden'><input type='hidden' id='hdn_ddl_Type_Name' value="${ddl_CC_Type}" /></td>
                  <td class='no-padding' colspan="2">
                    <table id='tbl_${ddl_Type_Id}' border='0' width='100%'>
                    <tbody id='tbody_${ddl_Type_Id}'>
                    <tr>
                        <td width="20" class="red center bom_width_td"> <i class="fa fa-trash" aria-hidden="true" title="${Span_Delete_Title}" onclick="Cmn_CCDeleteChild(event,${ddl_Type_Id})"></i></td>
                        <td class="bom_width_td"><i class="fa fa-edit"  aria-hidden="true" id='hdn_editRowId' title="" onclick ="Cmn_CC_editRow(event)"></i></td>
                        <td id="CC_Name" style="width:266px;">${ddl_CC_Name}</td>
                        <td id="CC_Amount" class="num_right">${CCAmount1}</td>
                        <td hidden='hidden'><input type='hidden' id="hdntbl_CstAmt" value="${CCAmount1}" /></td>
                        <td hidden='hidden'><input type='hidden' id="hdntbl_CCName_Id" value="${ddl_Name_Id}" /></td
                    </tr>
                    </tbody>
                    
                    </table>
                     
                   </td>
            </tr>`
        /*commented and modify by Hina Sharma on 04-07-2025 to show total amount*/
        //< tfoot >
        //             <td style="width:3%;">&nbsp</td>
        //             <td style="width:30%;">&nbsp</td>
        //             <td class="num_right" style="width:50%;"><strong>Total</strong></td>
        //             <td class="num_right" id="Total_${ddl_Type_Id}" placeholder="00.00" style="width:17%;"></td>
        //         </tfoot >
        $("#tbladd_body").append(ccrows);
        /*start code add by Hina Sharma on 04-07-2025 to show total amount*/
        if (len == 0) {
            var FCCAmount1 = parseFloat(FCCAmount1) + parseFloat(CCAmount);
            $("#CCTotalAmt").text(cmn_addCommas(parseFloat(FCCAmount1).toFixed(cmn_ValDecDigit)));
        }
        else {
            var FCCAmount1 = cmn_ReplaceCommas($("#CCTotalAmt").text());
            var FCCAmount1 = parseFloat(FCCAmount1) + parseFloat(CCAmount);
            $("#CCTotalAmt").text(cmn_addCommas(parseFloat(FCCAmount1).toFixed(cmn_ValDecDigit)));
        }
        /*end code add by Hina Sharma on 04-07-2025 to show total amount*/
    }
    if (flag_check_op_id == 'Y') {
        ccrows += `<tr>
                        <td width="20" class="red center bom_width_td"> <i class="fa fa-trash" aria-hidden="true" title="${Span_Delete_Title}" onclick="Cmn_CCDeleteChild(event,${ddl_Type_Id})"></i></td>
                        <td class="bom_width_td"><i class="fa fa-edit"  aria-hidden='true' id='hdn_editRowId' title="" onclick = "Cmn_CC_editRow(event)"></i></td>
                        <td id='CC_Name'>${ddl_CC_Name}</td>
                        <td id="CC_Amount" class="num_right">${CCAmount1}</td>
                        <td hidden='hidden'><input type='hidden' id="hdntbl_CstAmt" value="${CCAmount1}" /></td>
                        <td hidden='hidden'><input type='hidden' id="hdntbl_CCName_Id" value="${ddl_Name_Id}" /></td>
                </tr>`
        $('#tbl_' + ddl_Type_Id + ' tbody').append(ccrows);
        /*start code add by Hina Sharma on 04-07-2025 to show total amount*/
        var FCCAmount1 = cmn_ReplaceCommas($("#CCTotalAmt").text());
        var FCCAmount1 = parseFloat(FCCAmount1) + parseFloat(CCAmount);
        $("#CCTotalAmt").text(cmn_addCommas(parseFloat(FCCAmount1).toFixed(cmn_ValDecDigit)));
        /*end code add by Hina Sharma on 04-07-2025 to show total amount*/
    }
}
function Cmn_CC_onclickSaveandExitBtn() {
    debugger;
    currRow1 = $(this);
    const CcMendate = $("#hdn_CostCenterDetailMandatory").text();
    var DocumentId = $("#DocumentMenuId").val();
    var Table_Text = $("#hdnTable_Id").text();
    var GLAmount = cmn_ReplaceCommas($("#GLAmount").val());
    var hdn_GlAccount = $("#hdnGLAccount_Id").val();
    var Flag = $("#txtdisable").val();
    var ErrorFlag = "Y";
    var hdntbl_vou_sr_no = $("#CC_vou_sr_no").val();
    var hdntbl_gl_sr_no = $("#CC_gl_sr_no").val();
    var hdntbl_int_br_id = $("#CC_int_br_id").val();//Added by Suraj on 02-09-2024
    var Tbllen = $("#tbladd > tbody > tr").length;
    var hdnTbllen = $("#tbladdhdn > tbody >tr").length;
    if (Flag == "Y") {
        if (Tbllen != hdnTbllen) {
            return false;
        }
    }
    var Length = $("#tbladd > tbody > tr").length;
    var FTotalAmount = parseFloat(0);
    if (Length == 0) {
        if (CcMendate == "Y") {//Added by Suraj Maurya on 10-12-2025 to validate cost center mendatory parameter wise
            ErrorFlag = "N";
            swal("", $("#GlamtmismatchWithCCAmt").text(), "warning");
            $("#CCSaveAndExitBtn").attr("data-dismiss", "");
            return false;
        }
        $("#CCSaveAndExitBtn").attr("data-dismiss", "modal");
        //var hdntbl_vou_sr_no = $("#CC_vou_sr_no").val();
        //var hdntbl_int_br_id = $("#CC_int_br_id").val();
        if ((hdntbl_vou_sr_no != null && hdntbl_vou_sr_no != "") || (hdntbl_int_br_id != null && hdntbl_int_br_id != "")) {//Added by Suraj on 14-08-2024
            $("#tbladdhdn > tbody >tr #hdntbl_GlAccountId:contains('" + hdn_GlAccount + "')").closest('tr').each(function () {
                var row = $(this);
                var vouSrNo = row.find("#hdntbl_vou_sr_no").text();
                if (DocumentId == "105104115120" || DocumentId == "105104115110") {
                    var gl_int_br_id = row.find("#hdntbl_CstIntBrId").text();
                    if (vouSrNo == hdntbl_vou_sr_no && hdntbl_int_br_id == gl_int_br_id) {
                        row.remove();
                    }
                } else {
                    if (vouSrNo == hdntbl_vou_sr_no) {
                        row.remove();
                    }
                }

            });
        } else {
            $("#tbladdhdn > tbody >tr #hdntbl_GlAccountId:contains('" + hdn_GlAccount + "')").closest('tr').remove();
        }

        //CC validation color
        $("#" + Table_Text + " > tbody >tr #hfAccID[value=" + hdn_GlAccount + "]").closest('tr').each(function () {
            if ($(this).find("#td_vou_sr_no").text() == hdntbl_vou_sr_no) {
                ValidateEyeColor($(this), "BtnCostCenterDetail", "N");
            }
        });

    }
    else {
        if (Length > 0) {
            //if (DocumentId == '105104105') {
            //    var FinBudgetTotal = parseFloat(FinBudgetCalculateAmount());
            //    if (FinBudgetTotal != parseFloat(GLAmount)) {
            //        ErrorFlag = "N";
            //        if (ErrorFlag == "N") {
            //            swal("", $("#TotalMonthlyAmtVsCostCenterAmt").text(), "warning");
            //            $("#CCSaveAndExitBtn").attr("data-dismiss", "");
            //        }
            //    }

            //}
            //else {
            $("#tbladd > tbody > tr").each(function () {

                var currentrow = $(this);
                var ddl_Type_Id = currentrow.find("#hdn_ddl_Type_Id").val();
                var ddl_Type_Name = currentrow.find("#hdn_ddl_Type_Name").val();
                var TotalAmount = parseFloat(Cmn_CalculateAmtCC(ddl_Type_Id)).toFixed(cmn_ValDecDigit);

                FTotalAmount = parseFloat(FTotalAmount) + parseFloat(TotalAmount)/*add by Hina sharma on 04-07-2025*/
                /*commented and modify by Hina sharma on 04-07-2025 to show total gl amount instead of show type wise amount*/
                //if (ddl_Type_Id != "") {
                // if (parseFloat(GLAmount) != parseFloat(TotalAmount)) {

                //        ErrorFlag = "N";
                //        if (ErrorFlag == "N") {
                //            swal("", ' ' + ddl_Type_Name + ' ' + ' ' + $("#WiseTotalAmtMismatchWithGLAmt").text() + ' ', "warning");
                //            $("#CCSaveAndExitBtn").attr("data-dismiss", "");
                //        }
                //    }
                //}
            })
            if (parseFloat(GLAmount) != parseFloat(FTotalAmount)) {
                ErrorFlag = "N";
                if (ErrorFlag == "N") {
                    swal("", $("#GlamtmismatchWithCCAmt").text(), "warning");
                    $("#CCSaveAndExitBtn").attr("data-dismiss", "");
                }
            }
            if (ErrorFlag == "N") {
                return false;
            }

            //}
            $("#tbladdhdn > tbody >tr #hdntbl_GlAccountId:contains(" + hdn_GlAccount + ")").closest('tr').each(function () {
                var currRow = $(this);
                if (DocumentId == "105104115120" || DocumentId == "105104115110") {
                    var gl_int_br_id = currRow.find("#hdntbl_CstIntBrId").text();
                    if (currRow.find("#hdntbl_vou_sr_no").text() == hdntbl_vou_sr_no && hdntbl_int_br_id == gl_int_br_id) {
                        currRow.remove();
                    }
                } else {
                    if (currRow.find("#hdntbl_vou_sr_no").text() == hdntbl_vou_sr_no) {
                        currRow.remove();
                    }
                }

            });
            if (ErrorFlag == "Y") {
                $("#tbladd > tbody > tr").each(function () {
                    var currentrow = $(this);
                    var hdntbl_CCtypeName = currentrow.find("#CCtype_Name").text();
                    var ddl_Type_Id = currentrow.find("#hdn_ddl_Type_Id").val();
                    $("#tbl_" + ddl_Type_Id + " tbody > tr").each(function () {

                        var CurrRow = $(this);
                        var hdntbl_CCtypeId = CurrRow.find("#hdntbl_CCName_Id").val();
                        var hdntbl_CC_Name = CurrRow.find("#CC_Name").text();
                        var hdntbl_CC_Amt = cmn_ReplaceCommas(CurrRow.find("#CC_Amount").text());

                        $("#tbladdhdn > tbody").append(`<tr>
                            <td id="hdntbl_GlAccountId">${hdn_GlAccount}</td>
                            <td id="hdntbl_CCtype">${hdntbl_CCtypeName}</td>
                            <td id="hdntbl_CCtype_Id">${ddl_Type_Id}</td>
                            <td id="hdntbl_CC_Name">${hdntbl_CC_Name}</td>
                            <td id="hdntbl_CCName_Id">${hdntbl_CCtypeId}</td>
                            <td id="hdntbl_CstAmt">${hdntbl_CC_Amt}</td>
                            <td id="hdntbl_vou_sr_no">${hdntbl_vou_sr_no}</td>
                            <td id="hdntbl_gl_sr_no">${hdntbl_gl_sr_no}</td>
                            <td id="hdntbl_CstIntBrId">${hdntbl_int_br_id}</td>
                            </tr>`)
                    })
                })

                if (DocumentId == "105104115155") {/*Add by Hina sharma on 25-11-2024 for COST CENTER REALLOCATION*/

                    SaveInsertCostCenterReAllocationDetail();
                }

                $("#CCSaveAndExitBtn").attr("data-dismiss", "modal");

                //CC validation color
                $("#" + Table_Text + " > tbody >tr #hfAccID[value=" + hdn_GlAccount + "]").closest('tr').each(function () {
                    if ($(this).find("#td_vou_sr_no").text() == hdntbl_vou_sr_no) {
                        ValidateEyeColor($(this), "BtnCostCenterDetail", "N");
                    }
                });
                if (DocumentId == "105104105") {//Added by Suraj Maurya on 11-12-2025 for finance budget.
                    $("#BtnCostCenterDetail").removeClass("highlight_tr_red");
                }
            }
        }
        else {
            swal("", $("#GlamtmismatchWithCCAmt").text(), "warning");
            $("#CCSaveAndExitBtn").attr("data-dismiss", "");
            ErrorFlag = "N";
        }
    }
    if (ErrorFlag == "Y") {
        if (DocumentId == "105104115155") {/*Add by Hina sharma on 25-11-2024 for COST CENTER REALLOCATION*/

            //if (SaveInsertCostCenterReAllocationDetail() == false)
            //    return false;
            SaveInsertCostCenterReAllocationDetail();

        }
        return true
    }
    else {
        return false;
    }
}

function Cmn_CalculateAmtCC(ddl_Type_Id) {
    debugger
    var Amt = 0;
    if (ddl_Type_Id != "0") {
        $('#tbl_' + ddl_Type_Id + ' > tbody > tr').each(function () {
            var curRow = $(this);
            var CCAmount = curRow.find("#hdntbl_CstAmt").val();
            var CCAmount1 = cmn_ReplaceCommas(CCAmount);
            Amt = parseFloat(CCAmount1) + parseFloat(Amt);
        })
    }
    return Amt;
}

function FinBudgetCalculateAmount() {

    var Amt = 0;
    $("#tbladd > tbody > tr").each(function () {
        var CurrRow = $(this);
        var ddl_Type_Id = CurrRow.find("#hdn_ddl_Type_Id").val();
        $('#tbl_' + ddl_Type_Id + ' > tbody > tr').each(function () {
            var curRow = $(this);
            var CCAmount = curRow.find("#hdntbl_CstAmt").val();
            Amt = parseFloat(CCAmount) + parseFloat(Amt);
        })

    })

    return Amt;
}
function cmn_CC_ValidationCheck(ddl_Type_Id, ddl_Name_Id, CCAmount, CcAmount, Flag, GLAmount) {
    debugger;
    var DocumentMenuId = $("#DocumentMenuId").val();
    //if (DocumentMenuId == "105103145125") {
    //    ValDigit = $("#ExpImpRateDigit").text();
    //}
    //var CC_Amt = parseFloat(Cmn_CalculateAmtCC(ddl_Type_Id)).toFixed(cmn_ValDecDigit);/*commented and modify by Hina sharma on 04-07-2025*/
    var CC_Amt1 = $("#CCTotalAmt").text();
    var CC_Amt = cmn_ReplaceCommas(CC_Amt1);
    //var CcAmount1 = CcAmount.replace(",", "");
    var CcAmount1 = cmn_ReplaceCommas(CcAmount);
    var Total = parseFloat(CC_Amt) + parseFloat(CcAmount1);
    var TotalAmt = parseFloat(Total).toFixed(cmn_ValDecDigit);
    if (GLAmount == "") {
        Flag = "Y";
    }
    if (CheckNullNumber(ddl_Type_Id) == "0") {
        $('#spn_CCType').text($("#valueReq").text());
        $("#spn_CCType").css("display", "block");
        $("#ddl_CC_Type").css("border-color", "red");
        Flag = 'Y';
    }
    if (CheckNullNumber(ddl_Name_Id) == "0") {
        $('#spn_CCName').text($("#valueReq").text());
        $("#spn_CCName").css("display", "block");
        $("#ddl_CC_Name").css("border-color", "red");
        Flag = "Y";
    }

    if (CheckNullNumber(CcAmount) == "0") {
        $('#spn_CCAmount').text($("#valueReq").text());
        $("#spn_CCAmount").css("display", "block");
        $("#CCAmount").css("border-color", "red");
        Flag = "Y";
    }
    else {
        $("#spn_CCAmount").css("display", "none");
        $("#CCAmount").css("border-color", "#ced4da");
    }


    if (parseFloat(TotalAmt) > parseFloat(GLAmount)) {
        $("#spn_CCAmount").text($("#ExceedingAmount").text());
        $("#spn_CCAmount").css("display", "block");
        $("#CCAmount").css("border-color", "red");
        Flag = "Y";
    }

    if (CheckNullNumber(CCAmount) == "0") {
        Flag = "Y";
    }

    if (Flag == 'Y') {
        return false;
    }
    else {
        return true;
    }
}
function Cmn_CC_ResetDropDown() {

    $("#ddl_CC_Type").attr("disabled", false);
    $("#ddl_CC_Name").attr("disabled", false);
    $("#ddl_CC_Type").val('0').attr('selected', 'selected');
    var s = '<option value="0">---Select---</option>';
    $("#ddl_CC_Name").html(s);
    $("#CCAmount").val(null);
    $("#spn_CCName").css("display", "none");
    $("#ddl_CC_Name").css("border-color", "#ced4da");
    $("#spn_CCAmount").css("display", "none");
    $("#CCAmount").css("border-color", "#ced4da");
}
function Cmn_CC_editRow(e) {

    var clickedrow = $(e.target).closest("tr");
    var ddlCstId = clickedrow.find("#hdntbl_CCName_Id").val();
    var ddlCst = clickedrow.find("#CC_Name").text();
    var tropAmount = clickedrow.find("#CC_Amount").text();
    var currentrow = clickedrow.closest('table').closest('tr');
    //var csttypename = currentrow.find("#CCtype_Name").text();
    var Csttype_Id = currentrow.find("#hdn_ddl_Type_Id").val();
    $("#ddl_CC_Type").val(Csttype_Id);
    $("#ddl_CC_Name option").remove();
    $("#ddl_CC_Name").append(`<option value="${ddlCstId}">${ddlCst}</option>`);
    $("#CCAmount").val(tropAmount);
    $("#ddl_CC_Type").attr("disabled", true);
    $("#ddl_CC_Name").attr("disabled", true);
    $("#CostCenterDetailPopup #divUpdate").css("display", "block");
    $("#CostCenterDetailPopup #divAdd").css("display", "none");
    Cmn_CC_ValidationDisable();
}
function Cmn_CC_onclkUpdateBtn(e) {

    debugger;
    var CC_Amount = cmn_ReplaceCommas($("#CCAmount").val());
    var GLAmount = cmn_ReplaceCommas($("#GLAmount").val());
    var ddl_CC_type = $("#ddl_CC_Type option:selected").val();
    var ddl_CC_Name = $("#ddl_CC_Name option:selected").val();
    if (CheckNullNumber(CC_Amount) == "0") {
        $('#spn_CCAmount').text($("#valueReq").text());
        $("#spn_CCAmount").css("display", "block");
        $("#CCAmount").css("border-color", "red");
        return false;
    }
    var zero = "0";
    var Amt = Cmn_CC_clkEditDiscardAmt(ddl_CC_type, ddl_CC_Name);
    var Totalamount = parseFloat(Amt) + parseFloat(CC_Amount);
    var TotalAmount = parseFloat(Totalamount).toFixed(cmn_ValDecDigit);
    if (parseFloat(TotalAmount) > parseFloat(GLAmount)) {
        $("#spn_CCAmount").text($("#ExceedingAmount").text());
        $("#spn_CCAmount").css("display", "block");
        $("#CCAmount").css("border-color", "red");
        return false;
    }
    if (GLAmount > parseFloat(zero).toFixed(cmn_ValDecDigit) && CheckNullNumber(CC_Amount) != "") {
        $("#tbladd > tbody > tr").each(function () {

            var currentrow = $(this);
            var CC_Type_Id = currentrow.find("#hdn_ddl_Type_Id").val();
            if (ddl_CC_type == CC_Type_Id) {
                $("#tbl_" + CC_Type_Id + " tbody > tr").each(function () {

                    var CurrRow = $(this);
                    var CstCntrId = CurrRow.find("#hdntbl_CCName_Id").val();
                    {
                        if (ddl_CC_Name == CstCntrId) {
                            CurrRow.find("#CC_Amount").text(cmn_addCommas(CC_Amount));
                            CurrRow.find("#hdntbl_CstAmt").val(cmn_addCommas(CC_Amount));
                            $("#ddl_CC_Type").attr("disabled", false);
                            $("#ddl_CC_Name").attr("disabled", false);
                            $("#CCAmount").val("0");
                            $("#CostCenterDetailPopup #divUpdate").css("display", "none");
                            $("#CostCenterDetailPopup #divAdd").css("display", "block");
                            var Select = '<option value="0">----Select-----</option>';
                            $("#ddl_CC_Name").html(Select);
                            $("#ddl_CC_Type").val('0').attr('selected', 'selected');
                            var TotalAmt = parseFloat(Cmn_CalculateAmtCC(CC_Type_Id)).toFixed(cmn_ValDecDigit);
                            /*commented and modify by Hina Sharma on 04-07-2025 to show total amount*/
                            /*$('#Total_' + CC_Type_Id + '').html(cmn_addCommas(TotalAmt));*/
                            //$("#CCTotalAmt").text(parseFloat(TotalAmt).toFixed(cmn_ValDecDigit));
                            Cmn_CC_BindFinalTotalAmt();
                        }
                    }
                })
            }
        })
    }
    else {
        return false;
    }
}
//function Cmn_InsertCCDetails() {
//    
//    var CCDetailList = new Array();
//    $("#tbladdhdn > tbody > tr").each(function () {
//        
//        currentrow = $(this);
//        var ItemList = {};
//        ItemList.GlAccountId = currentrow.find("#hdntbl_GlAccountId").text();
//        ItemList.CstCntrTypeId = currentrow.find("#hdntbl_CCtype_Id").text();
//        ItemList.CstNameId = currentrow.find("#hdntbl_CCName_Id").text();
//        ItemList.CstAmt = currentrow.find("#hdntbl_CstAmt").text();
//        CCDetailList.push(ItemList);
//    });
//    return CCDetailList;
//};
function Cmn_InsertCCDetails() {

    var DMenuId = $("#DocumentMenuId").val();
    var CCDetailList = new Array();
    $("#tbladdhdn > tbody > tr").each(function () {

        currentrow = $(this);
        var ItemList = {};
        ItemList.GlAccountId = currentrow.find("#hdntbl_GlAccountId").text();
        ItemList.CstCntrTypeId = currentrow.find("#hdntbl_CCtype_Id").text();
        ItemList.CstNameId = currentrow.find("#hdntbl_CCName_Id").text();
        ItemList.CstAmt = cmn_ReplaceCommas(currentrow.find("#hdntbl_CstAmt").text());
        ItemList.ddl_CC_Name = currentrow.find('#hdntbl_CC_Name').text();
        ItemList.ddl_CC_Type = currentrow.find("#hdntbl_CCtype").text();
        ItemList.vou_sr_no = currentrow.find("#hdntbl_vou_sr_no").text();
        ItemList.gl_sr_no = currentrow.find("#hdntbl_gl_sr_no").text();
        if (DMenuId == "105104115120" || DMenuId == "105104115110") {
            if ($("#InterBranch").is(":checked")) {
                ItemList.int_br_id = currentrow.find("#hdntbl_CstIntBrId").text();
            } else {
                ItemList.int_br_id = 0;
            }
        }

        CCDetailList.push(ItemList);
    });
    return CCDetailList;
};
function Cmn_CC_clkEditDiscardAmt(ddl_Type_Id, ddl_CC_Name) {

    var Amt = 0;
    if (ddl_Type_Id != "0") {
        $('#tbl_' + ddl_Type_Id + ' tbody tr').each(function () {

            var currRow = $(this);
            var CstItemval = currRow.find("#CC_Amount").text();
            var tbl_hdn_CstCntrId = currRow.find("#hdntbl_CCName_Id").val();
            if (ddl_CC_Name == tbl_hdn_CstCntrId) {
                Amt = Amt + "";
            }
            else {
                Amt = parseFloat(CstItemval) + parseFloat(Amt);
            }
        })
    }
    return Amt;
}
function Cmn_CC_ValidationDisable() {

    $("#spn_CCAmount").css("display", "none");
    $("#CCAmount").css("border-color", "#ced4da");
    $("#spn_CCName").css("display", "none");
    $("#ddl_CC_Name").css("border-color", "#ced4da");
    $("#spn_CCType").css("display", "none");
    $("#ddl_CC_Type").css("border-color", "#ced4da");
}
function Cmn_CC_DtlSaveButtonClick(tbl_id, db_Amt, cr_Amt,status_id) {
    debugger
    const CcMendate = $("#hdn_CostCenterDetailMandatory").text();
    if (CcMendate == "Y") {//Added by Suraj Maurya on 09-12-2025
        let doc_status = $("#" + status_id).val();
        if (doc_status == null || doc_status == "" || doc_status == "D") {
            if (Cmn_CC_ValidateIfMandatory(tbl_id, db_Amt, cr_Amt) == false) {
                return false;
            }
        }
        return true;
    } else {
        var Flag = "N";
        $("#" + tbl_id + " > tbody > tr").each(function () {

            var CurrentRow = $(this);
            var hfAccID = CurrentRow.find("#hfAccID").val();
            //var hdnAccGrpval3_4 = CurrentRow.find("#hdnAccGrpval3_4").val();
            var DebitAmountInBase = CurrentRow.find("#" + db_Amt + "").val();
            var JvAmt = 0;
            if (CheckNullNumber(DebitAmountInBase) != "0") {
                JvAmt = cmn_ReplaceCommas(CurrentRow.find("#" + db_Amt + "").val());
            }
            else {
                JvAmt = cmn_ReplaceCommas(CurrentRow.find("#" + cr_Amt + "").val());
            }
            var arr = [];
            //var VouSrNo = $("#CC_vou_sr_no").val();
            var VouSrNo = CurrentRow.find("#td_vou_sr_no").text();
            $("#tbladdhdn > tbody >tr #hdntbl_GlAccountId:contains('" + hfAccID + "')").closest('tr').each(function () {

                var currentRow = $(this);
                var vou_sr_no = currentRow.find("#hdntbl_vou_sr_no").text();
                if (VouSrNo == vou_sr_no) {

                    var ddl_Type_Id = currentRow.find("#hdntbl_CCtype_Id").text();

                    arr.push(ddl_Type_Id);
                }

            })
            var unique = arr.filter(function (itm, i, arr) {
                return i == arr.indexOf(itm);
            });
            var amt = 0;/*--add by Hina sharma on 04-07-2025--------------*/

            var GLRow = $("#tbladdhdn > tbody >tr #hdntbl_GlAccountId:contains('" + hfAccID + "')").closest('tr');
            for (let i = 0; i <= unique.length - 1; i++) {
                var Amt = 0;
                var GL_CCRow = GLRow.find("#hdntbl_CCtype_Id:contains('" + unique[i] + "')").closest('tr');
                GL_CCRow.each(function () {
                    var CurrRow = $(this);
                    if (CurrRow.find("#hdntbl_vou_sr_no").text() == VouSrNo) {
                        var CC_Amt = cmn_ReplaceCommas(CurrRow.find("#hdntbl_CstAmt").text());
                        Amt = parseFloat(CC_Amt) + parseFloat(Amt);
                    }
                });
                var jvAmt = parseFloat(JvAmt).toFixed(cmn_ValDecDigit);
                /*-----------Code Start commented and modify by Hina sharma on 04-07-2025--------------*/
                /*var jvAmt = parseFloat(JvAmt).toFixed(cmn_ValDecDigit);*/
                /*var amt = parseFloat(Amt).toFixed(cmn_ValDecDigit);*/
                amt = (parseFloat(amt) + parseFloat(Amt)).toFixed(cmn_ValDecDigit);
                //if (parseFloat(jvAmt) != parseFloat(amt)) {
                //    ValidateEyeColor(CurrentRow, "BtnCostCenterDetail", "Y");
                //    //CurrentRow.find("#BtnCostCenterDetail").css("border-color", "red");
                //    Flag = "Y";
                //}
                //else {
                //    //CurrentRow.find("#BtnCostCenterDetail").css("border-color", "#ced4da");
                //    ValidateEyeColor(CurrentRow, "BtnCostCenterDetail", "N");
                //}
                /*-----------Code end commented and modify by Hina sharma on 04-07-2025--------------*/
            }
            if (unique.length != 0) {
                if (parseFloat(jvAmt) != parseFloat(amt)) {
                    ValidateEyeColor(CurrentRow, "BtnCostCenterDetail", "Y");
                    //CurrentRow.find("#BtnCostCenterDetail").css("border-color", "red");
                    Flag = "Y";
                }
                else {
                    //CurrentRow.find("#BtnCostCenterDetail").css("border-color", "#ced4da");
                    ValidateEyeColor(CurrentRow, "BtnCostCenterDetail", "N");
                    Flag = "N";
                }
            }
            /*-----------Code end commented and modify by Hina sharma on 04-07-2025--------------*/

            if (unique.length == 0) {
                ValidateEyeColor(CurrentRow, "BtnCostCenterDetail", "N");
            }
        })
        if (Flag == "Y") {
            swal("", $("#GlamtmismatchWithCCAmt").text(), "warning");
            return false;
        } else {
            return true;
        }
    }
    
}
function Cmn_CCOnClickResetButton() {

    var hdn_GlAccount = $("#hdnGLAccount_Id").val();
    var rowCount = $('#tbladd >tbody >tr').length;
    var ddl_CC_Type = $("#ddl_CC_Type option:selected").val();
    var ddl_CC_Name = $("#ddl_CC_Name option:selected").val();
    if (rowCount > 0) {
        $("#tbladd > tbody > tr").remove();
        /* $("#tbladdhdn > tbody >tr").remove();*//*add by Hina sharma on 04-07-2025*/
        //$("#tbladdhdn > tbody >tr #hdntbl_GlAccountId:contains('" + hdn_GlAccount + "')").closest('tr').remove();
        $("#CCTotalAmt").text("");/*add by Hina sharma on 04-07-2025*/

        $("#CCAmount").val(null);
        $("#spn_CCAmount").css("display", "none");
        $("#CCAmount").css("border-color", "#ced4da");
    }
    else {
        $("#CCAmount").val(null);
        $("#spn_CCAmount").css("display", "none");
        $("#CCAmount").css("border-color", "#ced4da");
    }
    if (ddl_CC_Name == "0") {
        $("#spn_CCName").css("display", "none");
        $("#ddl_CC_Name").css("border-color", "#ced4da");
    }
    if (ddl_CC_Type == "0") {
        $("#spn_CCType").css("display", "none");
        $("#ddl_CC_Type").css("border-color", "#ced4da");
    }
    var Select = '<option value="0">----Select-----</option>';
    $("#ddl_CC_Name").html(Select);
    $("#ddl_CC_Type").val(0);
    $("#ddl_CC_Type").attr("disabled", false);
    $("#ddl_CC_Name").attr("disabled", false);
    $("#CostCenterDetailPopup #divUpdate").css("display", "none");
    $("#CostCenterDetailPopup #divAdd").css("display", "block");
}
function Cmn_CC_onclickaddBtn() {
    debugger;
    var Flag = 'N';
    var ddl_CC_Type = $("#ddl_CC_Type option:selected").text();
    var ddl_Type_Id = $("#ddl_CC_Type option:selected").val();
    var ddl_CC_Name = $("#ddl_CC_Name option:selected").text();
    var ddl_Name_Id = $("#ddl_CC_Name option:selected").val();
    var GLAmount = $("#GLAmount").val();
    var GLAmount1 = cmn_ReplaceCommas(GLAmount);
    var CcAmount = $("#CCAmount").val();
    var CcAmount1 = cmn_ReplaceCommas(CcAmount);
    var CCAmount = parseFloat(CcAmount1).toFixed(cmn_ValDecDigit);
    if (cmn_CC_ValidationCheck(ddl_Type_Id, ddl_Name_Id, CCAmount, CcAmount, Flag, GLAmount1) == false) {
        return false;
    }
    var rowCount = $('#tbladd >tbody >tr').length;
    var flag_check_op_id = 'N';
    var rowspn = parseInt(0);
    $("#tbladd >tbody >tr").each(function (i, row) {

        var currentRow = $(this);
        if (rowCount == 0) {
            rowspn = 1;
        }
        if (rowCount > 0) {
            var op_id = currentRow.find("#hdn_ddl_Type_Id").val();
            if (ddl_Type_Id == op_id) {
                flag_check_op_id = 'Y';
            }
        }
    });
    Cmn_AddNewRowCC(ddl_CC_Type, ddl_Type_Id, ddl_CC_Name, CCAmount, ddl_Name_Id, flag_check_op_id);
    var s = '<option value="0">---Select---</option>';
    $("#ddl_CC_Name").html(s);
    $("#CCAmount").val(null);
    //Cmn_CC_BindTotalAmt(ddl_Type_Id);
    Cmc_CC_BndName();
}
function Cmn_onchangeCCName() {

    var CstCntrNameID = $('#ddl_CC_Name').val();
    if (CstCntrNameID != "0") {
        $("#spn_CCName").css("display", "none");
        $("#ddl_CC_Name").css("border-color", "#ced4da");
    }
}
function Cmn_CC_DeleteParent(i, e) {
    debugger
    $(e.target).closest('tr').remove();
    //$("#tbladdhdn > tbody >tr #hdntbl_GlAccountId:contains('" + hdn_GlAccount + "')").closest('tr').remove();
    $(i).closest('tr').remove();

    Cmn_CC_BindFinalTotalAmt();

    $("#CostCenterDetailPopup #divUpdate").css("display", "none");
    $("#CostCenterDetailPopup #divAdd").css("display", "block");
    Cmn_CC_ResetDropDown();
};
function Cmn_CC_onkeypressValidate(el, evt) {

    if (Cmn_FloatValueonly(el, evt, cmn_ValDecDigit_id) == false) {
        return false;
    }
    else {
        return true;
    }
}
function Cmn_CC_onkeyupCCAmtount() {

    var DocumentMenuId = $("#DocumentMenuId").val();
    //if (DocumentMenuId == "105103145125") {
    //    ValDigit = $("#ExpImpRateDigit").text();
    //}
    var GLAmount = $("#GLAmount").val();
    //var GLAmount1 = GLAmount.replace(",", "");
    var GLAmount1 = cmn_ReplaceCommas(GLAmount);
    var CcAmount = $("#CCAmount").val();
    var ddl_Type_Id = $("#ddl_CC_Type option:selected").val();
    var ddl_CC_Name = $("#ddl_CC_Name option:selected").val();
    var CCAmount = parseFloat(CcAmount).toFixed(cmn_ValDecDigit);
    if (CheckNullNumber(CCAmount) == "") {
        return false;
    }
    if (CCAmount != "0" && CCAmount != "") {
        $("#spn_CCAmount").css("display", "none");
        $("#CCAmount").css("border-color", "#ced4da");
    }
    if (parseFloat(CCAmount) > parseFloat(GLAmount1)) {
        $("#spn_CCAmount").text($("#ExceedingAmount").text());
        $("#spn_CCAmount").css("display", "block");
        $("#CCAmount").css("border-color", "red");
    }
    else {
        $("#spn_CCAmount").css("display", "none");
        $("#CCAmount").css("border-color", "#ced4da");
    }

    var Amt = Cmn_CC_clkEditDiscardAmt(ddl_Type_Id, ddl_CC_Name);
    var Totalamount = parseFloat(Amt) + parseFloat(CCAmount);
    var TotalAmount = parseFloat(Totalamount).toFixed(cmn_ValDecDigit);
    if (parseFloat(TotalAmount) > parseFloat(GLAmount1)) {
        $("#spn_CCAmount").text($("#ExceedingAmount").text());
        $("#spn_CCAmount").css("display", "block");
        $("#CCAmount").css("border-color", "red");
        $("#ParaItemUpdateBtn").prop("disabled", "true");
    }
    else {
        $("#spn_CCAmount").css("display", "none");
        $("#CCAmount").css("border-color", "#ced4da");
        $("#ParaItemUpdateBtn").prop("disabled", "false");
    }

}
function Cmn_CC_onchangeCCAmount() {


    var Amount1 = $("#CCAmount").val();
    var Amount = cmn_ReplaceCommas(Amount1);
    var Amt = parseFloat(Amount).toFixed(cmn_ValDecDigit);
    if (CheckNullNumber(Amount) == "0") {
        $("#CCAmount").val(parseFloat(0).toFixed(cmn_ValDecDigit));
    }
    else {
        var amt1 = cmn_addCommas(Amt);
        $("#CCAmount").val(amt1);
    }
}
function Cmn_CCDeleteChild(e, ddl_Type_Id) {
    debugger
    var hdn_GlAccount = $("#hdnGLAccount_Id").val();
    //var Glrow = $("#tbladdhdn > tbody >tr #hdntbl_GlAccountId:contains('" + hdn_GlAccount + "')").closest('tr');
    var row = $('#tbl_' + ddl_Type_Id + ' tbody> tr').length;
    if (row == 1) {
        $('#tbl_' + ddl_Type_Id).closest('tr').remove();
        //Glrow.remove();

    }
    else {
        $(e.target).closest('tr').remove();
        //Glrow.find("#hdntbl_CCtype_Id:contains('" + ddl_Type_Id + "')").closest('tr').remove();
    }
    /*commented and modify by Hina Sharma on 04-07-2025 to show total amount*/
    //var Amt = Cmn_CalculateAmtCC(ddl_Type_Id);
    /*$('#Total_' + ddl_Type_Id + '').html(parseFloat(Amt).toFixed(cmn_ValDecDigit));*/
    Cmn_CC_BindFinalTotalAmt();

    $("#CostCenterDetailPopup #divUpdate").css("display", "none");
    $("#CostCenterDetailPopup #divAdd").css("display", "block");
    Cmn_CC_ResetDropDown();
};
function Cmn_CC_BindTotalAmt(ddl_Type_Id) {
    debugger;
    var Total = parseFloat(Cmn_CalculateAmtCC(ddl_Type_Id)).toFixed(cmn_ValDecDigit);
    var Total1 = cmn_addCommas(Total)
    $('#Total_' + ddl_Type_Id + '').html(Total1);
    /*$("#CCTotalAmt").text(parseFloat(Total1).toFixed(cmn_ValDecDigit));*/
}
function Cmn_CC_BindFinalTotalAmt() {
    debugger;
    /*start code add by Hina Sharma on 04-07-2025 to show total amount*/
    var FTotalAmount = parseFloat(0);
    var len = $("#tbladd > tbody > tr").length;
    if (len > 0) {
        $("#tbladd > tbody > tr").each(function () {
            var currentrow = $(this);
            var CC_Type_Id = currentrow.find("#hdn_ddl_Type_Id").val();
            var TotalAmt = parseFloat(Cmn_CalculateAmtCC(CC_Type_Id)).toFixed(cmn_ValDecDigit);
            FTotalAmount = parseFloat(FTotalAmount) + parseFloat(TotalAmt)
            $("#CCTotalAmt").text(cmn_addCommas(parseFloat(FTotalAmount).toFixed(cmn_ValDecDigit)));
        })
    }
    else {
        $("#CCTotalAmt").text(parseFloat(0).toFixed(cmn_ValDecDigit));
    }
    /*end code add by Hina Sharma on 04-07-2025 to show total amount*/
}
function Cmn_CC_ValidateIfMandatory(tbl_id, db_Amt, cr_Amt) {//Added by Suraj Maurya on 09-12-2025
    const CcMendate = $("#hdn_CostCenterDetailMandatory").text();
    if (CcMendate == "Y") {
        let DocMenuId = $("#DocumentMenuId").val();
        let CC_Error = false;
        $("#" + tbl_id + " > tbody > tr").each(function () {
            var CurrentRow = $(this);
            var hfAccID = CurrentRow.find("#hfAccID").val();

            acc_id_start_no = hfAccID.toString().substring(0, 1);
            var checkCC=false;
            if (acc_id_start_no == "3" || acc_id_start_no == "4") {
                checkCC = true;
            }
            if (checkCC) {
                
                var DebitAmountInBase = CurrentRow.find("#" + db_Amt + "").val();
                var JvAmt = 0;
                if (DocMenuId == "105104115147") {//for Expense Voucher Added by Suraj maurya on 11-12-2025
                    DebitAmountInBase = CurrentRow.find("#" + db_Amt + "").text();
                    if (CheckNullNumber(DebitAmountInBase) != "0") {
                        JvAmt = cmn_ReplaceCommas(CurrentRow.find("#" + db_Amt + "").text());
                    }
                    else {
                        JvAmt = cmn_ReplaceCommas(CurrentRow.find("#" + cr_Amt + "").text());
                    }
                }
                else {
                    if (CheckNullNumber(DebitAmountInBase) != "0") {
                        JvAmt = cmn_ReplaceCommas(CurrentRow.find("#" + db_Amt + "").val());
                    }
                    else {
                        JvAmt = cmn_ReplaceCommas(CurrentRow.find("#" + cr_Amt + "").val());
                    }
                }
                var arr = [];
                var VouSrNo = CurrentRow.find("#td_vou_sr_no").text();
                $("#tbladdhdn > tbody >tr #hdntbl_GlAccountId:contains('" + hfAccID + "')").closest('tr').each(function () {

                    var currentRow = $(this);
                    var vou_sr_no = currentRow.find("#hdntbl_vou_sr_no").text();
                    var gl_acc_id = currentRow.find("#hdntbl_GlAccountId").text();
                    if (VouSrNo == vou_sr_no && gl_acc_id == hfAccID) {
                        var ddl_Type_Id = currentRow.find("#hdntbl_CCtype_Id").text();
                        arr.push(ddl_Type_Id);
                    }

                })
                var unique = arr.filter(function (itm, i, arr) {
                    return i == arr.indexOf(itm);
                });
                var amt = 0;

                var GLRow = $("#tbladdhdn > tbody >tr #hdntbl_GlAccountId:contains('" + hfAccID + "')").closest('tr');
                for (let i = 0; i <= unique.length - 1; i++) {
                    var Amt = 0;
                    var GL_CCRow = GLRow.find("#hdntbl_CCtype_Id:contains('" + unique[i] + "')").closest('tr');
                    GL_CCRow.each(function () {
                        var CurrRow = $(this);
                        if (CurrRow.find("#hdntbl_vou_sr_no").text() == VouSrNo) {
                            var CC_Amt = cmn_ReplaceCommas(CurrRow.find("#hdntbl_CstAmt").text());
                            Amt = parseFloat(CC_Amt) + parseFloat(Amt);
                        }
                    });
                    var jvAmt = parseFloat(JvAmt).toFixed(cmn_ValDecDigit);
                    amt = (parseFloat(amt) + parseFloat(Amt)).toFixed(cmn_ValDecDigit);
                }
                if (unique.length != 0) {
                    if (parseFloat(jvAmt) != parseFloat(amt)) {
                        ValidateEyeColor(CurrentRow, "BtnCostCenterDetail", "Y"); 
                        CC_Error = true;
                    }
                    else {
                        ValidateEyeColor(CurrentRow, "BtnCostCenterDetail", "N");
                    }
                }
                if (unique.length == 0) {
                    ValidateEyeColor(CurrentRow, "BtnCostCenterDetail", "Y");
                    CC_Error = true;
                }
            }
        })

        if (CC_Error) {
            swal("", $("#GlamtmismatchWithCCAmt").text(), "warning");
            return false;
        } else {
            return true;
        }        
    }
    return true;
}

/*** ------------------------Cost Center END-----------------------------------------------***/

/***-------------------------Account Detail Section-------------------------------------***/
function onlickCalculatorIcon(e, flag, date_id, rowno, ddl_id) {
    debugger
    var clickedrow = $(e.target).closest("tr");
    var DocumentMenuId = $("#DocumentMenuId").val();
    var coa_id;
    var VouDate = $("#" + date_id + "").val();
    var ddlAccName;
    if (flag == "N" && rowno == "") {
        ddlAccName = $("#" + ddl_id + " option:selected").text();
        coa_id = $("#" + ddl_id + "").val();
    }
    else {
        ddlAccName = clickedrow.find("#GLAccount_" + rowno + " option:selected").text();
        coa_id = clickedrow.find("#GLAccount_" + rowno + " option:selected").val();
    }
    if (coa_id == "0") {
        ddlAccName = null;
    }
    var int_br_id;
    if (DocumentMenuId == "105104115110" || DocumentMenuId == "105104115120") {
        if (!(flag == "N" && rowno == "")) {
            int_br_id = clickedrow.find("#hfGlBranchID").val();
        }

    }
    $.ajax({
        type: "POST",
        url: "/Common/Common/GetAccBalDetail",
        data: {
            acc_id: coa_id,
            Date: VouDate,
            int_br_id: int_br_id
        },
        success: function (data) {

            $("#AccountBalanceDetailIcon").html(data);
            $("#GLName").val(ddlAccName);
            $("#hdnacc_id").val(coa_id);
        }
    })
}/***-------------------------Account Detail Section End-------------------------------------***/

//function GetDatetimeYYYYMMDDHHMMSS() {
//    var today = new Date();
//    var dd = String(today.getDate()).padStart(2, '0');
//    var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
//    var yyyy = today.getFullYear();
//    var hh = String(today.getHours()).padStart(2, '0');
//    var mm = String(today.getHours()).padStart(2, '0');
//    var ss = String(today.getHours()).padStart(2, '0');
//    return yyyy + mm + dd + hh + mm + ss;
//}
function GetDatetimeYYYYMMDDHHMMSS() {
    var today = new Date();
    var dd = String(today.getDate()).padStart(2, '0');
    var MM = String(today.getMonth() + 1).padStart(2, '0'); // Month
    var yyyy = today.getFullYear();
    var hh = String(today.getHours()).padStart(2, '0');     // Hours
    var mm = String(today.getMinutes()).padStart(2, '0');   // Minutes
    var ss = String(today.getSeconds()).padStart(2, '0');   // Seconds
    return yyyy + MM + dd + hh + mm + ss;
}
/*----------------------------TDS Section-----------------------------*/
/*Modified by Suraj on 19-06-2024 Third party TDS*/
async function CMN_OnClickTDSCalculationBtn(NetAmt, Hdn_Tds_Table_Id, Oc_Id, OcValWithTax, tax_type) {
    debugger;
    var DocumentMenuId = $("#DocumentMenuId").val();
    var TDS_data = [];
    var txtdisable = 'N';
    if (DocumentMenuId == "105101147") { /*Added by Surbhi on 19/05/2025 for Supplementary Purchase Invoice(105101147)*/
        if (Hdn_Tds_Table_Id == "P") { txtdisable = "Y"; }
        else if (Hdn_Tds_Table_Id == "R") { txtdisable = $("#txtdisable").val(); }
        if (Oc_Id == null) {
            Hdn_Tds_Table_Id = "Hdn_TDS_CalculatorTbl";
        } else {
            Hdn_Tds_Table_Id = "Hdn_OC_TDS_CalculatorTbl";
        }
    }
    Hdn_Tds_Table_Id = IsNull(Hdn_Tds_Table_Id, "Hdn_TDS_CalculatorTbl");
    var tds_ass_aply_on = "ET";
    var tds_ass_val_custom = 0;
    $("#" + Hdn_Tds_Table_Id + " tbody tr").each(function () {
        var row = $(this);
        var bindrow = "Y";
        if (Hdn_Tds_Table_Id == "Hdn_OC_TDS_CalculatorTbl") {
            if (row.find("#td_TDS_OC_Id").text() != Oc_Id) {
                bindrow = "N";
            }
        }
        if (bindrow == "Y") {
            var list = {};
            list.tds_name = row.find("#td_TDS_Name").text();
            list.tds_id = row.find("#td_TDS_NameID").text();
            list.tds_rate = row.find("#td_TDS_Percentage").text();
            list.tds_level = row.find("#td_TDS_Level").text();
            list.tds_apply_on = row.find("#td_TDS_ApplyOn").text();
            list.tds_amt = parseFloat(row.find("#td_TDS_Amount").text()).toFixed(0);
            list.tds_apply_on_id = row.find("#td_TDS_ApplyOnID").text();
            list.tds_acc_id = row.find("#td_TDS_AccId").text();
            if (DocumentMenuId == "105101147") {
                list.tds_base_amt = NetAmt;
                if (Oc_Id == null) {
                    txtdisable = "Y";
                }
            }
            else {
                list.tds_base_amt = row.find("#td_TDS_BaseAmt").text();
                txtdisable = $("#txtdisable").val();
            }
            list.tds_ass_val_apply_on = row.find("#td_TDS_AssValApplyOn").text();
            TDS_data.push(list);
            if (row.find("#td_TDS_AssValApplyOn").text() == "IT") {
                tds_ass_aply_on = "IT";
            } else if (row.find("#td_TDS_AssValApplyOn").text() == "CA") {/* Added by Suraj Maurya on 14-05-2025 */
                tds_ass_aply_on = "CA";
                tds_ass_val_custom = row.find("#td_TDS_BaseAmt").text();
            }
        }

    });
    //var ValDigit = $("#ValDigit").text();
    var data = JSON.stringify(TDS_data);
    //var txtdisable = $("#txtdisable").val();
    /*Added by Surbhi on 05/06/2025 for Supplementary Purchase Invoice(105101147)*/
    if (DocumentMenuId != "105101147") {
        var txtdisable = $("#txtdisable").val();
        txtdisable = $("#txtdisable").val();
    }
    await $.ajax({
        type: "POST",
        url: "/Common/Common/Cmn_GetTDSDetail",
        data: {
            NetAmt: parseFloat(CheckNullNumber(NetAmt)).toFixed(cmn_ValDecDigit)
            , TDS_data: data, doc_id: DocumentMenuId, Disable: txtdisable, tax_type: tax_type
        },
        success: function (data) {
            debugger;
            $("#PopUp_TDSCalculate").html(data);
            $("#TDS_AssessableValueWithTax").val(parseFloat(CheckNullNumber(OcValWithTax)).toFixed(cmn_ValDecDigit));

            if (parseFloat(CheckNullNumber(tds_ass_val_custom)) > 0) {// Added by Suraj Maurya on 14-05-2025 to set custom assessable val.
                $("#TDS_AssessableValueCustom").val(parseFloat(CheckNullNumber(tds_ass_val_custom)).toFixed(cmn_ValDecDigit));
            }
            else {
                $("#TDS_AssessableValueCustom").val("");
            }
            if (tds_ass_aply_on != "CA") {// Added by Suraj Maurya on 14-05-2025 to disable assessable val.
                $("#TDS_AssessableValueCustom").attr("disabled", true);
            }
            if (tds_ass_aply_on == "ET") {
                $("#TdsAssVal_ExcludeTax").attr("checked", true);
            }
            else if (tds_ass_aply_on == "IT") {
                $("#TdsAssVal_IncluedTax").attr("checked", true);
            }
            else if (tds_ass_aply_on == "CA") { // Added by Suraj Maurya on 14-05-2025 for custom assesable value
                $("#TdsAssVal_Custom").attr("checked", true);

            }
            HideShowTDSLevel();
            var TDS_Level = $("#TDS_CalculatorTbl tbody tr:last-child #TDS_level").text();
            ResetTDS_LevelVal(TDS_Level);
            $('#TDS_Level').val("1").prop('selected', true);
            //Added by Suraj on 01-08-2024 to get Assasable Value for TDS.
            if (DocumentMenuId == "105101145" || DocumentMenuId == "105101147") {/*Added by Surbhi on 07/05/2025 for Supplementary Purchase Invoice(105101147)*/
                if (parseFloat(CheckNullNumber(NetAmt)) == 0) {
                    let SuppId = $("#SupplierName").val();
                    let GrossAmt = CheckNullNumber(NetAmt);
                    //let GrossAmt = $("#TxtGrossValueInBase").val();
                    $.ajax({
                        type: "POST",
                        url: "/Common/Common/Cmn_GetTdsDetails",
                        data: { SuppId: SuppId, GrossVal: GrossAmt, tax_type: "TDS" },
                        success: function (data) {

                            ////var ValDecDigit = $("#ValDigit").text();
                            var arr = JSON.parse(data);
                            let total_tds_bs_amt = 0;
                            let AutoTds = "N";
                            if (arr.Table != null) {
                                if (arr.Table[0].tds_posting == "Y") {
                                    if (arr.Table[0].tds_apply_on == "B") {
                                        AutoTds = "Y";
                                    }
                                }
                            }
                            if (AutoTds == "Y") {
                                if (arr.Table1 != null) {
                                    for (var i = 0; i < arr.Table1.length; i++) {
                                        let tds_bs_amt = arr.Table1[i].tds_bs_amt;
                                        total_tds_bs_amt = parseFloat(total_tds_bs_amt) + parseFloat(tds_bs_amt);
                                    }
                                    $("#TDS_AssessableValue").val(parseFloat(total_tds_bs_amt).toFixed(cmn_ValDecDigit));
                                }
                            } else {
                                //$("#TDS_AssessableValue").val(parseFloat($("#TxtGrossValueInBase").val()).toFixed(cmn_ValDecDigit));
                                $("#TDS_AssessableValue").val(parseFloat(NetAmt).toFixed(cmn_ValDecDigit));
                            }
                        }
                    })
                }
                else {
                    $("#TDS_AssessableValue").val(parseFloat(CheckNullNumber(NetAmt)).toFixed(cmn_ValDecDigit));
                }
            }
        }
    })
}

function TDS_TableDataBind(rowIdx, TDS_Name, TDS_NameID, TDS_Percentage, TDS_Level, TDS_ApplyOn
    , TDS_Amount, TDS_ApplyOnID, TDS_AccId, TDS_base_amt, tds_temp) {
    debugger;
    //TDS_Amount = parseFloat(TDS_Amount).toFixed(0);//Commented by Suraj Maurya on 24-03-2025
    TDS_Amount = Cmn_RoundValue(TDS_Amount, "P");

    //var ValDecDigit = $("#ValDigit").text();
    if (TDS_Name != null && TDS_Name != "") {
        var percent = TDS_Percentage.substr(TDS_Percentage.length - 1);
        if (percent != "%") {
            TDS_Percentage = parseFloat(TDS_Percentage).toFixed(2);
            TDS_Percentage += "%";
        } else {
            TDS_Percentage = TDS_Percentage.replace("%", "");
            TDS_Percentage = parseFloat(TDS_Percentage).toFixed(2);
            TDS_Percentage += "%";
        }
        $('#TDS_CalculatorTbl tbody').append(`<tr id="R${rowIdx}">
        <td id="TDS_name" width="35%">${TDS_Name}</td>
        <td  hidden="hidden" id="TDS_id">${TDS_NameID}</td>
        <td class="num_right" width="13%" id="TDS_rate">${TDS_Percentage}</td>
        <td width="17%" class='center' id="TDS_level">${TDS_Level}</td>
        <td width="18%" id="TDS_applyonname">${TDS_ApplyOn}</td>
        <td align="right" width="17%" id="TDS_val">${parseFloat(TDS_Amount).toFixed(cmn_ValDecDigit)}</td>
        <td hidden="hidden" id="TDS_applyon">${TDS_ApplyOnID}</td>
        <td hidden="hidden" id="TDS_acc_id">${TDS_AccId}</td>
        <td hidden="hidden" id="TDS_base_amt">${TDS_base_amt}</td>
        <td hidden="hidden" id="TDS_temp">${tds_temp}</td>
        </tr>`);
        //$('#TotalTDS_Amount').text(parseFloat(TotalTDS_Amount).toFixed(cmn_ValDecDigit));
    }
    CalTDS_Amount();
    ResetTDS_LevelVal(TDS_Level);
}
//function OnChangeTDS_Type() {
//    if ($('#TDS_Type').val() == "0") {
//        $('#SpanTDS_Name').text($("#valueReq").text());
//        $("#SpanTDS_Name").css("display", "block");
//        $("#TDS_Type").css("border-color", "red");
//    }
//    else {
//        $("#SpanTDS_Name").css("display", "none");
//        $("#TDS_Type").css("border-color", "#ced4da");
//        BindTDS_Percentage($('#TDS_Type').val());
//    }
//}

function OnChangeTDS_Type() {
    debugger;
    var DocId = $("#DocumentMenuId").val();
    var tds_type = $('#TDS_Type').val();
    if (DocId != "105104135160") {
        if (tds_type == "0") {
            $('#SpanTDS_Name').text($("#valueReq").text());
            $("#SpanTDS_Name").css("display", "block");
            $("#TDS_Type").css("border-color", "red");
        }
        else {
            $("#SpanTDS_Name").css("display", "none");
            $("#TDS_Type").css("border-color", "#ced4da");
            /* BindTDS_Percentage($('#TDS_Type').val());*/
        }
    }

    if (tds_type != "0") {
        BindTDS_Percentage($('#TDS_Type').val());
    }
}


function BindTDS_Percentage(TDS_ID) {

    $.ajax({
        type: "POST",
        url: "/Common/Common/GetTaxPercentList",
        dataType: "json",
        data: { TaxID: TDS_ID },
        success: function (data) {
            if (data == 'ErrorPage') {
                Comn_ErrorPage();
                return false;
            }
            if (data !== null && data !== "") {
                var arr = [];
                arr = JSON.parse(data);
                if (arr.Table.length > 0) {
                    $("#TDS_Percentage").val(parseFloat(arr.Table[0].tax_perc).toFixed(2));

                    OnChangeTDS_Percentage();
                }
            }
        },
        error: function (data) {

        }
    });
};
function OnChangeTDS_Percentage() {

    if (AvoidDot($("#TDS_Percentage").val()) == false) {
        $("#TDS_Percentage").val("");
    }
    else {
        $("#TDS_Percentage").val($("#TDS_Percentage").val());
    }
    if ($('#TDS_Level').val() == "0") {

    }
    else {
        $("#SpanTDS_Level").css("display", "none");
        $("#TDS_Level").css("border-color", "#ced4da");
    }
    var TDS_percent = parseFloat($("#TDS_Percentage").val());
    if ($('#TDS_Percentage').val() == "0" || $('#TDS_Percentage').val() == "" || TDS_percent == 0) {
        $('#SpanTDS_Percent').text($("#valueReq").text());
        $("#SpanTDS_Percent").css("display", "block");
        $("#TDS_Percentage").css("border-color", "red");

    }
    else {
        $("#SpanTDS_Percent").css("display", "none");
        $("#TDS_Percentage").css("border-color", "#ced4da");
    }
    debugger;
    //var ValDecDigit = $("#ValDigit").text();
    /* Added by Suraj Maurya on 05-12-2024 */
    var AssAmount = $("#TDS_AssessableValue").val();
    if ($("#TdsAssVal_ExcludeTax").is(":checked")) {
        AssAmount = $("#TDS_AssessableValue").val();
    }
    else if ($("#TdsAssVal_IncluedTax").is(":checked")) {
        AssAmount = $("#TDS_AssessableValueWithTax").val();
    }
    else if ($("#TdsAssVal_Custom").is(":checked")) {// Added by Suraj Maurya on 14-05-2025 for custom assesable value
        AssAmount = $("#TDS_AssessableValueCustom").val();
    }
    /* Added by Suraj Maurya on 05-12-2024 end */

    var TDS_Percentage = $("#TDS_Percentage").val();
    var AssAmtDec = parseFloat(AssAmount).toFixed(cmn_ValDecDigit);
    var TDS_PercentageDec = parseFloat(TDS_Percentage).toFixed(cmn_ValDecDigit);

    if ($("#TDS_ApplyOn option:selected").text() == "Immediate Level") {
        if ($("#TDS_Level").val() == "1") {
            if (AssAmtDec > 0 && TDS_PercentageDec > 0) {
                var TDS_Amt = AssAmtDec * TDS_PercentageDec / 100;
                var FTDS_Amt = parseFloat(TDS_Amt).toFixed(cmn_ValDecDigit);
                $("#TDS_Amount").val(FTDS_Amt);
            }
        }
        else {
            var TDS_AMountColIL = parseFloat(0).toFixed(cmn_ValDecDigit);
            var TDS_Level = parseInt($("#TDS_Level").val()) - 1;
            $("#TDS_CalculatorTbl >tbody >tr").each(function (i, row) {
                var currentRow = $(this);
                var Level = parseInt(currentRow.find("#TDS_level").text());
                if (TDS_Level == Level) {
                    TDS_AMountColIL = (parseFloat(TDS_AMountColIL) + parseFloat(currentRow.find("#TDS_val").text())).toFixed(cmn_ValDecDigit);
                }
            });
            if (AssAmtDec > 0 && TDS_PercentageDec > 0) {
                var FinalAssAmtIL = (parseFloat(TDS_AMountColIL)).toFixed(cmn_ValDecDigit);
                var TDS_Amt = FinalAssAmtIL * TDS_PercentageDec / 100;
                var FTDS_Amt = parseFloat(TDS_Amt).toFixed(cmn_ValDecDigit);
                $("#TDS_Amount").val(FTDS_Amt);
            }
        }
    }
    if ($("#TDS_ApplyOn option:selected").text() == "Cummulative") {
        var Level = $("#TDS_Level").val();
        if ($("#TDS_Level").val() == "1") {
            if (AssAmtDec > 0 && TDS_PercentageDec > 0) {
                var TDS_Amt = AssAmtDec * TDS_PercentageDec / 100;
                var FTDS_Amt = parseFloat(TDS_Amt).toFixed(cmn_ValDecDigit);
                $("#TDS_Amount").val(FTDS_Amt);
            }
        }
        else {
            var TDS_AMountCol = parseFloat(0).toFixed(cmn_ValDecDigit);
            $("#TDS_CalculatorTbl >tbody >tr").each(function (i, row) {
                var currentRow = $(this);
                if (Level != currentRow.find("#TDS_level").text()) {
                    TDS_AMountCol = (parseFloat(TDS_AMountCol) + parseFloat(currentRow.find("#TDS_val").text())).toFixed(cmn_ValDecDigit);
                }
            });
            if (AssAmtDec > 0 && TDS_PercentageDec > 0) {
                var FinalAssAmt = (parseFloat(AssAmtDec) + parseFloat(TDS_AMountCol)).toFixed(cmn_ValDecDigit);
                var TDS_Amt = FinalAssAmt * TDS_PercentageDec / 100;
                var FTDS_Amt = parseFloat(TDS_Amt).toFixed(cmn_ValDecDigit);
                $("#TDS_Amount").val(FTDS_Amt);
            }
        }
    }
    var TDS_amount = parseFloat($('#TDS_Amount').val());
    if ($('#TDS_Amount').val() == "" || TDS_amount <= 0) {

    } else {
        $("#SpanTDS_Amounterr").css("display", "none");
        $("#TDS_Amount").css("border-color", "#ced4da");
    }
}
function OnClickAddTDS_Amt() {
    var rowIdx = 0;

    var ValidInfo = "N";
    if ($('#TDS_Type').val() == "0" || $('#TDS_Type').val() == null) {
        ValidInfo = "Y";
        $('#SpanTDS_Name').text($("#valueReq").text());
        $("#SpanTDS_Name").css("display", "block");
        $("#TDS_Type").css("border-color", "red");
    } else {
        $("#SpanTDS_Name").css("display", "none");
        $("#TDS_Type").css("border-color", "#ced4da");
    }
    if ($('#TDS_Percentage').val() == "0" || $('#TDS_Percentage').val() == "") {
        ValidInfo = "Y";
        $('#SpanTDS_Percent').text($("#valueReq").text());
        $("#SpanTDS_Percent").css("display", "block");
        $("#TDS_Percentage").css("border-color", "red");
    } else {
        $("#SpanTDS_Percent").css("display", "none");
        $("#TDS_Percentage").css("border-color", "#ced4da");
    }
    if ($('#TDS_Level').val() == "0") {
        ValidInfo = "Y";
        $('#SpanTDS_Level').text($("#valueReq").text());
        $("#SpanTDS_Level").css("display", "block");
        $("#TDS_Level").css("border-color", "red");
    } else {
        $("#SpanTDS_Level").css("display", "none");
        $("#TDS_Level").css("border-color", "#ced4da");
    }
    var TDS_amount = parseFloat($('#TDS_Amount').val());
    if ($('#TDS_Amount').val() == "" || TDS_amount <= 0) {
        ValidInfo = "Y";
        $('#SpanTDS_Amounterr').text($("#valueReq").text());
        $("#SpanTDS_Amounterr").css("display", "block");
        $("#TDS_Amount").css("border-color", "red");
    } else {
        $("#SpanTDS_Amounterr").css("display", "none");
        $("#TDS_Amount").css("border-color", "#ced4da");
    }
    if (ValidInfo == "Y") {
        return false;
    }
    /* Added by Suraj Maurya on 14-05-2025 */
    var AssAmount = $("#TDS_AssessableValue").val();
    if ($("#TdsAssVal_ExcludeTax").is(":checked")) {
        AssAmount = $("#TDS_AssessableValue").val();
    }
    else if ($("#TdsAssVal_IncluedTax").is(":checked")) {
        AssAmount = $("#TDS_AssessableValueWithTax").val();
    }
    else if ($("#TdsAssVal_Custom").is(":checked")) {// Added by Suraj Maurya on 14-05-2025 for custom assesable value
        AssAmount = $("#TDS_AssessableValueCustom").val();
    }
    /* Added by Suraj Maurya on 14-05-2025 end */
    TDS_TableDataBind(++rowIdx,
        $("#TDS_Type option:selected").text(), $("#TDS_Type").val(), $("#TDS_Percentage").val(), $("#TDS_Level").val(),
        $("#TDS_ApplyOn option:selected").text(), $("#TDS_Amount").val(), $("#TDS_ApplyOn").val()
        , $("#TDS_Type option:selected").attr("data-acc_id"), AssAmount, "temp")

    CalTDS_Amount();
    //ResetTDS_LevelVal();
}
function CalTDS_Amount() {
    // 
    //var DecDigit = $("#ValDigit").text();
    var TotalAMount = parseFloat(0).toFixed(cmn_ValDecDigit);

    $("#TDS_CalculatorTbl >tbody >tr").each(function (i, row) {
        var currentRow = $(this);
        TotalAMount = (parseFloat(TotalAMount) + parseFloat(currentRow.find("#TDS_val").text())).toFixed(cmn_ValDecDigit);
    });

    $("#TDS_CalculatorTbl #TotalTDS_Amount").text(TotalAMount);
};

function ResetTDS_CalculationDetails(tmplt_id) {

    $("#SpanTDS_Name").css("display", "none");
    $("#TDS_Type").css("border-color", "#ced4da");

    $("#SpanTDS_Percent").css("display", "none");
    $("#TDS_Percentage").css("border-color", "#ced4da");

    $("#SpanTDS_Level").css("display", "none");
    $("#TDS_Level").css("border-color", "#ced4da");

    $("#SpanTDS_Amounterr").css("display", "none");
    $("#TDS_Amount").css("border-color", "#ced4da");

    if (tmplt_id != "0") {
        $("#TDS_CalculatorTbl >tbody >tr").remove();
        $('#TDS_Type').val("0").prop('selected', true);
        $('#TDS_ApplyOn').val("I").prop('selected', true);
        $('#TDS_Percentage').val("");
        $('#TDS_Amount').val("");
        $('#TotalTDS_Amount').text(parseFloat(0).toFixed(cmn_ValDecDigit));
    }
    HideShowTDSLevel();
    $("#TDS_Type option").show();
    //BindTDS_List();
}
function ResetTDS_LevelVal(TDS_Level) {
    $("#TDS_Percentage").val("");
    $("#TDS_Amount").val("");
    //$("#TDS_Type option[value=" + $('#TDS_Type').val() + "]").hide();
    HideshowTDS_NameList();
    $('#TDS_Type').val("0").prop('selected', true);
    $('#TDS_Level').val("1").prop('selected', true);
    //const tds_level = TDS_Level;//$("#TDS_Level").val();
    //if (tds_level == "1") {
    //    $("#TDS_Level option[value=" + 1 + "]").show();
    //    $("#TDS_Level option[value=" + 2 + "]").show();
    //    $('#TDS_Level').val("1").prop('selected', true);
    //}
    //else {
    //    if (parseInt(tds_level) <= 9 && parseInt(tds_level) >= 0) {
    //        $("#TDS_Level option[value=" + (parseInt(tds_level) - 1) + "]").hide();
    //        $("#TDS_Level option[value=" + parseInt(tds_level) + "]").show();
    //        $("#TDS_Level option[value=" + (parseInt(tds_level) + 1) + "]").show();
    //        $('#TDS_Level').val("1").prop('selected', true);
    //    }
    //}
}
function Reset_ReOpen_TDS_LevelVal(TDSLevel) {
    $("#TDS_Percentage").val("");
    $("#TDS_Amount").val("");
    $('#TDS_Level').val("1").prop('selected', true);
    //if (TDSLevel == "1") {
    //    $("#TDS_Level option[value=" + 1 + "]").show();
    //    $("#TDS_Level option[value=" + 2 + "]").show();
    //    $('#TDS_Level').val("0").prop('selected', true);
    //}
    //else {
    //    if (parseInt(TDSLevel) <= 9 && parseInt(TDSLevel) >= 0) {
    //        $("#TDS_Level option[value=" + (parseInt(TDSLevel) - 1) + "]").hide();
    //        $("#TDS_Level option[value=" + parseInt(TDSLevel) + "]").show();
    //        $("#TDS_Level option[value=" + (parseInt(TDSLevel) + 1) + "]").show();
    //        $('#TDS_Level').val("0").prop('selected', true);
    //    }
    //}
}
function HideShowTDSLevel() {
    $("#TDS_Level option[value=" + 1 + "]").show();
    $("#TDS_Level option[value=" + 2 + "]").hide();
    $("#TDS_Level option[value=" + 3 + "]").hide();
    $("#TDS_Level option[value=" + 4 + "]").hide();
    $("#TDS_Level option[value=" + 5 + "]").hide();
    $("#TDS_Level option[value=" + 6 + "]").hide();
    $("#TDS_Level option[value=" + 7 + "]").hide();
    $("#TDS_Level option[value=" + 8 + "]").hide();
    $("#TDS_Level option[value=" + 9 + "]").hide();
    $("#TDS_Level option[value=" + 10 + "]").hide();
    $('#TDS_Level').val("1").prop('selected', true);/***Modifyed By shubham maurya on 13-08-2024 for add "1" ***/
}
//const OnClickTDS_DiscardAndExitBtn = () => {

//}
function Delet_OC_Tds_Detail(OCID) {

    try {
        $("#Hdn_OC_TDS_CalculatorTbl > tbody tr").each(function () {
            let row = $(this);
            if (row.find("#td_TDS_OC_Id").text() == OCID) {
                row.remove();
            }
        });
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }


};

function OnChangeTDSTemplate() {

    var tmplt_id = $("#TDS_Template").val();
    //$("#TDS_Template").val(tmplt_id);
    var DocumentMenuId = $("#DocumentMenuId").val();
    var TDS_AssessableValue = $("#TDS_AssessableValue").val();
    $.ajax({
        type: "POST",
        url: "/Common/Common/GetTDSTemplateDetail",
        data: { tmplt_id: tmplt_id, doc_id: DocumentMenuId, AmtForTds: TDS_AssessableValue },
        success: function (data) {
            var arr = JSON.parse(data);
            ResetTDS_CalculationDetails(tmplt_id);
            for (var i = 0; i < arr.Table.length; i++) {
                TDS_TableDataBind((i + 1), arr.Table[i].tds_name, arr.Table[i].tds_id, arr.Table[i].tds_rate + ''
                    , arr.Table[i].tds_level, arr.Table[i].tds_apply_on, arr.Table[i].tds_amt
                    , arr.Table[i].tds_apply_on_id, arr.Table[i].tds_acc_id, TDS_AssessableValue)
            }
        }
    });
}
function HideshowTDS_NameList() {
    $("#TDS_CalculatorTbl tbody tr").each(function () {
        var TDS_id = $(this).find("#TDS_id").text();
        $("#TDS_Type option[value=" + TDS_id + "]").hide();
    });
}
function ResetTDS_CalOnchangeDocDetail(NewBaseAmt_ET, TotalTdsID, NewBaseAmt_IT) {
    var totalTdsAmt = 0;
    var tds_ass_apply_on = "";
    //var QtyDecDigit = $("#ValDigit").text();
    //this Method is modified by Suraj Maurya on 06-12-2024 for Calculating New TDS on the basis of base_amt saved in tds hidden table.
    $("#Hdn_TDS_CalculatorTbl tbody tr").each(function () {
        var row = $(this);
        var TaxPerc = row.find("#td_TDS_Percentage").text();
        tds_ass_apply_on = row.find("#td_TDS_AssValApplyOn").text();
        if (tds_ass_apply_on != "CA") {
            var Tds_TaxPerc = TaxPerc.replace("%", "");
            //var tds_amt = row.find("#td_TDS_Amount").text();
            var base_amt = tds_ass_apply_on == "IT" ? NewBaseAmt_IT : NewBaseAmt_ET;//row.find("#td_TDS_BaseAmt").text();
            //var new_tds_amt = parseFloat(tds_amt) / parseFloat(base_amt) * parseFloat(NewBaseAmt);


            //var new_tds_amt = parseFloat(Tds_TaxPerc) * parseFloat(NewBaseAmt) / parseFloat(100)
            var new_tds_amt = parseFloat(Tds_TaxPerc) * parseFloat(base_amt) / parseFloat(100);
            //new_tds_amt = new_tds_amt.toFixed(0)
            new_tds_amt = Cmn_RoundValue(new_tds_amt, "P")
            totalTdsAmt = parseFloat(totalTdsAmt) + parseFloat(new_tds_amt);
            row.find("#td_TDS_Amount").text(new_tds_amt);
            row.find("#td_TDS_BaseAmt").text(base_amt);
        }

    });
    if (tds_ass_apply_on != "CA") {
        $(TotalTdsID).val(parseFloat(totalTdsAmt).toFixed(cmn_QtyDecDigit));
    }

}

function Cmn_OcTDS_CalOnchangeDocDetail(NewBaseAmt_ET, OC_Id, NewBaseAmt_IT) {
    var totalTdsAmt = 0;
    $("#Hdn_OC_TDS_CalculatorTbl tbody tr").each(function () {
        var row = $(this);
        var tds_oc_id = row.find("#td_TDS_OC_Id").text();
        var tds_ass_apply_on = row.find("#td_TDS_AssValApplyOn").text();
        if (tds_oc_id == OC_Id) {
            var TaxPerc = row.find("#td_TDS_Percentage").text();
            var Tds_TaxPerc = TaxPerc.replace("%", "");
            var base_amt = (tds_ass_apply_on == "IT" ? NewBaseAmt_IT : NewBaseAmt_ET);//row.find("#td_TDS_BaseAmt").text();
            var new_tds_amt = parseFloat(Tds_TaxPerc) * parseFloat(base_amt) / parseFloat(100)
            //new_tds_amt = new_tds_amt.toFixed(0)
            new_tds_amt = Cmn_RoundValue(new_tds_amt, "P")
            totalTdsAmt = parseFloat(totalTdsAmt) + parseFloat(new_tds_amt);
            row.find("#td_TDS_Amount").text(new_tds_amt);
            row.find("#td_TDS_BaseAmt").text(base_amt);
        }

    });
    return totalTdsAmt.toFixed(cmn_ValDecDigit);
}
function BindTdsTemplatelist() {

    var DocumentMenuId = $("#DocumentMenuId").val();
    $.ajax({
        type: "POST",
        url: "/Common/Common/BindTdsTemplatelist",
        data: {
            DocumentMenuId: DocumentMenuId
        },
        success: function (data) {


            if (data != null && data != "" && data != "{}") {
                var arr = JSON.parse(data);
                if (arr.Table.length > 0) {
                    $("#Tax_Template").attr("onchange", "OnChangeTaxTmpltDdl()")
                    $("#Tax_Template option").remove();
                    for (var j = 0; j < arr.Table.length; j++) {
                        $("#Tax_Template").append(`<option value='${arr.Table[j].tmplt_id}'>${arr.Table[j].tmplt_name}</option`);
                    }
                }
                var tmplt_id = $("#hd_tax_id").val();
                if (tmplt_id == "" || tmplt_id == null) {
                    tmplt_id = "0";
                }
                //$("#Tax_Template").val(tmplt_id);
                $("#Tax_Template").select2();
            }

        }
    })
}

//Common OC TDS List to insert
function Cmn_Insert_OC_Tds_Details() {

    var TDS_Details = [];
    $("#Hdn_OC_TDS_CalculatorTbl >tbody >tr").each(function (i, row) {

        var Tds_id = "";
        var Tds_rate = "";
        var Tds_level = "";
        var Tds_val = "";
        var Tds_apply_on = "";
        var Tds_name = "";
        var Tds_applyOnName = "";
        var Tds_totalAmnt = "";
        var Tds_supp_id = "";
        var Tds_oc_id = "";
        var Tds_AssValApplyOn = "";


        var currentRow = $(this);

        Tds_id = currentRow.find("#td_TDS_NameID").text();
        Tds_rate = currentRow.find("#td_TDS_Percentage").text();
        Tds_level = currentRow.find("#td_TDS_Level").text();
        Tds_val = currentRow.find("#td_TDS_Amount").text();
        Tds_apply_on = currentRow.find("#td_TDS_ApplyOnID").text();
        Tds_name = currentRow.find("#td_TDS_Name").text();
        Tds_applyOnName = currentRow.find("#td_TDS_ApplyOn").text();
        Tds_totalAmnt = currentRow.find("#td_TDS_BaseAmt").text();
        Tds_supp_id = currentRow.find("#td_TDS_Supp_Id").text();
        Tds_oc_id = currentRow.find("#td_TDS_OC_Id").text();
        Tds_AssValApplyOn = currentRow.find("#td_TDS_AssValApplyOn").text();

        TDS_Details.push({
            Tds_id: Tds_id, Tds_rate: Tds_rate, Tds_level: Tds_level, Tds_val: Tds_val
            , Tds_apply_on: Tds_apply_on, Tds_name: Tds_name, Tds_applyOnName: Tds_applyOnName
            , Tds_totalAmnt: Tds_totalAmnt, Tds_supp_id: Tds_supp_id, Tds_oc_id, Tds_oc_id: Tds_oc_id
            , Tds_AssValApplyOn: Tds_AssValApplyOn
        });
    });
    return TDS_Details;
}
function Cmn_ApplyOnTdsAssValue() {
    let TdsAssVal_applyOn = "ET";
    debugger;
    let AssAmount = $("#TDS_AssessableValue").val();

    if ($("#TdsAssVal_IncluedTax").is(":checked")) {
        TdsAssVal_applyOn = "IT";
        AssAmount = $("#TDS_AssessableValueWithTax").val();
    }
    else if ($("#TdsAssVal_Custom").is(":checked")) {// Added by Suraj Maurya on 14-05-2025 for custom assesable value
        AssAmount = $("#TDS_AssessableValueCustom").val();
    }
    if ($("#TdsAssVal_Custom").is(":checked")) {
        $("#TDS_AssessableValueCustom").attr("disabled", false);
        $("#TDS_AssessableValueCustom").css("border-color", "#ced4da");/*Added by Surbhi on 10/09/2025 for Custome Validation*/
        $("#SpanTDS_AssessableValueCustomErrorMsg").css("display", "none");
    } else {
        $("#TDS_AssessableValueCustom").val("").attr("disabled", true);
    }
    if ($("#TDS_CalculatorTbl > tbody > tr").length > 0) {
        let total_tds = 0;
        $("#TDS_CalculatorTbl > tbody > tr").each(function () {
            let row = $(this);
            let TDS_rate = row.find("#TDS_rate").text();
            TDS_rate = TDS_rate != null ? TDS_rate.replace('%', '') : 0;
            row.find("#TDS_base_amt").text(parseFloat(CheckNullNumber(AssAmount)).toFixed(cmn_ValDecDigit));
            //let tds_val = Math.round((parseFloat(CheckNullNumber(AssAmount)) * parseFloat(CheckNullNumber(TDS_rate)).toFixed(2)) / 100);
            let tds_val = Cmn_RoundValue(((parseFloat(CheckNullNumber(AssAmount)) * parseFloat(CheckNullNumber(TDS_rate)).toFixed(2)) / 100), "P");
            row.find("#TDS_val").text(parseFloat(CheckNullNumber(tds_val)).toFixed(cmn_ValDecDigit));
            total_tds = parseFloat(CheckNullNumber(total_tds)) + parseFloat(CheckNullNumber(tds_val))
        });

        $("#TotalTDS_Amount").text(total_tds.toFixed(cmn_ValDecDigit));
    }

    if (parseFloat(CheckNullNumber($("#TDS_Percentage").val())) > 0) {
        if ($("#TdsAssVal_Custom").is(":checked")) {//Added by Suraj Maurya on 16-05-2025
            $("#TDS_Type").val("0");
            $("#TDS_Percentage").val("");
            $("#TDS_Amount").val("");
        } else {
            OnChangeTDS_Percentage();
        }
    }
}

function Cmn_Insert_Tcs_Details() {
    var TCS_Details = [];
    $("#Hdn_TDS_CalculatorTbl >tbody >tr").each(function (i, row) {/* this table is used for TCS */
        var Tcs_id = "";
        var Tcs_rate = "";
        var Tcs_level = "";
        var Tcs_val = "";
        var Tcs_apply_on = "";
        var Tcs_name = "";
        var Tcs_applyOnName = "";
        var Tcs_totalAmnt = "";
        var Tcs_supp_id = "";
        var Tcs_oc_id = "";
        var Tcs_AssValApplyOn = "";
        var currentRow = $(this);
        Tcs_id = currentRow.find("#td_TDS_NameID").text();
        Tcs_rate = currentRow.find("#td_TDS_Percentage").text();
        Tcs_level = currentRow.find("#td_TDS_Level").text();
        Tcs_val = currentRow.find("#td_TDS_Amount").text();
        Tcs_apply_on = currentRow.find("#td_TDS_ApplyOnID").text();
        Tcs_name = currentRow.find("#td_TDS_Name").text();
        Tcs_applyOnName = currentRow.find("#td_TDS_ApplyOn").text();
        Tcs_totalAmnt = currentRow.find("#td_TDS_BaseAmt").text();
        Tcs_supp_id = currentRow.find("#td_TDS_Supp_Id").text();
        Tcs_oc_id = currentRow.find("#td_TDS_OC_Id").text();
        Tcs_AssValApplyOn = currentRow.find("#td_TDS_AssValApplyOn").text();
        TCS_Details.push({
            Tcs_id: Tcs_id, Tcs_rate: Tcs_rate, Tcs_level: Tcs_level, Tcs_val: Tcs_val
            , Tcs_apply_on: Tcs_apply_on, Tcs_name: Tcs_name, Tcs_applyOnName: Tcs_applyOnName
            , Tcs_totalAmnt: Tcs_totalAmnt, Tcs_supp_id: Tcs_supp_id, Tcs_oc_id: Tcs_oc_id
            , Tcs_AssValApplyOn: Tcs_AssValApplyOn
        });
    });
    return TCS_Details;
}
/*----------------------------TDS Section End-----------------------------*/
/*----------------------------Voucher Details Section-----------------------------*/
function Cmn_GetVouDetails(vou_no, voudt, vou_dt, cflag, narr) {
    $.ajax({
        type: "POST",
        url: "/Common/Common/cmn_get_voucherdetails",/*Controller=Common and Fuction=cmn_get_voucherdetails*/
        data: { vou_no: vou_no, vou_dt: vou_dt, flag: cflag, narr: narr },/*Registration pass value like model*/
        success: function (data) {

            if (data !== null && data !== "") {
                $("#gl_mwvoucherdetails").html(data);
                $("#GLVoucherNo").val(vou_no);
                $("#GLVoucherDt").val(voudt);
                $("#mwhdn_voudt").val(vou_dt);
            }
        },

        error: function (Data) {

        }
    });
}
function Cmn_GetcostcenterDetails(vou_no, vou_dt, acc_id, acc_name, amt) {
    $.ajax({
        type: "POST",
        url: "/Common/Common/cmn_getcostcenterdetails",/*Controller=Common and Fuction=cmn_getcostcenterdetails*/
        /*  dataType: "json",*/
        data: { vou_no: vou_no, vou_dt: vou_dt, acc_id: acc_id },/*Registration pass value like model*/
        success: function (data) {

            if (data !== null && data !== "") {
                $("#gl_ccdeatilsdis").html(data);

                $("#CC_GLAccount").val(acc_name);
                $("#CC_GLAmount").val(cmn_addCommas(parseFloat(amt).toFixed(cmn_ValDecDigit)));//modified by Suraj on 11-10-2024 used funtion cmn_addCommas
            }
        },

        error: function (Data) {

        }
    });
}
/*----------------------------Voucher Details Section End-----------------------------*/

/*-------------------------------BOM Alternate Item Detail--------------------------------//Added By Suraj on 17-10-2023 */
function Cmn_OnClickAlternateItemInfo(e, Level) {
    debugger;
    var CurrRow = $(e.target).closest('tr');
    let ItemType = CurrRow.find("#td_ItemType").text().trim();
    let ItemTypeId = CurrRow.find("#hfitmtypeid").val().trim();
    let ItemName = CurrRow.find("#td_ItemName").text().trim();
    let ItemId = CurrRow.find("#hfitmid").val().trim();
    let ItemUom = CurrRow.find("#td_UomAlias").text().trim();
    let ItemUomId = CurrRow.find("#hfuomid").val().trim();
    let OpName = CurrRow.find("#hfopName").val().trim();
    let OpId = CurrRow.find("#hfopid").val().trim();
    var bomLevel = "";
    if (Level != null && Level != "") {
        bomLevel = "Lvl" + (parseInt(Level) - 1);
    }
    let product_id = $("#PPLPopUp_BillOfMaterial" + bomLevel + " #Hdn_BomProductId").val().trim();

    var AltArr = new Array();

    $.ajax({
        type: "POST",
        url: "/Common/Common/GetAlternateItemDetailInfo",
        data: { product_id: product_id, op_id: OpId, item_type_id: ItemTypeId, item_id: ItemId },
        success: function (data) {

            $("#PopUp_AlternateItemDetailInfo").html(data);
            $("#Inf_Alt_OpName").val(OpName);
            $("#hdn_Inf_Alt_OpId").val(OpId);
            $("#Inf_Alt_ItemType").val(ItemType);
            $("#hdn_Inf_Alt_ItemTypeId").val(ItemTypeId);
            $("#Inf_Alt_ItemName").val(ItemName);
            $("#hdn_Inf_Alt_ItemId").val(ItemId);
            $("#Inf_Alt_ItemUom").val(ItemUom);
            $("#hdn_Inf_Alt_ItemUomId").val(ItemUomId);

        }
    })
}

/*-------------------------------BOM Alternate Item Detail End--------------------------------*/


function onlynumeric_char(el, evt) { //added By Nitesh 22-11-2023 for  char and numeric data is type

    var charCode = (evt.which) ? evt.which : event.keyCode;
    if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57) && (charCode < 65 || charCode > 90) && (charCode < 97 || charCode > 122)) {
        return false;
    }
    if (charCode == 46 && el.value.indexOf(".") !== -1) {
        return false;
    }
    var key = evt.key;
    if (key == ".") {
        return false;
    }
    var number = el.value
    if (key == "0" && number == "0") {
        return false;
    }
    //var numval = number + key + "";
    var selectedval = Cmn_SelectedTextInTextField(evt);
    var KeyLocation = evt.currentTarget.selectionStart;
    var valPer = el.value.splice(KeyLocation, 0, key);
    valPer = Cmn_CheckSelectedTextInTextField(evt) == true ? el.value.replace(selectedval, key) : valPer;


    return true;
}

function NOanycopypastedata(e) {   //added By Nitesh 22-11-2023 for No any char and numeric data paste in field

    var pasteData = e.clipboardData.getData('text');


    if (pasteData.length > 0) {
        var number = pasteData.split('.');
        if (number.length > 2) {
            return false;
        }
        for (var i = 0; i < pasteData.length; i++) {
            var charCode = pasteData.charCodeAt(i)
            if (charCode != null) {//!= 46 && charCode > 31 && (charCode < 48 || charCode < 57) && (charCode > 65 || charCode < 90) && (charCode > 97 || charCode > 122)) {
                return false;
            }
            if (charCode == 46) {
                var number = pasteData.split('.');
                if (number.length > 2) {
                    return false;
                }
            }
        }
    }

}
//-------------------------Cmn Save as Templte--------------------------------------------------//
function onclickSaveAsTemplat() {
    try {
        $("#TemplateName").val(null);
        $("#TemplateName").css("border-color", "#ced4da");
        $("#TemplateNameErrorMsg").text("");
        $("#TemplateNameErrorMsg").css("display", "none");
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}
function OnchangeTemplateName11() {
    try {

        if (CheckVallidation("TemplateName", "TemplateNameErrorMsg") == false) {
            return false;
        }
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}
function SaveTaxTemplateFromTandC() {
    try {


        if (CheckVallidation("TemplateName", "TemplateNameErrorMsg") == false) {
            return false;
        }
        if ($("#TblTerms_Condition >tbody >tr").length <= 0) {
            swal("", $("#TermsConditionsDetailsNotFound").text(), "warning");
            return false;
        }
        var TotalDetail = [];
        var FinalBranchDetail = [];
        var FinalTermDetail = [];
        FinalBranchDetail = Cmn_Tmplt_InsertBranchDetail();
        FinalTermDetail = Cmn_TermTmplt_InsertBranchDetail();

        var BranchDT = JSON.stringify(FinalBranchDetail);
        var Term = JSON.stringify(FinalTermDetail);

        TotalDetail = InsertTermDetail(Term, BranchDT);
        var TotalDT = JSON.stringify(TotalDetail);
        $.ajax({
            type: "POST",
            url: "/BusinessLayer/TermAndConditionTemplate/SaveTermTemplate",
            data: {
                DetailList: TotalDT
            },
            success: function (data) {

                var arr = JSON.parse(data);
                if (arr == "Save") {
                    $("#TemplateName").css("border-color", "#ced4da");
                    $("#TemplateNameErrorMsg").text("");
                    $("#TemplateNameErrorMsg").css("display", "none");

                    CMNBindTermsTemplatelist("Term");
                    $("#SaveAndExitBtn12").attr("data-dismiss", "modal");
                    // $("#SaveAndExitBtn12").attr("data-dismiss", "modal");
                }
                if (arr == "Duplicate") {
                    $("#TemplateName").css("border-color", "red");
                    $("#TemplateNameErrorMsg").text($("#valueduplicate").text());
                    $("#TemplateNameErrorMsg").css("display", "block");
                    $("#SaveAndExitBtn12").attr("data-dismiss", "");
                }
            }
        })
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}
function Cmn_TermTmplt_InsertBranchDetail() {
    try {
        var TermDetailList = new Array();
        $("#TblTerms_Condition tbody tr").each(function () {
            var Crow = $(this);
            var List = {};
            var term = Crow.find("#term_desc").text();
            List.TermCndsn = term;
            TermDetailList.push(List);
        });
        return TermDetailList;
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }

}
function Cmn_Tmplt_InsertBranchDetail() {
    try {

        var BranchDetailList = new Array();

        var List = {};
        var brid = $("#TopNavBranchList").val();
        List.brid = brid;
        List.ActiveStatus = "Y";
        BranchDetailList.push(List);

        return BranchDetailList;
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }

}
function InsertTermDetail(Term, BranchDT) {
    try {
        var DetailList = new Array();

        var List = {};
        List.tmplt_name = $("#TemplateName").val();
        List.TermDetails = Term;
        List.BranchDetail = BranchDT;
        DetailList.push(List);
        return DetailList
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }

}

//---------------------------Cmn Autofill Batch Qty-----------------------------//
//Added by Suraj on 20-02-2024
function Cmn_AutoFillBatchQty(BatchTable, QtyToFill, AvlQty_Id, FillQty_Id, TotalSpan_Id) {
    try {
        var DocID = $("#DocumentMenuId").val();
        let Avl_QtyToFill = QtyToFill;
        //let QtyDecDigit = $("#QtyDigit").text();
        let CalcBtQty = 0;
        if (CheckNullNumber($("#" + TotalSpan_Id).text()) == 0) {
            $("#" + BatchTable + " tbody tr").each(function () {
                let row = $(this);
                if (DocID == "105103148" || DocID == "105103149") {/*Add BY shubham Maurya on 02-06-2025 add 105103149*///add by shubham maurya on 06-05-2025 for Direct Sales Invoice
                    var bt_sale = row.find("#bt_sales").val();
                    if (bt_sale == "Y") {
                        let avlStk = row.find("#" + AvlQty_Id).val();
                        if (parseFloat(CheckNullNumber(Avl_QtyToFill)) > 0) {
                            if (parseFloat(avlStk) >= parseFloat(CheckNullNumber(Avl_QtyToFill))) {
                                row.find("#" + FillQty_Id).val(parseFloat(Avl_QtyToFill).toFixed(cmn_QtyDecDigit));
                                CalcBtQty = parseFloat(CalcBtQty) + parseFloat(Avl_QtyToFill);
                                Avl_QtyToFill = parseFloat(0);
                            } else {

                                row.find("#" + FillQty_Id).val(avlStk);
                                CalcBtQty = parseFloat(CalcBtQty) + parseFloat(avlStk);
                                Avl_QtyToFill = parseFloat(Avl_QtyToFill) - parseFloat(avlStk);
                            }
                        } else {
                            row.find("#" + FillQty_Id).val('');
                        }
                    }
                    else {
                        row.find("#BatchInvoiceQty").attr("disabled", true);
                    }
                }
                else {
                    let avlStk = row.find("#" + AvlQty_Id).val();
                    if (parseFloat(CheckNullNumber(Avl_QtyToFill)) > 0) {
                        if (parseFloat(avlStk) >= parseFloat(CheckNullNumber(Avl_QtyToFill))) {
                            row.find("#" + FillQty_Id).val(parseFloat(Avl_QtyToFill).toFixed(cmn_QtyDecDigit));
                            CalcBtQty = parseFloat(CalcBtQty) + parseFloat(Avl_QtyToFill);
                            Avl_QtyToFill = parseFloat(0);
                        } else {

                            row.find("#" + FillQty_Id).val(avlStk);
                            CalcBtQty = parseFloat(CalcBtQty) + parseFloat(avlStk);
                            Avl_QtyToFill = parseFloat(Avl_QtyToFill) - parseFloat(avlStk);
                        }
                    } else {
                        row.find("#" + FillQty_Id).val('');
                    }
                }
                //var bt_sale = row.find("#bt_sale").text();
                //if (bt_sale == "Y") {

                //}

            });
            $("#" + TotalSpan_Id).text(CalcBtQty.toFixed(cmn_QtyDecDigit));
        }
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}
function Cmn_PackingAutoFillBatchQty(BatchTable, QtyToFill, AvlQty_Id, FillQty_Id, TotalSpan_Id) {
    try {
        let Avl_QtyToFill = QtyToFill;
        //let QtyDecDigit = "";
        var DocumentMenuId = $("#DocumentMenuId").val();
        //if (DocumentMenuId == "105103145115") {
        //    QtyDecDigit = $("#ExpImpQtyDigit").text();
        //}
        //else {
        //    QtyDecDigit = $("#QtyDigit").text();
        //}
        let CalcBtQty = 0;
        if (DocumentMenuId == "105102130103" || DocumentMenuId == "105102150") {
            if (CheckNullNumber($("#" + TotalSpan_Id).text()) == 0) {
                $("#" + BatchTable + " tbody tr").each(function () {
                    let row = $(this);
                    let avlStk = row.find("#AvailableQuantity").val();
                    //var bt_sale = row.find("#bt_sale").text();
                    //if (bt_sale == "Y") {
                    if (parseFloat(CheckNullNumber(Avl_QtyToFill)) > 0) {
                        if (parseFloat(avlStk) >= parseFloat(CheckNullNumber(Avl_QtyToFill))) {
                            row.find("#" + FillQty_Id).val(parseFloat(Avl_QtyToFill).toFixed(cmn_QtyDecDigit));
                            CalcBtQty = parseFloat(CalcBtQty) + parseFloat(Avl_QtyToFill);
                            Avl_QtyToFill = parseFloat(0);
                        } else {

                            row.find("#" + FillQty_Id).val(avlStk);
                            CalcBtQty = parseFloat(CalcBtQty) + parseFloat(avlStk);
                            Avl_QtyToFill = parseFloat(Avl_QtyToFill) - parseFloat(avlStk);
                        }
                    } else {
                        row.find("#" + FillQty_Id).val('');
                    }


                });
                $("#" + TotalSpan_Id).text(CalcBtQty.toFixed(cmn_QtyDecDigit));
            }
        }
        else {
            if (CheckNullNumber($("#" + TotalSpan_Id).text()) == 0) {
                $("#" + BatchTable + " tbody tr").each(function () {
                    let row = $(this);
                    let avlStk = row.find("#" + AvlQty_Id).val();
                    var bt_sale = row.find("#bt_sale").text();
                    if (bt_sale == "Y") {
                        if (parseFloat(CheckNullNumber(Avl_QtyToFill)) > 0) {
                            if (parseFloat(avlStk) >= parseFloat(CheckNullNumber(Avl_QtyToFill))) {
                                row.find("#" + FillQty_Id).val(parseFloat(Avl_QtyToFill).toFixed(cmn_QtyDecDigit));
                                CalcBtQty = parseFloat(CalcBtQty) + parseFloat(Avl_QtyToFill);
                                Avl_QtyToFill = parseFloat(0);
                            } else {

                                row.find("#" + FillQty_Id).val(avlStk);
                                CalcBtQty = parseFloat(CalcBtQty) + parseFloat(avlStk);
                                Avl_QtyToFill = parseFloat(Avl_QtyToFill) - parseFloat(avlStk);
                            }
                        } else {
                            row.find("#" + FillQty_Id).val('');
                        }
                    } else {
                        row.find("#" + FillQty_Id).val('');
                    }

                });
                $("#" + TotalSpan_Id).text(CalcBtQty.toFixed(cmn_QtyDecDigit));
            }
        }

    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }
}
//---------------------------Cmn Autofill Batch Qty-----------------------------//

async function Cmn_StockUomWise(ItemId, UomId) {
    try {
        let itemStock = "";

        await $.ajax({
            type: "POST",
            url: "/Common/Common/getStockUomWise",
            data: {
                itemId: ItemId,
                uomId: UomId
            },
            dataType: "json",
            success: function (data) {

                try {
                    let res = JSON.parse(data);
                    //let QtyDecDigit = $("#QtyDigit").text();
                    itemStock = res.Table.length > 0 ? res.Table[0].br_avl_stk_bs : "0";
                    itemStock = parseFloat(itemStock).toFixed(cmn_QtyDecDigit);
                } catch (ex) {
                    console.log(ex.message);
                }


            },
        });
        return itemStock;
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }

}

async function Cmn_GetOC_ThirdParty(OcId, CurrencyId) {
    try {
        let SuppList;
        let DocId = $("#DocumentMenuId").val();
        await $.ajax({
            type: "POST",
            url: "/Common/Common/CmnGetOcTpEntityList",
            data: {
                OcId: OcId,
                CurrId: CurrencyId,
                DocId: DocId
            },
            dataType: "json",
            success: function (data) {

                if (data == 'ErrorPage') {
                    //Comn_ErrorPage();
                    return false;
                }
                if (data != "") {
                    let suppId = $("#SupplierName").val();
                    let Arr = JSON.parse(data).Table;
                    if (Arr == null) {
                        SuppList = [{ id: "0", text: "---Select---" }];
                    } else {
                        SuppList = Arr.filter(v => v.id != suppId);
                        SuppList.unshift({ id: "0", text: "---Select---" });
                    }
                }

            },
        });
        return SuppList;
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }

}
function CmnBindTPOCSupp(SuppList) {
    try {
        $("#OcThirdPartySupp_DDL").empty();
        //$("#hdn_oc_type").val("");
        //Removing Validations Alerts
        $("#SpanOcThirdPartySupp").css("display", "none");
        $("#OcThirdPartySupp_DDL").css("border-color", "#ced4da");
        $('[aria-labelledby="select2-OcThirdPartySupp_DDL-container"]').css("border-color", "#ced4da");

        /*Commented by Suraj on 16-07-2024*/
        //$("#OcThirdPartySupp_DDL").select2({
        //    data: SuppList,
        //});
        /*Commented by Suraj on 16-07-2024 End*/

        /*Added by Suraj on 16-07-2024*/
        $("#OcThirdPartySupp_DDL").html('<option value="0">---Select---</option>');
        $("#OcThirdPartySupp_DDL").select2({

            ajax: {
                url: "/Common/Common/Cmn_SerchableTPEntityList",
                data: function (params) {
                    var queryParameters = {
                        SearchName: params.term,
                        page: params.page || 1
                    };
                    return queryParameters;
                },
                multiple: true,
                cache: true,
                processResults: function (data, params) {

                    let array = [];
                    $("#Tbl_OC_Deatils tbody tr").each(function () {
                        var currentRow = $(this);
                        var supp_id = currentRow.find("#td_OCSuppID").text();

                        if (supp_id != "0") {
                            array.push({ id: supp_id });
                        }
                    });
                    var SerchedData = SuppList.filter(m => m.text.toLowerCase().includes(data.toString()))
                    var data = SerchedData.filter(j => array.findIndex(v => v.id == j.id) == -1);
                    return {
                        results: $.map(data, function (val, Item) {
                            return { id: val.id, text: val.text, acc_type: val.acc_type, supp_acc_id: val.supp_acc_id, supp_state_id: val.state_id };
                        })
                    };
                },
            }
        });
        /*Added by Suraj on 16-07-2024 end*/
    }
    catch (err) {
        ToAddJsErrorLogs(err);
    }

}
function ToAddJsErrorLogs(err) {

    let stack = err.stack;
    let message = err.message;
    console.log(stack);
    //location.href = "/Common/Common/Cmn_LogErrorInJS?stack=" + "tfy" + "&message=" + message;
    $.ajax({
        type: "POST",
        url: "/Common/Common/Cmn_LogErrorInJS",
        data: { stack: message, message: message },
        success: function (data) {
            console.log(data);
            Comn_ErrorPage();
        }
    })
    //window.location.href = "/Common/Common/Cmn_ErrorPage";
}
//Created By Suraj on 07-05-2024 for Finance Module control decimal difference
function Cmn_ControlDecimalDiffVal(detailTbl, DbtAmountInBase, DbtAmountInSpecific, CdtAmountInBase, CdtAmountInSpecific) {
    var debitAmount = 0;
    var DebitAmountSpecific = 0;
    var creditAmount = 0;
    var CreditAmountSpecific = 0;
    //var ValDigit = $("#ValDigit").text();
    $("#" + detailTbl + " tbody tr").each(function () {
        var currentrow = $(this);

        var DbtAmnt1 = currentrow.find("#" + DbtAmountInBase).val();
        var DebitAmountInSpecific1 = currentrow.find("#" + DbtAmountInSpecific).val();
        var DebitAmountInSpecific = cmn_ReplaceCommas(DebitAmountInSpecific1);
        var DbtAmnt = cmn_ReplaceCommas(DbtAmnt1);
        var CrdtAmnt1 = currentrow.find("#" + CdtAmountInBase).val();
        var CrdtAmnt = cmn_ReplaceCommas(CrdtAmnt1);
        var CreditAmountInSpecific1 = currentrow.find("#" + CdtAmountInSpecific).val();
        var CreditAmountInSpecific = cmn_ReplaceCommas(CreditAmountInSpecific1);

        if (AvoidDot(DbtAmnt) == false) {
            DbtAmnt = 0;
        }
        if (AvoidDot(DebitAmountInSpecific) == false) {
            DebitAmountInSpecific = 0;
        }
        if (AvoidDot(CrdtAmnt) == false) {
            CrdtAmnt = 0;
        }
        if (AvoidDot(CreditAmountInSpecific) == false) {
            CreditAmountInSpecific = 0;
        }
        debitAmount = parseFloat(debitAmount) + parseFloat(DbtAmnt);
        DebitAmountSpecific = parseFloat(DebitAmountSpecific) + parseFloat(DebitAmountInSpecific);
        creditAmount = parseFloat(creditAmount) + parseFloat(CrdtAmnt);
        CreditAmountSpecific = parseFloat(CreditAmountSpecific) + parseFloat(CreditAmountInSpecific);
    })

    if (DebitAmountSpecific.toFixed(5) == CreditAmountSpecific.toFixed(5)) {

        var difference = debitAmount - creditAmount;
        var FinalDiff1 = 0;
        if (difference > 0) {
            FinalDiff1 = (difference * 1)
        }
        else {
            FinalDiff1 = (difference * -1)
        }
        var FinalDiff = FinalDiff1.toFixed(cmn_ValDecDigit);

        if (debitAmount > creditAmount) {
            let FirstFilledCol = false;
            $("#" + detailTbl + " tbody tr").each(function () {
                let currentrow = $(this);
                if (FirstFilledCol == false) {
                    let CrdtAmnt11 = currentrow.find("#" + CdtAmountInBase).val();
                    let CrdtAmnt2 = cmn_ReplaceCommas(CrdtAmnt11);
                    if (AvoidDot(CrdtAmnt2) == false) {
                        CrdtAmnt2 = 0;
                    }
                    if (parseFloat(CrdtAmnt2) > 0) {
                        let FinCrAmt = parseFloat(CrdtAmnt2) + parseFloat(FinalDiff);
                        currentrow.find("#" + CdtAmountInBase).val(cmn_addCommas(FinCrAmt.toFixed(cmn_ValDecDigit)));
                        FirstFilledCol = true;
                        return false;
                    }

                }
            });
        }
        if (creditAmount > debitAmount) {
            let FirstFilledCol = false;
            $("#" + detailTbl + " tbody tr").each(function () {
                if (FirstFilledCol == false) {
                    let currentrow = $(this);

                    let DbtAmnt11 = currentrow.find("#" + DbtAmountInBase).val();
                    let DbtAmnt2 = cmn_ReplaceCommas(DbtAmnt11);
                    if (AvoidDot(DbtAmnt2) == false) {
                        DbtAmnt2 = 0;
                    }
                    if (parseFloat(DbtAmnt2) > 0) {
                        let FinDrAmt = parseFloat(DbtAmnt2) + parseFloat(FinalDiff);
                        currentrow.find("#" + DbtAmountInBase).val(cmn_addCommas(FinDrAmt.toFixed(cmn_ValDecDigit)));
                        FirstFilledCol = true;
                        return false;
                    }

                }
            });

        }
    }

}

function Comn_ErrorPage() {

    window.location.href = "/Common/Common/Cmn_ErrorPage";
}

function Cmn_Block_Keys(e, keyNames) {

    if (keyNames != "") {
        var keys = keyNames.split(',');
        if (keys.length > 0) {
            for (let i = 0; i < keys.length; i++) {
                if (e.code == keys[i]) {
                    return false;
                }
            }
        }
    }
}
function Cmn_RemoveSpacesAndTabs(data) {


    data = data.replaceAll(" ", "");
    data = data.replaceAll("\\", " ");
    data = data.replaceAll("\t", "");
    data = data.replaceAll(" ", "\\")

    return data;

}
/*-----------------------------------GL Setcion------------------------------------*/
async function Cmn_GLTableBind(supp_acc_id, GLDetail, doc_type) {
    //Code Modified by Suraj Maurya on 11-12-2024
    console.log("Cmn_GLTableBind")
    var glData = JSON.stringify(GLDetail);
    var docMenuId = $("#DocumentMenuId").val();
    await $.ajax({
        type: "POST",
        url: "/Common/Common/GetGLDetails_StringData",
        //contentType: "application/json; charset=utf-8",
        //dataType: "json",
        data: { GLDetail: glData, docMenuId: docMenuId },
        success: function (data) {
            debugger
            if (data == 'ErrorPage') {
                Comn_ErrorPage();
                return false;
            }

            if (data !== null && data !== "") {
                var arr = [];
                arr = JSON.parse(data);
                var Voudet = 'Y';
                $('#VoucherDetail tbody tr').remove();
                if (arr.Table1.length > 0) {
                    var errors = [];
                    var step = [];
                    for (var i = 0; i < arr.Table1.length; i++) {

                        if (arr.Table1[i].acc_id == "" || arr.Table1[i].acc_name == "" || arr.Table1[i].acc_name == null || arr.Table1[i].acc_id == "0" || arr.Table1[i].acc_id == null || arr.Table1[i].acc_id == 0) {
                            let gl_entity_name = arr.Table1[i].type == "RCM" ? "RCM Account" : arr.Table1[i].EntityName;

                            errors.push($("#GLAccountisnotLinked").text() + ' ' + gl_entity_name)
                            step.push(parseInt(i));
                            //Voudet = 'N';
                        }
                    }
                    var arrayOfErrorsToDisplay = [];
                    $.each(errors, function (i, error) {
                        arrayOfErrorsToDisplay.push({ text: error });
                    });
                    Swal.mixin({
                        confirmButtonText: 'Ok',
                        type: "warning",
                    }).queue(arrayOfErrorsToDisplay)
                        .then((result) => {
                            if (result.value) {

                            }
                        });
                }
                if (Voudet == 'Y') {
                    if (doc_type == "Purchase") {
                        if (arr.Table.length > 0) {
                            $('#VoucherDetail tbody tr').remove();
                            //let supp_acc_id = $("#supp_acc_id").val();
                            var arrSupp = arr.Table.filter(v => (v.type == "TSupp" || v.type == "Supp" || v.type == "Bank" || v.type == "VSupp"));
                            var mainSuppGl = arrSupp.filter(v => v.acc_id == supp_acc_id && v.type == "Supp");
                            var TdsSuppGl = arrSupp.filter(v => v.acc_id == supp_acc_id && (v.type == "TSupp" || v.type == "VSupp"));
                            var NewArrSupp = arrSupp.filter(v => v.acc_id != supp_acc_id).sort((a, b) => a.acc_id - b.acc_id);
                            if (TdsSuppGl.length > 0) {
                                if (TdsSuppGl.filter(v => v.type == "VSupp").length > 0) {
                                    NewArrSupp.unshift(TdsSuppGl.filter(v => v.type == "VSupp")[0]);
                                }
                                if (TdsSuppGl.filter(v => v.type == "TSupp").length > 0) {
                                    NewArrSupp.unshift(TdsSuppGl.filter(v => v.type == "TSupp")[0]);
                                }
                            }
                            NewArrSupp.unshift(mainSuppGl[0]);
                            arrSupp = NewArrSupp;
                            for (var j = 0; j < arrSupp.length; j++) {
                                /*Added by Surbhi on 17/05/2025 for Supplementary Purchase Invoice(105101147)*/
                                if (docMenuId == '105101147') {
                                    if (arrSupp[j] === undefined) {
                                        console.log(`Index ${j} is undefined, skipping.`);
                                        continue;
                                    }
                                }
                                let supp_id = arrSupp[j].id;
                                let supp_type = arrSupp[j].type;
                                let supp_bill_no = arrSupp[j].bill_no;
                                let supp_bill_dt = arrSupp[j].bill_dt;
                                let arrDetail;// = arr.Table.filter(v => (v.id == supp_id && (v.type == "Supp" || v.type == "Bank")));
                                //let arrDetailDr = arr.Table.filter(v => (v.parent == supp_id && (v.type == "OC" || v.type == "Itm" || v.type == "Tax" || v.type == "RCM")));
                                let arrDetailDr;
                                if (supp_type == "TSupp") {
                                    arrDetail = arr.Table.filter(v => (v.id == supp_id && (v.type == "TSupp")));
                                    arrDetailDr = arr.Table.filter(v => (v.parent == supp_id && (v.type == "Tds")));
                                }
                                else if (supp_type == "VSupp") {/* For Variance qty in PI */
                                    arrDetail = arr.Table.filter(v => (v.id == supp_id && (v.type == "VSupp")));
                                    arrDetailDr = arr.Table.filter(v => (v.parent == supp_id && (v.type == "VItm" || v.type == "VTax" || v.type == "VRCM")));
                                }
                                else {
                                    arrDetail = arr.Table.filter(v => (v.id == supp_id && (v.type == "Supp" || v.type == "Bank") && v.bill_no == supp_bill_no && v.bill_dt == supp_bill_dt));
                                    arrDetailDr = arr.Table.filter(v => (v.parent == supp_id && v.type != "OcTax" && v.type != "Tds" && v.type != "VItm" && v.type != "VTax" && v.type != "VRCM" && v.bill_no == supp_bill_no && v.bill_dt == supp_bill_dt));
                                }


                                let RcmValue = 0;
                                let RcmValueInBase = 0;
                                if (supp_type != "TSupp" && supp_type != "VSupp") {
                                    arr.Table.filter(v => (v.parent == supp_id && v.type == "RCM"))
                                        .map((res) => {
                                            RcmValue = RcmValue + res.Value;
                                            RcmValueInBase = RcmValueInBase + res.ValueInBase;
                                        });
                                }
                                if (supp_type == "VSupp") {
                                    arr.Table.filter(v => (v.parent == supp_id && v.type == "VRCM"))
                                        .map((res) => {
                                            RcmValue = RcmValue + res.Value;
                                            RcmValueInBase = RcmValueInBase + res.ValueInBase;
                                        });
                                }

                                arrDetail[0].Value = arrDetail[0].Value - RcmValue;
                                arrDetail[0].ValueInBase = arrDetail[0].ValueInBase - RcmValueInBase;

                                let rowSpan = 1;//arrDetailDr.length + 1;
                                let GlRowNo = 1;
                                // First Row Generated here for all GL Voucher 
                                let vouType = "";
                                if (arrDetail[0].type == "TSupp" || arrDetail[0].type == "VSupp")
                                    /*Added by Surbhi on 19/05/2025 for Supplementary Purchase Invoice(105101147)*/
                                    if (arrDetail[0].type == "TSupp" && docMenuId == '105101147' && (arrDetail[0].Value < 0)) {
                                        vouType = "CN"
                                    }
                                    else {
                                        vouType = "DN"
                                    }
                                if (arrDetail[0].type == "Supp")
                                    if (docMenuId == '105101147') {
                                        //var supp_acc_id = $("#supp_acc_id").val();
                                        if (supp_acc_id == arrDetail[0].acc_id) {
                                            if (arrDetail[0].Value > 0) {
                                                vouType = "CN";
                                            }
                                            else if (arrDetail[0].Value < 0) {
                                                vouType = "DN";
                                                arrDetail[0].Value = Math.abs(arrDetail[0].Value);
                                                arrDetail[0].ValueInBase = Math.abs(arrDetail[0].ValueInBase);
                                            }
                                        }
                                        else {
                                            vouType = "PV";
                                        }
                                    }
                                    else {
                                        vouType = "PV"
                                    }
                                if (arrDetail[0].type == "Bank")
                                    vouType = "BP"
                                if (vouType == "DN") {
                                    Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, arrDetail[0].type, arrDetail[0].acc_name, arrDetail[0].acc_id
                                        , arrDetail[0].Value, arrDetail[0].ValueInBase, 0, 0, vouType, arrDetail[0].curr_id
                                        , arrDetail[0].conv_rate, arrDetail[0].bill_no, arrDetail[0].bill_dt, arrDetail[0].gst_cat, arrDetail[0].i_capg);
                                } else {
                                    Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, arrDetail[0].type, arrDetail[0].acc_name, arrDetail[0].acc_id
                                        , 0, 0, arrDetail[0].Value, arrDetail[0].ValueInBase, vouType, arrDetail[0].curr_id
                                        , arrDetail[0].conv_rate, arrDetail[0].bill_no, arrDetail[0].bill_dt, arrDetail[0].gst_cat, arrDetail[0].i_capg);
                                }

                                let ArrTax = [];
                                let ArrGlDetailsDr = [];
                                for (var k = 0; k < arrDetailDr.length; k++) {
                                    //GlRowNo++;
                                    // Row Generated here for Other charge and Tax on item
                                    let getAccIndex = ArrGlDetailsDr.findIndex(v => v.acc_id == arrDetailDr[k].acc_id);
                                    if (getAccIndex > -1) {
                                        ArrGlDetailsDr[getAccIndex].Value = parseFloat(ArrGlDetailsDr[getAccIndex].Value) + parseFloat(arrDetailDr[k].Value)
                                        ArrGlDetailsDr[getAccIndex].ValueInBase = parseFloat(ArrGlDetailsDr[getAccIndex].ValueInBase) + parseFloat(arrDetailDr[k].ValueInBase)
                                    } else {
                                        //rowSpan++;
                                        if (arrDetailDr[k].type == "Tax" || arrDetailDr[k].type == "VTax") {
                                            let getAccIndex = ArrTax.findIndex(v => v.acc_id == arrDetailDr[k].acc_id && v.type == arrDetailDr[k].type);
                                            if (getAccIndex > -1) {
                                                ArrTax[getAccIndex].Value = parseFloat(ArrTax[getAccIndex].Value) + parseFloat(arrDetailDr[k].Value)
                                                ArrTax[getAccIndex].ValueInBase = parseFloat(ArrTax[getAccIndex].ValueInBase) + parseFloat(arrDetailDr[k].ValueInBase)
                                            } else {
                                                //rowSpan++;
                                                ArrTax.push(arrDetailDr[k]);
                                            }
                                            // ArrTax.push(arrDetailDr[k]);
                                        }
                                        else if (arrDetailDr[k].type == "OcTax") {
                                        }
                                        else {
                                            ArrGlDetailsDr.push(arrDetailDr[k]);
                                        }
                                    }
                                    if (arrDetailDr[k].type == "OC") {

                                        let arrDetailOCDr = arr.Table.filter(v => (v.parent == arrDetailDr[k].oc_id && v.type == "OcTax"));
                                        // Grouping the similer tax account
                                        for (var l = 0; l < arrDetailOCDr.length; l++) {

                                            let getAccIndex = ArrTax.findIndex(v => v.acc_id == arrDetailOCDr[l].acc_id);
                                            if (getAccIndex > -1) {
                                                ArrTax[getAccIndex].Value = parseFloat(ArrTax[getAccIndex].Value) + parseFloat(arrDetailOCDr[l].Value)
                                                ArrTax[getAccIndex].ValueInBase = parseFloat(ArrTax[getAccIndex].ValueInBase) + parseFloat(arrDetailOCDr[l].ValueInBase)
                                            } else {
                                                //rowSpan++;
                                                ArrTax.push(arrDetailOCDr[l]);
                                            }
                                        }
                                        //Updating rowspan as Tax on OC added
                                    }
                                }
                                var ArrGLDetailRCM = []
                                for (var i = 0; i < ArrGlDetailsDr.length; i++) {

                                    if (ArrGlDetailsDr[i].type == "RCM" || ArrGlDetailsDr[i].type == "VRCM") {
                                        ArrGLDetailRCM.push(ArrGlDetailsDr[i]);

                                    } else {
                                        GlRowNo++;
                                        rowSpan++;
                                        if (ArrGlDetailsDr[i].type == "Tds" || ArrGlDetailsDr[i].type == "VItm") {

                                            /*Added by Surbhi on 19/05/2025 for Supplementary Purchase Invoice(105101147)*/
                                            if (ArrGlDetailsDr[i].type == "Tds" && docMenuId == '105101147' && (ArrGlDetailsDr[i].Value < 0)) {
                                                if (ArrGlDetailsDr[i].Value > 0) {
                                                    Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGlDetailsDr[i].type, ArrGlDetailsDr[i].acc_name
                                                        , ArrGlDetailsDr[i].acc_id, 0, 0, ArrGlDetailsDr[i].Value, ArrGlDetailsDr[i].ValueInBase,
                                                        vouType, ArrGlDetailsDr[0].curr_id, ArrGlDetailsDr[0].conv_rate
                                                        , ArrGlDetailsDr[0].bill_no, ArrGlDetailsDr[0].bill_dt, ArrGlDetailsDr[0].gst_cat, ArrGlDetailsDr[i].i_capg)
                                                }
                                                else {
                                                    Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGlDetailsDr[i].type, ArrGlDetailsDr[i].acc_name
                                                        , ArrGlDetailsDr[i].acc_id, ArrGlDetailsDr[i].Value, ArrGlDetailsDr[i].ValueInBase, 0, 0,
                                                        vouType, ArrGlDetailsDr[0].curr_id, ArrGlDetailsDr[0].conv_rate
                                                        , ArrGlDetailsDr[0].bill_no, ArrGlDetailsDr[0].bill_dt, ArrGlDetailsDr[0].gst_cat, ArrGlDetailsDr[i].i_capg)
                                                }
                                            }
                                            else {
                                                Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGlDetailsDr[i].type, ArrGlDetailsDr[i].acc_name
                                                    , ArrGlDetailsDr[i].acc_id, 0, 0, ArrGlDetailsDr[i].Value, ArrGlDetailsDr[i].ValueInBase,
                                                    vouType, ArrGlDetailsDr[0].curr_id, ArrGlDetailsDr[0].conv_rate
                                                    , ArrGlDetailsDr[0].bill_no, ArrGlDetailsDr[0].bill_dt, ArrGlDetailsDr[0].gst_cat, ArrGlDetailsDr[i].i_capg)
                                            }
                                        }
                                        else {
                                            Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGlDetailsDr[i].type, ArrGlDetailsDr[i].acc_name
                                                , ArrGlDetailsDr[i].acc_id, ArrGlDetailsDr[i].Value, ArrGlDetailsDr[i].ValueInBase, 0, 0,
                                                vouType, ArrGlDetailsDr[0].curr_id, ArrGlDetailsDr[0].conv_rate
                                                , ArrGlDetailsDr[0].bill_no, ArrGlDetailsDr[0].bill_dt, ArrGlDetailsDr[0].gst_cat, ArrGlDetailsDr[i].i_capg
                                            )
                                        }

                                    }

                                }
                                for (var i = 0; i < ArrTax.length; i++) {
                                    GlRowNo++;
                                    rowSpan++;

                                    if (ArrTax[i].type == "VTax") {
                                        // Row Generated here for Tax on Variance Quantity
                                        Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrTax[i].type, ArrTax[i].acc_name, ArrTax[i].acc_id
                                            , 0, 0, ArrTax[i].Value, ArrTax[i].ValueInBase, vouType,
                                            ArrTax[0].curr_id, ArrTax[0].conv_rate, ArrTax[0].bill_no, ArrTax[0].bill_dt, ArrTax[0].gst_cat, ArrTax[i].i_capg
                                        )
                                    } else {
                                        // Row Generated here for Tax on Other Charge
                                        Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrTax[i].type, ArrTax[i].acc_name, ArrTax[i].acc_id
                                            , ArrTax[i].Value, ArrTax[i].ValueInBase, 0, 0, vouType,
                                            ArrTax[0].curr_id, ArrTax[0].conv_rate, ArrTax[0].bill_no, ArrTax[0].bill_dt, ArrTax[0].gst_cat, ArrTax[i].i_capg
                                        )
                                    }
                                }
                                for (var i = 0; i < ArrGLDetailRCM.length; i++) {
                                    GlRowNo++;
                                    rowSpan++;
                                    if (ArrGLDetailRCM[i].type == "VRCM") {
                                        Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGLDetailRCM[i].type, ArrGLDetailRCM[i].acc_name
                                            , ArrGLDetailRCM[i].acc_id, ArrGLDetailRCM[i].Value, ArrGLDetailRCM[i].ValueInBase, 0, 0
                                            , vouType, ArrGLDetailRCM[0].curr_id, ArrGLDetailRCM[0].conv_rate
                                            , ArrGLDetailRCM[0].bill_no, ArrGLDetailRCM[0].bill_dt, ArrGLDetailRCM[0].gst_cat, ArrGLDetailRCM[i].i_capg
                                        )
                                    } else {
                                        Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGLDetailRCM[i].type, ArrGLDetailRCM[i].acc_name
                                            , ArrGLDetailRCM[i].acc_id, 0, 0, ArrGLDetailRCM[i].Value, ArrGLDetailRCM[i].ValueInBase
                                            , vouType, ArrGLDetailRCM[0].curr_id, ArrGLDetailRCM[0].conv_rate
                                            , ArrGLDetailRCM[0].bill_no, ArrGLDetailRCM[0].bill_dt, ArrGLDetailRCM[0].gst_cat, ArrGLDetailRCM[i].i_capg
                                        )
                                    }

                                }
                                $("#tr_GlRow" + (j + 1) + " #td_SrNo").attr("rowspan", rowSpan);
                                $("#tr_GlRow" + (j + 1) + " #td_VouType").attr("rowspan", rowSpan);
                                $("#tr_GlRow" + (j + 1) + " #td_VouNo").attr("rowspan", rowSpan);
                                $("#tr_GlRow" + (j + 1) + " #td_VouDate").attr("rowspan", rowSpan);
                            }
                        }
                    }
                    else if (doc_type == "Sales") {
                        var cust_acc_id = supp_acc_id
                        if (arr.Table.length > 0) {
                            $('#VoucherDetail tbody tr').remove();
                            var arrSupp = arr.Table.filter(v => (v.type == "Cust" || v.type == "Bank" || v.type == "Supp" || v.type == "TSupp" || v.type == "TCust"));/*chnges for tds on OC for TSupp  by hina sharma on 09-07-2024*/
                            var mainSuppGl = arrSupp.filter(v => v.acc_id == cust_acc_id);
                            var TdsSuppGl = arrSupp.filter(v => v.acc_id == cust_acc_id && v.type == "TCust");/*chnges for tds on OC for TSupp  by hina sharma on 09-07-2024*/
                            var NewArrSupp = arrSupp.filter(v => v.acc_id != cust_acc_id).sort((a, b) => a.acc_id - b.acc_id/*chnges for tds on Oc for sort acc_id by hina sharma on 09-07-2024*/);
                            if (TdsSuppGl.length > 0) {/*chnges for tds on OC by hina sharma on 09-07-2024*/
                                NewArrSupp.unshift(TdsSuppGl[0]);
                            }
                            NewArrSupp.unshift(mainSuppGl[0]);
                            arrSupp = NewArrSupp;
                            for (var j = 0; j < arrSupp.length; j++) {
                                let cust_id = arrSupp[j].id;
                                let supp_type = arrSupp[j].type;/*chnges for tds on OC by hina sharma on 09-07-2024*/
                                let supp_bill_no = arrSupp[j].bill_no;
                                let supp_bill_dt = arrSupp[j].bill_dt;

                                //let arrDetail = arr.Table.filter(v => (v.id == cust_id && (v.type == "Cust" || v.type == "Bank" || v.type == "Supp")));
                                //let arrDetailDr = arr.Table.filter(v => (v.parent == cust_id && v.type != "OcTax"));
                                let arrDetailDr;
                                if (supp_type == "TSupp") {  /*chnges for tds on OC by hina sharma on 09-07-2024*/
                                    arrDetail = arr.Table.filter(v => (v.id == cust_id && (v.type == "TSupp")));
                                    arrDetailDr = arr.Table.filter(v => (v.parent == cust_id && v.type == "Tds"));
                                }
                                else if (supp_type == "TCust") {  /*chnges for tds on OC by Suraj Maurya on 24-01-2025*/
                                    arrDetail = arr.Table.filter(v => (v.id == cust_id && (v.type == "TCust")));
                                    arrDetailDr = arr.Table.filter(v => (v.parent == cust_id && v.type == "Tcs"));
                                }
                                else {
                                    arrDetail = arr.Table.filter(v => (v.id == cust_id && (v.type == "Cust" || v.type == "Bank" || v.type == "Supp") && v.bill_no == supp_bill_no && v.bill_dt == supp_bill_dt));
                                    arrDetailDr = arr.Table.filter(v => (v.parent == cust_id && v.type != "OcTax" && v.type != "Tds" && v.type != "Tcs" && v.bill_no == supp_bill_no && v.bill_dt == supp_bill_dt));
                                }

                                let RcmValue = 0;
                                let RcmValueInBase = 0;
                                if (supp_type != "TSupp" && supp_type != "TCust") { /* chnges for tds on OC by hina sharma on 10-07-2024 */
                                    arr.Table.filter(v => (v.parent == cust_id && v.type == "RCM"))
                                        .map((res) => {
                                            RcmValue = RcmValue + res.Value;
                                            RcmValueInBase = RcmValueInBase + res.ValueInBase;
                                        });
                                }
                                arrDetail[0].Value = arrDetail[0].Value - RcmValue;
                                arrDetail[0].ValueInBase = arrDetail[0].ValueInBase - RcmValueInBase;

                                let rowSpan = 1;//arrDetailDr.length + 1;
                                let GlRowNo = 1;
                                // First Row Generated here for all GL Voucher 
                                let vouType = "";
                                if (arrDetail[0].type == "TSupp" || arrDetail[0].type == "TCust")  /*chnges for tds on OC by hina sharma on 10-07-2024*/
                                    vouType = "DN"
                                if (arrDetail[0].type == "Cust")
                                    vouType = "SV"
                                if (arrDetail[0].type == "Supp")
                                    vouType = "PV"
                                if (arrDetail[0].type == "Bank")
                                    vouType = "BP"

                                if (vouType == "DN") {  /*chnges for tds on OC by hina sharma on 10-07-2024*/
                                    Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, arrDetail[0].type, arrDetail[0].acc_name, arrDetail[0].acc_id
                                        , arrDetail[0].Value, arrDetail[0].ValueInBase, 0, 0, vouType, arrDetail[0].curr_id
                                        , arrDetail[0].conv_rate, arrDetail[0].bill_no, arrDetail[0].bill_dt, arrDetail[0].gst_cat);
                                }
                                else if (vouType == "SV") {
                                    Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, arrDetail[0].type, arrDetail[0].acc_name, arrDetail[0].acc_id
                                        , arrDetail[0].Value, arrDetail[0].ValueInBase, 0, 0, vouType, arrDetail[0].curr_id
                                        , arrDetail[0].conv_rate, arrDetail[0].bill_no, arrDetail[0].bill_dt, arrDetail[0].gst_cat);
                                }
                                else {
                                    Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, arrDetail[0].type, arrDetail[0].acc_name, arrDetail[0].acc_id
                                        , 0, 0, arrDetail[0].Value, arrDetail[0].ValueInBase, vouType, arrDetail[0].curr_id
                                        , arrDetail[0].conv_rate, arrDetail[0].bill_no, arrDetail[0].bill_dt, arrDetail[0].gst_cat);
                                }
                                let ArrTax = [];
                                let ArrGlDetailsDr = [];
                                for (var k = 0; k < arrDetailDr.length; k++) {
                                    let getAccIndex = ArrGlDetailsDr.findIndex(v => v.acc_id == arrDetailDr[k].acc_id);
                                    if (getAccIndex > -1) {
                                        ArrGlDetailsDr[getAccIndex].Value = parseFloat(ArrGlDetailsDr[getAccIndex].Value) + parseFloat(arrDetailDr[k].Value)
                                        ArrGlDetailsDr[getAccIndex].ValueInBase = parseFloat(ArrGlDetailsDr[getAccIndex].ValueInBase) + parseFloat(arrDetailDr[k].ValueInBase)
                                    }
                                    else {
                                        if (arrDetailDr[k].type == "Tax") {
                                            let getAccIndex = ArrTax.findIndex(v => v.acc_id == arrDetailDr[k].acc_id);
                                            if (getAccIndex > -1) {
                                                ArrTax[getAccIndex].Value = parseFloat(ArrTax[getAccIndex].Value) + parseFloat(arrDetailDr[k].Value)
                                                ArrTax[getAccIndex].ValueInBase = parseFloat(ArrTax[getAccIndex].ValueInBase) + parseFloat(arrDetailDr[k].ValueInBase)
                                            } else {
                                                ArrTax.push(arrDetailDr[k]);
                                            }
                                        }
                                        else if (arrDetailDr[k].type == "OcTax") {
                                        }
                                        else {
                                            ArrGlDetailsDr.push(arrDetailDr[k]);
                                        }
                                    }
                                    if (arrDetailDr[k].type == "OC") {

                                        let arrDetailOCDr = arr.Table.filter(v => (v.parent == arrDetailDr[k].oc_id && v.type == "OcTax"));
                                        // Grouping the similer tax account
                                        for (var l = 0; l < arrDetailOCDr.length; l++) {

                                            let getAccIndex = ArrTax.findIndex(v => v.acc_id == arrDetailOCDr[l].acc_id);
                                            if (getAccIndex > -1) {
                                                ArrTax[getAccIndex].Value = parseFloat(ArrTax[getAccIndex].Value) + parseFloat(arrDetailOCDr[l].Value)
                                                ArrTax[getAccIndex].ValueInBase = parseFloat(ArrTax[getAccIndex].ValueInBase) + parseFloat(arrDetailOCDr[l].ValueInBase)
                                            } else {
                                                ArrTax.push(arrDetailOCDr[l]);
                                            }
                                        }
                                    }
                                }
                                var ArrGLDetailRCM = []
                                for (var i = 0; i < ArrGlDetailsDr.length; i++) {

                                    if (ArrGlDetailsDr[i].type == "RCM") {
                                        ArrGLDetailRCM.push(ArrGlDetailsDr[i]);

                                    } else {
                                        GlRowNo++;
                                        rowSpan++;
                                        if (ArrGlDetailsDr[i].type == "Tds" || ArrGlDetailsDr[i].type == "Tcs") {/*chnges for tds on OC by hina sharma on 10-07-2024*/
                                            Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGlDetailsDr[i].type, ArrGlDetailsDr[i].acc_name
                                                , ArrGlDetailsDr[i].acc_id, 0, 0, ArrGlDetailsDr[i].Value, ArrGlDetailsDr[i].ValueInBase,
                                                vouType, ArrGlDetailsDr[0].curr_id, ArrGlDetailsDr[0].conv_rate
                                                , ArrGlDetailsDr[0].bill_no, ArrGlDetailsDr[0].bill_dt, ArrGlDetailsDr[0].gst_cat
                                            )
                                        }
                                        else if (vouType == "SV") {
                                            //GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGlDetailsDr[i].type, ArrGlDetailsDr[i].acc_name
                                            //    , ArrGlDetailsDr[i].acc_id, 0, 0, ArrGlDetailsDr[i].Value, ArrGlDetailsDr[i].ValueInBase,
                                            //    vouType, ArrGlDetailsDr[0].curr_id, ArrGlDetailsDr[0].conv_rate
                                            //    , ArrGlDetailsDr[0].bill_no, ArrGlDetailsDr[0].bill_dt
                                            //)
                                            if (ArrGlDetailsDr[i].type == "Disc") {
                                                /*changes for Discount by Suraj Maurya 25 - 10 - 2024*/
                                                Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGlDetailsDr[i].type, ArrGlDetailsDr[i].acc_name
                                                    , ArrGlDetailsDr[i].acc_id, ArrGlDetailsDr[i].Value, ArrGlDetailsDr[i].ValueInBase, 0, 0,
                                                    vouType, ArrGlDetailsDr[0].curr_id, ArrGlDetailsDr[0].conv_rate
                                                    , ArrGlDetailsDr[0].bill_no, ArrGlDetailsDr[0].bill_dt, ArrGlDetailsDr[0].gst_cat
                                                )
                                            } else {
                                                Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGlDetailsDr[i].type, ArrGlDetailsDr[i].acc_name
                                                    , ArrGlDetailsDr[i].acc_id, 0, 0, ArrGlDetailsDr[i].Value, ArrGlDetailsDr[i].ValueInBase,
                                                    vouType, ArrGlDetailsDr[0].curr_id, ArrGlDetailsDr[0].conv_rate
                                                    , ArrGlDetailsDr[0].bill_no, ArrGlDetailsDr[0].bill_dt, ArrGlDetailsDr[0].gst_cat
                                                )
                                            }
                                        }
                                        else {
                                            Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGlDetailsDr[i].type, ArrGlDetailsDr[i].acc_name
                                                , ArrGlDetailsDr[i].acc_id, ArrGlDetailsDr[i].Value, ArrGlDetailsDr[i].ValueInBase, 0, 0,
                                                vouType, ArrGlDetailsDr[0].curr_id, ArrGlDetailsDr[0].conv_rate
                                                , ArrGlDetailsDr[0].bill_no, ArrGlDetailsDr[0].bill_dt, ArrGlDetailsDr[0].gst_cat
                                            )
                                        }
                                    }
                                }
                                for (var i = 0; i < ArrTax.length; i++) {
                                    GlRowNo++;
                                    rowSpan++;
                                    // Row Generated here for Tax on Other Charge
                                    if (vouType == "SV") {
                                        Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrTax[i].type, ArrTax[i].acc_name, ArrTax[i].acc_id
                                            , 0, 0, ArrTax[i].Value, ArrTax[i].ValueInBase, vouType,
                                            ArrTax[0].curr_id, ArrTax[0].conv_rate, ArrTax[0].bill_no, ArrTax[0].bill_dt, ArrTax[0].gst_cat
                                        )
                                    }
                                    else {
                                        Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrTax[i].type, ArrTax[i].acc_name, ArrTax[i].acc_id
                                            , ArrTax[i].Value, ArrTax[i].ValueInBase, 0, 0, vouType,
                                            ArrTax[0].curr_id, ArrTax[0].conv_rate, ArrTax[0].bill_no, ArrTax[0].bill_dt, ArrTax[0].gst_cat
                                        )
                                    }
                                }
                                for (var i = 0; i < ArrGLDetailRCM.length; i++) {
                                    GlRowNo++;
                                    rowSpan++;
                                    if (vouType == "SV") {
                                        Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGLDetailRCM[i].type, ArrGLDetailRCM[i].acc_name
                                            , ArrGLDetailRCM[i].acc_id, ArrGLDetailRCM[i].Value, ArrGLDetailRCM[i].ValueInBase, 0, 0
                                            , vouType, ArrGLDetailRCM[0].curr_id, ArrGLDetailRCM[0].conv_rate
                                            , ArrGLDetailRCM[0].bill_no, ArrGLDetailRCM[0].bill_dt, ArrGLDetailRCM[0].gst_cat
                                        )
                                    }
                                    else {
                                        Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGLDetailRCM[i].type, ArrGLDetailRCM[i].acc_name
                                            , ArrGLDetailRCM[i].acc_id, 0, 0, ArrGLDetailRCM[i].Value, ArrGLDetailRCM[i].ValueInBase
                                            , vouType, ArrGLDetailRCM[0].curr_id, ArrGLDetailRCM[0].conv_rate
                                            , ArrGLDetailRCM[0].bill_no, ArrGLDetailRCM[0].bill_dt, ArrGLDetailRCM[0].gst_cat
                                        )
                                    }
                                }
                                $("#tr_GlRow" + (j + 1) + " #td_SrNo").attr("rowspan", rowSpan);
                                $("#tr_GlRow" + (j + 1) + " #td_VouType").attr("rowspan", rowSpan);
                                $("#tr_GlRow" + (j + 1) + " #td_VouNo").attr("rowspan", rowSpan);
                                $("#tr_GlRow" + (j + 1) + " #td_VouDate").attr("rowspan", rowSpan);
                            }
                        }
                    }


                    //if (arr.Table.length > 0) {
                    //    $('#VoucherDetail tbody tr').remove();
                    //    //let supp_acc_id = $("#supp_acc_id").val();
                    //    var arrSupp = arr.Table.filter(v => (v.type == "Cust" || v.type == "TSupp" || v.type == "Supp" || v.type == "Bank"));
                    //    var mainSuppGl = arrSupp.filter(v => v.acc_id == supp_acc_id && (v.type == "Supp" || v.type == "Cust"));
                    //    var TdsSuppGl = arrSupp.filter(v => v.acc_id == supp_acc_id && v.type == "TSupp");
                    //    var NewArrSupp = arrSupp.filter(v => v.acc_id != supp_acc_id).sort((a, b) => a.acc_id - b.acc_id);
                    //    if (TdsSuppGl.length > 0) {
                    //        NewArrSupp.unshift(TdsSuppGl[0]);
                    //    }
                    //    if (mainSuppGl.length > 0) {
                    //        NewArrSupp.unshift(mainSuppGl[0]);
                    //    }
                    //    arrSupp = NewArrSupp;
                    //    for (var j = 0; j < arrSupp.length; j++) {
                    //        let supp_id = arrSupp[j].id;
                    //        let supp_type = arrSupp[j].type;
                    //        let supp_bill_no = arrSupp[j].bill_no;
                    //        let supp_bill_dt = arrSupp[j].bill_dt;
                    //        let arrDetail;// = arr.Table.filter(v => (v.id == supp_id && (v.type == "Supp" || v.type == "Bank")));
                    //        //let arrDetailDr = arr.Table.filter(v => (v.parent == supp_id && (v.type == "OC" || v.type == "Itm" || v.type == "Tax" || v.type == "RCM")));
                    //        let arrDetailDr;
                    //        if (supp_type == "TSupp") {
                    //            arrDetail = arr.Table.filter(v => (v.id == supp_id && (v.type == "TSupp")));
                    //            arrDetailDr = arr.Table.filter(v => (v.parent == supp_id && v.type == "Tds"));
                    //        } else {
                    //            arrDetail = arr.Table.filter(v => (v.id == supp_id && (v.type == "Cust" || v.type == "Supp" || v.type == "Bank") && v.bill_no == supp_bill_no && v.bill_dt == supp_bill_dt));
                    //            arrDetailDr = arr.Table.filter(v => (v.parent == supp_id && v.type != "OcTax" && v.type != "Tds" && v.bill_no == supp_bill_no && v.bill_dt == supp_bill_dt));
                    //        }


                    //        let RcmValue = 0;
                    //        let RcmValueInBase = 0;
                    //        if (supp_type != "TSupp") {
                    //            arr.Table.filter(v => (v.parent == supp_id && v.type == "RCM"))
                    //                .map((res) => {
                    //                    RcmValue = RcmValue + res.Value;
                    //                    RcmValueInBase = RcmValueInBase + res.ValueInBase;
                    //                });
                    //        }

                    //        arrDetail[0].Value = arrDetail[0].Value - RcmValue;
                    //        arrDetail[0].ValueInBase = arrDetail[0].ValueInBase - RcmValueInBase;

                    //        let rowSpan = 1;//arrDetailDr.length + 1;
                    //        let GlRowNo = 1;
                    //        // First Row Generated here for all GL Voucher 
                    //        let vouType = "";
                    //        if (arrDetail[0].type == "TSupp")
                    //            vouType = "DN"
                    //        if (arrDetail[0].type == "Cust")
                    //            vouType = "SV"
                    //        if (arrDetail[0].type == "Supp")
                    //            vouType = "PV"
                    //        if (arrDetail[0].type == "Bank")
                    //            vouType = "BP"
                    //        if (vouType == "DN") {
                    //            Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, arrDetail[0].type, arrDetail[0].acc_name, arrDetail[0].acc_id
                    //                , arrDetail[0].Value, arrDetail[0].ValueInBase, 0, 0, vouType, arrDetail[0].curr_id
                    //                , arrDetail[0].conv_rate, arrDetail[0].bill_no, arrDetail[0].bill_dt);
                    //        }
                    //        else if (vouType == "SV") {
                    //            Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, arrDetail[0].type, arrDetail[0].acc_name, arrDetail[0].acc_id
                    //                , arrDetail[0].Value, arrDetail[0].ValueInBase, 0, 0, vouType, arrDetail[0].curr_id
                    //                , arrDetail[0].conv_rate, arrDetail[0].bill_no, arrDetail[0].bill_dt);
                    //        }
                    //        else {
                    //            Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, arrDetail[0].type, arrDetail[0].acc_name, arrDetail[0].acc_id
                    //                , 0, 0, arrDetail[0].Value, arrDetail[0].ValueInBase, vouType, arrDetail[0].curr_id
                    //                , arrDetail[0].conv_rate, arrDetail[0].bill_no, arrDetail[0].bill_dt);
                    //        }

                    //        let ArrTax = [];
                    //        let ArrGlDetailsDr = [];
                    //        for (var k = 0; k < arrDetailDr.length; k++) {
                    //            //GlRowNo++;
                    //            // Row Generated here for Other charge and Tax on item
                    //            let getAccIndex = ArrGlDetailsDr.findIndex(v => v.acc_id == arrDetailDr[k].acc_id);
                    //            if (getAccIndex > -1) {
                    //                ArrGlDetailsDr[getAccIndex].Value = parseFloat(ArrGlDetailsDr[getAccIndex].Value) + parseFloat(arrDetailDr[k].Value)
                    //                ArrGlDetailsDr[getAccIndex].ValueInBase = parseFloat(ArrGlDetailsDr[getAccIndex].ValueInBase) + parseFloat(arrDetailDr[k].ValueInBase)
                    //            } else {
                    //                //rowSpan++;
                    //                if (arrDetailDr[k].type == "Tax") {
                    //                    let getAccIndex = ArrTax.findIndex(v => v.acc_id == arrDetailDr[k].acc_id);
                    //                    if (getAccIndex > -1) {
                    //                        ArrTax[getAccIndex].Value = parseFloat(ArrTax[getAccIndex].Value) + parseFloat(arrDetailDr[k].Value)
                    //                        ArrTax[getAccIndex].ValueInBase = parseFloat(ArrTax[getAccIndex].ValueInBase) + parseFloat(arrDetailDr[k].ValueInBase)
                    //                    } else {
                    //                        //rowSpan++;
                    //                        ArrTax.push(arrDetailDr[k]);
                    //                    }
                    //                    // ArrTax.push(arrDetailDr[k]);
                    //                }
                    //                else if (arrDetailDr[k].type == "OcTax") {
                    //                }
                    //                else {
                    //                    ArrGlDetailsDr.push(arrDetailDr[k]);
                    //                }
                    //            }



                    //            if (arrDetailDr[k].type == "OC") {

                    //                let arrDetailOCDr = arr.Table.filter(v => (v.parent == arrDetailDr[k].oc_id && v.type == "OcTax"));
                    //                // Grouping the similer tax account
                    //                for (var l = 0; l < arrDetailOCDr.length; l++) {

                    //                    let getAccIndex = ArrTax.findIndex(v => v.acc_id == arrDetailOCDr[l].acc_id);
                    //                    if (getAccIndex > -1) {
                    //                        ArrTax[getAccIndex].Value = parseFloat(ArrTax[getAccIndex].Value) + parseFloat(arrDetailOCDr[l].Value)
                    //                        ArrTax[getAccIndex].ValueInBase = parseFloat(ArrTax[getAccIndex].ValueInBase) + parseFloat(arrDetailOCDr[l].ValueInBase)
                    //                    } else {
                    //                        //rowSpan++;
                    //                        ArrTax.push(arrDetailOCDr[l]);
                    //                    }
                    //                }
                    //                //Updating rowspan as Tax on OC added

                    //            }
                    //        }
                    //        var ArrGLDetailRCM = []
                    //        for (var i = 0; i < ArrGlDetailsDr.length; i++) {

                    //            if (ArrGlDetailsDr[i].type == "RCM") {
                    //                ArrGLDetailRCM.push(ArrGlDetailsDr[i]);

                    //            } else {
                    //                GlRowNo++;
                    //                rowSpan++;
                    //                if (ArrGlDetailsDr[i].type == "Tds") {
                    //                    Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGlDetailsDr[i].type, ArrGlDetailsDr[i].acc_name
                    //                        , ArrGlDetailsDr[i].acc_id, 0, 0, ArrGlDetailsDr[i].Value, ArrGlDetailsDr[i].ValueInBase,
                    //                        vouType, ArrGlDetailsDr[0].curr_id, ArrGlDetailsDr[0].conv_rate
                    //                        , ArrGlDetailsDr[0].bill_no, ArrGlDetailsDr[0].bill_dt
                    //                    )
                    //                }
                    //                else if (vouType == "SV") {
                    //                    Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGlDetailsDr[i].type, ArrGlDetailsDr[i].acc_name
                    //                        , ArrGlDetailsDr[i].acc_id, 0, 0, ArrGlDetailsDr[i].Value, ArrGlDetailsDr[i].ValueInBase,
                    //                        vouType, ArrGlDetailsDr[0].curr_id, ArrGlDetailsDr[0].conv_rate
                    //                        , ArrGlDetailsDr[0].bill_no, ArrGlDetailsDr[0].bill_dt
                    //                    )
                    //                }
                    //                else {
                    //                    Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGlDetailsDr[i].type, ArrGlDetailsDr[i].acc_name
                    //                        , ArrGlDetailsDr[i].acc_id, ArrGlDetailsDr[i].Value, ArrGlDetailsDr[i].ValueInBase, 0, 0,
                    //                        vouType, ArrGlDetailsDr[0].curr_id, ArrGlDetailsDr[0].conv_rate
                    //                        , ArrGlDetailsDr[0].bill_no, ArrGlDetailsDr[0].bill_dt
                    //                    )
                    //                }

                    //            }

                    //        }
                    //        for (var i = 0; i < ArrTax.length; i++) {
                    //            GlRowNo++;
                    //            rowSpan++;
                    //            // Row Generated here for Tax on Other Charge
                    //            if (vouType == "SV") {
                    //                Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrTax[i].type, ArrTax[i].acc_name, ArrTax[i].acc_id
                    //                    , 0, 0, ArrTax[i].Value, ArrTax[i].ValueInBase, vouType,
                    //                    ArrTax[0].curr_id, ArrTax[0].conv_rate, ArrTax[0].bill_no, ArrTax[0].bill_dt
                    //                )
                    //            } else {
                    //                Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrTax[i].type, ArrTax[i].acc_name, ArrTax[i].acc_id
                    //                    , ArrTax[i].Value, ArrTax[i].ValueInBase, 0, 0, vouType,
                    //                    ArrTax[0].curr_id, ArrTax[0].conv_rate, ArrTax[0].bill_no, ArrTax[0].bill_dt
                    //                )
                    //            }


                    //        }
                    //        for (var i = 0; i < ArrGLDetailRCM.length; i++) {
                    //            GlRowNo++;
                    //            rowSpan++;
                    //            if (vouType == "SV") {
                    //                Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGLDetailRCM[i].type, ArrGLDetailRCM[i].acc_name
                    //                    , ArrGLDetailRCM[i].acc_id, ArrGLDetailRCM[i].Value, ArrGLDetailRCM[i].ValueInBase, 0, 0
                    //                    , vouType, ArrGLDetailRCM[0].curr_id, ArrGLDetailRCM[0].conv_rate
                    //                    , ArrGLDetailRCM[0].bill_no, ArrGLDetailRCM[0].bill_dt
                    //                )
                    //            } else {
                    //                Cmn_GlTableRenderHtml(j + 1, GlRowNo, rowSpan, ArrGLDetailRCM[i].type, ArrGLDetailRCM[i].acc_name
                    //                    , ArrGLDetailRCM[i].acc_id, 0, 0, ArrGLDetailRCM[i].Value, ArrGLDetailRCM[i].ValueInBase
                    //                    , vouType, ArrGLDetailRCM[0].curr_id, ArrGLDetailRCM[0].conv_rate
                    //                    , ArrGLDetailRCM[0].bill_no, ArrGLDetailRCM[0].bill_dt
                    //                )
                    //            }

                    //        }
                    //        $("#tr_GlRow" + (j + 1) + " #td_SrNo").attr("rowspan", rowSpan);
                    //        $("#tr_GlRow" + (j + 1) + " #td_VouType").attr("rowspan", rowSpan);
                    //        $("#tr_GlRow" + (j + 1) + " #td_VouNo").attr("rowspan", rowSpan);
                    //        $("#tr_GlRow" + (j + 1) + " #td_VouDate").attr("rowspan", rowSpan);
                    //    }
                    //}
                }
                BindDDLAccountList();
                Cmn_CalculateVoucherTotalAmount();
            }
        }
    });

}

function Cmn_GlTableRenderHtml(SrNo, GlSrNo, rowSpan, type, acc_name, acc_id, DrValue, DrValueInBase, CrValue, CrValueInBase, VouType
    , curr_id, conv_rate, bill_bo, bill_date, gst_cat,i_capg) {
    //var ValDecDigit = $("#ValDigit").text();///Amount
    var Acc_Id = acc_id;
    acc_id_start_no = Acc_Id.toString().substring(0, 1);
    var Disable;
    if (acc_id_start_no == "3" || acc_id_start_no == "4") {
        Disable = "";
    }
    else {
        Disable = "disabled";
    }
    if (parseFloat(DrValue) < 0) {
        CrValue = Math.abs(DrValue);
        DrValue = 0;
    }
    if (parseFloat(DrValueInBase) < 0) {
        CrValueInBase = Math.abs(DrValueInBase);
        DrValueInBase = 0;
    }
    if (parseFloat(CrValue) < 0) {
        DrValue = Math.abs(CrValue);
        CrValue = 0;
    }
    if (parseFloat(CrValueInBase) < 0) {
        DrValueInBase = Math.abs(CrValueInBase);
        CrValueInBase = 0;
    }
    /*--------------------Added by Suraj Maurya on 08-08-2025----------------------*/

    let gl_narr = "";

    try {
        gl_narr = Get_Gl_Narration(VouType, bill_bo, bill_date, type);/*Getting GL Narration from Main Document*/
    }
    catch (ex) {
        console.log(ex);
    }


    /*--------------------Added by Suraj Maurya on 08-08-2025 End----------------------*/

    acc_name = acc_name == null ? '' : acc_name;
    let hfSrNo = $('#VoucherDetail tbody tr').length + 1;
    var FieldType = "";
   // if (type == 'Itm' && i_capg != "Y") {
    /*Added type == 'Dep_ART' by Surbhi on 12/02/2026 */
    if ((type == 'Itm' && i_capg != "Y") || (type == 'FAR')) {
        FieldType = `<div class="col-sm-11 lpo_form no-padding">
                            <select class="form-control" id="Acc_name_${hfSrNo}" onchange ="OnChangeAccountName(${hfSrNo},event)">
                              </select>
                        </div>`;
        $("#hdnAccID").val(acc_id);
    }
    else {
        FieldType = `${acc_name}`;
    }
    let Table_tds = `<td id="td_GlSrNo">${GlSrNo}</td>
                                    <td id="td_vou_sr_no" hidden>${SrNo}</td>
                                    <td id="td_GlAccName" class="no-padding">
                                        `+ FieldType + `
                                    </td>
                                    <td id="tdhdn_GlAccId" hidden>${acc_id}</td>
                                    <td class="num_right" id="dramt">${parseFloat(DrValue).toFixed(cmn_ValDecDigit)}</td>
                                    <td class="num_right" id="dramtInBase">${parseFloat(DrValueInBase).toFixed(cmn_ValDecDigit)}</td>
                                    <td class="num_right" id="cramt">${parseFloat(CrValue).toFixed(cmn_ValDecDigit)}</td>
                                    <td class="num_right" id="cramtInBase">${parseFloat(CrValueInBase).toFixed(cmn_ValDecDigit)}</td>
                                    <td class="truncate-text" id="gl_narr" style="width:350px;padding-right:30px;"><span class="editable" contenteditable="true" onpaste="return Cmn_GLNarrLength(this,event);" onkeypress="return Cmn_GLNarrLength(this,event);" >${gl_narr}</span></td>
                                    <td class="center" id="td_CC">
                                        <button type="button" ${Disable} id="BtnCostCenterDetail" onclick="Onclick_CCbtn('type',event)" class="calculator subItmImg" data-toggle="modal" data-target="#CostCenterDetail" data-backdrop="static" data-keyboard="false"><i class="fa fa-eye" aria-hidden="true" title="${$("#span_CostCenterDetail").text()}"></i></button>
                                    </td>
                                <td hidden>
                                    <input type="hidden" id="SNohf" value="${hfSrNo}" />
                                    <input type="hidden" id="gldtl_acc_gst_cat" value="${gst_cat}" />
                                    <input type="hidden" id="type" value="${type}"/>
                                    <input  type="hidden" id="txthfAccID" value="${acc_name}"/>
                                    <input  type="hidden" id="hfAccID"  value="${acc_id}" />
                                    <input  type="hidden" id="glVouType"  value="${VouType}" />
                                    <input  type="hidden" id="gl_curr_id"  value="${curr_id}" />
                                    <input  type="hidden" id="gl_conv_rate"  value="${conv_rate}" />
                                    <input  type="hidden" id="gl_bill_no"  value="${bill_bo}" />
                                    <input  type="hidden" id="gl_bill_date"  value="${bill_date}" />
                                    <input  type="hidden" id="dramt1" value="${parseFloat(DrValue).toFixed(cmn_ValDecDigit)}"/>
                                    <input  type="hidden" id="dramtInBase1" value="${parseFloat(DrValueInBase).toFixed(cmn_ValDecDigit)}"/>
                                    <input  type="hidden" id="cramt1" value="${parseFloat(CrValue).toFixed(cmn_ValDecDigit)}"/>
                                    <input  type="hidden" id="cramtInBase1" value="${parseFloat(CrValueInBase).toFixed(cmn_ValDecDigit)}"/>
                                </td>`
    if (type == "TSupp" || type == "VSupp" || type == "TCust" || type == "Supp" || type == "Cust" || type == "Bank" || type == "Dep" || type == "AST" || type == "FAR") {
        $('#VoucherDetail tbody').append(`<tr id="tr_GlRow${SrNo}">
                                <td rowspan="${rowSpan}" id="td_SrNo">${SrNo}</td>
                                `+ Table_tds + `
                                <td rowspan="${rowSpan}" id="td_VouType">${VouType}</td>
                                <td rowspan="${rowSpan}" id="td_VouNo"></td>
                                <td rowspan="${rowSpan}" id="td_VouDate"></td>
                                
                            </tr>`)
    } else {
        $('#VoucherDetail tbody').append(`<tr>
                                     `+ Table_tds + `
                                </tr>`)

    }
    /*type == "Dep" || type == "AST" added by Surbhi on 10/12/2025 for Depreciation Process*/
}
function Cmn_GLNarrKeepSpanAlive() {/* Created by Suraj Maurya on 01-09-2025 */
    document.querySelectorAll("#VoucherDetail > tbody >tr td span.editable").forEach(span => {

        span.addEventListener("input", () => {
            debugger;
            if (span.innerText.trim() === "") {
                span.innerHTML = "\u200B"; // invisible char keeps span alive
            }
            console.log("Final content:", this.textContent);

        });

    });
    
}
// helper: get selected text length inside element
function Cmn_GetSelectedTextLength(el) {/* Created by Suraj Maurya on 01-09-2025 */
    let sel = window.getSelection();
    if (!sel.rangeCount) return 0;
    let range = sel.getRangeAt(0);
    if (!el.contains(range.startContainer)) return 0;
    return range.toString().length;
}
function Cmn_KeyPressMaxLengthCheck(el, evt, maxLength) {/* Created by Suraj Maurya on 01-09-2025 */
    // Allow control keys (backspace, delete, arrows, etc.)
    if (evt.key.length > 1) return true;

    let selectedLen = Cmn_GetSelectedTextLength(el);
    let currentLen = el.textContent.length;
    let newLen = currentLen - selectedLen + 1; // +1 for the new char

    if (newLen > maxLength) {
        evt.preventDefault();
        return false;
    }
    return true;
}
function Cmn_OnPasteMaxLengthCheck(el, evt, maxLength) {/* Created by Suraj Maurya on 01-09-2025 */
    evt.preventDefault();
    let text = evt.clipboardData.getData("text/plain");

    let selectedLen = Cmn_GetSelectedTextLength(el);
    let currentLen = el.textContent.length;
    let newLen = currentLen - selectedLen + text.length;

    if (newLen > maxLength) {
        let available = maxLength - (currentLen - selectedLen);
        text = text.substr(0, available);
    }

    // Insert at caret (modern + fallback)
    if (document.queryCommandSupported("insertText")) {
        document.execCommand("insertText", false, text);
    } else {
        let sel = window.getSelection();
        if (!sel.rangeCount) return false;
        let range = sel.getRangeAt(0);
        range.deleteContents();
        range.insertNode(document.createTextNode(text));
    }
    return true;
}

function Cmn_GLNarrLength(el, evt) {/* Created by Suraj Maurya on 01-09-2025 */

    let maxLength = 270;/* 30 Charectors is reserved for cancellation Narration */

    let content = el.textContent || "";
    let countInvNo = (content.toLocaleLowerCase().match(/\{inv_no\}/g) || []).length;

    if (countInvNo>0)
        maxLength = maxLength - (countInvNo + 1) * 12;

    // --- Handle typing ---
    if (evt.type === "keypress") {
        if (!Cmn_KeyPressMaxLengthCheck(el, evt, maxLength)) {
            return false;
        }
    }

    // --- Handle paste ---
    if (evt.type === "paste") {
        let text = evt.clipboardData.getData("text/plain");
        let countInvNo = (text.toLocaleLowerCase().match(/\{inv_no\}/g) || []).length;
        if (countInvNo > 0)
            maxLength = maxLength - (countInvNo) * 12;

        if (!Cmn_OnPasteMaxLengthCheck(el, evt, maxLength)) {
            return false;
        };
    }
}

async function Cmn_CalculateVoucherTotalAmount() {

    var DrTotAmt = parseFloat(0).toFixed(cmn_ValDecDigit);
    var DrTotAmtInBase = parseFloat(0).toFixed(cmn_ValDecDigit);
    var CrTotAmt = parseFloat(0).toFixed(cmn_ValDecDigit);
    var CrTotAmtInBase = parseFloat(0).toFixed(cmn_ValDecDigit);

    var VouDrCrList = [];
    $("#VoucherDetail >tbody >tr").each(function (index) {
        //
        var currentRow = $(this);
        var vou_sr_no = currentRow.find("#td_vou_sr_no").text();
        var dr_amt = currentRow.find("#dramt").text();
        var cr_amt = currentRow.find("#cramt").text()
        var dr_amt_bs = currentRow.find("#dramtInBase").text()
        var cr_amt_bs = currentRow.find("#cramtInBase").text()

        var getVouIndex = VouDrCrList.findIndex(m => m.vou_sr_no == vou_sr_no);
        if (getVouIndex > -1) {
            VouDrCrList[getVouIndex].dr_in_sp = parseFloat(parseFloat(VouDrCrList[getVouIndex].dr_in_sp) + parseFloat(dr_amt)).toFixed(cmn_ValDecDigit);
            VouDrCrList[getVouIndex].dr_in_base = parseFloat(parseFloat(VouDrCrList[getVouIndex].dr_in_base) + parseFloat(dr_amt_bs)).toFixed(cmn_ValDecDigit);
            VouDrCrList[getVouIndex].cr_in_sp = parseFloat(parseFloat(VouDrCrList[getVouIndex].cr_in_sp) + parseFloat(cr_amt)).toFixed(cmn_ValDecDigit);
            VouDrCrList[getVouIndex].cr_in_base = parseFloat(parseFloat(VouDrCrList[getVouIndex].cr_in_base) + parseFloat(cr_amt_bs)).toFixed(cmn_ValDecDigit);
            VouDrCrList[getVouIndex].vou_entries = VouDrCrList[getVouIndex].vou_entries + 1;
        } else {
            VouDrCrList.push({
                vou_sr_no: vou_sr_no
                , dr_in_sp: dr_amt, dr_in_base: dr_amt_bs
                , cr_in_sp: cr_amt, cr_in_base: cr_amt_bs, vou_entries: 1, all_previous_entries: index
            });
        }
    });

    var flag_check_diff = "N";
    VouDrCrList.map((item, index) => {
        DrTotAmt = parseFloat(DrTotAmt) + parseFloat(item.dr_in_sp);
        DrTotAmtInBase = parseFloat(DrTotAmtInBase) + parseFloat(item.dr_in_base);
        CrTotAmt = parseFloat(CrTotAmt) + parseFloat(item.cr_in_sp);
        CrTotAmtInBase = parseFloat(CrTotAmtInBase) + parseFloat(item.cr_in_base);

        if (parseFloat(item.dr_in_base) != parseFloat(item.cr_in_base)) {

            if (Math.abs(parseFloat(item.dr_in_base) - parseFloat(item.cr_in_base)) < 1) {
                flag_check_diff = "Y";
            }

        }
    });

    $("#DrTotal").text(parseFloat(DrTotAmt).toFixed(cmn_ValDecDigit));
    $("#DrTotalInBase").text(parseFloat(DrTotAmtInBase).toFixed(cmn_ValDecDigit));
    $("#CrTotal").text(parseFloat(CrTotAmt).toFixed(cmn_ValDecDigit));
    $("#CrTotalInBase").text(parseFloat(CrTotAmtInBase).toFixed(cmn_ValDecDigit));

    if (flag_check_diff == "Y") {
        await Cmn_AddRoundOffGL();
    }

}
async function Cmn_AddRoundOffGL() {

    //var ValDecDigit = $("#ValDigit").text();///Amount
    var docMenuId = $("#DocumentMenuId").val();
    var curr_id = "";
    var conv_rate = "";
    if (docMenuId == "105101140125") {
        curr_id = $("#ddlCurrency").val();
        conv_rate = $("#conv_rate").val();
    }
    //if (docMenuId == "105101150") {
    //    curr_id = $("#Hdn_ddlCurrency").val();
    //    conv_rate = $("#conv_rate").val();
    //}
    await $.ajax({
        type: "POST",
        url: "/ApplicationLayer/SalesReturn/GetRoundOffGLDetails",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        async: true,
        data: JSON.stringify({}),
        success: function (data) {

            if (data == 'ErrorPage') {
                //SI_ErrorPage();
                Comn_ErrorPage();
                return false;
            }
            if (data !== null && data !== "") {
                var arr = [];
                arr = JSON.parse(data);

                if (arr.Table.length > 0) {
                    //-------------

                    var VouDrCrList = [];
                    $("#VoucherDetail >tbody >tr").each(function (index) {
                        //
                        var currentRow = $(this);
                        var vou_sr_no = currentRow.find("#td_vou_sr_no").text();
                        var dr_amt = currentRow.find("#dramt").text();
                        var cr_amt = currentRow.find("#cramt").text()
                        var dr_amt_bs = currentRow.find("#dramtInBase").text()
                        var cr_amt_bs = currentRow.find("#cramtInBase").text()
                        var gl_curr_id = currentRow.find("#gl_curr_id").val()
                        var gl_conv_rate = currentRow.find("#gl_conv_rate").val()
                        var gl_bill_no = currentRow.find("#gl_bill_no").val()
                        var gl_bill_date = currentRow.find("#gl_bill_date").val()
                        var glVouType = currentRow.find("#glVouType").val()

                        var getVouIndex = VouDrCrList.findIndex(m => m.vou_sr_no == vou_sr_no);
                        if (getVouIndex > -1) {
                            VouDrCrList[getVouIndex].dr_in_sp = parseFloat(parseFloat(VouDrCrList[getVouIndex].dr_in_sp) + parseFloat(dr_amt)).toFixed(cmn_ValDecDigit);
                            VouDrCrList[getVouIndex].dr_in_base = parseFloat(parseFloat(VouDrCrList[getVouIndex].dr_in_base) + parseFloat(dr_amt_bs)).toFixed(cmn_ValDecDigit);
                            VouDrCrList[getVouIndex].cr_in_sp = parseFloat(parseFloat(VouDrCrList[getVouIndex].cr_in_sp) + parseFloat(cr_amt)).toFixed(cmn_ValDecDigit);
                            VouDrCrList[getVouIndex].cr_in_base = parseFloat(parseFloat(VouDrCrList[getVouIndex].cr_in_base) + parseFloat(cr_amt_bs)).toFixed(cmn_ValDecDigit);
                            VouDrCrList[getVouIndex].vou_entries = VouDrCrList[getVouIndex].vou_entries + 1;
                        } else {
                            VouDrCrList.push({
                                vou_sr_no: vou_sr_no
                                , dr_in_sp: dr_amt, dr_in_base: dr_amt_bs
                                , cr_in_sp: cr_amt, cr_in_base: cr_amt_bs
                                , vou_entries: 1, all_previous_entries: index
                                , gl_curr_id: gl_curr_id, gl_conv_rate: gl_conv_rate
                                , gl_bill_no: gl_bill_no, gl_bill_date: gl_bill_date
                                , glVouType: glVouType
                            });
                        }
                    });
                    debugger
                    var CountEntries = 0;
                    VouDrCrList.map((item, index) => {

                        if (Math.abs(parseFloat(item.cr_in_base) - parseFloat(item.dr_in_base)) < 1) {
                            if (parseFloat(item.dr_in_base) != parseFloat(item.cr_in_base)) {
                                if (parseFloat(item.dr_in_base) < parseFloat(item.cr_in_base)) {
                                    var Diff = parseFloat(item.cr_in_sp) - parseFloat(item.dr_in_sp);
                                    var DiffInBase = parseFloat(item.cr_in_base) - parseFloat(item.dr_in_base);

                                    var rowIdx = $('#VoucherDetail tbody tr').length;
                                    for (var j = 0; j < arr.Table.length; j++) {
                                        if (arr.Table[j].acc_id != "" && arr.Table[j].acc_id != "0" && arr.Table[j].acc_id != null) {
                                            var SrRows = $('#VoucherDetail > tbody > tr > #td_SrNo');
                                            GlSrNo = SrRows[index].textContent;
                                            let spanRowCount = 1;
                                            $('#VoucherDetail > tbody > tr > #td_vou_sr_no').each(function () {
                                                var row = $(this);
                                                if (row.text() == item.vou_sr_no) {
                                                    spanRowCount++;
                                                }
                                            });

                                            Cmn_GlTableRenderHtml(item.vou_sr_no, spanRowCount, spanRowCount, "RO", arr.Table[j].acc_name
                                                , arr.Table[j].acc_id, Diff, DiffInBase, 0, 0, item.glVouType, item.gl_curr_id
                                                , item.gl_conv_rate, item.gl_bill_no, item.gl_bill_date, item.gst_cat)

                                            var vouRow = $('#VoucherDetail > tbody > #tr_GlRow' + item.vou_sr_no);
                                            vouRow.find("#td_SrNo").attr("rowspan", spanRowCount);
                                            vouRow.find("#td_VouType").attr("rowspan", spanRowCount);
                                            vouRow.find("#td_VouNo").attr("rowspan", spanRowCount);
                                            vouRow.find("#td_VouDate").attr("rowspan", spanRowCount);

                                            var table = document.getElementById("VoucherDetail");
                                            rows = table.tBodies[0].rows;
                                            let ib = item.all_previous_entries + item.vou_entries + CountEntries;
                                            CountEntries = CountEntries + 1;
                                            let LastRow = $('#VoucherDetail tbody tr').length;
                                            rows[ib].parentNode.insertBefore(rows[LastRow - 1], rows[ib]);
                                        }
                                    }
                                }
                                else {
                                    var Diff = parseFloat(item.dr_in_sp) - parseFloat(item.cr_in_sp);
                                    var DiffInBase = parseFloat(item.dr_in_base) - parseFloat(item.cr_in_base);
                                    var rowIdx = $('#VoucherDetail tbody tr').length;
                                    for (var j = 0; j < arr.Table.length; j++) {
                                        if (arr.Table[j].acc_id != "" && arr.Table[j].acc_id != "0" && arr.Table[j].acc_id != null) {
                                            var SrRows = $('#VoucherDetail > tbody > tr > #td_SrNo');
                                            GlSrNo = SrRows[index].textContent;
                                            let spanRowCount = 1;
                                            $('#VoucherDetail > tbody > tr > #td_vou_sr_no').each(function () {
                                                var row = $(this);
                                                if (row.text() == item.vou_sr_no) {
                                                    spanRowCount++;
                                                }
                                            });
                                            Cmn_GlTableRenderHtml(item.vou_sr_no, spanRowCount, spanRowCount, "RO", arr.Table[j].acc_name
                                                , arr.Table[j].acc_id, 0, 0, Diff, DiffInBase, item.glVouType, item.gl_curr_id
                                                , item.gl_conv_rate, item.gl_bill_no, item.gl_bill_date, item.gst_cat)

                                            var vouRow = $('#VoucherDetail tbody #tr_GlRow' + item.vou_sr_no);
                                            vouRow.find("#td_SrNo").attr("rowspan", spanRowCount);
                                            vouRow.find("#td_VouType").attr("rowspan", spanRowCount);
                                            vouRow.find("#td_VouNo").attr("rowspan", spanRowCount);
                                            vouRow.find("#td_VouDate").attr("rowspan", spanRowCount);

                                            var table = document.getElementById("VoucherDetail");
                                            rows = table.tBodies[0].rows;
                                            let ib = item.all_previous_entries + item.vou_entries + CountEntries;
                                            CountEntries = CountEntries + 1;
                                            let LastRow = $('#VoucherDetail tbody tr').length;
                                            rows[ib].parentNode.insertBefore(rows[LastRow - 1], rows[ib]);
                                        }
                                    }
                                }
                            }
                        }

                    });
                    //-------------
                    /* Commented by Suraj Maurya on 05-12-2024  */
                    //var DrTotAmt = parseFloat(0).toFixed(cmn_ValDecDigit);
                    //var CrTotAmt = parseFloat(0).toFixed(cmn_ValDecDigit);
                    //var DrTotAmtInBase = parseFloat(0).toFixed(cmn_ValDecDigit);
                    //var CrTotAmtInBase = parseFloat(0).toFixed(cmn_ValDecDigit);
                    //$("#VoucherDetail >tbody >tr").each(function () {
                    //    //
                    //    var currentRow = $(this);
                    //    if (currentRow.find("#dramt").text() == "" || currentRow.find("#dramt").text() == "NaN") {
                    //        DrTotAmt = (parseFloat(DrTotAmt) + parseFloat(0)).toFixed(cmn_ValDecDigit);
                    //    }
                    //    else {
                    //        DrTotAmt = (parseFloat(DrTotAmt) + parseFloat(currentRow.find("#dramt").text())).toFixed(cmn_ValDecDigit);
                    //    }
                    //    if (currentRow.find("#cramt").text() == "" || currentRow.find("#cramt").text() == "NaN") {
                    //        CrTotAmt = (parseFloat(CrTotAmt) + parseFloat(0)).toFixed(cmn_ValDecDigit);
                    //    }
                    //    else {
                    //        CrTotAmt = (parseFloat(CrTotAmt) + parseFloat(currentRow.find("#cramt").text())).toFixed(cmn_ValDecDigit);
                    //    }
                    //    if (currentRow.find("#dramtInBase").text() == "" || currentRow.find("#dramtInBase").text() == "NaN") {
                    //        DrTotAmtInBase = (parseFloat(DrTotAmtInBase) + parseFloat(0)).toFixed(cmn_ValDecDigit);
                    //    }
                    //    else {
                    //        DrTotAmtInBase = (parseFloat(DrTotAmtInBase) + parseFloat(currentRow.find("#dramtInBase").text())).toFixed(cmn_ValDecDigit);
                    //    }
                    //    if (currentRow.find("#cramtInBase").text() == "" || currentRow.find("#cramtInBase").text() == "NaN") {
                    //        CrTotAmtInBase = (parseFloat(CrTotAmtInBase) + parseFloat(0)).toFixed(cmn_ValDecDigit);
                    //    }
                    //    else {
                    //        CrTotAmtInBase = (parseFloat(CrTotAmtInBase) + parseFloat(currentRow.find("#cramtInBase").text())).toFixed(cmn_ValDecDigit);
                    //    }
                    //});

                    //if (parseFloat(DrTotAmtInBase) != parseFloat(CrTotAmtInBase)) {
                    //    if (parseFloat(DrTotAmtInBase) < parseFloat(CrTotAmtInBase)) {
                    //        var Diff = parseFloat(CrTotAmt) - parseFloat(DrTotAmt);
                    //        var DiffInBase = parseFloat(CrTotAmtInBase) - parseFloat(DrTotAmtInBase);
                    //        var rowIdx = $('#VoucherDetail tbody tr').length;
                    //        for (var j = 0; j < arr.Table.length; j++) {
                    //            if (arr.Table[j].acc_id != "" && arr.Table[j].acc_id != "0" && arr.Table[j].acc_id != null) {
                    //                var SrRows = $('#VoucherDetail > tbody > tr > #td_SrNo');
                    //                GlSrNo = SrRows[SrRows.length - 1].textContent;
                    //                let spanRowCount = 1;
                    //                $('#VoucherDetail > tbody > tr > #td_vou_sr_no').each(function () {
                    //                    var row = $(this);
                    //                    if (row.text() == 1) {
                    //                        spanRowCount++;
                    //                    }
                    //                });

                    //                GlTableRenderHtml(1, spanRowCount, spanRowCount, "RO", arr.Table[j].acc_name, arr.Table[j].acc_id
                    //                    , Diff, DiffInBase, 0, 0, "PV", curr_id, conv_rate
                    //                    , $("#Bill_No").val(), $("#Bill_Date").val())

                    //                var vouRow = $('#VoucherDetail tbody #tr_GlRow1');
                    //                vouRow.find("#td_SrNo").attr("rowspan", spanRowCount);
                    //                vouRow.find("#td_VouType").attr("rowspan", spanRowCount);
                    //                vouRow.find("#td_VouNo").attr("rowspan", spanRowCount);
                    //                vouRow.find("#td_VouDate").attr("rowspan", spanRowCount);

                    //                var table = document.getElementById("VoucherDetail");
                    //                rows = table.tBodies[0].rows;
                    //                let ib = spanRowCount - 1;
                    //                let LastRow = $('#VoucherDetail tbody tr').length;
                    //                rows[ib].parentNode.insertBefore(rows[LastRow - 1], rows[ib]);
                    //            }
                    //        }
                    //    }
                    //    else {
                    //        var Diff = parseFloat(DrTotAmt) - parseFloat(CrTotAmt);
                    //        var DiffInBase = parseFloat(DrTotAmtInBase) - parseFloat(CrTotAmtInBase);
                    //        var rowIdx = $('#VoucherDetail tbody tr').length;
                    //        for (var j = 0; j < arr.Table.length; j++) {
                    //            if (arr.Table[j].acc_id != "" && arr.Table[j].acc_id != "0" && arr.Table[j].acc_id != null) {
                    //                var SrRows = $('#VoucherDetail > tbody > tr > #td_SrNo');
                    //                GlSrNo = SrRows[SrRows.length - 1].textContent;
                    //                let spanRowCount = 1;
                    //                $('#VoucherDetail > tbody > tr > #td_vou_sr_no').each(function () {
                    //                    var row = $(this);
                    //                    if (row.text() == 1) {
                    //                        spanRowCount++;
                    //                    }
                    //                });
                    //                GlTableRenderHtml(1, spanRowCount, spanRowCount, "RO", arr.Table[j].acc_name, arr.Table[j].acc_id
                    //                    , 0, 0, Diff, DiffInBase, "PV", curr_id, conv_rate, $("#Bill_No").val()
                    //                    , $("#Bill_Date").val())
                    //                var vouRow = $('#VoucherDetail tbody #tr_GlRow1');
                    //                vouRow.find("#td_SrNo").attr("rowspan", spanRowCount);
                    //                vouRow.find("#td_VouType").attr("rowspan", spanRowCount);
                    //                vouRow.find("#td_VouNo").attr("rowspan", spanRowCount);
                    //                vouRow.find("#td_VouDate").attr("rowspan", spanRowCount);

                    //                var table = document.getElementById("VoucherDetail");
                    //                rows = table.tBodies[0].rows;
                    //                let ib = spanRowCount - 1;
                    //                let LastRow = $('#VoucherDetail tbody tr').length;
                    //                rows[ib].parentNode.insertBefore(rows[LastRow - 1], rows[ib]);
                    //            }
                    //        }
                    //    }

                    //}
                    /* Commented by Suraj Maurya on 05-12-2024 end */
                    Cmn_CalculateVoucherTotalAmount();
                }
            }
        }
    });
}

function Cmn_RefreshBillNoBillDateInGLDetail(supp_acc_id, bill_no, bill_dt) {
    /*This Function is Added by Suraj on 06-12-2024 to reset bill number and bill date to GL Details*/
    let change_vou_sr_no = "";
    //$('#VoucherDetail > tbody > tr #hfAccID[value="' + supp_acc_id + '"]').closest("tr").each(function () {
    $('#VoucherDetail > tbody > tr ').closest("tr").each(function () {
        let row = $(this);
        let hfAccID = row.find("#hfAccID").val();
        let vouType = row.find("#glVouType").val();
        let vou_sr_no = row.find("#td_vou_sr_no").text();
        if (hfAccID == supp_acc_id) {
            row.find("#gl_bill_no").val(bill_no);
            row.find("#gl_bill_date").val(bill_dt);
            let narr = Get_Gl_Narration(vouType, bill_no, bill_dt);
            row.find("#gl_narr span").text(narr);
        }
        else {
            if (vou_sr_no == change_vou_sr_no) {
                let narr = Get_Gl_Narration(vouType, bill_no, bill_dt);
                row.find("#gl_narr span").text(narr);
            }
        }
    });
}
/*-----------------------------------GL Setcion End------------------------------------*/

/*----------------For Get value without round off----------------------*/
function getvalwithoutroundoff(cval, adlen) {
    //
    var bval = '';
    var aval = '';
    var dflag = 'N';
    var finval = '';
    var flen = parseInt(CheckNullNumber(adlen));
    try {
        let setDecimals = 1 + raplicateChar("0", flen);
        //finval = parseFloat(cval).toFixed(adlen);
        //Modified by Suraj Maurya on 29-01-2025 to solve issue in sum of 783315.8450 and 28269.8300 showing result 811585.6749999999
        finval = (Math.round(cval * setDecimals) / setDecimals);
        //for (var i = 0; i <= value.length - 1; i++) {
        //    if (value[i] == ".") {
        //        dflag = 'Y'
        //    }
        //    if (dflag == 'Y') {
        //        if (dflag == 'Y' && value[i] != ".") {
        //            if (aval.length < flen) {
        //                aval = aval + value[i];
        //            }
        //        }
        //    }
        //    else {
        //        bval = bval + value[i];
        //    }
        //}
        //if (aval.length == 0) {
        //    finval = bval;
        //}
        //else {
        //    finval = bval + "." + aval
        //}

    }
    catch {

    }
    return finval
}
/*--------------------End-------------------------*/

/*---------------------------To Multiply Two Values---------------------------*/
/*this function is developed to solve the multiplication issue for numbers like (1495.54163*80) ,100*80.10  */
function cmn_getmultival(num1, num2) {

    var output = 0;
    num1 = CheckNullNumber(num1);
    num2 = CheckNullNumber(num2);
    return num1 * num2;
    //Commented by Suraj at 31-07-2024
    //var negative = "N";
    //if (num1 < 0 && num2 < 0) {
    //    negative = "N";
    //    num1 = num1.toString().replaceAll('-', '');
    //    num2 = num2.toString().replaceAll('-', '');
    //}
    //else if (num1 < 0 || num2 < 0) {
    //    negative = "Y";
    //    num1 = num1.toString().replaceAll('-', '');
    //    num2 = num2.toString().replaceAll('-', '');
    //}

    //var spltNum1 = num1.toString().split('.');
    //var spltNum2 = num2.toString().split('.');
    //if (spltNum1.length <= 2 && spltNum2.length <= 2) {
    //    if (spltNum1.length > 1) {
    //        if (spltNum2.length > 1) {
    //            output = spltNum1[0] * spltNum2[0] + ('0.' + spltNum1[1]) * spltNum2[0] + spltNum1[0] * ('0.' + spltNum2[1]) + ('0.' + spltNum1[1]) * ('0.' + spltNum2[1]);
    //        } else {
    //        output = spltNum1[0] * num2 + ('0.' + spltNum1[1]) * num2;
    //        }
    //    } else {
    //        if (spltNum2.length > 1) {
    //            output = num1 * spltNum2[0] + num1 * ('0.' + spltNum2[1]);
    //        } else {
    //        output = num1 * num2;
    //        }
    //    }
    //}
    //return negative=="Y" ? -output : output;
}
/*---------------------------To Multiply Two Values End---------------------------*/

/*------------------------Common Check Function For All GL Voucher--------------------------*/

function Cmn_CheckGlVoucherValidations() {
    //Created by Suraj on 19-07-2024 to validate GL Voucher Details.
    try {
        var CheckMissingGlAccount = "N";
        var CheckMissingCurrency = "N";
        var CheckDuplicateGlAccount = "N";
        var CheckDrCrGlAccount = "N";
        var CheckMultiVoucharSupport = "Y";
        var CheckRCMError = "N";
        var CheckRCMVouSrNo = "";
        var RcmDrAmt = 0;
        var RcmCrAmt = 0;
        var RcmTaxDrAmt = 0;
        var RcmTaxCrAmt = 0;

        var AccList = [];
        var VouDrCrList = [];

        var errors = [];
        var step = [];

        var errors_rcm = [];
        var step_rcm = [];

        var errors_curr = [];
        var step_curr = [];

        var DMenuId = $("#DocumentMenuId").val();
        //if (DMenuId == "105103145127" || DMenuId == "105103145125") {
        //    ValDecDigit = $("#ExpImpValDigit").text();
        //} else {
        //    ValDecDigit = $("#ValDigit").text();
        //}
        if ($("#VoucherDetail >tbody >tr").length > 0) {
            var i = 0;
            var j = 0;

            $("#VoucherDetail >tbody >tr").each(function () {
                //
                var currentRow = $(this);
                var acc_id = currentRow.find("#hfAccID").val();
                var acc_name = currentRow.find("#txthfAccID").val();
                var acc_gst_cat = currentRow.find("#gldtl_acc_gst_cat").val();
                var ddl_acc_id = acc_id;
                if (DMenuId == "105103145127") {
                    acc_name = currentRow.find("#CInv_txthfAccID").text();
                    //var Srno = currentRow.find("#SNohf").val();
                    //var type = currentRow.find("#type").val();
                    //if (type == "Itm") {
                    //    ddl_acc_id = currentRow.find("#Acc_name_" + Srno).val();
                    //}
                }
                //if (DMenuId == "105102150") {
                var Srno = currentRow.find("#SNohf").val();
                var type = currentRow.find("#type").val();
                if (type == "Itm" && currentRow.find("#td_GlAccName select").length>0) {
                    ddl_acc_id = currentRow.find("#Acc_name_" + Srno).val();
                }
                //}
                var vou_sr_no = currentRow.find("#td_vou_sr_no").text();

                if (acc_id == "" || acc_id == null || acc_id == '0' || ddl_acc_id == "" || ddl_acc_id == null || ddl_acc_id == '0'
                    || acc_name == "" || acc_name == null) {
                    CheckMissingGlAccount = "Y";
                    if (vou_sr_no != null && vou_sr_no != "") {
                        errors.push($("#GlAccountNotFountInVoucherSerialNo").text() + ' ' + vou_sr_no)
                    } else {
                        errors.push($("#GlAccountNotFountInVoucherSerialNo").text() + ' 1')
                    }
                    step.push(parseInt(i));
                    i++;
                }

                if (AccList.findIndex(m => (m.acc_id == acc_id && m.vou_sr_no.toString() == vou_sr_no.toString())) > -1) {
                    CheckDuplicateGlAccount = "Y";
                    let index = AccList.findIndex(m => m.acc_id == acc_id);
                    AccList[index].duplicate == "Y";
                }
                if (vou_sr_no == null || vou_sr_no == "") {/*vou_sr_no will be null if document is not supports Multi Voucher*/
                    CheckMultiVoucharSupport = "N";
                    var dr_amt = currentRow.find("#dramt").text();
                    var cr_amt = currentRow.find("#cramt").text()
                }
                else {

                    var dr_amt = currentRow.find("#dramt").text();
                    var cr_amt = currentRow.find("#cramt").text()
                    var dr_amt_bs = currentRow.find("#dramtInBase").text()
                    var cr_amt_bs = currentRow.find("#cramtInBase").text()
                    let curr_id = currentRow.find("#gl_curr_id").val()
                    let conv_rate = currentRow.find("#gl_conv_rate").val()
                    let gl_vou_lype = currentRow.find("#glVouType").val()
                    let hdn_gl_bill_no = currentRow.find("#gl_bill_no").val()
                    /*-------------------- Added by Suraj Maurya on 01-08-2025 for RCM Check --------------------*/
                    if (acc_gst_cat == "UR" && (type == "Supp") && (gl_vou_lype == "PV" || gl_vou_lype == "SV")) {
                        CheckRCMVouSrNo = vou_sr_no;
                    }
                    if (CheckRCMVouSrNo == vou_sr_no) {
                        //let taxAdd = false;
                        //$("#ht_Tbl_OC_Deatils tbody tr").each(function () {
                        //    if ($(this).find("#OCBillNo").text() == hdn_gl_bill_no)
                        //        taxAdd = true;

                        //})

                        if (type == "Tax" || type == "OcTax") {

                            RcmTaxDrAmt = parseFloat(parseFloat(RcmTaxDrAmt) + parseFloat(dr_amt_bs)).toFixed(cmn_ValDecDigit);
                            RcmTaxCrAmt = parseFloat(parseFloat(RcmTaxCrAmt) + parseFloat(cr_amt_bs)).toFixed(cmn_ValDecDigit);
                        }
                        if (type == "RCM") {
                            RcmDrAmt = parseFloat(parseFloat(RcmDrAmt) + parseFloat(dr_amt_bs)).toFixed(cmn_ValDecDigit);
                            RcmCrAmt = parseFloat(parseFloat(RcmCrAmt) + parseFloat(cr_amt_bs)).toFixed(cmn_ValDecDigit);
                        }
                    }
                    else {
                        if (CheckRCMVouSrNo != 0) {
                            if (RcmTaxDrAmt == RcmCrAmt && RcmTaxCrAmt == RcmDrAmt) {

                            }
                            else {
                                CheckRCMError = "Y";
                                errors_rcm.push($("#MismatchFoundInRCMEntryForVoucherSerialNumber").text() + ' ' + CheckRCMVouSrNo);
                                step_rcm.push(parseInt(j));
                                j++;
                            }
                            CheckRCMVouSrNo = 0;
                        }
                        RcmTaxDrAmt = 0;
                        RcmTaxCrAmt = 0;
                        RcmDrAmt = 0;
                        RcmCrAmt = 0;
                    }
                    /*--------------------- Added by Suraj Maurya on 01-08-2025 End -------------------*/

                    if (curr_id == "" || curr_id == null || curr_id == '0' || conv_rate == "" || conv_rate == null || conv_rate == '0') {
                        CheckMissingCurrency = "Y";
                        errors_curr.push($("#span_InvCurrDtlsFor").text() + ' ' + acc_name);
                        step_curr.push(parseInt(j));
                        j++;
                    }

                    var getVouIndex = VouDrCrList.findIndex(m => m.vou_sr_no == vou_sr_no);
                    if (getVouIndex > -1) {
                        VouDrCrList[getVouIndex].dr_in_sp = parseFloat(parseFloat(VouDrCrList[getVouIndex].dr_in_sp) + parseFloat(dr_amt)).toFixed(cmn_ValDecDigit);
                        VouDrCrList[getVouIndex].dr_in_base = parseFloat(parseFloat(VouDrCrList[getVouIndex].dr_in_base) + parseFloat(dr_amt_bs)).toFixed(cmn_ValDecDigit);
                        VouDrCrList[getVouIndex].cr_in_sp = parseFloat(parseFloat(VouDrCrList[getVouIndex].cr_in_sp) + parseFloat(cr_amt)).toFixed(cmn_ValDecDigit);
                        VouDrCrList[getVouIndex].cr_in_base = parseFloat(parseFloat(VouDrCrList[getVouIndex].cr_in_base) + parseFloat(cr_amt_bs)).toFixed(cmn_ValDecDigit);
                    } else {
                        VouDrCrList.push({
                            vou_sr_no: vou_sr_no
                            , dr_in_sp: dr_amt, dr_in_base: dr_amt_bs
                            , cr_in_sp: cr_amt, cr_in_base: cr_amt_bs
                        });
                    }
                }

                AccList.push({
                    acc_id: acc_id, acc_name: acc_name, duplicate: "N", dr_amt: dr_amt, cr_amt: cr_amt, vou_sr_no: vou_sr_no
                });

            });

            if (CheckMissingGlAccount == "Y") {

                var arrayOfErrorsToDisplay = [];
                $.each(errors, function (i, error) {
                    arrayOfErrorsToDisplay.push({ text: error });
                });
                Swal.mixin({
                    confirmButtonText: 'Ok',
                    type: "warning",
                }).queue(arrayOfErrorsToDisplay)
                    .then((result) => {
                        if (result.value) {

                        }
                    });
                return false;
            }
            if (CheckMissingCurrency == "Y") {

                var arrayOfErrorsToDisplay = [];
                $.each(errors_curr, function (i, error) {
                    arrayOfErrorsToDisplay.push({ text: error });
                });
                Swal.mixin({
                    confirmButtonText: 'Ok',
                    type: "warning",
                }).queue(arrayOfErrorsToDisplay)
                    .then((result) => {
                        if (result.value) {

                        }
                    });
                return false;
            }

            if (CheckDuplicateGlAccount == "Y") {
                swal("", $("#DuplicateGlAccountFound").text(), "warning");
                return false;
            }

            if (CheckMultiVoucharSupport == "Y") {
                //for Voucher wise validation
                var MissMatchDrCrVauchaerNos = "";
                VouDrCrList.map((data) => {
                    if (CheckDrCrGlAccount == "N") {
                        if (parseFloat(data.dr_in_base).toFixed(cmn_ValDecDigit) != parseFloat(data.cr_in_base).toFixed(cmn_ValDecDigit)) {
                            CheckDrCrGlAccount = "Y";
                            MissMatchDrCrVauchaerNos = data.vou_sr_no;
                        }
                    }
                });

                if (CheckDrCrGlAccount == "Y") {
                    $("#VoucherDetail >tbody >tr").each(function () {//To validation Color
                        let row = $(this);
                        if (row.find("#td_vou_sr_no").text() == MissMatchDrCrVauchaerNos) {
                            row.css("background-color", 'rgb(247 108 108 / 16%)')
                        }
                    });
                    swal("", $("#DebtCredtAmntMismatch").text() + ' ' + $("#span_forVoucherSerialNo").text() + ' ' + MissMatchDrCrVauchaerNos, "warning");
                    return false;
                }
                if (CheckRCMVouSrNo != 0) {
                    if (RcmTaxDrAmt == RcmCrAmt && RcmTaxCrAmt == RcmDrAmt) {

                    }
                    else {
                        CheckRCMError = "Y";
                        errors_rcm.push($("#MismatchFoundInRCMEntryForVoucherSerialNumber").text() + ' ' + CheckRCMVouSrNo);
                        step_rcm.push(parseInt(j));
                        j++;
                    }
                    CheckRCMVouSrNo = 0;
                }
                if (CheckRCMError == "Y") {

                    var arrayOfErrorsToDisplay = [];
                    $.each(errors_rcm, function (i, error) {
                        arrayOfErrorsToDisplay.push({ text: error });
                    });
                    Swal.mixin({
                        confirmButtonText: 'Ok',
                        type: "warning",
                    }).queue(arrayOfErrorsToDisplay)
                        .then((result) => {
                            if (result.value) {

                            }
                        });
                    return false;
                }
            }
            
            var DrTotal = 0;
            var CrTotal = 0;
            if (CheckMultiVoucharSupport == "Y") {
                //DrTotal =parseFloat(CheckNullNumber($("#DrTotalInBase").text())).toFixed(cmn_ValDecDigit);
                VouDrCrList.map((itm) => {
                    DrTotal = (parseFloat(DrTotal) + parseFloat(CheckNullNumber(itm.dr_in_base))).toFixed(cmn_ValDecDigit)
                    CrTotal = (parseFloat(CrTotal) + parseFloat(CheckNullNumber(itm.cr_in_base))).toFixed(cmn_ValDecDigit)
                })
                //CrTotal = parseFloat(CheckNullNumber($("#CrTotalInBase").text())).toFixed(cmn_ValDecDigit);
            }
            else {
                AccList.map((itm) => {
                    DrTotal = (parseFloat(DrTotal) + parseFloat(CheckNullNumber(itm.dr_amt))).toFixed(cmn_ValDecDigit)
                    CrTotal = (parseFloat(CrTotal) + parseFloat(CheckNullNumber(itm.cr_amt))).toFixed(cmn_ValDecDigit)
                })
                //DrTotal = parseFloat(CheckNullNumber($("#DrTotal").text())).toFixed(cmn_ValDecDigit);
                //CrTotal = parseFloat(CheckNullNumber($("#CrTotal").text())).toFixed(cmn_ValDecDigit);
            }

            if (DrTotal == CrTotal && DrTotal != parseFloat(0).toFixed(cmn_ValDecDigit) && CrTotal != parseFloat(0).toFixed(cmn_ValDecDigit)) {
            }
            else {
                swal("", $("#DebtCredtAmntMismatch").text(), "warning");
                return false;
            }

        }
        else {
            swal("", $("#GLPostingNotFound").text(), "warning");
            return false;
        }
        return true;
    }
    catch (ex) {
        console.log(ex.message);
        return false;
    }


}

/*------------------------Common Check Function For All GL Voucher End--------------------------*/

function cmn_getsumval(num1, num2, decDigit) {

    // Created by Suraj on 19-07-2024 to solve the sum issue for numbers like 1338237.3678 + 1652.7617

    //Commented by Suraj on 31-07-2024
    //var output = 0;
    //num1 = parseFloat(CheckNullNumber(num1)).toFixed(cmn_ValDecDigit);
    //num2 = parseFloat(CheckNullNumber(num2)).toFixed(cmn_ValDecDigit);
    return parseFloat(CheckNullNumber(num1)) + parseFloat(CheckNullNumber(num2));
    //var spltNum1 = num1.toString().split('.');
    //var spltNum2 = num2.toString().split('.');

    //if (spltNum1.length <= 2 || spltNum2.length <= 2) {
    //    if (spltNum1.length > 1) {
    //        output = spltNum1[0] - (- spltNum2[0]);
    //        let decAmt = "0." + spltNum1[1] - (- ("0." + spltNum2[1]));
    //        output = output - (- decAmt);
    //    } else {
    //        output = num1 - (- num2);
    //    }
    //}
    //return getvalwithoutroundoff(output, decDigit);

}
//function cmn_getsumval(num1, num2,decDigit) {

//   // Created by Suraj on 19-07-2024 to solve the sum issue for numbers like 1338237.3678 + 1652.7617

//    var output = 0;
//    num1 = parseFloat(CheckNullNumber(num1)).toFixed(cmn_ValDecDigit);
//    num2 = parseFloat(CheckNullNumber(num2)).toFixed(cmn_ValDecDigit);

//    var spltNum1 = num1.toString().split('.');
//    var spltNum2 = num2.toString().split('.');

//    if (spltNum1.length <= 2 || spltNum2.length <= 2) {
//        if (spltNum1.length > 1) {
//            output = spltNum1[0] -(- spltNum2[0]);
//            let len = spltNum1[1] -(- spltNum2[1]);
//            let splitNum = len.toString().length - spltNum2[1].length;
//            output = output -(- len.toString().splice(splitNum,0, '.'))
//        } else {
//            output = num1 - (- num2);
//        }
//    }
//    return output;

//}

function Cmn_BindVouDate(fdt, todt) {/*code written by Hina sharma on 12-11-2024 for BP,BR,CP,CR,DbtNote,CrdtNote to validate Fromdate,Todate for bill adjustment detail popup*/
    debugger

    var date = new Date(todt), y = date.getFullYear(), m = date.getMonth();
    var firstDay = new Date(y, m, 1);
    var month = (firstDay.getMonth() + 1);
    var day = firstDay.getDate();
    if (month < 10)
        month = "0" + month;
    if (day < 10)
        day = "0" + day;
    var today = firstDay.getFullYear() + '-' + month + '-' + day;
    var docid = $("#DocumentMenuId").val();

    if (fdt != "") {
        if (docid == "105104115120" || docid == "105104115110" || docid == "105104115115"
            || docid == "105104115105" || docid == "105104115130" || docid == "105104115135") {/*BP,BR,CP,CR,Debit note,credit note*/

        }
        else {
            $("#txtFromdate").val(today);
        }

    }
    else {
        if (docid == "105104115120" || docid == "105104115110" || docid == "105104115115"
            || docid == "105104115105" || docid == "105104115130" || docid == "105104115135") {/*BP,BR,CP,CR,,Debit note,credit note*/
            $("#txtTodate").val(todt);
        }
        else {
            $("#txtFromdate").val("");
            $("#txtTodate").val(todt);
        }

    }


}


/* Round off on OC. // Created by Suraj on 26-11-2024*/
function Cmn_click_Oc_chkroundoff(evt, row) {

    let clickedRow = (row != null) ? row : $(evt.target).closest('tr');

    let chk_round = clickedRow.find("#oc_chk_roundoff").is(":checked");
    let total_oc = 0;
    let oc_val = clickedRow.find("#OcAmtBs").text();
    let tax_val = clickedRow.find("#OCTaxAmt").text();

    if (chk_round) {
        var netval = (parseFloat(CheckNullNumber(oc_val)) + parseFloat(CheckNullNumber(tax_val))).toFixed(cmn_ValDecDigit);
        var fnetval = 0;
        if (parseFloat(netval) > 0) {
            var finnetval = netval.split('.');
            if (parseFloat(CheckNullNumber(finnetval[1])) > 0) {

                if (clickedRow.find("#oc_p_round").is(":checked")) {//Positive Round Off
                    var decval = '0.' + finnetval[1];
                    var faddval = 1 - parseFloat(decval);
                    fnetval = parseFloat(netval) + parseFloat(faddval);
                }
                if (clickedRow.find("#oc_m_round").is(":checked")) {//Negative Round Off
                    var decval = '0.' + finnetval[1];
                    fnetval = parseFloat(netval) - parseFloat(decval);
                }

                if (clickedRow.find("#oc_p_round").is(":checked") || clickedRow.find("#oc_m_round").is(":checked")) {
                    var roundoff_netval = Math.round(fnetval);
                    var f_netval = parseFloat(roundoff_netval).toFixed(cmn_ValDecDigit);
                    clickedRow.find("#OCTotalTaxAmt").text(f_netval);
                }
                else {//Added by Surbhi on 06/09/2025
                    clickedRow.find("#OCTotalTaxAmt").text(netval);
                }

            } else {
                clickedRow.find("#OCTotalTaxAmt").text(netval);
            }
        }

    } else {

        total_oc = parseFloat(CheckNullNumber(oc_val)) + parseFloat(CheckNullNumber(tax_val));
        clickedRow.find("#OCTotalTaxAmt").text(parseFloat(CheckNullNumber(total_oc)).toFixed(cmn_ValDecDigit));
    }
    if (row == null) {//Call this calculation only if manually clicked on Round Off.
        Calculate_OCAmount();
    }

}

function Cmn_OnClickOcRoundOffCheckBox(evt) {
    let clickedRow = $(evt.target).closest('tr');
    let chk_round = clickedRow.find("#oc_chk_roundoff").is(":checked");
    if (chk_round) {
        clickedRow.find("#oc_p_round").attr("disabled", false).attr("checked", false);
        clickedRow.find("#oc_m_round").attr("disabled", false).attr("checked", false);
    } else {
        clickedRow.find("#oc_p_round").attr("disabled", true).attr("checked", false);
        clickedRow.find("#oc_m_round").attr("disabled", true).attr("checked", false);
        Cmn_click_Oc_chkroundoff(evt);
    }

}

function Cmn_ByDefaultBranchData(tableid, TDID, checkBoxID, PageName, activeStatus) {
    /* Purpose : On Business Layer  */
    debugger;
    var LoginBR_id = $("#BrId").text();
    $(tableid + " tbody tr").each(function () {
        var branchRow = $(this);
        var pageLoadBranchID = branchRow.find(TDID).val();
        var ActiveStatus_checkBox = branchRow.find(activeStatus).val();
        if (LoginBR_id == pageLoadBranchID) {
            if (ActiveStatus_checkBox == "Y") {
                branchRow.find(checkBoxID + pageLoadBranchID).prop("checked", true);
            }
            else if (ActiveStatus_checkBox == "N") {
                branchRow.find(checkBoxID + pageLoadBranchID).prop("checked", false);
            }
            else {
                branchRow.find(checkBoxID + pageLoadBranchID).prop("checked", true);
            }
        }
        else {
            if (ActiveStatus_checkBox == "Y") {
                branchRow.find(checkBoxID + pageLoadBranchID).prop("checked", true);
            }
            else {
                branchRow.find(checkBoxID + pageLoadBranchID).prop("checked", false);
            }

        }

    })
    ReadBranchList();
}
function Cmn_OnClickIconBtnBOMDetailLevelWise(e, Level) {
    var Crow = $(e.target).closest("tr");
    debugger;
    //$("#BillOfMaterialLvl" + Level + " #PP_BOMDetail tbody tr").remove();
    var FGItemId = $("#PPLPopUp_BillOfMaterialLvl" + Level + " #Hdn_BomProductId").val();
    var ItemId = Crow.find("#hfitmid").val();
    var Mtype = Crow.find("#hfitmtypeid").val();
    Crow.find("#BillOfMaterial").val();
    if (Mtype == "IR" || Mtype == "IW"/* || Mtype == "OW"*/) {
        FGItemId = ItemId;
        ItemId = "";
    }
    if (Level == null || Level == undefined) {
        Level = 2;
    }

    $.ajax(
        {
            type: "POST",
            url: "/Common/Common/Cmn_GetSFBOMDetailsItemWise",
            data: { FGItemId: FGItemId, SFItemId: ItemId, Level: parseInt(Level) + 1 },
            //dataType: "json",
            success: function (data) {
                debugger;
                $("#PPLPopUp_BillOfMaterialLvl" + Level).html(data);

            },
        });
}
/*----------------To Create Json data to CSV-------------*/
function Cmn_arrayToCSV(arr) {
    const header = Object.keys(arr[0]); // Extract header from the first object keys
    const rows = arr.map(obj => header.map(fieldName => obj[fieldName]).join(',')); // Create rows

    return [header.join(','), ...rows].join('\n'); // Combine header and rows
}
// Create CSV content
function Cmn_CreateJsonArrayToCsv(data) {
    if (data != null && data != "") {
        const csvContent = Cmn_arrayToCSV(data);
        Cmn_downloadCSV(csvContent);
    }

}
// Function to trigger download
function Cmn_downloadCSV(content, filename = 'data.csv') {
    const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.target = '_blank';
    link.download = filename;
    link.click();
}
/*----------------To Create Json data to CSV End-------------*/

/*Added BY This Function By NItesh 29012025 1716*/
function Cmn_itemSearchPartial(flag) {
    debugger;
    $("#Btn_Search1").removeAttr("onclick", "");
    $("#ShowDataOk").removeAttr("onclick", "");
    var flag1 = flag;
    var onclick = "Cmn_ItemNameSearch('" + flag1 + "')";
    var onclickOK = "Cmn_onclickSearchItem_ShowDataOk('" + flag1 + "')";
    $("#Btn_Search1").attr("onclick", onclick);
    $("#ShowDataOk").attr("onclick", onclickOK);

    $("#spanItemName").text("");
    $("#spanItemName").css("display", "none");
    $("#SearchItemNameText").css("border-color", "#ced4da");
    $("#SearchItemNameID").val("");
    $("#SearchItemNameText").val("");

    $("#spanItemName1").text("");
    $("#spanItemName1").css("display", "none");

}
function Cmn_ItemNameSearch(flag) {

    debugger;
    var itemNameSearch = $("#SearchItemNameText").val();
    if (itemNameSearch == "" && itemNameSearch != null) {
        var Error_msg = $("#valueReq").text();
        $("#spanItemName").text(Error_msg);
        $("#spanItemName").css("display", "block");
        $("#SearchItemNameText").css("border-color", "Red");
        return false;
    }
    $.ajax({

        type: "POST",
        url: "/Common/Common/Cmn_GetItemSearch",
        dataType: "json",
        //async: true,
        data: { itemNameSearch: itemNameSearch },

        success: function (data) {
            debugger;
            /*dynamically dropdown list of all Assessment */
            if (data !== null && data !== "") /*For Chekin Json Data is return or not */ {
                var arr = [];
                arr = JSON.parse(data);/*this is use for json data braking in array type and put in a Array*/
                if (arr.length > 0) {
                    if (arr[0].item_name == "NotFoundItem") {

                        $("#spanItemName1").text("");
                        $("#spanItemName1").css("display", "none");
                        var Error_msg = $("#span_ItmNotFound").text();
                        $("#spanItemName").text(Error_msg);
                        $("#spanItemName").css("display", "block");
                        $("#SearchItemNameText").css("border-color", "Red");
                        $("#SearchItemNameID").val("");
                        /* $("#itemNameList").val("0").trigger('change');*/
                        $("#hf_ItemID").val("");
                        $("#FlagOK").val("NotOK");

                    }
                    else {
                        $("#FlagOK").val("OK");
                        var Error_msg = $("#span_ItmFound").text();

                        $("#spanItemName").text("");
                        $("#spanItemName").css("display", "none");
                        $("#spanItemName1").text(Error_msg);
                        $("#spanItemName1").css("display", "block");
                        $("#SearchItemNameText").css("border-color", "Green");
                        $("#SearchItemNameID").val(arr[0].item_id);
                        $("#SearchItemName").val(arr[0].item_name);
                    }

                }
            }
        },
        error: function (Data) {
        }
    })
}
async function Cmn_onclickSearchItem_ShowDataOk(flag) {
    debugger;

    var errorFlag = "Y";
    var FlagOK = $("#FlagOK").val();
    if (FlagOK == "NotOK") {
        errorFlag = "N";
    }
    else {
        var item_ID = $("#SearchItemNameID").val();
        var item_name = $("#SearchItemName").val();
        if (item_ID != null && item_ID != "") {
            if (flag == "ItemSearch") {
                await NullValueAllField();
                // $("#itemNameList").val(item_ID).trigger("change");
                $("#itemNameList").append(`<option value="${item_ID}">${item_name}</option>`);
                $("#itemNameList").val(item_ID).trigger("change");
                $("#hf_ItemID").val(item_ID);
                $("#SpanSerchItemID").css("display", "none");
                $("#itemNameList").css("border-color", "#ced4da");
                $("[aria-labelledby='select2-itemNameList-container']").css("border-color", "#ced4da");

            }
            else if (flag == "stkdetail" || flag == "stkdetailshfl") {
                //$("#ddlItemName").val(item_ID).trigger("change");
                $("#ddlItemName").append(`<option value="${item_ID}">${item_name}</option>`);
                $("#ddlItemName").val(item_ID).trigger("change");
            }
            else if (flag == "stkdetailConso") {
                //$("#ddlItemList").val(item_ID).trigger("change");//Commented by Suraj Maurya on 05-03-2025
                $("#ddlItemList").append(`<option value="${item_ID}">${item_name}</option>`);
                $("#ddlItemList").val(item_ID).trigger("change");
            }
            else if (flag == "stkMovement") {
                //$("#Item_name").val(item_ID).trigger("change");//Commented by Suraj Maurya on 05-03-2025
                $("#Item_name").append(`<option value="${item_ID}">${item_name}</option>`);
                $("#Item_name").val(item_ID).trigger("change");
            }

        }
        else {
            errorFlag = "N";
        }
    }

    if (errorFlag == "Y") {
        $("#ShowDataOk").attr("data-dismiss", "modal");
    }
    else {
        $("#ShowDataOk").attr("data-dismiss", "");
        return false;
    }
}

/*End NItesh 29012025 1716*/
/* -----------------Filter Table Data------------------ */
function Cmn_FilterTableData(e, tableId, txtCols) {
    /*
        Created by Suraj maurya on 13-02-2025 to filter table
        -----------------------------------------------------
        e : event
        tableId : table id
        txtCols : columns is an array like 
        [{ "FieldId": "TxtItemName", "FieldType": "input"},{ "FieldId": "TdItemName", "FieldType": "span"}
        ,{ "FieldId": "DdlName", "FieldType": "select","SrNo":"HdnSrNo"}]
        
     */
    var textValue = e.currentTarget.value.toLocaleLowerCase();
    var list = "";
    $("#" + tableId + " >tbody > tr").each(function () {
        var currentRow = $(this);
        var filterList = [];
        var listItem;
        txtCols.map((item) => {
            if (item != null && item != "") {
                if (item.FieldType == "input") {
                    listItem = currentRow.find("#" + item.FieldId).val();
                    filterList.push(listItem);
                }
                else if (item.FieldType == "select") {
                    let SrNo = item.SrNo != "" && item.SrNo != null ? currentRow.find("#" + item.SrNo).val() : "";
                    listItem = currentRow.find("#" + item.FieldId + SrNo + " option:selected").text();
                    filterList.push(listItem);
                }
                else {//default 
                    listItem = currentRow.find("#" + item.FieldId).text();
                    filterList.push(listItem);
                }
            }
        });

        if (cmn_checkfiltercolumns(filterList, textValue) == -1) {
            currentRow.attr("hidden", true);
        } else {
            currentRow.attr("hidden", false);
        }
    });
}
function cmn_checkfiltercolumns(Arr, listdt) {
    let indexs = -1
    Arr.map((res, index) => {
        indexs = res.toLocaleLowerCase().indexOf(listdt) > -1 ? res.toLocaleLowerCase().indexOf(listdt) : indexs;
    })
    return indexs;
}
/* -----------------Filter Table Data End------------------ */

function CheckUserRolePageAccess(MaterPagetype, TranctionPageName) /*Added This Function 17032025 For Page User role Setup*/ {
    debugger;
    $.ajax({
        type: "POST",
        url: "/Common/Common/CheckUserRolePageAccess",
        data: { MaterPagetype: MaterPagetype, TranctionPageName: TranctionPageName },
        dataType: "json",
        success: function (data) {
            debugger;
            data = JSON.parse(data)
            if (data == 'ErrorPage') {
                Comn_ErrorPage();
                return false;
            }
            if (data !== null && data !== "") {
                if (data.Table.length > 0) {


                    var grant_access1 = data.Table[0].grant_access
                    if (grant_access1 == "Y") {
                        if (TranctionPageName == "RFQ" || TranctionPageName == "SQ" || TranctionPageName == "SEQ") {
                            $("#Div_ProspectSetup").css("display", "block");
                        }
                        else if (TranctionPageName == "RQ") {
                            $("#Prosbtn").css("display", "block");
                        }
                        else {
                            $("#Prosbtn").css("display", "block");
                        }

                    }
                    else {
                        if (TranctionPageName == "RFQ" || TranctionPageName == "SQ" || TranctionPageName == "SEQ") {
                            $("#Div_ProspectSetup").css("display", "none");
                        }
                        else if (TranctionPageName == "RQ") {
                            $("#Prosbtn").css("display", "none");
                        }
                        else {
                            $("#Prosbtn").css("display", "none");
                        }

                    }
                }
                else {
                    if (TranctionPageName == "RFQ" || TranctionPageName == "SQ" || TranctionPageName == "SEQ") {
                        $("#Div_ProspectSetup").css("display", "none");
                    }
                    else if (TranctionPageName == "RQ") {
                        $("#Prosbtn").css("display", "none");
                    }
                    else {
                        $("#Prosbtn").css("display", "none");
                    }

                }
            }
        },
    });
}
function Cmn_RoundValue(value, round_type) {
    /* Created by Suraj Maurya on 24-03-2025 to get round value */
    if (value == null || value == "") {
        value = 0;
    }
    var fnetval = value;
    if (round_type == null || round_type == "") {
        fnetval = parseFloat(value).toFixed(0);
    }
    else {
        var netval = parseFloat(value).toFixed(cmn_ValDecDigit);
        if (parseFloat(netval) > 0) {
            var finnetval = netval.split('.');
            if (parseFloat(CheckNullNumber(finnetval[1])) > 0) {
                if (round_type == "P") {
                    var decval = '0.' + finnetval[1];
                    var faddval = 1 - parseFloat(decval);
                    fnetval = parseFloat(netval) + parseFloat(faddval);
                }
                if (round_type == "N") {
                    var decval = '0.' + finnetval[1];
                    fnetval = parseFloat(netval) - parseFloat(decval);
                }
            } else {
                fnetval = netval;
            }
        }
    }

    return fnetval

}

function Cmn_DataTableCSVFileName() {
    /*Modified By NItesh 08042025 For Add Change Excel File Name*/
    debugger;
    const Doc_id = $("#DocumentMenuId").val();

    if (Doc_id == "105102180125") {
        return $("#IssueType option:selected").text();
    }
    else if (Doc_id == "105102180120") {
        return $("#ReceiptType option:selected").text();
    }
    else {
        return $("title").text();
    }

}

/*----------------Multi Branch Selection----------------------*/
function cmn_multibranchlist(br_list) {
    //var brid_list = "";
    //if (br_list != null && br_list != "") {
    //    if (br_list.length > 0) {
    //        for (var i = 0; i < br_list.length; i++) {
    //            if (brid_list == "") {
    //                brid_list = br_list[i];
    //            }
    //            else {
    //                brid_list = brid_list + "," + br_list[i];
    //            }
    //        }
    //    }
    //}
    //else {
    //    brid_list = "";
    //}
    var brid_list = cmn_getddldataasstring("#ddl_branch"); //$("#ddl_branch option:selected").map(function () { return $(this).val(); }).get().join(",") || "";

    if (brid_list == '0' || brid_list == "" || brid_list == null) {
        $("#div_ddl_brlist .btn-group .multiselect").prop("style", "border-color: #ff0000;");
        $("#span_br").text($("#valueReq").text());
        $("#span_br").css("display", "block");
    }
    else {
        $("#div_ddl_brlist .btn-group .multiselect").prop("style", "border-color: #ced4da;");
        $("#span_br").css("display", "none");
    }

    return brid_list;
}
function cmn_onchangemultibrlist() {
    var br_list = $("#ddl_branch").val();
    cmn_multibranchlist(br_list);
}
/*----------------End Multi Branch Selection----------------------*/
//Added by Nidhi on 02-08-2025
/*-------------Added by Nidhi on 31-07-2025---------------------*/
let editingRow = null;
var Email1 = null;
function BindEmail() {
    debugger;
    $("#emailTableBody").empty();
    $("#vmEmail").text("");
    $("#Emailtxt").css("border-color", "#ced4da");
    $("#divUpdate").hide();
    var mailInput = $("#Email").val().trim();
    var emails = mailInput.split(",").map(function (email) {
        return email.trim();
    }).filter(function (email) {
        return email.length > 0;
    });

    var tableBody = $("#emailTableBody");
    var existingEmails = new Set();

    // Collect existing emails from the table
    tableBody.find("tr").each(function () {
        var rowEmail = $(this).find("td:eq(3)").text().trim().toLowerCase();
        existingEmails.add(rowEmail);
    });

    emails.forEach(function (mail) {
        if (existingEmails.has(mail.toLowerCase())) {
            return; // Skip duplicates
        }

        var rowCount = tableBody.find("tr").length + 1;
        var srNo = rowCount.toString().padStart(2,);

        var newRow = $(`
            <tr role="row">
                <td class="center sorting_1">
                    <i class="fa fa-pencil edit-btn" title="Edit" style="cursor:pointer;"></i>
                </td>
                <td class="center">
                    <i class="fa fa-trash red delete-btn" title="Delete" style="cursor:pointer;"></i>
                </td>
                <td>${srNo}</td>
                <td class="email-cell">${mail}</td>
            </tr>
        `);

        newRow.find(".edit-btn").on("click", function () {
            editingRow = $(this).closest("tr");
            var currentEmail = editingRow.find(".email-cell").text();
            $("#Emailtxt").val(currentEmail);
            $("#divUpdate").show();
            $("#addnew").hide();
            editingRow.find(".delete-btn").css("pointer-events", "none").css("opacity", "0.5").css("color", "black");
        });
        newRow.find(".delete-btn").on("click", function () {
            var row = $(this).closest("tr");
            row.remove();
            $("#emailTableBody tr").each(function (index) {
                $(this).find("td:eq(2)").text((index + 1).toString().padStart(2));
            });
            var remainingRows = $("#emailTableBody tr");
            if (remainingRows.length === 1) {
                remainingRows.find(".delete-btn").css("pointer-events", "none").css("opacity", "0.5").css("color", "black");
            }
            else {
                remainingRows.find(".delete-btn").css("pointer-events", "auto").css("opacity", "1").attr("title", "Delete");
            }
        });

        tableBody.append(newRow);
        existingEmails.add(mail.toLowerCase());
    });
    $("#Emailtxt").val('');
    //$("#Email").val('');
}
function AddNewEmailBtnClick() {
    debugger;
    if ($("#Emailtxt").val().trim() == "") {
        $("#vmEmail").text("value required");
        $("#vmEmail").addClass('right');
        $("#Emailtxt").css("border-color", "red");
        return false;
    }
    $(".delete-btn").css("pointer-events", "auto").css("opacity", "1").css("color", "#dc3545");
    var mail = $("#Emailtxt").val().trim();
    var tableBody = $("#emailTableBody");

    if (!onclickEmail()) return;

    if (!mail) return;

    // Check for duplicate email (except the row being edited)
    var isDuplicate = false;
    tableBody.find("tr").each(function () {
        var rowEmail = $(this).find(".email-cell").text().trim();
        if (rowEmail.toLowerCase() === mail.toLowerCase()) {
            if (!editingRow || editingRow.find(".email-cell").text().trim().toLowerCase() !== mail.toLowerCase()) {
                isDuplicate = true;
                return false; // break loop
            }
        }
    });

    if (isDuplicate) {
        $("#vmEmail").text("This email already exists.");
        $("#Emailtxt").css("border-color", "red");
        return;
    }
    if (editingRow) {
        // Edit mode — update existing row
        // var Row = $("#emailTableBody tr");
        // if (Row.length === 1) {
        //     Row.find(".delete-btn").css("pointer-events", "none").css("opacity", "0.5").css("color", "black");
        // }
        //else {
        //     Row.find(".delete-btn").css("pointer-events", "auto").css("opacity", "1").css("color", "#dc3545");
        // }
        editingRow.find(".email-cell").text(mail);
        editingRow = null;
        $("#Emailtxt").val("");
        $("#divUpdate").hide();
        $("#addnew").show();

        return;
    }
    var rowCount = tableBody.find("tr").length + 1;
    var srNo = rowCount.toString().padStart(2);

    var newRow = $(`
        <tr role="row">
            <td class="center sorting_1">
                <i class="fa fa-pencil edit-btn" title="Edit" style="cursor:pointer;"></i>
            </td>
            <td class="center">
                <i class="fa fa-trash red delete-btn" title="Delete" style="cursor:pointer;"></i>
            </td>
            <td>${srNo}</td>
            <td class="email-cell">${mail}</td>
        </tr>
    `);
    newRow.find(".edit-btn").on("click", function () {
        editingRow = $(this).closest("tr");
        var currentEmail = editingRow.find(".email-cell").text();
        $("#Emailtxt").val(currentEmail);
        $("#divUpdate").show();
        $("#addnew").hide();
        editingRow.find(".delete-btn").css("pointer-events", "none").css("opacity", "0.5").css("color", "black");
    });
    newRow.find(".delete-btn").on("click", function () {
        var row = $(this).closest("tr");
        if (editingRow && row.is(editingRow)) {
            return;
        }
        row.remove();
        ReorderSerialNumbers();
        editingRow = null;
    });
    tableBody.append(newRow);
    $("#Emailtxt").val("");
}
function onclickEmail() {
    var email = $("#Emailtxt").val().trim();

    var emailPattern = /^[a-zA-Z0-9_.+\-]+[\x40][a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}$/;
    if ((email !== "") && (!emailPattern.test(email))) {
        $("#vmEmail").text($('#Invalidemailformat').text());
        $("#vmEmail").addClass('right');
        $("#Emailtxt").css("border-color", "red");
        return false;
    }
    else {
        $("#vmEmail").text("");
        $("#Emailtxt").css("border-color", "#ced4da");
        return true;
    }
}
function ResetEmail() {
    var emailIds = $("#Email").val().trim();

    $("#Emailtxt").val('');
    $(".delete-btn").not(".disabled").css("pointer-events", "auto").css("opacity", "1");
    $("#vmEmail").text("");
    $("#Emailtxt").css("border-color", "#ced4da");
    $("#emailTableBody tr:gt(0)").remove();
    $("#divUpdate").hide();
    $("#addnew").show();
    BindEmail()
}
function DiscardandExit() {
    debugger;
    Email = $("#Email").val();
    $("#Emailtxt").val('');
    $("#emailTableBody tr:gt(0)").remove();
    $(".delete-btn").css("pointer-events", "auto").css("opacity", "1").css("color", "#dc3545");
    /* var Email = $("#emailTableBody tr:first td:eq(3)").text().trim();*/
    $("#Email").val(Email);
    $("#vmEmail").text("");
    $("#Emailtxt").css("border-color", "#ced4da");
    $("#divUpdate").hide();
    $("#addnew").show();
}
function ClosePopup() {
    debugger;
    $("#Email").val('');
    $("#Emailtxt").val('');
    $("#checkboxID").prop('checked', false);
    $("#showMsg").text('');
    $("#idmailstatus").text('');
    $("#emailTableBody").empty();
    $("#vmEmail").text('');
    $("#Emailtxt").css("border-color", "#ced4da");
    //$("#Emailsentsuccessfully").text('');
    //$("#SendingfailedInvalidemailbodyconfiguration").text('');
    //$("#SendingfailedInvalidsenderemailconfiguration").text('');
}
function Check() {
    debugger;
    var mail = $("#Email").val().trim();
    if ((mail != "") && ($("#checkboxID").is(":checked"))) {
        $('#btnsend').prop('disabled', false);
        $("#btnsend").css({ "-webkit-filter": "none", "filter": "none" });
    }
    else {
        $('#btnsend').prop('disabled', true);
        $("#btnsend").css({ "-webkit-filter": "grayscale(100%)", "filter": "grayscale(100%);" });
    }
}
function SaveEmail() {
    debugger
    var Email = $("#Email").val();
    var emailArray = [];
    $("#emailTableBody tr").each(function () {
        var email = $(this).find("td:eq(3)").text().trim();
        if (email) {
            emailArray.push(email);
            $('#btnsend').prop('disabled', false);
            $("#btnsend").css({ "-webkit-filter": "none", "filter": "none" });
        }
    });
    var emailString = emailArray.join(", ");
    $("#Email").val(emailString);
    $("#emailTableBody").empty();
    $("#vmEmail").text("");
    $("#Emailtxt").css("border-color", "#ced4da");
    if (!$("#checkboxID").is(":checked")) {
        $('#btnsend').prop('disabled', true);
        $("#btnsend").css({ "-webkit-filter": "grayscale(100%)", "filter": "grayscale(100%);" });
    }
    if (emailArray.length == "0") {
        $("#Email").val(Email);
        $('#btnsend').prop('disabled', true);
        $("#btnsend").css({ "-webkit-filter": "grayscale(100%)", "filter": "grayscale(100%);" })
        $('#MailView').prop('disabled', true);
    }
    if ((Email != "") && ($("#checkboxID").is(":checked"))) {
        $('#btnsend').prop('disabled', false);
        $("#btnsend").css({ "-webkit-filter": "none", "filter": "none" });
    }
    else if ((emailString != "" || Email != "") && ($("#checkboxID").is(":checked"))) {
        $("#Email").val();
        $('#btnsend').prop('disabled', true);
        $('#btnsend').prop('disabled', false);
        $("#btnsend").css({ "-webkit-filter": "none", "filter": "none" });
    }

    else {
        if (emailString == "") {
            $("#Email").val(Email1);
        }
        else {
            $("#Email").val(emailString);
        }

        $('#btnsend').prop('disabled', true);
        $("#btnsend").css({ "-webkit-filter": "grayscale(100%)", "filter": "grayscale(100%);" })
        $('#MailView').prop('disabled', true);
    }
}
function Cmn_SendEmail(DocID, Id, type) {
    debugger;
    $('#btnsend').prop('disabled', false);
    $("#btnsend").css({ "-webkit-filter": "none", "filter": "none" });
    if (DocID == "105104135115") {
        $('.tdPrintButton').hide();  // hide entire td
    }
    $('#btnsend').prop('disabled', false);
    $.ajax({
        type: "POST",
        url: "/Common/Common/GetSupplierEmail",
        data: { DocID: DocID, Id: Id, type: type },
        success: function (data) {
            var parsedData = JSON.parse(data);
            if (parsedData.length != 0) {
                var email = parsedData[0].cont_email;
                Email1 = email;
                $("#Email").val(email);
                if ((email == "") || (!$("#checkboxID").is(":checked"))) {
                    $('#btnsend').prop('disabled', true);
                    $("#btnsend").css({ "-webkit-filter": "grayscale(100%)", "filter": "grayscale(100%);" });
                    $('#MailView').prop('disabled', true);
                }
            }
        },
        error: function (xhr, status, error) {
        }
    });

}
function Cmn_ViewEmailAlert(mail_id, status, docid, Doc_no, Doc_dt, filepath) {
    debugger;
    $.ajax({
        type: "POST",
        url: "/Common/Common/ViewEmailAlert",
        data: {
            mail: mail_id,
            status: status,
            docid: docid,
            Doc_no: Doc_no,
            Doc_dt: Doc_dt,
            FilePath: filepath
        },
        success: function (data) {
            debugger;
            $("#mailview").html(data);
        },
        error: function (xhr, status, error) {
            console.error("Error", error);
        }
    });
}
function Cmn_SendEmailAlert(mail_id, status, docid, Doc_no, Doc_dt, statusAM, url, filepath, srcType, GstApplicable) {
    debugger;
    if (($("#checkboxID").is(":checked")) && (mail_id != null || mail_id != "")) {
        $('#btnsend').prop('disabled', false);
        $("#btnsend").css({ "-webkit-filter": "none", "filter": "none" });

        $.ajax({
            type: "POST",
            url: url,
            data: { mail_id: mail_id, status: status, docid: docid, Doc_no: Doc_no, Doc_dt: Doc_dt, statusAM: statusAM, filepath: filepath, srcType: srcType, GstApplicable: GstApplicable},
            success: function (data) {
                if (data == "success") {
                    $("#showMsg").text($('#Emailsentsuccessfully').text()).css("color", "green");
                    $("#idmailstatus").removeAttr("style");
                    $('#btnsend').prop('disabled', true);
                    $("#btnsend").css({ "-webkit-filter": "grayscale(100%)", "filter": "grayscale(100%);" });
                }
                if (data == "invalidemail") {
                    $("#showMsg").text($('#SendingfailedInvalidemailbodyconfiguration').text()).css("color", "red");
                }
                if (data == "invalid" || data == "ErrorInMail") {
                    $("#showMsg").text($('#SendingfailedInvalidsenderemailconfiguration').text()).css("color", "red");
                }
            },
            error: function (xhr, status, error) {
                console.error("Error", error);
            }
        });
    }
    else {
        $('#btnsend').prop('disabled', true);
        $("#btnsend").css({ "-webkit-filter": "grayscale(100%)", "filter": "grayscale(100%);" });
        swal("", "Please check the email checkbox", "warning");
    }
}
function Cmn_EmailAlertLogDetails(status, docid, Doc_no, Doc_dt) {
    debugger;
    var dateParts = Doc_dt.split("-");
    var formattedDate = dateParts[2] + "-" + dateParts[1] + "-" + dateParts[0];
    $.ajax({
        type: "POST",
        url: "/Common/Common/EmailAlertLogDetails",
        data: {
            docid: docid,
            Doc_no: Doc_no,
        },
        success: function (data) {
            $("#IdLogView").html(data);
            if (docid == "105104135115") {
                var part = Doc_no.split('_');
                Doc_no = part[0];
            }
            $("#LogDocumentNumber").val(Doc_no);
            $("#LogDocumentDate").val(formattedDate);
        },
        error: function (xhr, status, error) {
            console.error("Error", error);
        }
    });
}
function onclickmailCmnOptionPrint(type) {
    debugger;
    $("#MailPrintOption").val(type);
    var ext_mail = $("#MailPrintOption").val();
    var docid = $("#DocumentMenuId").val();
    if (ext_mail == type) {
        if (docid == "105101130" || docid == "105101135" || docid == "105101140101" || docid == "105101136") {
            $('#CmnOptionPrint').modal("show");
        }
        if (docid == "105103120" || docid == "105103145105" || docid == "105103135" || docid == "105103142" ||
            docid == "105103147" || docid == "105103125" || docid == "105103145110" || docid == "105103140" || docid == "105103148") {
            $('#SalesInvoicePrint').modal("show");
        }
        if (docid == "105101130") {
            $('#CmnOptionPrint').modal("show");
        }
        $("#btn_print").css("display", "none");
        $("#btn_mail_print").css("display", "");
    }
    else {
        $("#btn_mail_print").css("display", "none");
        $("#btn_print").css("display", "");
    }
}
//function onclickCmnOptionPrint() {
//    debugger;
//    $("#btn_mail_print").css("display", "none");
//    $("#btn_print").css("display", "");

//}
//END by Nidhi
//External Mail Alert End

/*-----------------------Srart Code add by Hina Sharma on 11-08-2025----------------*/
/*-------------------For Popup Vocher detail PDF Data Add by Hina Sharma on 07-08-2025---------------------*/
function Cmn_VocherDetailsPDF(e) {
    debugger;
    var clickedrow = $(e.target).closest("tr");
    var VouNo = clickedrow.find("#td_VouNo").text().trim();
    var VouDate = clickedrow.find("#td_VouDate").text().split("-").reverse().join("-");
    var VouType = clickedrow.find("#td_VouType").text().trim();
    //Cmn_GeneratePDFVoucherWise(VouNo, VouDate, VouType);
    debugger;
    if (VouType == "SV") {
        window.location.href = "/ApplicationLayer/SalesVoucher/GenratePdfFile?Vou_No=" + VouNo + "&Vou_Date=" + VouDate;

    }
    if (VouType == "PV") {
        window.location.href = "/ApplicationLayer/PurchaseVoucher/GenratePdfFile?Vou_No=" + VouNo + "&Vou_Date=" + VouDate;

    }
    if (VouType == "BP") {
        window.location.href = "/ApplicationLayer/BankPayment/GenratePdfFile?Vou_No=" + VouNo + "&Vou_Date=" + VouDate;

    }
    if (VouType == "DN") {
        window.location.href = "/ApplicationLayer/DebitNote/GenratePdfFile?Vou_No=" + VouNo + "&Vou_Date=" + VouDate;

    }
    if (VouType == "CN") {
        window.location.href = "/ApplicationLayer/CreditNote/GenratePdfFile?Vou_No=" + VouNo + "&Vou_Date=" + VouDate;

    }
    /*Added by Surbhi on 23/12/2025 for JV Print*/
    if (VouType == "JV") {
        window.location.href = "/ApplicationLayer/JournalVoucher/GenratePdfFile?JV_No=" + VouNo + "&JV_Date=" + VouDate;

    }
}
function CMN_BindAccountBalance(clickedrow, Acc_ID, VouDate) {/*Created by Hina Sharma on 26-08-2025*/
    debugger
    $.ajax(
        {
            type: "POST",
            url: "/Common/Common/GetAccountBalance",
            data: {
                Acc_ID: Acc_ID,
                VouDate: VouDate,
            },
            success: function (data) {
                debugger;
                if (data == 'ErrorPage') {
                    Comn_ErrorPage();
                    return false;
                }
                if (data !== null && data !== "") {
                    var arr = [];
                    arr = JSON.parse(data);
                    if (arr.Table.length > 0) {
                        clickedrow.find("#RowWiseAccBal").val(arr.Table[0].Avl_bal);
                        clickedrow.find("#hdn_RowWiseAccBal").val(arr.Table[0].Avl_bal);
                    }
                    else {
                        clickedrow.find("#RowWiseAccBal").val(parseFloat(0).toFixed(RateDecDigit));
                        clickedrow.find("#hdn_RowWiseAccBal").val(parseFloat(0).toFixed(RateDecDigit));
                    }
                }
            },
        });
}

function CancelledRemarks(id, flag) {

    $("#Cancelledremarks").attr("maxlength", "500");
    const isChecked = $(id).is(":checked");

    $("#Div_Cancelledremarks").css("display", isChecked ? "block" : "none");

    if (flag !== "Disabled") {
        $("#Cancelledremarks").attr("disabled", !isChecked);
    }
}
function Cmn_blockSpecialChars($input, safeRegex) {/* Added by Suraj Maurya on 06-09-2025 */
    // Allow only letters, numbers, and spaces (change regex if needed)
    const regex = (safeRegex != "" && safeRegex != null && safeRegex != undefined) ? safeRegex : /^[a-zA-Z0-9 _.-]*$/;// /^[a-zA-Z0-9 ,/:;'"(){}<>._]*$/;
    // Block typing
    $input.on("keypress", function (e) {
        debugger;
        const char = String.fromCharCode(e.which);
        if (!regex.test(char)) {
            e.preventDefault();
        }
    });

    // Block pasting
    $input.on("paste", function (e) {
        let pasteData = (e.originalEvent.clipboardData || window.clipboardData).getData("text");
        if (!regex.test(pasteData)) {
            e.preventDefault();
        }
    });
}
//Added by Nidhi on 13-09-25
async function Cmn_GetPdfFilePathToSendonEmailAlert(Doc_no, Doc_dt, fileName, docid, docstatus, url) {
    debugger;
    let filepath = "";
    try {
        filepath = await $.ajax({
            type: "POST",
            url: url,
            data: { Doc_no: Doc_no, Doc_dt: Doc_dt, fileName: fileName, docid: docid, docstatus: docstatus }
        });
    } catch (error) {
    }
    return filepath;
}
function Cmn_importDataToCSV(e, dt, button, config, url, csvName) { /* Added by Suraj maurya on 04-10-2025 for csv */
    let params = dt.ajax.params();
    debugger;
    // visible columns indexes
    let visibleIndexes = dt.columns(':visible').indexes().toArray();

    // Prepare array of {data: propertyName, title: headerText}
    params.ColumnsExport = visibleIndexes.map(i => {
        return {
            data: dt.settings()[0].aoColumns[i].data,
            title: $(`<span>${dt.settings()[0].aoColumns[i].sTitle}</span>`).text()
        };
    });

    // Force server to return all records (ignore pagination)
    params.start = 0;
    params.length = -1;

    // Use POST to send large data if needed
    $.ajax({
        url: url,
        type: 'POST',
        data: JSON.stringify(params),
        contentType: 'application/json',
        xhrFields: {
            responseType: 'blob' // important for file download
        },
        success: function (blob) {
            // download file
            csvName = csvName != null ? csvName : Cmn_DataTableCSVFileName();
            let link = document.createElement('a');
            let url = window.URL.createObjectURL(blob);
            link.href = url;
            link.download = csvName + '.csv';
            document.body.appendChild(link);
            link.click();
            link.remove();
            window.URL.revokeObjectURL(url);
        }
    });
}
function Cmn_ItemAliasListBind(Ddl_Id) {/* Added by Suraj maurya on 07-10-2025 */
    $("#" + Ddl_Id).select2({
        ajax: {
            type:"POST",
            url: "/Common/Common/Cmn_GetItemAliasList",
            data: function (params) {
                var queryParameters = {
                    SearchAlias: params.term,
                    page: params.page || 1
                };
                return queryParameters;
            },
            multiple: true,
            cache: true,
            processResults: function (data, params) {
                //
                debugger;
                var pageSize,
                    pageSize = 20;
                data = JSON.parse(data).Table;
                var page = params.page || 1;
                Fdata = data.slice((page - 1) * pageSize, page * pageSize);
                
                return {
                    results: $.map(Fdata, function (val, Item) {
                        return { id: val.item_alias_id, text: val.item_alias };
                    }),
                    pagination: {
                        more: (page * pageSize) < data.length
                    }
                };
            },
            cache: true
        },
        //templateResult: function (data) {

        //    var classAttr = $(data.element).attr('class');
        //    var hasClass = typeof classAttr != 'undefined';
        //    classAttr = hasClass ? ' ' + classAttr : '';
        //    var $result;
        //    $result = $(

        //        '<div ' + classAttr + '">' + data.text + '</div>'
        //    );
        //    return $result;
        //    firstEmptySelect = false;
        //},

    });
}
//function Cmn_importDataToCSV(e, dt, button, config) {/* for rows less then 10k */
//    let params = dt.ajax.params();
//    params.start = 0;
//    params.length = dt.page.info().recordsTotal;

//    $.ajax({
//        url: dt.ajax.url(),
//        type: "POST",
//        data: params,
//        success: function (json) {
//            let csvData = [];

//            // Only visible columns
//            let visibleIndexes = dt.columns(':visible').indexes().toArray();

//            // Use column titles as headers
//            let headers = visibleIndexes.map(i => dt.settings()[0].aoColumns[i].title);
//            csvData.push(headers.join(","));

//            // rows
//            json.data.forEach(row => {
//                let rowData = visibleIndexes.map(i => {
//                    let colName = dt.settings()[0].aoColumns[i].data;
//                    let text = row[colName] ?? "";
//                    // cleanup
//                    text = $('<div>').html(text).text();
//                    text = text.replace(/\n/g, '').replace(/\s+/g, ' ').trim();
//                    text = text.replace(/,/g, ''); // remove commas
//                    return text;
//                });
//                csvData.push(rowData.join(","));
//            });

//            // download CSV
//            let csvString = csvData.join("\n");
//            let blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
//            let link = document.createElement("a");
//            link.href = URL.createObjectURL(blob);
//            link.download = Cmn_CustomCsvName() + ".csv";
//            link.click();
//        }
//    });
//}


/*-----------------Start multiple section on dropdown---------------------*/
function Cmn_initializeMultiselect(selectors) {
    selectors.forEach(function (selector) {
        $(selector).multiselect({
            includeSelectAllOption: true,
            enableFiltering: true,
            enableCaseInsensitiveFiltering: true,
            SelectedText2: true,
            buttonWidth: '100%',
            buttonClass: 'btn btn-default btn-custom SourceType',
            nonSelectedText: '---All---',
            numberDisplayed:1,
            maxHeight: 200
        });
    });
}

function Cmn_initializeMultiselect_ddl_br(selectors) {
    selectors.forEach(function (selector) {
        $(selector).multiselect({
            includeSelectAllOption: true,
            enableFiltering: true,
            enableCaseInsensitiveFiltering: true,
            buttonWidth: '100%',
            buttonClass: 'btn btn-default btn-custom SourceType'
        });
    });
}
function Cmn_formatSelectedValues(values) {
    if (!values || values.length === 0) return null;
    return `${values.join(",")}`;
}
function cmn_getddldataasstring(id) {
    //debugger
    var data = $("" + id + " option:selected").map(function () {
        //return $(this).val();
        const val = this.value;
        return (val === "multiselect-all" || val === "0") ? null : val;
    }).filter(function (value) {
        return value !== null; // Filter out the null values
    }).get().join(",") || "";

    return data;
}

/*-----------------End multiple section on dropdown---------------------*/


function Cmn_OnChangeMfgMrp(e) {//Added by Suraj Maurya on 18-11-2025 for MFG MRP on Batch Details Insight
    debugger;
    var data = e.target.value;
    if (parseFloat(CheckNullNumber(data)).toFixed(cmn_RateDecDigit) == parseFloat(0).toFixed(cmn_RateDecDigit)) {
        e.target.value = "";
    }
    else {
        e.target.value = parseFloat(CheckNullNumber(data)).toFixed(cmn_RateDecDigit);
    }
}
function Cmn_OnChangeMfgName(e) {//Added by Suraj Maurya on 18-11-2025 for MFG MRP on Batch Details Insight
    debugger;
    var data = e.target.value;

    data = data.replaceAll("\\", "{\\}");
    data = data.replaceAll("\t", "");
    data = data.replaceAll("{\\}", "\\");
    e.target.value = data;
}
function Cmn_FormatDate_ddmmyyyy(date) {//Created by Suraj Maurya on 25-11-2025
    if (date != null && date != "") {
        
        date = moment(date).format('DD-MM-YYYY');
        if (date == "01-01-1900") {
            date = "";
        }
    }
    else {
        date = "";
    }
    return date;
}
function Cmn_FormatDate_ddmmmyyyy(date) {//Created by Suraj Maurya on 25-11-2025
    if (date != null && date != "") {

        date = moment(date).format('DD-MMM-YYYY');
        if (date == "01-Jan-1900") {
            date = "";
        }
    }
    else {
        date = "";
    }
    return date;
}
function Cmn_GetParameterValues() {//Added by Suraj Maurya on 09-12-2025
    $.ajax({
        type: "GET",
        url: "/Common/Common/Cmn_GetParameterValues",
        data: {},
        success: function (data) {
            var parsedData = JSON.parse(data);
            if (parsedData.length != 0) {
                parsedData.Table.map((row) => {
                    if (row.param_id == "118") {
                        $("#hdn_CostCenterDetailMandatory").text(row.param_stat);
                    }
                });

            }
        },
        error: function (xhr, status, error) {
        }
    });
}

function Cmn_GetItemStockWhLotBatchSerialWise(ItemId, ItemName, Uom) {/* Added by Suraj Maurya on 29-12-2025 */
    debugger
    var DocMenuId = $("#DocumentMenuId").val();
    $.ajax(
        {
            type: "POST",
            url: "/Common/Common/Cmn_GetItemStockWhLotBatchSerialWise",
            data: {
                ItemId: ItemId, DocMenuId: DocMenuId
            },
            success: function (data) {
                debugger;
                if (data == 'ErrorPage') {
                    Comn_ErrorPage();
                    return false;
                }
                else {
                    $("#Popup_ItemStockLotBatchSrWise").html(data);
                    $("#ItemNameBatchWise").val(ItemName);
                    $("#UOMBatchWise").val(Uom);
                    //cmn_apply_datatable("#Cmn_LBS_Detail_WhWise");

                }
            },
        });
}
function OnclickDownExcelSerial(FlagSerialExport) {
    debugger
    /*Added by NItesh 09012025 1723 For Add EXcel Imported*/
    var SerialReceivedQuantity = 0;
    var SerialRejQuantity = 0;
    var SerialReworkQuantity = 0;
    var TotalQty = 0;
    var itemNamesList = "";
    var uomList = "";
    $("#hdnImportExcelFileFlag").val(FlagSerialExport);


    if (FlagSerialExport == "GRNSerialExcel") {
        itemNamesList = $("#SerialItemName").val();
        uomList = $("#serialUOM").val();
        SerialReceivedQuantity = parseFloat($("#SerialReceivedQuantity").val());
        SerialRejQuantity = parseFloat($("#SerialRejQuantity").val());
        SerialReworkQuantity = parseFloat($("#SerialReworkQuantity").val());
        TotalQty = parseFloat(SerialReceivedQuantity) + parseFloat(SerialRejQuantity) + parseFloat(SerialReworkQuantity)
    }
    else if (FlagSerialExport == "DPISerialExcel" || FlagSerialExport == "StockTakeSerialExcel" ||
        FlagSerialExport == "ExtRcptSerialExcel" || FlagSerialExport == "OpeningRcptSerialExcel") {
        debugger
        itemNamesList = $("#SerialItemName").val();
        uomList = $("#serialUOM").val();
        SerialReceivedQuantity = parseFloat($("#SerialReceivedQuantity").val());

        TotalQty = parseFloat(SerialReceivedQuantity)
    }
    window.location.href =
        "/Common/Common/DownloadFile"
        + "?itemNamesList=" + itemNamesList
        + "&uomList=" + uomList + "&SerialReceivedQuantity=" + SerialReceivedQuantity + "&SerialRejQuantity=" + SerialRejQuantity +
        "&SerialReworkQuantity=" + SerialReworkQuantity + "&TotalQty=" + TotalQty + "&Flag=" + FlagSerialExport;

}
function OnClickImportSerialDataExcel(FlagSerialExport) {
    $("#hdnImportExcelFileFlag").val(FlagSerialExport);
}
function FetchDataSerial() {
    debugger;
    /*Added by NItesh 09012025 1723 For Add EXcel Imported*/
    var Flag = $("#hdnImportExcelFileFlag").val();
    var ItemName = $('#SerialItemName').val();
    var isfileexist = $('#ChooseSerialNofile').val();

    if (isfileexist != null && isfileexist != "") {
        FetchAndValidateDataSerial('0', ItemName, Flag);
    }
    else {
        swal("", "Please choose file", "warning");
    }
}

function SearchByUploadStatusSerial() {
    debugger;
    /*Added by NItesh 09012025 1723 For Add EXcel Imported*/
    var Flag = $("#hdnImportExcelFileFlag").val();
    var ItemName = $('#SerialItemName').val();
    var uploadStatus = $('#UploadStatusSerial').val();
    if ($('#DttblBtnsSerial tbody tr').length > 0) {
        FetchAndValidateDataSerial(uploadStatus, ItemName, Flag);
    }
}
function FetchAndValidateDataSerial(uploadStatus, ItemName, Flag) {
    debugger
    /*Added by NItesh 09012025 1723 For Add EXcel Imported*/
    var Doc_id = $("#DocumentMenuId").val();
    $(".loader1").show();
    var formData = new FormData();
    var file = $("#ChooseSerialNofile").get(0).files[0];
    formData.append("file", file);
    $('#btnImportData').prop('disabled', false);
    $('#btnImportData').css('background-color', '#007bff')
    var PName = window.location.pathname.split('/')
    //var addr = '/' + PName[1] + '/' + PName[2]
    var addr = "/Common/Common";

    var xhr = new XMLHttpRequest();
    xhr.open('POST', addr + '/ValidateExcelFile?uploadStatus=' + uploadStatus + "&ItemName=" + ItemName + "&Flag=" + Flag + "&Doc_id=" + Doc_id);
    xhr.send(formData);
    xhr.onreadystatechange = function () {
        debugger;
        if (xhr.readyState == 4 && xhr.status == 200) {
            $('#PartialImportSerialDetail').html(xhr.response);
            //$('#DttblBtns').DataTable({
            //    dom: 'l B f p',
            //    buttons: ['csv']
            //});
            cmn_apply_datatable("#DttblBtnsSerial")
            debugger;
            var responseMessage = xhr.responseText.trim().replace(/^"|"$/g, '');
            var InvalidData = parseInt($("#hdnNotOkSerial").val());
            if (responseMessage == "Excel file is empty. Please fill data in excel file and try again" || responseMessage == "ErrorPage" || InvalidData > 0) {
                $('#btnImportData').prop('disabled', true);
                $('#btnImportData').css('background-color', '#D3D3D3')
            } else {
                $('#btnImportData').prop('disabled', false);
                $('#btnImportData').css('background-color', '#007bff')
            }
        }

    }
}
function Cmn_OnClickErrorDetails(e) {
    debugger;
    /*Added by NItesh 09012025 1723 For Add EXcel Imported*/
    var clickedrow = $(e.target).closest("tr");
    var Error = clickedrow.find("#ErrorMessageSerialDataExport").text();

    var ErrorArray = Error.split(',').map(function (x) {
        return x.trim();
    }).filter(Boolean);

    $.ajax({

        type: 'POST',
        url: '/Common/Common/Cmn_GetErrorDetails',
        data: { errors: ErrorArray },
        success: function (data) {
            $("#divErrorDetail").html(data);
            $("#divErrorDetail")
                .find("#CloseBtnExportError1, #CloseBtnExportError")
                .removeAttr("data-dismiss");
        }
    });

}
$(document).on("click", "#CloseBtnExportError1, #CloseBtnExportError", function (e) {
    e.preventDefault();/*Added by NItesh 09012025 1723 For Add EXcel Imported*/
    e.stopPropagation();

    $(this).closest(".modal").modal("hide");
});

function Closemodal(btn) {
    /*Added by NItesh 09012025 1723 For Add EXcel Imported*/
    if ($.fn.DataTable.isDataTable('#DttblBtnsSerial')) {
        $('#DttblBtnsSerial').DataTable().clear().destroy();
    }
    $('#tblstatus_id').empty();
    $('#ChooseSerialNofile').val('');
    $('#btnImportData').prop('disabled', true);
    $('#btnImportData').css('background-color', '#D3D3D3')
    $("#ClosemodalPartialImportData").attr("data-dismiss", "modal");

    $(btn).closest('.modal').modal('hide');

}
function ImportDataFromSerialExcel(btn) {
    debugger;

    var FlagSerial = $("#hdnImportExcelFileFlag").val();
    var SerialReceivedQuantity = 0;
    var SerialRejQuantity = 0;
    var SerialReworkQuantity = 0;



    if (FlagSerial == "GRNSerialExcel") {
        SerialReceivedQuantity = parseFloat($("#SerialReceivedQuantity").val());
        SerialRejQuantity = parseFloat($("#SerialRejQuantity").val());
        SerialReworkQuantity = parseFloat($("#SerialReworkQuantity").val());

        var TotalQty = parseFloat(SerialReceivedQuantity) + parseFloat(SerialRejQuantity) + parseFloat(SerialReworkQuantity)
        var TotalSQty = parseFloat($("#hdnOkSerial").val());
        if (parseFloat(TotalQty) == parseFloat(TotalSQty)) {
            if ($.fn.DataTable.isDataTable('#SerialDetailTbl')) {
                $('#SerialDetailTbl').DataTable().clear().destroy();
            }
            $('#SerialDetailTbl tbody').empty();


            var rowIdx = 0;
            var table = $('#DttblBtnsSerial').DataTable();

            table.rows().every(function () {
                var currrow = $(this.node());
                var sr_no = currrow.find("#srno").text();
                var serial_no = currrow.find("#serial_no").text()
                var Qty_type = currrow.find("#Qty_type").text()
                var mgf_name = currrow.find("#mgf_name").text()
                var MRP = currrow.find("#MRP").text()
                var mgf_dt = currrow.find("#mgf_dt").text().trim();
                var mgf_dt = currrow.find("#mgf_dt").text().trim();

                // Normalize invalid values
                if (!mgf_dt || mgf_dt.toLowerCase() === "undefined") {
                    mgf_dt = "";
                }

                let mfg_date = "";
                let mfg_date1 = "";

                if (mgf_dt) {
                    var m = moment(
                        mgf_dt,
                        [
                            "DD-MM-YYYY",
                            "DD-MMM-YYYY",
                            "DD/MM/YYYY",
                            "YYYY-MM-DD",
                            "YYYY-MM-DD HH:mm:ss",
                            "YYYY-MM-DDTHH:mm:ss",
                            "YYYY-MM-DD HH:mm"
                        ],
                        true // 🔴 strict parsing
                    );

                    if (m.isValid()) {
                        mfg_date = m.format("DD-MM-YYYY");
                        mfg_date1 = m.format("YYYY-MM-DD");
                    }
                }
                var TblLen = $('#SerialDetailTbl tbody tr').length;
                $('#SerialDetailTbl tbody').append(`<tr id="R${++rowIdx}">
 <td class=" red center"> <i class="fa fa-trash deleteIcon" aria-hidden="true" id="SerialDeleteIcon" title="${$("#Span_Delete_Title").text()}"></i></td>
<td id="SerialID" >${TblLen + 1}</td>
<td id="SerialNo" >${serial_no}</td>
<td id="QtyType" >${Qty_type}</td>
<td id="sr_MfgName" >${mgf_name}</td>
<td id="sr_MRP" class="num_right">${MRP}</td>
<td id="sr_MfgDate" >${mfg_date}</td>
<td id="sr_hdn_MfgDate" hidden="hidden">${mfg_date1}</td>
</tr>`);

            })
            $('#SerialNo').val("");
            OnClickSerialDeleteIconGRN();
            $("#SerialNo").focus()
            Closemodal(btn);
        }
        else {
            swal("", $("#Serialqtydoesnotmatchwithreceivedqty").text(), "warning");
        }
    }
    else if (FlagSerial == "DPISerialExcel" || FlagSerial == "StockTakeSerialExcel" || FlagSerial == "ExtRcptSerialExcel"
        || FlagSerial == "OpeningRcptSerialExcel") {
        SerialReceivedQuantity = parseFloat($("#SerialReceivedQuantity").val());
        var TotalQty = parseFloat(SerialReceivedQuantity);
        var TotalSQty = parseFloat($("#hdnOkSerial").val());
        if (parseFloat(TotalQty) == parseFloat(TotalSQty)) {
            if ($.fn.DataTable.isDataTable('#SerialDetailTbl')) {
                $('#SerialDetailTbl').DataTable().clear().destroy();
            }
            $('#SerialDetailTbl tbody').empty();


            var rowIdx = 0;
            var table = $('#DttblBtnsSerial').DataTable();
            var srID, SerialNo, MfgName, MfgMrp, MfgDate, mfgdate1 = "";

            if (FlagSerial === "DPISerialExcel") {
                srID = "SerialID";
                SerialNo = "SerialNo";
                MfgName = "sr_MfgName";
                MfgMrp = "sr_MfgMrp";
                MfgDate = "sr_MfgDate";
                mfgdate1 = "sr_hdn_MfgDate";
            }
            else if (FlagSerial === "ExtRcptSerialExcel") {
                srID = "SerialID";
                SerialNo = "SerialNo";
                MfgName = "sr_MfgName";
                MfgMrp = "sr_MfgMrp";
                MfgDate = "sr_MfgDate";
                mfgdate1 = "sr_hdn_MfgDate";
            }
            else {
                srID = "SerialID";
                SerialNo = "SerialNo";
                MfgName = "sr_mfg_name";
                MfgMrp = "sr_mfg_mrp";
                MfgDate = "sr_mfg_date";
                mfgdate1 = "sr_mfg_hdn_date";
            }

            table.rows().every(function () {
                var currrow = $(this.node());
                var sr_no = currrow.find("#srno").text();
                var serial_no = currrow.find("#serial_no").text();
                var mgf_name = currrow.find("#mgf_name").text()
                var MRP = currrow.find("#MRP").text()
                var mgf_dt = currrow.find("#mgf_dt").text().trim();
                var mgf_dt = currrow.find("#mgf_dt").text().trim();

                // Normalize invalid values
                if (!mgf_dt || mgf_dt.toLowerCase() === "undefined") {
                    mgf_dt = "";
                }

                let mfg_date = "";
                let mfg_date1 = "";

                if (mgf_dt) {
                    var m = moment(
                        mgf_dt,
                        [
                            "DD-MM-YYYY",
                            "DD-MMM-YYYY",
                            "DD/MM/YYYY",
                            "YYYY-MM-DD",
                            "YYYY-MM-DD HH:mm:ss",
                            "YYYY-MM-DDTHH:mm:ss",
                            "YYYY-MM-DD HH:mm"
                        ],
                        true // 🔴 strict parsing
                    );

                    if (m.isValid()) {
                        mfg_date = m.format("DD-MM-YYYY");
                        mfg_date1 = m.format("YYYY-MM-DD");
                    }
                }

                var TblLen = $('#SerialDetailTbl tbody tr').length;
                var mfg_date1_val = mfg_date1 || "";

                $('#SerialDetailTbl tbody').append(`
<tr id="R${++rowIdx}">
    <td class="red center">
        <i class="fa fa-trash deleteIcon"
           aria-hidden="true"
           title="${$("#Span_Delete_Title").text()}"></i>
    </td>
    <td id="${srID}">${TblLen + 1}</td>
    <td id="${SerialNo}">${serial_no}</td>
    <td id="${MfgName}">${mgf_name}</td>
    <td id="${MfgMrp}" class="num_right">${MRP}</td>
    <td id="${MfgDate}">${mfg_date}</td>
    <td id="${mfgdate1}" hidden>${mfg_date1_val}</td>
</tr>`);
            })
            $('#SerialNo').val("");
            if (FlagSerial === "DPISerialExcel" || FlagSerial === "ExtRcptSerialExcel") {
                OnClickSerialDeleteIcon_ExternalReceipt();
            }

            else if (FlagSerial === "StockTakeSerialExcel") {
                Cmn_OnClickSerialDeleteIcon();
            }

            $("#SerialNo").focus()
            Closemodal(btn);
        }
        else {
            swal("", $("#Serialqtydoesnotmatchwithreceivedqty").text(), "warning");
        }
    }

} /*Added by NItesh 09012025 1723 For Add EXcel Imported*/

function Cmn_FilterSerialData(searchval) {
    debugger;
    var totalRows = $("#ItemSerialwiseTbl > tbody > tr").length;
    if (totalRows > 0) {
        debugger;
        var searchValue = searchval.currentTarget.value.trim().toUpperCase();

        $("#ItemSerialwiseTbl > tbody > tr").each(function () {
            var row = $(this);

            // Get values from input fields (Lot and BatchNumber)
            var lotInput = row.find('input[name="Lot"]');
            var batchInput = row.find('input[name="SerialNumberDetail"]');
            var Mfg_NameInput = row.find('input[name="MfgName"]');
            var MrpInput = row.find('input[name="MfgMrp"]');


            var lotVal = lotInput.length ? lotInput.val().trim().toUpperCase() : '';
            var batchVal = batchInput.length ? batchInput.val().trim().toUpperCase() : '';
            var Mfg_Name = Mfg_NameInput.length ? Mfg_NameInput.val().trim().toUpperCase() : '';
            var Mfg_Mrp = MrpInput.length ? MrpInput.val().trim().toUpperCase() : '';



            // Check if searchValue is contained in Lot or BatchNumber
            if (searchValue === "" || lotVal.includes(searchValue) || batchVal.includes(searchValue) || Mfg_Name.includes(searchValue)
                || Mfg_Mrp.includes(searchValue)) {
                row.show(); // Show matching or all if empty
            } else {
                row.hide(); // Hide non-matching
            }
        })

    }

}
function Cmn_SerialDetailCheckboxSelectAlldeselectAll() {

    $(document).on('change', '#chkSelectAll', function () {

        var isChecked = $(this).is(':checked');

        // Get table
        var table = $(this).closest('table');
        var tableId = table.attr('id');

        // Required quantity
        var requiredQty = parseFloat($('#QuantitySerialWise').val()) || 0;

        // Reset all checkboxes first
        table.find('tbody #ChkItemSerialWise').prop('checked', false);

        if (!isChecked || requiredQty <= 0) {
            onchangeChkItemSerialWise();
            return;
        }

        var selectedQty = 0;

        // ✅ Loop ONLY visible rows
        //table.find('tbody tr:visible').each(function () {
        table.find('tbody tr').each(function () {

            if (selectedQty >= requiredQty) {
                return false; // break loop
            }

            var row = $(this);
            var rowCheckbox = row.find('#ChkItemSerialWise');
            var rowQty = 1; // assuming 1 qty per row

            if (rowQty > 0) {
                rowCheckbox.prop('checked', true);
                selectedQty += rowQty;
            }
        });

        onchangeChkItemSerialWise();
        console.log('Table:', tableId, 'Selected Qty:', selectedQty);
    });
}

function Cmn_getSchemeFOCQty(ItemId, CustId, OrderQty, OrderValue, OrdDate) { //Added by Suraj Maurya on 15-01-2026
    debugger;
    try {
        let foc_detail = [];
        $.ajax({
            type: "POST",
            url: "/Common/Common/Cmn_getSchemeFocDetail",
            data: { item_id: ItemId, cust_id: CustId, order_qty: OrderQty, order_value: OrderValue, ord_dt: OrdDate },
            async: false,
            success: function (data) {
                if (data !== "ErrorPage") {
                    let arr = JSON.parse(data);
                    if (arr.Table.length > 0) {
                        //foc_qty = arr.Table[0].foc_qty;
                        foc_detail = arr.Table;
                    }
                } else {
                    console.log("ErrorPage")
                }
            }
        });
        return foc_detail;
    }
    catch (ex) {
        console.log(ex);
        return "";
    }

}

/*This iS Payament Schudle Part in Sales Invoice,Direct Sales Invoice,Service Sales Invoice Added by Nitesh 22012026 1336*/
function Cmn_allowAlphaNumericSpace(el) {
    el.value = el.value.replace(/[^a-zA-Z0-9 ]/g, '');
}
function Cmn_PaymSchedPerce() {
    $("#SpanPaymentSchedulePercentageErrorMsg").css("display", "none");
    $("#SpanPaymentSchedulePercentageErrorMsg").text("");
    $("#PaymentSchedulePercentage").css("border-color", "#ced4da");

    var invoiceAmount = parseFloat($("#PaymentscheduleInvoiceAmount").val()) || 0;
    var percentage = parseFloat($("#PaymentSchedulePercentage").val()) || 0;

    // calculate amount
    var calculatedAmount = (invoiceAmount * percentage) / 100;

    // set result (change ID if needed)
    $("#PaymentSchedulePaymentAmount").val(calculatedAmount.toFixed(2));
    // SwitchToAddMode();
}
function Cmn_PaymSchePaymTerms() {
    $("#SpanPaymentSchedulePaymentTermsErrorMsg").hide().text("");
    $("#PaymentScheduleTerms").css("border-color", "#ced4da");
}
function Cmn_AddUpdateBtnPaymeSched() {
    debugger;
    var headerSrNo = parseInt($("#tblPaymentSchedule_Headersr_no").val()) || 0;

    // Fetch and Sanitize Values
    var terms = $("#PaymentScheduleTerms").val().trim();
    var percentage = parseFloat($("#PaymentSchedulePercentage").val()) || 0;
    var amount = parseFloat($("#PaymentSchedulePaymentAmount").val()) || 0;
    var rawInvoiceAmt = $("#PaymentscheduleInvoiceAmount").val();
    var invoiceAmount = parseFloat(rawInvoiceAmt) || 0;

    // ===== VALIDATION =====
    // Invoice Amount Validation
    if (!rawInvoiceAmt || invoiceAmount <= 0) {
        $('#SpanPaymentScheduleInvoiceAmountErrorMsg').text($("#valueReq").text()).show();
        $("#PaymentscheduleInvoiceAmount").css("border-color", "red");
        return;
    } else {
        $('#SpanPaymentScheduleInvoiceAmountErrorMsg').hide();
        $("#PaymentscheduleInvoiceAmount").css("border-color", "#ced4da");
    }

    // Terms Validation
    if (terms === "") {
        $('#SpanPaymentSchedulePaymentTermsErrorMsg').text($("#valueReq").text()).show();
        $("#PaymentScheduleTerms").css("border-color", "red");
        return;
    } else {
        Cmn_PaymSchePaymTerms();
    }

    // Percentage Range Validation
    if (percentage <= 0 || percentage > 100) {
        $('#SpanPaymentSchedulePercentageErrorMsg').text($("#InvlidPercentage").text()).show();
        $("#PaymentSchedulePercentage").css("border-color", "red");
        return;
    } else {
        $('#SpanPaymentSchedulePercentageErrorMsg').hide();
        $("#PaymentSchedulePercentage").css("border-color", "#ced4da");
    }

    // ===== DUPLICATE CHECK & CALCULATION =====
    var tableBody = $("#tblPaymentSchedule tbody");
    var sumtblPercentage = 0;
    var isDuplicate = false;

    tableBody.find("tr").each(function () {
        var row = $(this);
        var sr_no = parseInt(row.find(".ps-srno").text()) || 0;
        var tblPaymentterm = row.find(".ps-term").text().trim().toUpperCase();

        if (sr_no !== headerSrNo) {
            if (tblPaymentterm === terms.toUpperCase()) {
                isDuplicate = true;
            }
            sumtblPercentage += parseFloat(row.find(".ps-percentage").text()) || 0;
        }
    });

    if (isDuplicate) {
        $('#SpanPaymentSchedulePaymentTermsErrorMsg').text($("#valueduplicate").text()).show();
        $("#PaymentScheduleTerms").css("border-color", "red");
        return;
    }

    // Check if total exceeds 100%
  
    if ((sumtblPercentage + percentage) > 100.00 || (sumtblPercentage + percentage) > 100) 
    {
        $('#SpanPaymentSchedulePercentageErrorMsg').text($("#InvlidPercentage").text()).show();
        $("#PaymentSchedulePercentage").css("border-color", "red");
        return;
    }


    if (parseFloat((sumtblPercentage + percentage)) == 100.00 || parseFloat((sumtblPercentage + percentage)) == 100)
    {
        var Total = $("#TotaltblPaymentAmount").text();
        var count = $("#tblPaymentSchedule tbody tr").length;
        if (count > 1) {
            amount = rawInvoiceAmt - Total;
        }
        else {
            
            amount = amount ;
        }
       
    }

    // ===== ADD OR UPDATE ROW =====
    if (headerSrNo > 0) {
        // UPDATE MODE
        var row = tableBody.find("tr").filter(function () {
            return parseInt($(this).find(".ps-srno").text()) === headerSrNo;
        });
        row.find(".ps-term").text(terms);
        row.find(".ps-percentage").text(percentage);
        row.find(".ps-amount").text(amount.toFixed(2));
    } else {
        // ADD MODE
        var srNo = tableBody.find("tr").length + 1;
        tableBody.append(`
            <tr>
                <td class="center"><i class="fa fa-edit" style="cursor:pointer" onclick="Cmn_EditPaymentSchedule(this)"></i></td>
                <td class="center"><i class="fa fa-trash red" style="cursor:pointer" onclick="Cmn_DeletePaymentSchedule(this)"></i></td>
                <td class="text-center ps-srno">${srNo}</td>
                <td class="ps-term">${terms}</td>
                <td class="text-right ps-percentage">${percentage}</td>
                <td class="text-right ps-amount">${amount.toFixed(2)}</td>
            </tr>
        `);
    }

    // ===== RESET UI =====
    $("#PaymentScheduleTerms, #PaymentSchedulePercentage, #PaymentSchedulePaymentAmount").val("");
    $("#tblPaymentSchedule_Headersr_no").val("0");
    Cmn_RecalPaymScheTotals();
    $("#PaymentScheduleBtnAddItem")
        .removeClass("fa-refresh")
        .addClass("fa-plus")
        .attr("title", "Add New");

    $("#tblPaymentSchedule_Headersr_no").val("0");
}

function Cmn_EditPaymentSchedule(el) {
    var row = $(el).closest('tr');

    $("#PaymentScheduleTerms").val(row.find(".ps-term").text().trim());
    $("#PaymentSchedulePercentage").val(row.find(".ps-percentage").text().trim());
    $("#PaymentSchedulePaymentAmount").val(row.find(".ps-amount").text().trim());
    $("#tblPaymentSchedule_Headersr_no").val(row.find(".ps-srno").text().trim());

    $("#PaymentScheduleBtnAddItem")
        .removeClass("fa-plus")
        .addClass("fa fa-refresh")
        .attr("title", "Update");
}
function Cmn_DeletePaymentSchedule(el) {
    var row = $(el).closest('tr');
    var headerSrNo = parseInt($("#tblPaymentSchedule_Headersr_no").val()) || 0;
    var rowSrNo = parseInt(row.find(".ps-srno").text());

    row.remove();

    // If deleting the item currently being edited, reset the form
    if (headerSrNo === rowSrNo) {
        $("#PaymentScheduleTerms, #PaymentSchedulePercentage, #PaymentSchedulePaymentAmount").val("");
        $("#tblPaymentSchedule_Headersr_no").val("0");
        $("#PaymentScheduleBtnAddItem")
            .removeClass("fa-refresh")
            .addClass("fa-plus")
            .attr("title", "Add New");

        $("#tblPaymentSchedule_Headersr_no").val("0");
    }

    // Recalculate Serial Numbers
    $("#tblPaymentSchedule tbody tr").each(function (i) {
        $(this).find(".ps-srno").text(i + 1);
    });

    Cmn_RecalPaymScheTotals();
}
function Cmn_RecalPaymScheTotals() {
    var totalPercentage = 0;
    var totalAmount = 0;

    $("#tblPaymentSchedule tbody tr").each(function () {
        totalPercentage += parseFloat($(this).find(".ps-percentage").text()) || 0;
        totalAmount += parseFloat($(this).find(".ps-amount").text()) || 0;
    });

    $("#TotaltblPaymentSchedulePercentage").text(totalPercentage.toFixed(2));
    $("#TotaltblPaymentAmount").text(totalAmount.toFixed(ValDigit));
}


function Cmn_ValidationPaymentSchedule() {
    debugger;
    var Leng = parseInt($("#tblPaymentSchedule tbody tr").length);

    if (Leng > 0) {
        var NetValue = parseFloat($("#NetOrderValueInBase").val()) || 0;
        var tableBody = $("#tblPaymentSchedule tbody");
        var sumtblPercentage = 0;
        var sumtblAmount = 0;

        // Ensure ValDigit is defined (default to 2 if missing)
        var decimals = (typeof ValDigit !== 'undefined') ? ValDigit : 2;

        tableBody.find("tr").each(function () {
            var row = $(this);
            // Use text() and cleanup any potential whitespace
            var pct = parseFloat(row.find(".ps-percentage").text()) || 0;
            var amt = parseFloat(row.find(".ps-amount").text()) || 0;

            sumtblPercentage += pct;
            sumtblAmount += amt;
        });

        // Precision handling: Round to avoid 99.99999 != 100 issues
        var totalPct = parseFloat(sumtblPercentage.toFixed(2));
        var totalAmt = parseFloat(sumtblAmount.toFixed(decimals));
        var targetAmt = parseFloat(NetValue.toFixed(decimals));

        // Validation Check
        if (totalPct !== 100 || totalAmt !== targetAmt) {

            var message = $("#PaymentSchedule100percent").text();

            Swal("", message, "warning");
            return false;
        }
    }
    return true; // Added return true if valid
}

function Cmn_BindPaymentSchedule() {
    var rows = $('#tblPaymentSchedule tbody tr');

    if (rows.length > 0) {
        var scheduleList = [];

        rows.each(function () {
            var row = $(this);

            // Create object with keys matching your C# DTO class
            var item = {
                sr_no: parseInt(row.find(".ps-srno").text()) || 0,
                paym_mst: row.find(".ps-term").text().trim(), // Aligned with SQL Type 'paym_mst'
                precentage: parseFloat(row.find(".ps-percentage").text()) || 0, // Aligned with SQL 'precentage'
                amt: parseFloat(row.find(".ps-amount").text()) || 0 // Aligned with SQL 'amt'
            };

            scheduleList.push(item);
        });

        // Serialize to JSON
        $("#HdnPaymentScheduleTable").val(JSON.stringify(scheduleList));
    } else {
        $("#HdnPaymentScheduleTable").val(''); // Clear if empty
    }
}
function Cmn_ChangeValueReplicate(OnchageID, ChangeData) {
    $(ChangeData).val($("#" + OnchageID).val())
    var input = document.getElementById(OnchageID);
    if (!input || input.__hooked) return;

    input.__hooked = true; // 🔒 prevent double hook

    var internalValue = input.value;

    Object.defineProperty(input, "value", {
        configurable: true,
        get: function () {
            return internalValue;
        },
        set: function (newValue) {

            internalValue = newValue;
            $(ChangeData).val(newValue);
            input.setAttribute("value", newValue);
        }
    });
}
/*END- This iS Payament Schudle Part in Sales Invoice,Direct Sales Invoice,Service Sales Invoice*/
function Cmn_ApplySearchBtnOnDataTable(tableId) {//Added by Suraj Maurya on 27-01-2026 to apply search btn on datatable search
    debugger
    $('#' + tableId + '_filter input').off();
    $('#' + tableId + '_filter input').css("padding-right","30px");
    $('#' + tableId + '_filter input').addClass("dtSearchBox");
    var searchBox = $('#' + tableId + '_filter input');

    searchBox.after(`
                <button id="${tableId}dtSearchBtn" type="button" class="dt-search-btn">
                    <i class="fa fa-search"></i>
                </button>
            `);
    var table = $("#" + tableId).DataTable();
    $('#' + tableId + 'dtSearchBtn').on('click', function () {
        table.search(searchBox.val()).draw();
    });

    searchBox.on('keypress', function (e) {
        if (e.which === 13) {   // Enter key
            e.preventDefault();//Added by Suraj Maurya on 10-02-2026 to prevent submit.
            table.search(this.value).draw();
        }
    });
}
function Cmn_ApplySearchBtnOnDataTable_New(tableId) {//Added by Suraj Maurya on 27-01-2026 to apply search btn on datatable search
    debugger
    $('#' + tableId + '_filter input').off();
    $('#' + tableId + '_filter input').css("padding-right", "30px");
    $('#' + tableId + '_filter input').addClass("dtSearchBox");
    var searchBox = $('#' + tableId + '_filter input');

    searchBox.after(`
                <button id="${tableId}dtSearchBtn" type="button" class="dt-search-btn">
                    <i class="fa fa-search"></i>
                </button>
            `);
    var table = $("#" + tableId).DataTable();
    $('#' + tableId + 'dtSearchBtn').on('click', function () {
        table.search(searchBox.val()).draw();
    });

    searchBox.on('keypress', function (e) {
        if (e.which === 13) {   // Enter key
            e.preventDefault();//Added by Suraj Maurya on 10-02-2026 to prevent submit.
            table.search(this.value).draw();
        }
    });
}