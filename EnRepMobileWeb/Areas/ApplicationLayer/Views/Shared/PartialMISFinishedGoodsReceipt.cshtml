@using EnRepMobileWeb.Resources;
<script src="~/Content/Scripts/Common/CommonPartialJS.js"></script>
<script src="~/Content/Scripts/ApplicationLayer/InventoryManagement/MIS/MISFinishedGoodsReceipt/MISFinishedGoodsReceipt_JS.js"></script>
<style>
#datatable-buttons_wrapper .btn-group a:nth-child(3) {
    display: inline-block;
    position: absolute;
}

.hidden {
    display: none;
}

/*thead tr > th {
    position: sticky;
    padding: .5rem;
    z-index: 2;
    top: 0;
}

thead tr > :nth-child(2) {
    z-index: 100 !important;
    position: sticky;
    left: 0;
    top: 0;
}

tbody tr > :nth-child(2) {
    background: #ffffff;
    position: sticky;
    z-index: 1;
    left: 0;
}*/
</style>
@{
    string tableWidth = "width2000";
    if (ViewBag.ShowAs == "P")
    {
        tableWidth = "width2000";
    }
    else
    {
        tableWidth = "width2000";
    }
}

<table id="MISFGRReport" class="table table-striped rowhighlighttbl mb-3 @tableWidth itmfrz" cellspacing="0" width="100%">
    <thead>
        @if (ViewBag.ShowAs == "P")
        {
            <tr class="sticky-header">
                <th width="2%"> @Resource.SrNo</th>
                <th width="18%" class="itmStick">@Resource.Product  <br /> @Resource.Name</th>
                <th hidden="hidden">@Resource.Product  <br /> @Resource.Name</th>
                <th width="5%" title="@Resource.UnitOfMeasure">@Resource.UOM</th>
                <th width="7%">@Resource.Receipt  <br /> @Resource.Quantity </th>
                <th width="10%" class="center">@Resource.Receipt @Resource.Quantity <br /> @Resource.InSpecific </th>
                <th width="9%">@Resource.Shopfloor  <br /> @Resource.Name </th>
                <th hidden="hidden">@Resource.Shopfloor  <br /> @Resource.Name </th>
                <th width="8%">@Resource.Receipt  <br /> @Resource.Number </th>
                <th width="7%">@Resource.Receipt  <br /> @Resource.Date </th>
                <th width="6%">@Resource.Batch <br /> @Resource.Number</th>
                <th width="7%">@Resource.Lot</th>
                <th width="7%">@Resource.Expiry 	 <br /> @Resource.Date</th>
                <th width="7%">@Resource.Cost @Resource.Price </th>
                <th width="7%">@Resource.Value</th>
            </tr>
        }
        else
        {
            <tr class="sticky-header">
                <th width="2%"> @Resource.SrNo</th>
                <th width="8%" class="itmStick">@Resource.Receipt  <br /> @Resource.Number</th>
                <th width="5%">@Resource.Receipt  <br /> @Resource.Date </th>
                <th hidden="hidden">@Resource.Receipt  <br /> @Resource.Date </th>
                <th width="10%">@Resource.Shopfloor  <br /> @Resource.Name </th>
                <th hidden="hidden">@Resource.Shopfloor  <br /> @Resource.Name </th>
                <th width="11%">@Resource.Input  <br /> @Resource.MaterialName </th>
                <th hidden="hidden">@Resource.Input  <br /> @Resource.MaterialName </th>
                <th width="4%" title="@Resource.UnitOfMeasure">@Resource.UOM</th>
                <th hidden="hidden" title="@Resource.UnitOfMeasure">@Resource.UOM</th>
                <th width="5%">@Resource.Consumed  <br /> @Resource.Quantity </th>
                <th width="11%">@Resource.Output  <br /> @Resource.Product @Resource.Name </th>
                <th hidden="hidden">@Resource.Output  <br /> @Resource.Product @Resource.Name </th>
                <th width="5%" title="@Resource.UnitOfMeasure">@Resource.UOM</th>
                <th width="5%">@Resource.Received  <br /> @Resource.Quantity </th>
                <th width="8%">@Resource.Receipt @Resource.Quantity <br /> @Resource.InSpecific </th>
                <th width="6%">@Resource.Batch  <br /> @Resource.Number </th>
                <th width="5%">@Resource.Lot</th>
                <th width="5%">@Resource.ExpiryDate</th>
                <th width="5%">@Resource.Cost @Resource.Price </th>
                <th width="5%">@Resource.Value</th>
                <th hidden="hidden"></th>
                <th hidden="hidden"></th>
                <th hidden="hidden"></th>
                <th hidden="hidden"></th>
                <th hidden="hidden"></th>
            </tr>
        }
    </thead>
    <tbody>
    </tbody>
</table>
<script>
    $(document).ready(function () {
        debugger;
        MISFGRDatatable();
        debugger;

        //debugger;
        //var showas = $("#ddl_ShowAs").val();
        //if (showas == "D") {
        //    $("#MISFGRReport tbody tr").each(function () {
        //        debugger;
        //        var curr = $(this);
        //        var rcptno = curr.find("#tditem").val();
        //    })
        //}
    });
    function MISFGRDatatable() {
        debugger;
        var showas = $("#ddl_ShowAs").val();
        if (showas == "P") {
            var itmid = $("#ddlItemName").val();
           // var GroupID = $("#ddlItemGroupName").val();
            var GroupID = cmn_getddldataasstring("#ddlItemGroupName");
            var txtFromdate = $("#txtFromdate").val();
            var txtTodate = $("#txtTodate").val();
            var MultiselectItemHdn = $("#MultiselectItemHdn").val();
            var ShopFloor_id = $("#Hdnshopfloor_id").val();
            //var ShopFloor_id = cmn_getddldataasstring("#Hdnshopfloor_id");
            var ddl_ShowAs = $("#ddl_ShowAs").val();
        }
        else {
            var itmid = $("#ddlItemName").val();
           // var GroupID = $("#ddlItemGroupName").val();
            var GroupID = cmn_getddldataasstring("#ddlItemGroupName");
            var txtFromdate = $("#txtFromdate").val();
            var txtTodate = $("#txtTodate").val();
            var MultiselectItemHdn = $("#MultiselectItemHdn").val();
            var ShopFloor_id = $("#Hdnshopfloor_id").val();
            var ddl_ShowAs = $("#ddl_ShowAs").val();
        }
        //var filters = itmid + "," + GroupID + "," + txtFromdate + "," + txtTodate + ","
        //    + MultiselectItemHdn + "," + ShopFloor_id + "," + ddl_ShowAs;

        var filterArray = [itmid, GroupID, txtFromdate, txtTodate, MultiselectItemHdn, ShopFloor_id, ddl_ShowAs];
        var filters = filterArray.map(x => `[${x}]`).join('_');

        $("#MISFGRReport").DataTable().destroy();
        $("#MISFGRReport").DataTable
            ({
                "pageLength": 50,
                "processing": true, // for show progress bar
                "serverSide": true, // for process server side
                "filter": true, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once

                "ajax": {
                    "url": "/ApplicationLayer/MISFinishedGoodsReceipt/LoadData1",
                    "data": {
                        ItemListFilter: filters,
                        ReportType: showas
                    },
                    "type": "POST",
                    "datatype": "json",
                },
                "columns": MISFGRColumns(showas),
                columnDefs: MISFGRTarget(showas),

            });
        var exportbtn = `<a class="btn btn-default buttons-csv buttons-html5 btn-sm" tabindex="0"
            id='DownloadExcel'    aria-controls="MISFGRReport" href="#"><span>CSV</span></a>
            <a class="btn btn-default buttons-pdf buttons-html5 btn-sm" tabindex="0"
              aria-controls="MISFGRReport" href="#"><span>PDF</span></a>`;
        $("#MISFGRReport_length").append(exportbtn);

        DownloadExcel();

    }
    function MISFGRColumns(ReportType) {
        var Array = [];
        debugger;
        if (ReportType == "P") {
            Array = [

                { "data": "SrNo", "name": "SrNo", "autoWidth": true },
                { "data": "item_name", "name": "item_name", "autoWidth": true, "id": "ItemNameSpan", className: "ItmNameBreak itmStick tditemfrz" },
                { "data": "item_id", "name": "item_id", "autoWidth": true, className: "hidden", "id": "hfItemID" },
                { "data": "uom_alias", "name": "uom_alias", "autoWidth": true, "id": "ddluom_alias" },
                { "data": "out_qty", "name": "out_qty", "autoWidth": true, className: "num_right" },
                { "data": "Qty_in_Sp", "name": "Qty_in_Sp", "autoWidth": true, className: "num_right" },
                { "data": "shfl_name", "name": "shfl_name", "autoWidth": true, "id": "ddlshfl_name", className: "ItmNameBreak" },
                { "data": "shfl_id", "name": "shfl_id", "autoWidth": true, className: "hidden" },
                { "data": "rcpt_no", "name": "rcpt_no", "autoWidth": true },
                { "data": "rcpt_dt", "name": "rcpt_dt", "autoWidth": true },
                { "data": "batch_no", "name": "batch_no", "autoWidth": true },
                { "data": "lot_no", "name": "lot_no", "autoWidth": true },
                { "data": "exp_dt", "name": "exp_dt", "autoWidth": true },
                { "data": "cost_price", "name": "cost_price", "autoWidth": true, className: "num_right" },
                { "data": "total_value", "name": "total_value", "autoWidth": true, className: "num_right" },
            ]
        }
        else {
            Array = [
                { "data": "SrNo1", "name": "SrNo", "autoWidth": true, "id": "srno_id" },
                { "data": "rcpt_no", "name": "rcpt_no", "autoWidth": true, className: "ItmNameBreak itmStick tditemfrz"},
                { "data": "rcpt_dt", "name": "rcpt_dt", "autoWidth": true },
                { "data": "Doc_dt", "name": "Doc_dt", "autoWidth": true, className: "hidden", "id": "Doc_dt" },
                { "data": "shfl_name", "name": "shfl_name", "autoWidth": true, "id": "ddlshfl_name", className: "ItmNameBreak"},
                { "data": "shfl_id", "name": "shfl_id", "autoWidth": true, className: "hidden" },
                { "data": "input_item_name", "name": "input_item_name", "autoWidth": true, "id": "ItmNameSpan1", className: "ItmNameBreak" },
                { "data": "input_item_id", "name": "input_item_id", "autoWidth": true, className: "hidden", "id": "hfItemID1" },
                { "data": "input_uom_name", "name": "input_uom_name", "autoWidth": true, "id":"UOM" },
                { "data": "input_uom_id", "name": "input_uom_id", "autoWidth": true, className: "hidden", "id":"UOM_ID" },
                { "data": "cons_qty", "name": "cons_qty", "autoWidth": true, className: "num_right", "id": "Consume_qty" },
                { "data": "item_name", "name": "item_name", "autoWidth": true, "id": "ItemNameSpan", className: "ItmNameBreak"},
                { "data": "item_id", "name": "item_id", "autoWidth": true, className: "hidden", "id": "hfItemID" },
                { "data": "uom_alias", "name": "uom_alias", "autoWidth": true, "id": "ddluom_alias" },
                { "data": "out_qty", "name": "out_qty", "autoWidth": true, className: "num_right" },
                { "data": "Qty_in_Sp", "name": "Qty_in_Sp", "autoWidth": true},
                { "data": "batch_no", "name": "batch_no", "autoWidth": true },
                { "data": "lot_no", "name": "lot_no", "autoWidth": true },
                { "data": "exp_dt", "name": "exp_dt", "autoWidth": true },
                { "data": "cost_price", "name": "cost_price", "autoWidth": true, className: "num_right" },
                { "data": "total_value", "name": "total_value", "autoWidth": true, className: "num_right" },
                { "data": "rowspanrcptno", "name": "rowspanrcptno", "autoWidth": true, className: "hidden", "id": "idrowspanrcptno" },
                { "data": "rowspanInputItem", "name": "rowspanInputItem", "autoWidth": true, className: "hidden", "id": "idrowspanInputItem" },
                { "data": "rowspanOutputItem", "name": "rowspanOutputItem", "autoWidth": true, className: "hidden", "id": "idrowspanOutputItem" },
                { "data": "Batchable", "name": "Batchable", "autoWidth": true, className: "hidden", "id": "idBatchable" },
                { "data": "Doc_no", "name": "Doc_no", "autoWidth": true, className: "hidden", "id": "hidden_Doc_no" },
            ]
        }
        return Array;
    }

    function MISFGRTarget(ReportType) {
        debugger;
        var array = [];
        if (ReportType == "P") {
            array = [

                {
                    'targets': 1,
                    'createdCell': function (td, cellData, rowData, row, col) {
                        $(td).attr('id', 'tditem');
                    }
                },

                {
                    render: (data, type, row) => `<div class="col-sm-11 no-padding"  id="multiWrapper"><span id="ItemNameSpan"> ${data}</span></div>
                        <div class="col-sm-1 i_Icon">
                            <button type="button" id="ItmInfoBtnIcon" class="calculator" onclick="OnClickIconBtn(event);" data-toggle="modal" data-target="#ItemInfo" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="Item Information">  </button>
                        </div>`,
                    targets: 1
                },
                {
                    render: (data, type, row) => `<input type="hidden" id="hfItemID" value='${data}'>`,
                    targets: 2
                },
                {
                    render: (data, type, row) => `<span id = "uom_alias" >${data}</span>`,
                    targets: 3
                },
                {
                    render: (data, type, row) => `<b> ${data}</b>`,
                    targets: 4
                },
                {
                    render: (data, type, row) => `<b> ${data}</b>`,
                    targets: 5
                },
                {
                    render: (data, type, row) => `<span id = "shfl_name" > ${data}</span>`,
                    targets: 6
                },
                {
                    render: (data, type, row) => `<input type="hidden" id="shfl_id" value='${data}'>`,
                    targets: 7
                },
                {

                    render: (data, type, row) => `<span id = "rcpt_no" > ${data}</span>`,
                    targets: 8
                },
                {
                    render: (data, type, row) => `<span id = "" > ${data}</span>`,
                    targets: 9
                },
                {
                    render: (data, type, row) => `<span id = "" > ${data}</span>`,
                    targets: 10
                },
                {
                    render: (data, type, row) => `<span id = "" > ${data}</span>`,
                    targets: 11
                },
                {
                    render: (data, type, row) => `<span id = "" > ${data}</span>`,
                    targets: 12
                },
                {
                    render: (data, type, row) => `<b> ${data}</b>`,
                    targets: 13
                },
                {
                    render: (data, type, row) => `<b> ${data}</b>`,
                    targets: 14
                },


            ]

        }
        else {

            array = [

                {
                    'targets': 0,
                    'createdCell': function (td, cellData, rowData, row, col) {
                        $(td).attr('id', 'Sno_id');
                    }
                },
                {
                    'targets': 1,
                    'createdCell': function (td, cellData, rowData, row, col) {
                        $(td).attr('id', 'tditem');
                    }
                },
                {
                    'targets': 6,
                    'createdCell': function (td, cellData, rowData, row, col) {
                        $(td).attr('id', 'input');

                    }
                },
                {
                    'targets': 10,
                    'createdCell': function (td, cellData, rowData, row, col) {
                        $(td).attr('id', 'Consume_qty');

                    }
                },



                {
                    render: (data, type, row) => `<span id = "sno" > ${data}</span>`,
                    targets: 0
                },
                {
                    render: (data, type, row) => `<span id = "rcpt_no" > ${data}</span>`,
                    targets: 1
                },
                {
                    render: (data, type, row) => `<span id = "" > ${data}</span>`,
                    targets: 2
                },
                {

                    render: (data, type, row) => `<input type="hidden" id="Doc_dt" value='${data}'>`,
                    targets: 3
                },

                {
                    render: (data, type, row) => `<span id = "shfl_name" > ${data}</span>`,
                    targets: 4
                },
                {
                    render: (data, type, row) => `<input type="hidden" id="shfl_id" value='${data}'>`,
                    targets: 5
                },
                {

                    render: (data, type, row) =>
                    {
                        if (data != null && data != "") {
                            return `<div class="col-sm-11 no-padding"  id="multiWrapper"><span id="ItmNameSpan1"> ${data}</span></div>
                        <div class="col-sm-1 i_Icon">
                            <button type="button" id="ItmInfoBtnIcon" class="calculator" onclick="OnClickIconBtn1(event);" data-toggle="modal" data-target="#ItemInfo" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="Item Information">  </button>
                        </div>`;
                        }
                        else {
                            return ` <span id = "ItmNameSpan1" > ${ data }</span >`;

                        }


                    },
                    targets: 6

                },
                {
                    render: (data, type, row) => `<input type="hidden" id="hfItemID1" value='${data}'>`,
                    targets: 7
                },
                {
                    render: (data, type, row) => `<span id = "UOM" > ${data}</span>`,
                    targets: 8
                },
                {
                    render: (data, type, row) => `<input type="hidden" id="UOM_ID" value='${data}'>`,
                    targets: 9
                },

                {
                    render: (data, type, row) =>
                    {
                        if (data != null && data != "")
                        {
                            if (row.Batchable == "Y") {
                                return `<div class="col-sm-11 no-padding">
                                <b> ${data}</b>
                                </div>
                                 <div class="col-sm-1 i_Icon">
                                 <button type="button" id="BatchDeatil" class="calculator" onclick="GetDataBatchDeatil(event)" data-toggle="modal" data-target="#BatchNumber" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="@Resource.Batch @Resource.Detail">  </button>
                                  </div>`;
                            }
                            else {
                                return `<b> ${data}</b>`;
                            }

                        }
                        else {
                            return `<b> ${data}</b>`;
                        }

                    },

                    targets: 10
                },
                {
                    render: (data, type, row) =>
                    {
                        if (data != null && data != "") {
                            return   `<div class="col-sm-11 no-padding"  id="multiWrapper"><span id="ItemNameSpan"> ${data}</span></div>
                        <div class="col-sm-1 i_Icon">
                            <button type="button" id="ItmInfoBtnIcon" class="calculator" onclick="OnClickIconBtn(event);" data-toggle="modal" data-target="#ItemInfo" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="Item Information">  </button>
                        </div>`;
                        }
                        else {
                            return ` <span id = "ItmNameSpan1" > ${data}</span >`;
                        }
                    },

                    targets: 11
                },
                {
                    render: (data, type, row) => `<input type="hidden" id="hfItemID" value='${data}'>`,
                    targets: 12
                },
                {
                    render: (data, type, row) => `<span id = "uom_alias" >${data}</span>`,
                    targets: 13
                },
                {
                    render: (data, type, row) => `<b> ${data}</b>`,
                    targets: 14
                },
                {
                    render: (data, type, row) => `<b> ${data}</b>`,
                    targets: 15
                },
                {
                    render: (data, type, row) => `<span id = "" > ${data}</span>`,
                    targets: 16
                },
                {
                    render: (data, type, row) => `<span id = "" > ${data}</span>`,
                    targets: 17
                },
                {
                    render: (data, type, row) => `<span id = "" > ${data}</span>`,
                    targets: 18
                },
                {
                    render: (data, type, row) => `<b> ${data}</b>`,
                    targets: 19
                },
                {
                    render: (data, type, row) => `<b> ${data}</b>`,
                    targets: 20
                },
                {
                    render: (data, type, row) => `<input type="hidden" id="rowspanrcptno" value='${data}'>`,
                    targets: 21
                },
                {
                    render: (data, type, row) => `<input type="hidden" id="rowspanInputItem" value='${data}'>`,
                    targets: 22
                },
                {
                    render: (data, type, row) => `<input type="hidden" id="rowspanOutputItem" value='${data}'>`,
                    targets: 23
                },
                {
                    render: (data, type, row) => `<input type="hidden" id="batchable" value='${data}'>`,
                    targets: 24
                },
                {
                    render: (data, type, row) => `<input type="hidden" id="hidden_Doc_no" value='${data}'>`,
                    targets: 25
                },
            ]
        }
        return array;
    }
</script>
