@using EnRepMobileWeb.Resources;
@using System.Data;
@{
    string ValDigit = "0.";
    var VD = Convert.ToInt32(Session["ValDigit"].ToString());
    for (var i = 0; i < VD; i++)
    {
        ValDigit += "0";
    }
    string QtyDigit = "0.";
    var QD = Convert.ToInt32(Session["QtyDigit"].ToString());
    for (var i = 0; i < QD; i++)
    {
        QtyDigit += "0";
    }
    string RateDigit = "0.";
    var RD = Convert.ToInt32(Session["RateDigit"].ToString());
    for (var i = 0; i < RD; i++)
    {
        RateDigit += "0";
    }
    decimal Total = 0;

    string IsNull(string InVal,string OutVal)
    {
        return string.IsNullOrEmpty(InVal) ? OutVal : InVal;
    }
}
<style>
    .grey {
        color: #646363;
    }
</style>
<script src="~/Content/Scripts/Common/CommonPartialJS.js"></script>

<div class="modal-content">
    <div class="modal-header">
        <h2>@Resource.BillOfMaterial</h2>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
    </div>
    
    <div class="card-box table-responsive dy_table margin15">
        <input hidden id="Hdn_BomProductId" value="@ViewBag.BomProduct_id" />
        <div class="col-md-12">
            <div id="" class="sticky-table sticky-ltr-cells sb-container container-example1 OrderHistory height45VH">
                <table id="PP_BOMDetail" data-order="" class="table table-striped table-bordered RowHighLightMultiTable" style="width:100%">
                    <thead>
                        <tr class="sticky-header">
                            <th width="1%">@Resource.SrNo</th>
                            <th width="20%"> @Resource.OperationName </th>
                            <th width="20%">@Resource.ItemType</th>
                            <th width="49%"> @Resource.ItemName</th>
                            <th width="10%" title="Unit Of Measure"> @Resource.UOM</th>
                            @*<th>@Resource.Quantity</th>*@
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.BOMDetailsItemWise != null)
                            {
                                if (ViewBag.BOMDetailsItemWise.Tables[0].Rows.Count >0)
                                {
                                    var srno = 1;
                                    foreach (System.Data.DataRow dr in ViewBag.BOMDetailsItemWise.Tables[0].Rows)
                                    {
                                        var opid = dr["op_id"].ToString();
                                        var opidcount = dr["op_count"].ToString();
                                        DataTable Details = new DataTable();
                                        Details = ViewBag.BOMDetailsItemWise.Tables[1];
                                        DataView data = new DataView();
                                        data = Details.DefaultView;
                                        data.RowFilter = "op_id='" + opid + "'";
                                        data.Sort = "item_type_seq_no";
                                        //data.Sort = "item_name";
                                        Details = data.ToTable();
                                        var j = 0;
                                        foreach (System.Data.DataRow dr1 in Details.Rows)
                                        {
                                            if (j == 0)
                                            {
                                            <tr>
                                                <td rowspan="@opidcount">@srno</td>
                                                <td rowspan="@opidcount" class="center" style="vertical-align:middle;">@dr1["op_name"]</td>
                                                <td>
                                                    <div class="col-sm-10 no-padding" id="td_ItemType">
                                                        @dr1["Item_type"]<input type="hidden" id="hfitmtypeid" value="@dr1["item_type_id"]">
                                                        <input type="hidden" id="hfopid" value="@dr1["op_id"]">
                                                        <input type="hidden" id="hfopName" value="@dr1["op_name"]">
                                                    </div>
                                                    @if (dr1["item_type_id"].ToString().Trim() == "IR" || dr1["item_type_id"].ToString().Trim() == "P")
                                                    {
                                                        <div class="col-sm-2 i_Icon">
                                                            <button type="button" id="btnAltItemInfo" class="calculator alter @(dr1["alt_fill"].ToString()=="Y"?"green1":"")" onclick="Cmn_OnClickAlternateItemInfo(event,@IsNull(ViewBag.BOMLevel,""))" data-toggle="modal" data-target="#AlternateItemDetailInfo" data-backdrop="static" data-keyboard="false" title="@Resource.Alternate @Resource.ItemDetail"> <i class="fa fa-th-large" aria-hidden="true"></i>  </button>
                                                        </div>
                                                    }
                                                </td>
                                                <td>
                                                    @if ((dr1["bom_avl"].ToString() == "Y" || dr1["Outer_Sf"].ToString() == "Y") && !("OF,OW,IW").Split(',').Contains(dr1["item_type_id"].ToString().Trim()))
                                                    {
                                                        <div class="col-sm-10 no-padding" id="td_ItemName">@dr1["item_name"]<input type="hidden" id="hfitmid" value="@dr1["item_id"]"></div>

                                                        <div class="col-sm-1 i_Icon">
                                                            <button type="button" id="ItmInfoBtnIcon" class="calculator" onclick="ItemInfoBtnClick('@dr1["item_id"]');" data-toggle="modal" data-target="#ItemInfo" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="@Resource.ItemInformation"> </button>
                                                        </div>
                                                        <div class="col-sm-1 i_Icon">
                                                            <button type="button" id="BillOfMaterial" class="calculator no-padding" onclick="Cmn_OnClickIconBtnBOMDetailLevelWise(event,@ViewBag.BOMLevel)" data-toggle="modal" data-target="@("#BillOfMaterialLvl" + IsNull(ViewBag.BOMLevel,"2"))" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/BillOfMaterial.png" alt="" title="@Resource.BillOfMaterial"></button>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="col-sm-10 no-padding" id="td_ItemName">@dr1["item_name"]<input type="hidden" id="hfitmid" value="@dr1["item_id"]"></div>
                                                        <div class="col-sm-1 i_Icon">
                                                            <button type="button" id="ItmInfoBtnIcon" class="calculator" onclick="ItemInfoBtnClick('@dr1["item_id"]');" data-toggle="modal" data-target="#ItemInfo" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="@Resource.ItemInformation"> </button>
                                                        </div>
                                                        <div class="col-sm-1 i_Icon">
                                                            <button type="button" id="BillOfMaterial" class="calculator no-padding subItmImg" data-toggle="modal" data-target="@("#BillOfMaterialLvl" + IsNull(ViewBag.BOMLevel,"2"))" data-backdrop="static" data-keyboard="false" disabled><img src="/Content/Images/BillOfMaterial.png" alt="" title="@Resource.BillOfMaterial"></button>
                                                        </div>
                                                    }

                                                </td>
                                            <td id="td_UomAlias">@dr1["uom_alias"]<input type="hidden" id="hfuomid" value="@dr1["uom_id"]"></td>
                                            @*<td class="num_right">@dr1["qty"]<input type="hidden" id="hfqty" value="@dr1["qty"]"></td>*@
                                        </tr>
                                            srno = srno+1;
                                        }
                                        else
                                        {
                    <tr>
                        
                        <td>
                            <div class="col-sm-10 no-padding" id="td_ItemType">
                                @dr1["Item_type"]<input type="hidden" id="hfitmtypeid" value="@dr1["item_type_id"]">
                                <input type="hidden" id="hfopid" value="@dr1["op_id"]">
                                <input type="hidden" id="hfopName" value="@dr1["op_name"]">
                            </div>
                                @if (dr1["item_type_id"].ToString().Trim() == "IR" || dr1["item_type_id"].ToString().Trim() == "P")
                                {
                                    <div class="col-sm-2 i_Icon">
                                        <button type="button" id="btnAltItemInfo" class="calculator alter @(dr1["alt_fill"].ToString()=="Y"?"green1":"")" onclick="Cmn_OnClickAlternateItemInfo(event,@IsNull(ViewBag.BOMLevel,""))" data-toggle="modal" data-target="#AlternateItemDetailInfo" data-backdrop="static" data-keyboard="false" title="@Resource.Alternate @Resource.ItemDetail"> <i class="fa fa-th-large" aria-hidden="true"></i>  </button>
                                    </div>
                                }
                        </td>
                        <td>
                            @if ((dr1["bom_avl"].ToString() == "Y" || dr1["Outer_Sf"].ToString() == "Y") && !("OF,OW,IW").Split(',').Contains(dr1["item_type_id"].ToString().Trim()))
                            {
                                <div class="col-sm-10 no-padding" id="td_ItemName">@dr1["item_name"]<input type="hidden" id="hfitmid" value="@dr1["item_id"]"></div>

                                <div class="col-sm-1 i_Icon">
                                    <button type="button" id="ItmInfoBtnIcon" class="calculator" onclick="ItemInfoBtnClick('@dr1["item_id"]');" data-toggle="modal" data-target="#ItemInfo" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="Item Information"> </button>
                                </div>
                                <div class="col-sm-1 i_Icon">
                                    <button type="button" id="BillOfMaterial" class="calculator no-padding" onclick="Cmn_OnClickIconBtnBOMDetailLevelWise(event,@ViewBag.BOMLevel)" data-toggle="modal" data-target="@("#BillOfMaterialLvl" + IsNull(ViewBag.BOMLevel,"2"))" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/BillOfMaterial.png" alt="" title="Bill Of Material"></button>
                                </div>

                            }
                            else
                            {
                                <div class="col-sm-10 no-padding" id="td_ItemName">@dr1["item_name"]<input type="hidden" id="hfitmid" value="@dr1["item_id"]"></div>
                                <div class="col-sm-1 i_Icon">
                                    <button type="button" id="ItmInfoBtnIcon" class="calculator" onclick="ItemInfoBtnClick('@dr1["item_id"]');" data-toggle="modal" data-target="#ItemInfo" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="Item Information"> </button>
                                </div>
                                <div class="col-sm-1 i_Icon">
                                    <button type="button" id="BillOfMaterial" class="calculator no-padding subItmImg"  data-toggle="modal" data-target="#@("#BillOfMaterialLvl" + IsNull(ViewBag.BOMLevel,"2"))" data-backdrop="static" data-keyboard="false" disabled><img src="/Content/Images/BillOfMaterial.png" alt="" title="Bill Of Material"></button>
                                </div>
                            }

                        </td>
                        <td id="td_UomAlias">@dr1["uom_alias"]<input type="hidden" id="hfuomid" value="@dr1["uom_id"]"></td>
                        @*<td class="num_right">@dr1["qty"]<input type="hidden" id="hfqty" value="@dr1["qty"]"></td>*@
                    </tr>
                                }
                                j = j + 1;
                               
                            }
                        }

                    }

                }
                       
                        </tbody>
                    </table>
            </div>

        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-sm" data-dismiss="modal">@Resource.Close</button>
    </div>
</div>



