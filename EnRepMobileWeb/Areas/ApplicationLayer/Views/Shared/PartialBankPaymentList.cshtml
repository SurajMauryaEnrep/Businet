@model EnRepMobileWeb.MODELS.ApplicationLayer.FinancialAccountingAndControl.GeneralLedgerVoucher.BankPayment.BankPaymentList_Model
@using EnRepMobileWeb.Resources;
@{
    var rowId = 0;
}
<script src="~/Content/Scripts/Common/CommonPartialJS.js"></script>
<script src="~/Content/Scripts/ApplicationLayer/FinancialAccountingAndControl/GeneralLedgerVoucher/BankPayment/BankPaymentList.js"></script>

<table id="Tbl_BankPaymentDetails" class="table table-striped width2600 rowhighlighttbl itmfrz" cellspacing="0" width="100%">
    <thead>
        <tr class="sticky-header">
            <th width="3%"> @Resource.SrNo</th>
            <th width="7%">@Resource.BankAccount</th>
            <th width="7%" class="itmStick">@Resource.GLVoucher <br /> @Resource.Number</th>
            <th width="5%">@Resource.GLVoucher <br /> @Resource.Date</th>
            <th width="6%" hidden>@Resource.GLVoucher <br /> @Resource.Date</th>
            <th width="4%">@Resource.PDC </th>
            <th width="4%">@Resource.InterBranch</th>
            <th width="5%">@Resource.SourceType</th>
            <th width="6%">@Resource.Requisition <br /> @Resource.Number</th>
            <th width="6%">@Resource.Requisition <br /> @Resource.Date</th>
            <th width="5%">@Resource.Instrument <br /> @Resource.Type</th>
            <th width="5%">@Resource.Instrument <br /> @Resource.Number</th>
            <th width="5%">@Resource.Currency</th>
            <th width="5%">@Resource.Amount</th>
            <th width="5%">@Resource.Status</th>
            <th width="5%">@Resource.Reconciliation <br /> @Resource.Status</th>
            <th width="5%">@Resource.CreatedBy</th>
            <th width="5%">@Resource.Createdon</th>
            <th width="5%">@Resource.ApprovedBy</th>
            <th width="5%">@Resource.ApprovedOn</th>
            <th width="5%">@Resource.AmendedBy</th>
            <th width="5%">@Resource.AmendedOn</th>
        </tr>
    </thead>
    <tbody id="">
        @*@if (Model.VoucherList != null)
        {
            foreach (var row in Model.VoucherList)
            {
                rowId++;
        <tr>
            <td>@rowId</td>
            <td>@row.bank_name</td>
            
            <td id="VouNumber" class="ItmNameBreak itmStick tditemfrz">
                <div class="col-sm-10 no-padding" id="Bp_Vouno">@row.VouNumber</div>
                <div class="col-sm-2 i_Icon">
                    <button type="button" id="VoucherDetail" class="calculator" onclick="OnClickIconBtn(event);" data-toggle="modal" data-target="#VoucherDetailMW" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="@Resource.VoucherDetail"> </button>
                </div>
            </td>

            <td id="Bp_Date">@row.VouDate</td>
            <td hidden id="hdVouDate">@row.hdVouDate</td>
            <td>
                @if (@row.HDNListPDC == true)/*Add by Hina on 12-08-2024 for PDC and inter branch*/
                {
                    <i class="fa fa-check text-success " aria-hidden="true"></i>
                }
                else
                {
                    <i class="fa fa-times-circle text-danger" aria-hidden="true"></i>
                }
                </td>
                <td>
                
                @if (@row.HDNListInterBrch == true)/*Add by Hina on 12-08-2024 for PDC and inter branch*/
                {
                    <i class="fa fa-check text-success " aria-hidden="true"></i>
                }
                else
                {
                    <i class="fa fa-times-circle text-danger" aria-hidden="true"></i>
                }
                </td>
            <td>@row.SrcType</td>
            <td>@row.ReqNo</td>
            <td>@row.ReqDt</td>
            <td>@row.Ins_type</td>
            <td>@row.Ins_num</td>
            <td class="center">@row.curr_logo</td>
            <td class="num_right">@row.Amount</td>
            <td id="Doc_Status">@row.VouStatus</td>
            <td>@row.Reco_Status</td>
            <td>@row.create_by</td>
            <td>@row.CreatedON</td>
            <td>@row.app_by</td>
            <td>@row.ApprovedOn</td>
            <td>@row.mod_by</td>
            <td>@row.ModifiedOn</td>
        </tr>
            }
        }*@

    </tbody>
</table>

<script type="text/javascript">
    $(document).ready(function () {
        debugger;
        BankPaymentDtList();
    });
    function BankPaymentDtList() {
        var SrcType = $("#Src_Type").val();
        var BankName = $("#ddlBankAccName").val();
        var Fromdate = $("#txtFromdate").val();
        var Todate = $("#txtTodate").val();
        var Status = $("#ddlStatus").val().trim();
        var WF_Status = $("#WF_Status").val().trim();
        if (BankName == "" || BankName == null) {
            BankName = "0";
        }
        var Currency = $("#ddlcurrlist").val();
        var InsType = $("#ddlInstype").val();
        var RecoStatus = $("#ddlRecostatus").val();

       
        var docid = $("#DocumentMenuId").val();
        var url = "/ApplicationLayer/BankPayment/LoadBankPaymentDetailsData";
        if (docid != '105104115120') {
            url = "/ApplicationLayer/BankReceipt/LoadBankRecieptDetailsData";
        } 
        


        $("#Tbl_BankPaymentDetails").DataTable().destroy();
        $("#Tbl_BankPaymentDetails").DataTable({
            dom: "Blfrtip",
            "pageLength": 50,
            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "ajax": {
                "url": url,
                "data": {
                    Src_Type: SrcType,
                    bank_id: BankName,
                    Fromdate: Fromdate,
                    Todate: Todate,
                    Status: Status,
                    Currency: Currency,
                    InsType: InsType,
                    RecoStatus: RecoStatus,
                    WF_Status: WF_Status
                },
                "type": "POST",
                "datatype": "json",
            },
            "columns": StkDtldataColumns(),
            columnDefs: StkDtlDataColumnRenders(),
            buttons: [
                {
                    extend: "csv",
                    className: "btn-sm",
                    action: function (e, dt, button, config) {
                        var csvUrl = "/ApplicationLayer/BankPayment/ExportCsv";
                        if (docid != '105104115120') {
                            csvUrl = "/ApplicationLayer/BankReceipt/ExportCsv";
                        }
                        let CsvName = $("title").text() + "_" + moment().format('YYYYMMDDhhmmss');
                        Cmn_importDataToCSV(e, dt, button, config, csvUrl, CsvName);

                    }

                }],
        });
        //var exportbtn = `<button type="submit" class="btn btn-default buttons-csv buttons-html5 btn-sm" onclick="return InsertSearchDetail()" id='' tabindex="0" aria-controls="datatable-buttons"
        //        name="Command" value="CSV">
        //        <span>CSV</span></button>`;
        //$("#Tbl_BankPaymentDetails_length").append(exportbtn);
    }
    //function InsertSearchDetail() {
    //    debugger
    //    var searchValue = $("#Tbl_BankPaymentDetails_filter input[type=search]").val();
    //    $("#searchValue").val(searchValue);
    //    return true;
    //}
    function StkDtldataColumns() {
        var Array = [];
        var Array = [
            { "data": "SrNo", "name": "SrNo", "autoWidth": true },
            { "data": "bank_name", "name": "bank_name", "autoWidth": true },
            { "data": "vou_no", "name": "vou_no", "autoWidth": true, className:"ItmNameBreak itmStick tditemfrz"},
            { "data": "vou_dt", "name": "vou_dt", "autoWidth": true },
            { "data": "vou_date", "name": "vou_date", "autoWidth": true },
            { "data": "pdc", "name": "pdc", "autoWidth": true },
            { "data": "int_br", "name": "int_br", "autoWidth": true },
            { "data": "SrcType", "name": "SrcType", "autoWidth": true },
            { "data": "src_doc_no", "name": "src_doc_no", "autoWidth": true },
            { "data": "src_doc_dt", "name": "src_doc_dt", "autoWidth": true },
            { "data": "ins_type", "name": "ins_type", "autoWidth": true },
            { "data": "ins_no", "name": "ins_no", "autoWidth": true },
            { "data": "curr_logo", "name": "curr_logo", "autoWidth": true, className: "center" },
            { "data": "vou_amt", "name": "vou_amt", "autoWidth": true, className: "num_right" },
            { "data": "vou_status", "name": "vou_status", "autoWidth": true },
            { "data": "reco_status", "name": "reco_status", "autoWidth": true },
            { "data": "create_by", "name": "create_by", "autoWidth": true },
            { "data": "created_on", "name": "created_on", "autoWidth": true },
            { "data": "app_by", "name": "app_by", "autoWidth": true },
            { "data": "app_dt", "name": "app_dt", "autoWidth": true },
            { "data": "mod_by", "name": "mod_by", "autoWidth": true },
            { "data": "mod_on", "name": "mod_on", "autoWidth": true }
        ];

        return Array;
    }
    function StkDtlDataColumnRenders() {
        debugger;
        var array = [];
        array = [
            {
                'createdCell': function (td, cellData, rowData, row, col) {
                    $(td).attr('id', 'VouNumber');
                },
                render: (data, type, row) => `<div class="col-sm-10 no-padding" id="Bp_Vouno">${data}</div>
                                                <div class="col-sm-2 i_Icon">
                                                    <button type="button" id="VoucherDetail" class="calculator" onclick="OnClickIconBtn(event);" data-toggle="modal" data-target="#VoucherDetailMW" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="@Resource.VoucherDetail"> </button>
                                                </div>`,
                targets: 2
            },
            {
                'createdCell': function (td, cellData, rowData, row, col) {
                    $(td).attr('id', 'Bp_Date');
                },
                targets: 3
            },
            {
                'createdCell': function (td, cellData, rowData, row, col) {
                    $(td).attr('id', 'hdVouDate');
                    $(td).attr('hidden', 'hidden');
                },
                targets: 4
            },
            {

                render: (data, type, row) => data == "Y" ? `<i class="fa fa-check text-success " aria-hidden="true"></i>` :`<i class="fa fa-times-circle text-danger" aria-hidden="true"></i>`,
                targets: 5
            },
            {
                render: (data, type, row) => data == "Y" ? `<i class="fa fa-check text-success " aria-hidden="true"></i>` :`<i class="fa fa-times-circle text-danger" aria-hidden="true"></i>`,
                targets: 6
            },
            {
                'createdCell': function (td, cellData, rowData, row, col) {
                    $(td).attr('id', 'Doc_Status');
                },
                targets: 14
            }
        ]
        return array;
    }
</script>
@*@if (Model.VouSearch != null)
{
    if (Model.VouSearch == "Vou_Search")
    {
        @Scripts.Render("~/Content/Scripts/DataTableRefreshJs")
        @Scripts.Render("~/Content/Scripts/DatatablesJs")
        Model.VouSearch = null;
    }
}*@





