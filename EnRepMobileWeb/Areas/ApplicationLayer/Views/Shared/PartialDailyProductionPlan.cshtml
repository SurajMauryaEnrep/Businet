@using EnRepMobileWeb.Resources;
@using System.Data;
@{
    decimal tableWidth = 1200;//= "width1800";
    if (ViewBag.DailyPPDetailDates != null)
    {
        var count = ViewBag.DailyPPDetailDates.Rows.Count;
        if (count > 4)
        {
            tableWidth = 1200 + 200 * (count - 4);
        }
    }
}
<style>
    
    #datatable-buttons-new_wrapper .dt-buttons {
        position: absolute;
        margin-left: 15% !important;
        top: 0px;
    }

    #datatable-buttons-new_filter {
        position: absolute;
        right: 5px;
        top: 0px;
    }

    #datatable-buttons-new_wrapper {
        padding-left: 2px !important;
    }
    
        #datatable-buttons-new_wrapper .dt-buttons {
            width: 6%;
            margin-left: 2%;
        }
</style>

<script src="~/Content/Scripts/Common/CommonPartialJS.js"></script>
<script src="~/Content/Scripts/ApplicationLayer/ProductionAndPlanning/MIS/DailyProductionPlan/DailyProductionPlan.js"></script>
<table id="datatable-buttons-new" class="table table-striped table-bordered itmfrz " style="min-width:@(tableWidth.ToString()+"px") !important;" cellspacing="0">
    <thead>
        <tr class="sticky-header">
            <th width="30">&nbsp;</th>
            <th class="itmStick width-250" width="12%">&nbsp;</th>
            <th width="70">&nbsp;</th>
            @if (ViewBag.DailyPPDetailDates != null)
            {
                foreach (System.Data.DataRow dr in ViewBag.DailyPPDetailDates.Rows)
                {
                    var dt = dr["date"].ToString();
                    string a = dt.Replace("-", "");
                    var DateId = "date" + a;
                    <th colspan="2">@dr["date"]<span hidden id="@DateId">@dr["date_ymd"]</span></th>

                }
            }
        </tr>
        <tr class="sticky-header">
            <th width="30">@Resource.SrNo</th>
            <th class="itmStick width-250" width="12%">@Resource.Product  <br /> @Resource.Name</th>
            <th width="70">@Resource.UOM</th>
            @if (ViewBag.DailyPPDetailDates != null)
            {
                foreach (System.Data.DataRow dr in ViewBag.DailyPPDetailDates.Rows)
                {
                    <th>@Resource.Planned</th>
                    <th>@Resource.Produced</th>
                }
            }

        </tr>
    </thead>
    <tbody id="">
        @if (ViewBag.DailyPPDetailProducts != null)
        {
            var srNo = 1;
            DataView data = new DataView();
            foreach (System.Data.DataRow dr in ViewBag.DailyPPDetailProducts.Rows)
            {
                <tr>
                    <td>@srNo</td>
                    <td id="tditem" class="ItmNameBreak itmStick tditemfrz">
                        <div class="col-sm-11 lpo_form no-padding">
                            @dr["item_name"]
                            <input hidden id="tdProductId" value='@dr["op_out_item_id"]' />
                            <input hidden id="tdProductName" value='@dr["item_name"]' />
                        </div>
                        <div class="col-sm-1 i_Icon">
                            <button type="button" id="ItmInfoBtnIcon" class="calculator" onclick="OnClickIconBtntbl(event);" data-toggle="modal" data-target="#ItemInfo" data-backdrop="static" data-keyboard="false">
                                <img src="/Content/Images/iIcon1.png" alt="" title="@Resource.ItemInformation">
                            </button>
                        </div>
                    </td>
                    <td id="UOM">@dr["uom_alias"]</td>
                    @if (ViewBag.DailyPPDetailDates != null)
                    {
                        foreach (DataRow dr1 in ViewBag.DailyPPDetailDates.Rows)
                        {
                            var dt = dr1["date"].ToString();
                            string a = dt.Replace("-", "");
                            var DateId = "date" + a;
                            if (ViewBag.DailyPPDetailScheduleDetail != null)
                            {
                                data = ViewBag.DailyPPDetailScheduleDetail.DefaultView;
                                DataTable NewDT = new DataTable();
                                data.RowFilter = "op_out_item_id='" + dr["op_out_item_id"].ToString() + "'";

                                NewDT = data.ToTable();
                                data = NewDT.DefaultView;
                                data.RowFilter = "date='" + dr1["date"].ToString() + "'";
                                NewDT = data.ToTable();
                                if (NewDT.Rows.Count > 0)
                                {
                                    foreach (System.Data.DataRow dr2 in NewDT.Rows)
                                    {
                                        <td class="num_right">
                                            <div class="col-sm-10 lpo_form no-padding">
                                                @dr2["prod_qty"]
                                                @*<span hidden id="prod_qty">@dr2["prod_qty"]</span>*@
                                            </div>
                                            @if (dr2["prod_qty"].ToString() != "")
                                            {
                                                <div class="col-sm-2 i_Icon">
                                                    <button type="button" id="ItmInfoBtnIcon" class="calculator" onclick="OnClickDPP_PlannedQty(event,'@DateId');" data-toggle="modal" data-target="#DPlannedDetail" data-backdrop="static" data-keyboard="false">
                                                        <img src="/Content/Images/iIcon1.png" alt="" title="@Resource.Planned @Resource.Detail">
                                                    </button>
                                                </div>
                                            }

                                        </td>
                                        <td class="num_right">
                                            <div class="col-sm-10 lpo_form no-padding">
                                                @dr2["produced_qty"]
                                                @*<span hidden id="produced_qty">@dr2["produced_qty"]</span>*@
                                            </div>
                                            @if (dr2["produced_qty"].ToString() != "")
                                            {
                                                <div class="col-sm-2 i_Icon">
                                                    <button type="button" id="ItmInfoBtnIcon" class="calculator" onclick="OnClickDPP_ProducedQty(event,'@DateId');" data-toggle="modal" data-target="#DProductionDetail" data-backdrop="static" data-keyboard="false">
                                                        <img src="/Content/Images/iIcon1.png" alt="" title="@Resource.Production @Resource.Detail">
                                                    </button>
                                                </div>
                                            }


                                        </td>
                                    }
                                }
                                else
                                {
                                    <td class="num_right"></td>
                                    <td class="num_right"></td>
                                }
                            }
                            else
                            {
                                <td class="num_right"></td>
                                <td class="num_right"></td>
                            }
                        }
                    }
                </tr>
                srNo++;
            }
        }
    </tbody>
</table>
@if (ViewBag.Search != null)
{
    if (ViewBag.Search)
    {
        @Scripts.Render("~/Content/Scripts/DataTableRefreshJs")
        @Scripts.Render("~/Content/Scripts/DatatablesJs")
    }
}

