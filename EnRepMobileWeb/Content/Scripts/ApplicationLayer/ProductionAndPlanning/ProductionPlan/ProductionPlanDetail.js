$(document).ready(function () {
    debugger;
    $("#AutoGen_Remarks").val($("#AutoGeneratedFromProductionPlan").text());
    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function (i, row) {
        var currentRow = $(this);
        var sno = currentRow.find("#hfsno").val();
        if ($("#ddl_src_type").val() != "O") {
            BindProductItmList(sno, "bdind", currentRow);
        }
        var OrderToProcureQuantity = parseFloat(CheckNullNumber(currentRow.find("#OrderToProcureQuantity").val()));
        if (OrderToProcureQuantity != "" || OrderToProcureQuantity != 0) {
            $("#RequiredRequirementArea").removeAttr('style');
        }
    });
    if ($("#ddl_src_type").val() == "O") {
        BindCustomerList();
        $("#ReqAreaList").select2();
    } else {
        BindProductItmList(1, "");
    }
/*    ddl_src_type_onchange();*/
    $('#ProductPlanItemDetailsTbl tbody').on('click', '.deleteIcon', function () {
        debugger; 
        var child = $(this).closest('tr').nextAll();
        child.each(function () { 
            var id = $(this).attr('id');
            var idx = $(this).children('.row-index').children('p');
            var dig = parseInt(id.substring(1));
            idx.html(`Row ${dig - 1}`);
            $(this).attr('id', `R${dig - 1}`);
        });

        var Sno = $(this).closest('tr').find("#hfsno").val();
        var item_id = $(this).closest('tr').find("#ProductName" + Sno).val();
        $(this).closest('tr').remove();
        let ddl_src_type = $("#ddl_src_type").val();
        if (ddl_src_type == "O") {
            $("#HdnTablePendingOrderQty > tbody > tr #h_item_id:contains('" + item_id + "')").closest("tr").each(function () {
                $(this).remove();

            });
        }
        Cmn_DeleteSubItemQtyDetail(item_id);
        DeleteSubItemQtyDetail_proc(item_id);
        ResetSerialNo();
    });
    if ($("#ProductPlanItemDetailsTbl tbody tr").length == 0) {
        $("#AllProductPlanCheck").attr("disabled", true);
        $("#AllDelete").attr("disabled", true);
        $("#AllDelete").css("filter", "grayscale(100%)");
    }
    HideForecastfields();
    HideShowAddProPlanBtn();
    PPNo = $("#txt_PPNumber").val();
    $("#hdDoc_No").val(PPNo);


    if ($("#hd_Status").val() == "" || $("#hd_Status").val() == null) {
        $("#BtnAddItem").closest(".plus_icon1").css("display", "none");
        $("#ProductPlanItemDetailsTbl tbody tr select ,#ItmInfoBtnIcon ,#StockDetail ,#PlannedQuantity ,#PlannedQuantityDetail ,#remarks").attr("disabled", true);
    }
   

});
function DeleteSubItemQtyDetail_proc(item_id) {
    debugger;
    if (item_id != null && item_id != "") {
        if ($("#hdn_SubItemDetailTblPP_Procure >tbody >tr").length > 0) {
            if ($("#hdn_SubItemDetailTblPP_Procure >tbody >tr td #ItemId[value=" + item_id + "]").length > 0) {
                $("#hdn_SubItemDetailTblPP_Procure >tbody >tr td #ItemId[value=" + item_id + "]").closest('tr').remove();
            }
        }
    }
}
var QtyDecDigit = $("#QtyDigit").text();///Quantity

function ForwardBtnClick() {
    debugger;
    //var OrderStatus = "";
    //OrderStatus = $('#hd_Status').val().trim();
    //if (OrderStatus === "D" || OrderStatus === "F") {

    //    if ($("#hd_nextlevel").val() === "0") {
    //        $("#Btn_Forward").attr("data-target", "");
    //    }
    //    else {
    //        $("#Btn_Forward").attr("data-target", "#Forward_Pop");
    //        $("#Btn_Approve").attr("data-target", "");
    //    }
    //    var Doc_ID = $("#DocumentMenuId").val();
    //    $("#OKBtn_FW").attr("data-dismiss", "modal");

    //    Cmn_GetForwarderList(Doc_ID);

    //}
    //else {
    //    $("#Btn_Forward").attr("data-target", "");
    //    $("#Btn_Forward").attr('onclick', '');
    //    $("#Btn_Forward").css({ "-webkit-filter": "grayscale(100%)", "filter": "grayscale(100%);" });
    //}
    //return false;

    /*start Add by Hina on 19-02-2024 to chk Financial year exist or not*/
    try {
    var compId = $("#CompID").text();
    var brId = $("#BrId").text();
    var SrtDate = $("#txt_PPDate").val();
    $.ajax({
        type: "POST",
        /*url: "/Common/Common/CheckFinancialYear",*/
        url: "/Common/Common/CheckFinancialYearAndPreviousYear",
        data: {
            compId: compId,
            brId: brId,
            DocDate: SrtDate
        },
        success: function (data) {
            /* if (data == "Exist") {*/ /*End to chk Financial year exist or not*/
            /*Above Commented and modify by Hina sharma on 09-05-2025 to check Existing with previous year transaction*/
            if (data == "TransAllow") {
                var OrderStatus = "";
                OrderStatus = $('#hd_Status').val().trim();
                if (OrderStatus === "D" || OrderStatus === "F") {

                    if ($("#hd_nextlevel").val() === "0") {
                        $("#Btn_Forward").attr("data-target", "");
                    }
                    else {
                        $("#Btn_Forward").attr("data-target", "#Forward_Pop");
                        $("#Btn_Approve").attr("data-target", "");
                    }
                    var Doc_ID = $("#DocumentMenuId").val();
                    $("#OKBtn_FW").attr("data-dismiss", "modal");

                    Cmn_GetForwarderList(Doc_ID);

                }
                else {
                    $("#Btn_Forward").attr("data-target", "");
                    $("#Btn_Forward").attr('onclick', '');
                    $("#Btn_Forward").css({ "-webkit-filter": "grayscale(100%)", "filter": "grayscale(100%);" });
                }
            }
            else {/* to chk Financial year exist or not*/
                /*  swal("", $("#FinancialYearDoesNotExistTransactionCanNotBeDone").text(), "warning");*/
                /*Above Commented and modify by Hina sharma on 09-05-2025 to check Existing with previous year transaction*/
                swal("", $("#NomodificationisallowedinpreviousFYdocument").text(), "warning");
                $("#Btn_Forward").attr("data-target", "");
                $("#Btn_Approve").attr("data-target", "");
                $("#Forward_Pop").attr("data-target", "");

            }
        }
    });
    }
    catch (ex) {
        console.log(ex);
        return false;
    }
    /*End to chk Financial year exist or not*/
    return false;
}
function ProductionCompletioDateReplicate() {
    debugger;
    var date = $("#ProductionCompletionDt").val();
    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function () {
        debugger;
        var currentRow = $(this);
        var Qty = currentRow.find("#PlannedQuantity").val();
        //var ProduceQty = currentRow.find("#OrderToProduceQuantity").val();
        var BOM_Avl = currentRow.find("#BOM_Avl").val();
        if (BOM_Avl == "N") {

        }
        else {
            if (parseFloat(CheckNullNumber(Qty)) > 0) {
                currentRow.find("#ProductionCompletionDate").val(date);
                currentRow.find("#ProductionCompletionDate").css("border-color", "#ced4da");
                currentRow.find("#ProductionCompletionDateError").text("");
                currentRow.find("#ProductionCompletionDateError").css("display", "none");
            }
        }        
    });
}
async function OnClickForwardOK_Btn() {
    debugger;
    var fwchkval = $("input[name='forward_action']:checked").val();
    var PPNo = "";
    var PPDate = "";
    var docid = "";
    var level = "";
    var Remarks = "";
    var forwardedto = "";
    var WF_Status1 = "";
    var ModelData = "";
    var mailerror = "";

    Remarks = $("#fw_remarks").val();
    PPNo = $("#txt_PPNumber").val();
    PPDate = $("#txt_PPDate").val();
    docid = $("#DocumentMenuId").val();
    WF_Status1 = $("#WF_Status1").val();
    ModelData = (PPNo + ',' + WF_Status1);
    var ListFilterData1 = $("#ListFilterData1").val();
    $("#forwardDetailsTbl >tbody >tr").each(function () {
        var currentRow = $(this);
        debugger;
        var Userid = currentRow.find("#user").text();
        if ($("#r_" + Userid).is(":checked")) {
            //docid = currentRow.find("td:eq(2)").text();
            forwardedto = currentRow.find("#user").text();
            level = currentRow.find("#level").text();
        }
    });
    if (fwchkval != "Approve") {
        var pdfAlertEmailFilePath = "ProductionPlan_" + GetDatetimeYYYYMMDDHHMMSS() + ".pdf";
        var pdfAlertEmailFilePath1 = await Cmn_GetPdfFilePathToSendonEmailAlert(DocNo, DocDate, pdfAlertEmailFilePath, docid, fwchkval, "/ApplicationLayer/ProductionPlan/SavePdfDocToSendOnEmailAlert");
        if (pdfAlertEmailFilePath1 == "" || pdfAlertEmailFilePath1 == null) {
            pdfAlertEmailFilePath = "";
        }
    }

    if (fwchkval === "Forward") {
        if (fwchkval != "" && PPNo != "" && PPDate != "" && level != "") {
            debugger;
            await Cmn_InsertDocument_ForwardedDetail1(PPNo, PPDate, docid, level, forwardedto, fwchkval, Remarks, pdfAlertEmailFilePath);
            mailerror = $("#MailError").val();
            window.location.href = "/ApplicationLayer/ProductionPlan/ToRefreshByJS?ListFilterData1=" + ListFilterData1 + "&ModelData=" + ModelData + "&Mailerror=" + mailerror;
        }
    }
    if (fwchkval === "Approve") {
        var list = [{ PPNo: PPNo, PPDate: PPDate, A_Status: "Approve", A_Level: $("#hd_currlevel").val(), A_Remarks: Remarks, AutoGen_Remarks:$("#AutoGen_Remarks").val() }];
        var AppDtList = JSON.stringify(list);
        window.location.href = "/ApplicationLayer/ProductionPlan/ApproveDocByWorkFlow?AppDtList=" + AppDtList + "" + "&ListFilterData1=" + ListFilterData1 + "&WF_Status1=" + WF_Status1;
    }
    if (fwchkval === "Reject") {
        if (fwchkval != "" && PPNo != "" && PPDate != "") {
            await Cmn_InsertDocument_ForwardedDetail1(PPNo, PPDate, docid, $("#hd_currlevel").val(), forwardedto, fwchkval, Remarks, pdfAlertEmailFilePath);
            mailerror = $("#MailError").val();
            window.location.href = "/ApplicationLayer/ProductionPlan/ToRefreshByJS?ListFilterData1=" + ListFilterData1 + "&ModelData=" + ModelData + "&Mailerror=" + mailerror;
        }
    }
    if (fwchkval === "Revert") {
        debugger
        if (fwchkval != "" && PPNo != "" && PPDate != "") {
            await Cmn_InsertDocument_ForwardedDetail1(PPNo, PPDate, docid, $("#hd_currlevel").val(), forwardedto, fwchkval, Remarks, pdfAlertEmailFilePath);
            mailerror = $("#MailError").val();
            window.location.href = "/ApplicationLayer/ProductionPlan/ToRefreshByJS?ListFilterData1=" + ListFilterData1 + "&ModelData=" + ModelData + "&Mailerror=" + mailerror;
        }
    }
}
//function GetPdfFilePathToSendonEmailAlert(poNo, poDate, fileName) {
//    debugger;
//    $.ajax({
//        type: "POST",
//        url: "/ApplicationLayer/ProductionPlan/SavePdfDocToSendOnEmailAlert",
//        data: { poNo: poNo, poDate: poDate, fileName: fileName },
//        /*dataType: "json",*/
//        success: function (data) {

//        }
//    });
//}
function OtherFunctions(StatusC, StatusName) {

}
function ForwardHistoryBtnClick() {
    var Doc_ID = $("#DocumentMenuId").val();
    var Doc_No = $("#txt_PPNumber").val();
    debugger;
    if (Doc_No != "" && Doc_No != null && Doc_ID != "" && Doc_ID != null)
        Cmn_GetForwarderHistoryList(Doc_No, Doc_ID);
    return false;
}
/*-----------------------------Production Plan Against Sales Forecast----------------------------------*/
async function AddForeCastItemDetail() {
   var Error = "N";
    var F_Fy = $("#ddl_financial_year").val();
    var F_Period = $("#ddl_period").val();
    var FromDate = $("#hdn_FromDate").val();
    var ToDate = $("#hdn_ToDate").val();
    if (CheckVallidation("ddl_financial_year", "vm_ddl_financial_year") == false) {
        Error = "Y";
    }
    if (CheckVallidation("ddl_period", "vm_ddl_period") == false) {
        Error = "Y";
    }
    var RequiredArea = $("#ddlRequiredArea").val();

    if (RequiredArea == "0" || RequiredArea == null || RequiredArea == "") {
        $("#vmRequiredArea").text($("#valueReq").text());
        $("#vmRequiredArea").css("display", "block");
        $("#ddlRequiredArea").css("border-color", "red");
        Error = "Y";
    }
    else {
        $("#vmRequiredArea").css("display", "none");
        $("#ddlRequiredArea").css("border-color", "#ced4da");
    }
    if (Error == "N") {
        $("#ddl_src_type").attr("disabled", true);
        $("#ddl_financial_year").attr("disabled", true);
        $("#ddl_period").attr("disabled", true);

        $("#AddBtnIconPP").css("display", "none");
        showLoader();
        debugger;
        try {
            await $.ajax({
                type: "POST",
                url: "/ApplicationLayer/ProductionPlan/AddForeCastItemDetail",
                data: {
                    F_Fy: F_Fy,
                    F_Period: F_Period,
                    FromDate: FromDate,
                    ToDate: ToDate
                },
                success: function (data) {
                    try {
                        var arr = JSON.parse(data);
                        if (arr != null) {
                            if (arr.Table.length > 0) {

                                var QtyDigit = $("#QtyDigit").text();
                                for (var i = 0; i < arr.Table.length; i++) {
                                    AddnewRowOnly(i + 1, arr.Table[i].BOM_Avl);
                                    HideShowAddProPlanBtn()
                                    //AddNewProduct_OnClick();
                                    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function (i, row) {
                                        debugger
                                        var currentRow = $(this);
                                        if (currentRow.find("#ProductName" + (i + 1)).val() == null) {

                                            currentRow.find("#ProductName" + (i + 1)).append(`<option value="${arr.Table[i].item_id}">${arr.Table[i].item_name}</option>`);
                                            currentRow.find("#hfproductID").val(arr.Table[i].item_id);
                                            currentRow.find("#UOM").val(arr.Table[i].uom_alias);
                                            currentRow.find("#UOMID").val(arr.Table[i].uom_id);
                                            currentRow.find("#ItemtypeFlag").val(arr.Table[i].i_pur);
                                            currentRow.find("#ForecastQuantity").val(parseFloat(arr.Table[i].tgt_qty).toFixed(QtyDigit));
                                            currentRow.find("#AvailableStockInBase").val(parseFloat(arr.Table[i].Avlstock).toFixed(QtyDigit));
                                            currentRow.find("#WIPstock").val(parseFloat(arr.Table[i].wip_stock).toFixed(QtyDigit));
                                            currentRow.find("#ShopFloorstock").val(parseFloat(arr.Table[i].shfl_avl_stk_bs).toFixed(QtyDigit));
                                            //currentRow.find("#INtransit").val(parseFloat(arr.Table[i].intransit_stock).toFixed(QtyDigit));
                                            var PlanQty = parseFloat(arr.Table[i].tgt_qty) - (parseFloat(arr.Table[i].Avlstock) + parseFloat(arr.Table[i].wip_stock) + parseFloat(arr.Table[i].shfl_avl_stk_bs))
                                            PlanQty = PlanQty > 0 ? PlanQty : 0;
                                            if (arr.Table[i].BOM_Avl == "N") {
                                                currentRow.find("#BOM_Avl").val(arr.Table[i].BOM_Avl);
                                            }
                                            currentRow.find("#PlannedQuantity").val(parseFloat(PlanQty).toFixed(QtyDigit)).trigger("change");
                                            //currentRow.find("#OrderToProduceQuantity").attr("disabled", false)
                                            //currentRow.find("#OrderToProcureQuantity").attr("disabled", false)
                                            debugger;
                                            currentRow.find("#sub_item").val(arr.Table[i].sub_item);
                                            var subitem = arr.Table[i].sub_item;
                                            if (subitem == "Y") {
                                                currentRow.find("#SubItemButton").attr("disabled", false)
                                                currentRow.find("#SubItemShflStockBtn").attr("disabled", false)
                                                currentRow.find("#SubItemWipStockBtn").attr("disabled", false)
                                                currentRow.find("#SubItemAvlStockBtn").attr("disabled", false)
                                                currentRow.find("#SubItemOrdrToPrecurQty").attr("disabled", false)
                                            }
                                            else {
                                                currentRow.find("#SubItemButton").attr("disabled", true)
                                                currentRow.find("#SubItemShflStockBtn").attr("disabled", true)
                                                currentRow.find("#SubItemWipStockBtn").attr("disabled", true)
                                                currentRow.find("#SubItemAvlStockBtn").attr("disabled", true)
                                                currentRow.find("#SubItemOrdrToPrecurQty").attr("disabled", true)
                                            }
                                            currentRow.find("#ProductName" + (i + 1)).attr("disabled", true);
                                        }


                                    });
                                }
                                debugger;
                                //for (var i = 0; i < arr.Table1.length; i++) {
                                //    $("#hdn_Sub_ItemDetailTbl tbody").append(
                                //        `<tr>
                                //                            <td><input type="text" id="ItemId" value='${arr.Table1[i].item_id}'></td>
                                //                            <td><input type="text" id="subItemId" value='${arr.Table1[i].sub_item_id}'></td>
                                //                            <td><input type="text" id="SrcDocQty" value='${arr.Table1[i].tgt_qty}'></td>
                                //                           <td><input type="text" id="SubItemPPLPendingQty" ='0'></td>
                                //                            <td><input type="text" id="subItemQty" value=''></td>



                                //                        </tr>`)
                                //}
                                //$(".deleteIcon").css("display", "none");//commented by Suraj maurya on 22-01-2025 as discussed with vishal sir and prem sir.
                                $("#AddBtnIconPP").css("display", "none");

                            }
                        }
                        hideLoader();
                    }
                    catch (ex) {
                        console.log(ex);
                        hideLoader();
                    }
                    debugger
                }



            })
        }
        catch (ex) {
            console.log(ex);
            hideLoader();
        }


    }
    else {
        return false;
    }
  

}
function ResetSerialNo() {
    var SoNo = 0;
    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function (i, row) {
        var currentRow = $(this);
        SoNo = parseInt(SoNo) + 1;
        currentRow.find("#sno").text(SoNo);
    });
}
function ShowForecastfields() {
    //$("#divdocsection").css("display", "block");
    $("#thforecast").removeAttr("style");
    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function (i, row) {
        var currentRow = $(this);
        currentRow.find("#tdforecastqty").removeAttr("style");
    });
}
function ShowSalesOrderfields() {
    //$("#divdocsection").css("display", "block");
    $("#thforecast").css("display", "none");
    $("#thPendingodrqty").css("display", "");
    //$("#thOrderToProcureqty").css("display", "");
    //$("#thProcureComplsnDate").css("display", "");
    //$("#thOrderToProduceqty").css("display", "");
    //$("#thProduceComplsnDate").css("display", "");
    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function (i, row) {
        var currentRow = $(this);
        currentRow.find("#tdforecastqty").css("display", "none");
        currentRow.find("#thPendingodrqty").css("display", "");
        //currentRow.find("#thOrderToProcureqty").css("display", "");
        //currentRow.find("#thProcureComplsnDate").css("display", "");
        //currentRow.find("#thOrderToProduceqty").css("display", "");
        //currentRow.find("#thProduceComplsnDate").css("display", "");
        
    });
}
function HideSalesOrderfields() {
    //$("#divdocsection").css("display", "block");
    //$("#thforecast").css("display", "none");
    $("#thPendingodrqty").css("display", "none");
    //$("#thOrderToProcureqty").css("display", "none");
    //$("#thProcureComplsnDate").css("display", "none");
    //$("#thOrderToProduceqty").css("display", "none");
    //$("#thProduceComplsnDate").css("display", "none");
    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function (i, row) {
        var currentRow = $(this);
        //currentRow.find("#tdforecastqty").css("display", "none");
        currentRow.find("#thPendingodrqty").css("display", "none");
        //currentRow.find("#thOrderToProcureqty").css("display", "none");
        //currentRow.find("#thProcureComplsnDate").css("display", "none");
        //currentRow.find("#thOrderToProduceqty").css("display", "none");
        //currentRow.find("#thProduceComplsnDate").css("display", "none");

    });
}
function HideForecastfields() {
    //$("#divdocsection").css("display", "none");
    $("#thforecast").css("display", "none");
    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function (i, row) {
        var currentRow = $(this);
        currentRow.find("#tdforecastqty").css("display", "none")
    });
}
/*----------------------------------End------------------------------------------------------------*/ 
function ddl_src_type_onchange() {
    debugger;
    HideShowAddProPlanBtn();
    var srcval = $("#ddl_src_type").val();
    $("#ddl_financial_year").val(0).trigger('change');
    $("#ddl_period").val(0);
    $("#vm_ddl_financial_year").css("display", "none");
    $("#ddl_financial_year").css("border-color", "#ced4da");
    $("#vm_ddl_period").css("display", "none");
    $("#ddl_period").css("border-color", "#ced4da");
    if (srcval === "F") {
        $("#ProductionbyDAdHoc").css("display", "none");
        $("#ProductionbyDF").css("display", "");
        $("#ProductionbySO").css("display", "none");
    $("#ProductPlanItemDetailsTbl tbody tr").remove();
    $("#BtnAddItem").closest("div .plus_icon1").css("display", "none");
    }
    else if (srcval === "O") { /*For Production Plan Against Sales order*/
        $("#CustomerName").val(0).trigger('change');
        $("#OrderNumber").val(0).trigger('change');
        $("#ProductPlanItemDetailsTbl tbody tr").remove();
        $("#ProductionbyDAdHoc").css("display", "none");
        $("#ProductionbyDF").css("display", "none");
        $("#ProductionbySO").css("display", "");
        BindCustomerList();
        //$("#AddBtnIconSO").css("display", "none");
        $("#BtnAddItem").closest("div .plus_icon1").css("display", "none");
    } else if (srcval === "A") {
        $("#ProductionbyDAdHoc").css("display", "");
        $("#ProductionbyDF").css("display", "None");
        $("#ProductionbySO").css("display", "none");
        $("#BtnAddItem").closest("div .plus_icon1").css("display", "");
        $("#ProductPlanItemDetailsTbl tbody tr").remove();
        AddNewProduct_OnClick();
        $("#ProductPlanItemDetailsTbl tbody tr select ,#ItmInfoBtnIcon ,#StockDetail ,#PlannedQuantity ,#PlannedQuantityDetail ,#remarks").attr("disabled", false);
    }
    else {
        $("#ProductionbyDAdHoc").css("display", "none");
        $("#ProductionbyDF").css("display", "");
        $("#ProductionbySO").css("display", "none");
        //$("#BtnAddItem").closest("div .plus_icon1").css("display", "");
        $("#ProductPlanItemDetailsTbl tbody tr").remove();
        AddNewProduct_OnClick();
        $("#ProductPlanItemDetailsTbl tbody tr select ,#ItmInfoBtnIcon ,#StockDetail ,#PlannedQuantity ,#PlannedQuantityDetail ,#remarks").attr("disabled", true);
    }

};
//Commented By Suraj on 25-01-2023
//function OnChangeReqAreaList() {
//    debugger;
//    var ReqAreaList = $("#ReqAreaList").val();
//    if (ReqAreaList != "0") {
//        $('[aria-labelledby="select2-ReqAreaList-container"]').css("border-color", "#ced4da");
//        $("#vm_ReqAreaList").text("");
//        $("#vm_ReqAreaList").css("display", "None");
//    }
//}
function HideShowAddProPlanBtn() {
    var srcval = $("#ddl_src_type").val();
    if (srcval === "F") {
        $("#AddBtnIconPP").removeAttr("style");
     
        ShowForecastfields();
        HideSalesOrderfields()
    }
    else if (srcval === "O") {
        ShowSalesOrderfields();
    }
    else {
        $("#AddBtnIconPP").css("display", "none");
        HideForecastfields();
        HideSalesOrderfields()
    }
    $("#hdn_ddl_src_type").val(srcval);
}
function ddl_financial_year_onchange(e) {
    debugger;
    var ddl_f_frequency = $("#ddl_financial_year").val();
    if (ddl_f_frequency != "0") {
        $("#vm_ddl_financial_year").css("display", "none");
        $("#ddl_financial_year").css("border-color", "#ced4da");
    }
    else {
        $('#vm_ddl_financial_year').text($("#valueReq").text());
        $("#vm_ddl_financial_year").css("display", "block");
        $("#ddl_financial_year").css("border-color", "red");
    }
    var ddl_financial_year = $("#ddl_financial_year").val();
    $("#hdn_ddl_financial_year").val(ddl_financial_year);
    var financial_year = $("#hdn_ddl_financial_year").val();
    $("#txtFromDate").val('');
    $("#txtToDate").val('');
    $('#hdn_FromDate').val('');
    $('#hdn_ToDate').val('');
    var Flag = $("#ddl_src_type").val();
    if (Flag == "F") {
        Flag = "SF";
    }
    if (Flag == "D") {
        Flag = "PP_D";
    }
    if (ddl_f_frequency != "0") {
        $.ajax({
            type: "POST",
            url: "/ApplicationLayer/ProductionPlan/BindPeriod",
            data: {
                financial_year: financial_year,
                Flag: Flag
            },
            dataType: "json",
            success: function (data) {
                debugger;
                if (data !== null && data !== "") {
                    var arr = [];
                    $('#ddl_period').empty();
                    arr = JSON.parse(data);
                    if (arr.Table1.length > 0) {
                        $('#ddl_period').append(`<option value=0>---Select---</option>`);
                        for (var i = 0; i < arr.Table1.length; i++) {
                            $('#ddl_period').append(`<option value="${arr.Table1[i].id}">${arr.Table1[i].name}</option>`);
                        }
                    }
                    else {
                        $('#ddl_period').append(`<option value=0>---Select---</option>`);
                    }
                }
            },
        });
    }
};
function ddl_period_onchange(e) {
    debugger;
    var ddl_financial_year = $("#ddl_financial_year").val();
    $("#hdn_ddl_financial_year").val(ddl_financial_year);
    
    var financial_year = $("#hdn_ddl_financial_year").val();

    var ddl_period = $("#ddl_period").val();
    var F_period = $("#ddl_period option:selected").text();
    if (ddl_period == "0" || ddl_period == null) {
        $("#vm_ddl_period").text($("#valueReq").text());
        $("#vm_ddl_period").css("display", "block");
        $("#ddl_period").css("border-color", "red");
        ValidationFlag = false;
    }
    else {
        $("#vm_ddl_period").css("display", "none");
        $("#ddl_period").css("border-color", "#ced4da");
    }
    $("#hdn_ddl_period").val(ddl_period);
    $("#hdn_period").val(F_period);
    var period = $("#hdn_ddl_period").val();
    resetitemdetail();
    if (ddl_period != "0") {
        $.ajax({
            type: "POST",
            url: "/ApplicationLayer/ProductionPlan/BindDateRange",
            data: {
                financial_year: financial_year,
                period: period,
            },
            dataType: "json",
            success: function (data) {
                debugger;
                if (data !== null && data !== "") {
                    var arr = [];
                    $('#txtFromDate').val('');
                    $('#txtToDate').val('');
                    $('#hdn_FromDate').val('');
                    $('#hdn_ToDate').val('');
                    arr = JSON.parse(data);
                    if (arr.Table.length > 0) {
                        for (var i = 0; i < arr.Table.length; i++) {
                            $('#txtFromDate').val(arr.Table[i].StartDT);
                            $('#txtToDate').val(arr.Table[i].EndDT);

                            $('#hdn_FromDate').val(arr.Table[i].StartDTyf);
                            $('#hdn_ToDate').val(arr.Table[i].EndDTyf);
                        }
                    }

                    if ($("#ddl_src_type").val() == "D")
                        $("#BtnAddItem").closest(".plus_icon1").css("display", "");

                    //$("#ProductPlanItemDetailsTbl tbody tr select ,#ItmInfoBtnIcon ,#StockDetail ,#PlannedQuantity ,#OrderToProcureQuantity ,#PlannedQuantityDetail ,#remarks").attr("disabled", false);
                    $("#ProductPlanItemDetailsTbl tbody tr select ,#ItmInfoBtnIcon ,#StockDetail ,#PlannedQuantity ,#PlannedQuantityDetail ,#remarks").attr("disabled", false);

                }
                else {
                    $('#txtFromDate').val('');
                    $('#txtToDate').val('');

                    $('#hdn_FromDate').val('');
                    $('#hdn_ToDate').val('');
                }
            },
        });
    }
};
function onchangeOrderToProcureQuantity(el, evt) {
    debugger;
    var clickedrow = $(evt.target).closest("tr");
    var OrderToProcureQuantity = clickedrow.find("#OrderToProcureQuantity").val();
    if (OrderToProcureQuantity == "" || OrderToProcureQuantity == null || OrderToProcureQuantity == 0) {
        clickedrow.find("#OrderToProcureQuantity").val("");
        clickedrow.find("#ProcurementCompletionDate").val("");
        clickedrow.find("#ProcurementCompletionDate").attr("disabled", true);
    }
    else {
        clickedrow.find("#OrderToProcureQuantity").val(parseFloat(OrderToProcureQuantity).toFixed(0));
        clickedrow.find("#ProcurementCompletionDate").attr("disabled", false);
    }
    var OrderToProcureQty = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProcureQuantity").val()));
    var PlannedQuantity = parseFloat(CheckNullNumber(clickedrow.find("#PlannedQuantity").val()));
    var OrderToProduceQuantity = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProduceQuantity").val()));
    if (OrderToProcureQty < OrderToProduceQuantity) {
        var qty = OrderToProduceQuantity - OrderToProcureQty;
        clickedrow.find("#OrderToProduceQuantity").val(parseFloat(qty).toFixed(0));
    }
    var ProcdQty = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProduceQuantity").val()));
    if (PlannedQuantity >= (OrderToProcureQty + ProcdQty)) {
        var tqty = (PlannedQuantity - (OrderToProcureQty + ProcdQty));
        var proQty = ProcdQty + tqty;
        clickedrow.find("#OrderToProduceQuantity").val(parseFloat(proQty).toFixed(0));
    }
    else {
        if (PlannedQuantity == OrderToProcureQty) {
            clickedrow.find("#OrderToProduceQuantity").val(parseFloat(0).toFixed(0));
        }
    }
    //if (parseFloat(CheckNullNumber(clickedrow.find("#OrderToProcureQuantity").val())) > 0) {
    //    $("#RequiredRequirementArea").css("display", "block");
    //}
    //else {
    //    $("#RequiredRequirementArea").css("display", "none");
    //}
    RequiredRequirementArea();
    OnChangeProcureQty(evt);
    
}
function resetitemdetail() {
    $('#txtFromDate').val('');
    $('#txtToDate').val('');
};
function AddNewProduct_OnClick() {
    debugger;
    var rowIdx = 0;
    var rowCount = $('#ProductPlanItemDetailsTbl >tbody >tr').length + 1;

    var RowNo = 0; 

    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function (i, row) {
        var currentRow = $(this);
        RowNo = parseInt(currentRow.find("#hfsno").val()) + 1;
    });
    if (RowNo == "0") {
        RowNo = 1;
    }
    AddnewRowOnly(RowNo);
    BindProductItmList(RowNo,"");
    HideShowAddProPlanBtn();
}
function AddnewRowOnly(RowNo,BOM_Avl) {
    var rowIdx = 0;
    var rowCount = $('#ProductPlanItemDetailsTbl >tbody >tr').length + 1;
    var ddl_src_type = $("#ddl_src_type").val();
    var hideSoColumn = "";
    if (ddl_src_type != "O") {
        hideSoColumn = "style='display: none;'";
    }
    var disableBOM = BOM_Avl == "N" ? "disabled" : "";
    var span_SubItemDetail = $("#span_SubItemDetail").text();
    var span_SubItemStockDetail = $("#span_SubItemStockDetail").text();
    var TodayDate = moment().format("YYYY-MM-DD");
    $('#ProductPlanItemDetailsTbl tbody').append(`<tr id="R${++rowIdx}">
            <td class="center"><input type="checkbox" class="tableflat" id="ProductPlanCheck"></td>
            <td class="red center"> <i class="fa fa-trash deleteIcon" aria-hidden="true" title="${$("#Span_Delete_Title").text()}"></i></td>
            <td class="sr_padding"><span id="sno">${rowCount}</span><input type="hidden" id="hfsno" value="${RowNo}" /></td>
            <td class="ItmNameBreak itmStick tditemfrz"><div class="col-sm-10 lpo_form" style="padding:0px;" >
                <select class="form-control" id="ProductName${RowNo}" onchange="OnChangeProductName(event)" name="ProductName"></select>
                <span id="productnameError" class="error-message is-visible"></span>
                <input type="hidden" id="hfproductID" /></div>
                <div class="col-sm-1 i_Icon">
                 <button type="button" id="ItmInfoBtnIcon" class="calculator" onclick="OnClickIconBtn(event);" data-toggle="modal" data-target="#ItemInfo" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="${$("#Span_ItemInformation_Title").text()}"></button>
                </div>
                <div class="col-sm-1 i_Icon">
                <button type="button" id="BtnBOMDetail" class="calculator no-padding subItmImg" ${disableBOM} onclick="OnClickIconBtnBOMDetail(event);" data-toggle="modal" data-target="#BillOfMaterial" data-backdrop="static" data-keyboard="false" ><img src="/Content/Images/BillOfMaterial.png" alt="" title="${$("#span_BillOfMaterial").text()}"></button>
                <input type="hidden" id="BOM_Avl" />
                <input type="hidden" id="ItemtypeFlag" />
                </div>
            </td>
            <td><input id="UOM" class="form-control" type="text" name="UOM" placeholder="${$("#ItemUOM").text()}" disabled><input id="UOMID" type="hidden" /></td>
            <td id="tdforecastqty" style="display:none"><input id="ForecastQuantity" class="form-control num_right" type="text" name="ForecastQuantity" placeholder="${$("#span_ForecastQuantity").text()}" disabled></td>
            <td id="tdPendingodrqty" ${hideSoColumn}>
                 <div class="col-sm-10 lpo_form" style="padding:0px;">
                     <input id="PendingOrderQuantity" class="form-control num_right" type="text" value="" name="PendingOrderQuantity" placeholder="0000.00" disabled>
                 </div>
                 <div class="col-sm-2 i_Icon">
                     <button type="button" id="" class="calculator" onclick="OnClickIconBtnPendingOrd(event);" data-toggle="modal" data-target="#PendingOrderQuantity" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="${$("#span_OrderWiseDetail").text()}"> </button>
                 </div>
            </td>
            <td><div class="col-sm-8" style="padding:0px;"><input id="AvailableStockInBase" class="form-control num_right" type="text" name="AvailableStock" placeholder="0000.00" disabled></div>
            <div class="col-sm-2 i_Icon" style="padding:0px;"><button type="button" id="StockDetail" class="calculator" onclick="ItemStockWareHouseWise(event)" data-toggle="modal" data-target="#StockDetail"><img src="/Content/Images/iIcon1.png" alt="" title="${$("#span_StockDetail").text()}"> </button></div>
            <div class="col-sm-2 i_Icon"><button type="button" id="SubItemAvlStockBtn" disabled class="calculator subItmImg" onclick="return GetSubItemAvlStock(event,'WH')" data-toggle="modal" data-target="#SubItemStock" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/subItem.png" alt="" title="${span_SubItemStockDetail}"></button></div>
            </td>          
             <td>
                 <div class="col-sm-8" style="padding:0px;"><input id="ShopFloorstock" class="form-control num_right" type="text" name="ShopFloorstock" placeholder="0000.00" disabled></div>
                 <div class="col-sm-2 i_Icon"><button type="button" id="" class="calculator" onclick="ItemStockShopFloorWise(event)" data-toggle="modal" data-target="#StockDetail" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="${$("#span_StockDetail").text()}">  </button></div>
                 <div class="col-sm-2 i_Icon"><button type="button" id="SubItemShflStockBtn" disabled class="calculator subItmImg" onclick="return GetSubItemAvlStock(event,'SF')" data-toggle="modal" data-target="#SubItemStock" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/subItem.png" alt="" title="${span_SubItemStockDetail}"></button></div>
             </td>
                 <td>
                 <div class="col-sm-8" style="padding:0px;"><input id="WIPstock" class="form-control num_right" type="text" name="WIPstock" placeholder="0000.00" disabled></div>
                 <div class="col-sm-2 i_Icon"><button type="button" id="" class="calculator" onclick="OnClickIconBtnWIPStock(event,'wip')" data-toggle="modal" data-target="#WIPStock" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="${$("#span_StockDetail").text()}"> </button></div>
                <div class="col-sm-2 i_Icon"><button type="button" id="SubItemWipStockBtn" disabled class="calculator subItmImg" onclick="return GetSubItemAvlStock(event,'WIP')" data-toggle="modal" data-target="#SubItemStock" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/subItem.png" alt="" title="${span_SubItemStockDetail}"></button></div>
             </td>
             <!---<td>
                 <div class="col-sm-10" style="padding:0px;"><input id="INtransit" class="form-control num_right" type="text" name="AvailableStock" placeholder="0000.00" disabled></div>
                 <div class="col-sm-1 i_Icon"><button type="button" id="StockDetail" class="calculator" onclick="OnClickIconBtnWIPStock(event,'intrst')" data-toggle="modal" data-target="#WIPStock" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="${$("#span_StockDetail").text()}"> </button></div>
             </td>--->
            <td><div class="col-sm-12 lpo_form" style="padding:0px;">
            <input id="PlannedQuantity" class="form-control num_right" autocomplete="off" onkeypress="return OnKeyPressPlannedQty(this,event);" onchange="OnChangePlannedQty(this,event)" type="text" name="PlannedQuantity" placeholder="0000.00"><span id="PlannedQtyError" class="error-message is-visible"></span></div></td>
            
             <td id="tdOrderToProduceQty" >
                <div class="col-sm-10 lpo_form" id="div_OrderToProduceQuantity" style="padding:0px;">
                    <input id="OrderToProduceQuantity" disabled class="form-control num_right" autocomplete="off" type="text" value="" onkeypress="return OnKeyPressProduceQty(this,event);" onchange="OnChangeProduceQty(event)" name="OrderToProduceQuantity" placeholder="0000.00" >
                    <span id="OrderToProduceQuantityError" class="error-message is-visible"></span>
                </div>
                <div class="col-sm-2 i_Icon" id="div_SubItemButton" style="padding:0px;">
                    <input hidden type="text" id="sub_item" value=""/>
                      <button type="button" id="SubItemButton"  disabled class="calculator subItmImg" onclick="return SubItemDetailsPopUp('Quantity',event)" data-toggle="modal" data-target="#SubItem" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/subItem.png" alt="" title="${$("#span_SubItemDetail").text()}"> </button>
                </div>
             </td>
             <td id="tdProduceComplsnDate" >
                <div class="lpo_form" style="padding:0px;">
                    <input id="ProductionCompletionDate" onchange="onchangeProductionCompDate(event)" onfocusout="RemoveMinMaxDate(event)" onclick="onClockProductionDate(event)" class="form-control " type="date" min="${TodayDate}" value="" name="ProductionCompletionDate" placeholder="" disabled>
                    <span id="ProductionCompletionDateError" class="error-message is-visible"></span>
                </div>
             </td>
 <td>
                                                                <div class="col-sm-10 lpo_form no-padding">
                                                                     <input id="OrderToProcureQuantity" onchange="onchangeOrderToProcureQuantity(this,event)" autocomplete="off" value="" class="form-control num_right" type="text" name="OrderToProcureQuantity" placeholder="0000.00" disabled>
                                                                     <span id="OrderToProcureQuantityError" class="error-message is-visible"></span>
                                                                </div>
                                                                <div class="col-sm-2 i_Icon" id="div_SubItemOrdrToPrecurQty" style="padding:0px; ">
                                                                    <input hidden type="text" id="sub_item" value="" />
                                                                    <button type="button" id="SubItemOrdrToPrecurQty" disabled class="calculator subItmImg" onclick="return SubItemDetailsPopUp('OrdrToPrecurQuantity',event)" data-toggle="modal" data-target="#SubItem" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/subItem.png" alt="" title="${$("#span_SubItemDetail").text()}"> </button>
                                                                </div>
                                                                <input hidden type="text" id="HdnSFsubitemFlag" value="OrdrToPrecurQuantity" />
                                                            </td>
                                                            <td>
                                                                <div class="lpo_form">
                                                                        <input id="ProcurementCompletionDate" disabled onchange="OnChangeSFProduceDate(event)" min="@System.DateTime.Now.ToString("yyyy-MM-dd")" class="form-control" type="date" value="" name="RequisitionQuantity">
                                                                    <span id="ProcurementCompletionDateError" class="error-message is-visible"></span>
                                                                </div>
                                                            </td>
            <td>
                <div class="col-sm-8 lpo_form" id="div_ProducedQuantity" style="padding:0px;">
                    <input id="ProducedQuantity" class="form-control num_right" autocomplete="off" value="" type="text" name="ProducedQuantity" placeholder="0000.00" disabled>
                </div>
                <div class="col-sm-2 i_Icon">
                    <button type="button" id="" class="calculator" onclick="OnClickProductionDetailsIcon(event);" data-toggle="modal" data-target="#ProductionDetail" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/iIcon1.png" alt="" title="${$("#span_ProductionOrder").text()}">  </button>
                </div>
             <div class="col-sm-2 i_Icon" id="div_SubItemProduceQty" style="padding:0px; ">
                  <button type="button" id="SubItemProduceQty"  disabled class="calculator subItmImg" onclick="return SubItemDetailsPopUp('ProduceQty',event)" data-toggle="modal" data-target="#SubItem" data-backdrop="static" data-keyboard="false"><img src="/Content/Images/subItem.png" alt="" title="${span_SubItemDetail}"> </button>
             </div>
               
            </td>
            <td>
                <div class="col-sm-12 lpo_form" id="div_PendingQuantity" style="padding:0px;">
                    <input id="PendingQuantity" class="form-control num_right" autocomplete="off" value="" type="text" name="PendingQuantity" placeholder="0000.00" readonly="readonly">
                </div>
                
            </td>
            <td><textarea id="remarks" class="form-control remarksmessage" name="remarks" maxlength="100" placeholder="${$("#span_remarks").text()}" ></textarea></td>
            </tr>`);
    DisableAllPackingCheck()
}
function OnChangeSFProduceDate(evt) {
    var currentRow = $(evt.target).closest("tr");
    currentRow.find("#ProcurementCompletionDate").css("border-color", "#ced4da");
    currentRow.find("#ProcurementCompletionDateError").text("");
    currentRow.find("#ProcurementCompletionDateError").css("display", "none");

}
function OnClickAllProductPlanCheck() {
    debugger;
    var Allcheck = "";
    if ($("#AllProductPlanCheck").is(":checked")) {
        Allcheck = 'Y';
    }
    else {
        Allcheck = 'N';
    }
    if (Allcheck == 'Y') {
        $("#ProductPlanItemDetailsTbl tbody tr").each(function () {
            debugger;
            var CurrentRow = $(this);
            CurrentRow.find("#ProductPlanCheck").prop("checked", true);
            CurrentRow.find("#ProductPlanCheck").is(":checked")
        });
    }
    else {
        $("#ProductPlanItemDetailsTbl tbody tr").each(function () {
            debugger;
            var CurrentRow = $(this);
            CurrentRow.find("#ProductPlanCheck").prop("checked", false);
            if (CurrentRow.find("#ProductPlanCheck").is(":checked")) {
                check = 'Y';
            }
            else {
                check = 'N';
            }
            if (check == 'N') {
                CurrentRow.find("#ProductPlanCheck").prop("checked", false);
            }
        });
    }
}
function OnClickAllPackingDelete() {
    $("#ProductPlanItemDetailsTbl tbody tr").each(function () {
        debugger;
        var CurrentRow = $(this);
        if (CurrentRow.find("#ProductPlanCheck").is(":checked")) {
            var child = CurrentRow.nextAll();
            child.each(function () {
                var id = $(this).attr('id');
                var idx = $(this).children('.row-index').children('p');
                var dig = parseInt(id.substring(1));
                idx.html(`Row ${dig - 1}`);
                $(this).attr('id', `R${dig - 1}`);
            });
            var Sno = $(this).closest('tr').find("#hfsno").val();
            var item_id = $(this).closest('tr').find("#ProductName" + Sno).val();
            $(this).closest('tr').remove();
            let ddl_src_type = $("#ddl_src_type").val();
            if (ddl_src_type == "O") {
                $("#HdnTablePendingOrderQty > tbody > tr #h_item_id:contains('" + item_id + "')").closest("tr").each(function () {
                    $(this).remove();
                });
            }
            Cmn_DeleteSubItemQtyDetail(item_id);
            ResetSerialNo();
        }
    });
    $("#AllProductPlanCheck").prop("checked", false);
    DisableAllPackingCheck();
}
function DisableAllPackingCheck() {
    if ($("#ProductPlanItemDetailsTbl tbody tr").length == 0) {
        $("#AllProductPlanCheck").attr("disabled", true);
        $("#AllDelete").attr("disabled", true);
        $("#AllDelete").css("filter", "grayscale(100%)");
    }
    else {
        $("#AllProductPlanCheck").attr("disabled", false);
        $("#AllDelete").attr("disabled", false);
        $("#AllDelete").css("filter", "");
    }
}
function OnChangeAHToDate() {
    CheckVallidation("AH_txtToDate", "vm_AH_txtToDate");
    var Todt = $("#AH_txtToDate").val();
    $("#AH_hdn_ToDate").val(Todt);
    CheckAdHocDateRange();
}
function CheckAdHocDateRange() {
    var fromdt = $("#AH_txtFromDate").val();
    var todt = $("#AH_txtToDate").val();
    if (fromdt != "" && todt != "") {
        let fromdt1 = new Date(fromdt).getTime();
        let todt1 = new Date(todt).getTime();
        if (fromdt1 > todt1) {
            $("#vm_AH_txtToDate").text($("#JC_InvalidDate").text());
            $("#vm_AH_txtToDate").css("display", "block");
            $("#AH_txtToDate").css("border-color", "red");
            return false;
        } else {
            $("#vm_AH_txtToDate").text("");
            $("#vm_AH_txtToDate").css("display", "none");
            $("#AH_txtToDate").css("border-color", "#ced4da");
            return true;
        }
    }  
}
function OnChangeAHFromdate() {
    CheckVallidation("AH_txtFromDate", "vm_AH_txtFromDate")
    var fromdt = $("#AH_txtFromDate").val();
    $("#AH_hdn_FromDate").val(fromdt);
    CheckAdHocDateRange();
}
function OnClickAdHocToDate() {
    debugger;
    var fromdt = $("#AH_txtFromDate").val();
    $("#AH_txtToDate").attr("min", fromdt);
}
function CheckFormValidation() {
    debugger;
    var btn = $("#hdnsavebtn").val();
    if (btn == "AllreadyclickSaveBtn") { /**Added this Condition by Nitesh 11-01-2024 for Disable Save btn after one Click**/
        $("#btn_save").attr("disabled", true);
        $("#btn_save").css("filter", "grayscale(100%)");
        return false;
    }
    var rowcount = $('#ProductPlanItemDetailsTbl tbody tr').length;
    var ValidationFlag = true;
    var ddl_src_type = $("#ddl_src_type").val();
    var RequiredArea = $("#ddlRequiredArea").val();

    if (RequiredArea == "0" || RequiredArea == null || RequiredArea == "") {
        $("#vmRequiredArea").text($("#valueReq").text());
        $("#vmRequiredArea").css("display", "block");
        $("#ddlRequiredArea").css("border-color", "red");
        ValidationFlag = false;
    }
    else {
        $("#vmRequiredArea").css("display", "none");
        $("#ddlRequiredArea").css("border-color", "#ced4da");
    }

    if (ddl_src_type != "O" && ddl_src_type != "A") {
        var fy = $("#ddl_financial_year").val();
        var period = $("#ddl_period").val();
        if (fy == "0" || fy == null) {
            $("#vm_ddl_financial_year").text($("#valueReq").text());
            $("#vm_ddl_financial_year").css("display", "block");
            $("#ddl_financial_year").css("border-color", "red");
            ValidationFlag = false;
        }
        else {
            $("#vm_ddl_financial_year").css("display", "none");
            $("#ddl_financial_year").css("border-color", "#ced4da");
        }
        if (period == "0" || period == null) {
            $("#vm_ddl_period").text($("#valueReq").text());
            $("#vm_ddl_period").css("display", "block");
            $("#ddl_period").css("border-color", "red");
            ValidationFlag = false;
        }
        else {
            debugger;
            $("#vm_ddl_period").css("display", "none");
            $("#ddl_period").css("border-color", "#ced4da");
            var ddlperiod = $("#ddl_period Option:selected").text();
            var srctype_id = $("#ddl_src_type option:selected").text();
            $("#hdn_id_ddl_src_type").val(srctype_id);
            $("#hdn_period").val(ddlperiod);
        }
    }
    if (ddl_src_type == "A") {
        if (CheckVallidation("AH_txtFromDate", "vm_AH_txtFromDate")==false) {
            ValidationFlag = false;
        }
        if (CheckVallidation("AH_txtToDate", "vm_AH_txtToDate") == false) {
            ValidationFlag = false;
        }
        if (CheckAdHocDateRange() == false) {
            ValidationFlag = false;
        }
    }
    if (ValidationFlag == true) {
        if (rowcount > 0) {
            var flagProductname = CheckMaterialValidations_ProductName();
            if (flagProductname == false) {
                return false;
            }            
            var flagPlannedQty = true;
                flagPlannedQty = CheckMaterialValidations_PlannedQty();
                if (flagPlannedQty == false) {
                    return false;
                }
                var flagProcureAndProduce = CheckMaterialValidations_ProcureAndProduce();
                if (flagProcureAndProduce == false) {
                    return false;
            }
           
                var flagsubItemVald = CheckValidations_forSubItems();
                if (flagsubItemVald == false) {
                    return false;
                }
            var flagsubItemVald1 = CheckValidations_forSubItemsProc();
            if (flagsubItemVald1 == false) {
                return false;
            }
            debugger;
            if (flagPlannedQty == true && flagProductname == true) {
                var srctype = $("#ddl_src_type").val();
                var srctype_id = $("#ddl_src_type option:selected").text();
                var fy = $("#ddl_financial_year").val();
                var period = $("#ddl_period").val();
                $("#hdn_ddl_src_type").val(srctype);
                $("#hdn_ddl_financial_year").val(fy);
                $("#hdn_ddl_period").val(period);
                $("#hdn_id_ddl_src_type").val(srctype_id);

                var PPProductItemDetailList = new Array();

                $("#ProductPlanItemDetailsTbl TBODY TR").each(function () {
                    debugger;
                    var row = $(this);
                    var currntrow = $(this);
                    var ItemList = {};
                    var srno = row.find("#hfsno").val();
                    ItemList.ProductId = row.find("#hfproductID").val();
                    ItemList.UOMId = row.find('#UOMID').val();
                    ItemList.ForecastQuantity = row.find('#ForecastQuantity').val();
                    ItemList.Pending_ord_qty = row.find('#PendingOrderQuantity').val();
                    ItemList.PlannedQuantity = row.find('#PlannedQuantity').val();
                    ItemList.ord_to_procure_qty = IsNull(row.find('#OrderToProcureQuantity').val(),"");
                    ItemList.procure_comp_date = IsNull(row.find('#ProcurementCompletionDate').val(),"");
                    ItemList.ord_to_produce_qty = IsNull(row.find('#OrderToProduceQuantity').val(),"");
                    ItemList.produce_comp_date = IsNull(row.find('#ProductionCompletionDate').val(),"");
                    ItemList.remarks = row.find('#remarks').val();
                    ItemList.AvlStk = row.find('#AvailableStockInBase').val();
                    ItemList.WipStk = row.find('#WIPstock').val();
                    ItemList.ShflStk = row.find('#ShopFloorstock').val();        
                    ItemList.item_name = currntrow.find("#ProductName" + srno + " option:selected").text();
                    ItemList.UOMName = row.find('#UOM').val();
                    ItemList.BOM_Avl = row.find('#BtnBOMDetail').text();
                    ItemList.subitem = row.find('#sub_item').val();
                    ItemList.prod_qty = row.find('#ProducedQuantity').val();
                    ItemList.so_no = row.find('#h_app_so_no').text();
                    ItemList.so_date = row.find('#h_so_date').text();
                    ItemList.cust_id = row.find('#h_cust_id').text();
                    ItemList.cust_name = row.find('#h_cust_name').text();
                    PPProductItemDetailList.push(ItemList);
                });
                var str = JSON.stringify(PPProductItemDetailList);
                $('#HDProductPlanDetails').val(str);

                var PPSalesOrderItemDList = new Array();

                $("#HdnTablePendingOrderQty TBODY TR").each(function () {
                    var row = $(this);
                    var ItemList = {};
                    ItemList.item_id = row.find("#h_item_id").text();
                    ItemList.uom_id = row.find('#h_uom_id').text();
                    ItemList.so_no = row.find('#h_app_so_no').text();
                    ItemList.so_date = row.find('#h_so_date').text();
                    ItemList.cust_id = row.find('#h_cust_id').text();
                    ItemList.cust_name = row.find('#h_cust_name').text();
                    ItemList.Pending_ord_qty = row.find('#h_Pending_ord_qty').text();
                    PPSalesOrderItemDList.push(ItemList);
                });
                debugger;
                var str1 = JSON.stringify(PPSalesOrderItemDList);
                $('#HDSOItemDetails').val(str1);
                    var SubItemsListArr = Cmn_SubItemList();
                    var str2 = JSON.stringify(SubItemsListArr);
                $('#SubItemDetailsDt').val(str2);

                var SFPecureSubitem = GetDataSubitem_SFPrecure();
                var str3 = JSON.stringify(SFPecureSubitem);
                $('#SubItemDetailsDt_precure').val(str3);
                debugger;
                debugger;
                /*Added By Nitesh 10-07-2024 For Date Range Nit Disable Save Btn*/ 
                var AH_txtFromDate = $("#AH_txtFromDate").val();
                var date = new Date();
              
                let day = date.getDate();
                let month = date.getMonth() + 01;
                let year = date.getFullYear();
                var currentDate = `${year}-${month}-${day}`;
                if (AH_txtFromDate <= currentDate) {
                    $("#hdnsavebtn").val("");
                }
                else {
                    $("#hdnsavebtn").val("AllreadyclickSaveBtn");
                }
             
                return true;
            }
            else {
                return false;
            }
        }
        else {
            swal("", $("#noitemselectedmsg").text(), "warning");
            return false;
        }
    }
    else {
        return false;
    }
}
function GetDataSubitem_SFPrecure() {
    debugger;
    var NewArr = new Array();
    $("#hdn_SubItemDetailTblPP_Procure tbody tr").each(function () {
        var row = $(this);
        if (parseFloat(CheckNullNumber(row.find('#subItemQty').val())) > 0) {
            debugger;
            var List = {};
            List.item_id = row.find("#ItemId").val();
            List.sub_item_id = row.find('#subItemId').val();
            List.qty = row.find('#subItemQty').val();
            NewArr.push(List);
        }
    });
    return NewArr;
}
function CheckMaterialValidations_ProductName() {   
    var ErrorFlag = "N";
    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function () {
        
        var currentRow = $(this);
        var sno = currentRow.find("#hfsno").val();
        var ProductName = currentRow.find("#ProductName" + sno).val();
        var OrderToProcureQuantity = parseFloat(CheckNullNumber(currentRow.find("#OrderToProcureQuantity").val()));

        if (ProductName == "0") {
            currentRow.find("#productnameError").text($("#valueReq").text());
            currentRow.find("#productnameError").css("display", "block");
            currentRow.find(".select2-container--default .select2-selection--single").css("border-color", "red");
            ErrorFlag = "Y";
        }
        else {
            currentRow.find("#productnameError").css("display", "none");
            currentRow.find(".select2-container--default .select2-selection--single").css("border-color", "#ced4da");
        }
        if (OrderToProcureQuantity > 0) {
            var req = $("#ddlRequiredArea").val();
            if (req == "" || req == null || req == 0) {
                document.getElementById("vmRequiredArea").innerHTML = $("#valueReq").text();
                $("#ddlRequiredArea").css("border-color", "red");
                ErrorFlag = "Y";
            }
            else {
                $("#vmRequiredArea").css("display", "none");
                $("#ddlRequiredArea").css("border-color", "#ced4da");
            }
            if (currentRow.find("#ProcurementCompletionDate").val() == "") {
                currentRow.find("#ProcurementCompletionDate").css("border-color", "red");
                currentRow.find("#ProcurementCompletionDateError").text($("#valueReq").text());
                currentRow.find("#ProcurementCompletionDateError").css("display", "block");
                currentRow.find("#ProcurementCompletionDate").focus();
                ErrorFlag = "Y";
            }
        }
    });
    if (ErrorFlag == "Y") {
        return false;
    }
    else {
        return true;
    }
}
function onChangeRequiredArea() {
    debugger;
    var RequisitionArea = $('#ddlRequiredArea').val();
    if (RequisitionArea != "0") {
        document.getElementById("vmRequiredArea").innerHTML = null;
        $("#ddlRequiredArea").css('border-color', '#ced4da');
        $("#hdRequiredArea").val(RequisitionArea);
    }
}
function CheckMaterialValidations_PlannedQty() { 
    var ErrorFlag = "N";
    var totalplanqty = 0;
    var ddl_src_type = $("#ddl_src_type").val();
    if (ddl_src_type == "O" || ddl_src_type == "F") {
        $("#ProductPlanItemDetailsTbl >tbody >tr").each(function () {
            var currentRow = $(this);
            var plannedQty = currentRow.find("#PlannedQuantity").val();
            totalplanqty = parseFloat(totalplanqty) + parseFloat(CheckNullNumber(plannedQty));
        });
        if (parseFloat(totalplanqty) <= parseFloat(0)) {
            swal("", $("#PlannedQuantityCanNotBeZeroForAllItems").text(), "warning");
            return false;
        } else {
            return true;
        }
    } else {
        $("#ProductPlanItemDetailsTbl >tbody >tr").each(function () {
            var currentRow = $(this);
            var plannedQty = currentRow.find("#PlannedQuantity").val();
            if (plannedQty != "") {
                if (parseFloat(plannedQty) == parseFloat(0)) {
                    currentRow.find("#PlannedQtyError").text($("#valueReq").text());
                    currentRow.find("#PlannedQtyError").css("display", "block");
                    currentRow.find("#PlannedQuantity").css("border-color", "red");
                    ErrorFlag = "Y";
                }
                else {
                    currentRow.find("#PlannedQtyError").css("display", "none");
                    currentRow.find("#PlannedQuantity").css("border-color", "#ced4da");
                }
            }
            else {
                currentRow.find("#PlannedQtyError").text($("#valueReq").text());
                currentRow.find("#PlannedQtyError").css("display", "block");
                currentRow.find("#PlannedQuantity").css("border-color", "red");
                ErrorFlag = "Y";
            }
            totalplanqty = parseFloat(totalplanqty) + parseFloat(CheckNullNumber(plannedQty));
        });
    }
    if (ErrorFlag == "Y") {
        return false;
    }
    else {
        return true;
    }
}
function CheckMaterialValidations_ProcureAndProduce() {
    debugger;
    var ErrorFlag = "N";
    var ErrorMismatchFlag = "N";
    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function () {
        
        var currentRow = $(this);
        var plannedQty = currentRow.find("#PlannedQuantity").val();
        var ProduceQty = currentRow.find("#OrderToProduceQuantity").val();
        var ProcureQty = parseFloat(CheckNullNumber(currentRow.find("#OrderToProcureQuantity").val()));
        var BOM_Avl = currentRow.find("#BOM_Avl").val();
        if (BOM_Avl != "N") {
        if (parseFloat(CheckNullNumber(plannedQty)) != (parseFloat(CheckNullNumber(ProduceQty)) + parseFloat(CheckNullNumber(ProcureQty)))) {
                currentRow.find("#OrderToProduceQuantity").css("border-color", "red");
            ErrorFlag = "Y";
            ErrorMismatchFlag = "Y";
        }
        else
        {

        }
            if (parseFloat(CheckNullNumber(ProduceQty)) > 0) {
                if (currentRow.find("#ProductionCompletionDate").val() == "") {
                    currentRow.find("#ProductionCompletionDate").css("border-color", "red");
                    currentRow.find("#ProductionCompletionDateError").text($("#valueReq").text());
                    currentRow.find("#ProductionCompletionDateError").css("display", "block");
                    currentRow.find("#ProductionCompletionDate").focus();
                    ErrorFlag = "Y";
                } else {
                    /*----------Code Added by Suraj Maurya on 15-10-2024-----------*/
                    var ddl_src_type = $("#ddl_src_type").val();
                    var txtFromDate, txtToDate
                    if (ddl_src_type == "D" || ddl_src_type == "F") {
                        txtFromDate = $("#hdn_FromDate").val();
                        txtToDate = $("#hdn_ToDate").val();

                    } else if (ddl_src_type == "A") {
                        txtFromDate = $("#AH_txtFromDate").val();
                        txtToDate = $("#AH_txtToDate").val();
                    }
                    if (txtFromDate != null && txtToDate != null) {
                        var ProdComplsnDt = currentRow.find("#ProductionCompletionDate").val();
                        if (ProdComplsnDt >= txtFromDate && ProdComplsnDt <= txtToDate) {
                            currentRow.find("#ProductionCompletionDate").css("border-color", "#ced4da");
                            currentRow.find("#ProductionCompletionDateError").text("");
                            currentRow.find("#ProductionCompletionDateError").css("display", "none");
                        } else {
                            currentRow.find("#ProductionCompletionDate").css("border-color", "red");
                            currentRow.find("#ProductionCompletionDateError").text($("#JC_InvalidDate").text());
                            currentRow.find("#ProductionCompletionDateError").css("display", "block");
                            currentRow.find("#ProductionCompletionDate").focus();
                            ErrorFlag = "Y";
                        }
                    } else {
                        currentRow.find("#ProductionCompletionDate").css("border-color", "#ced4da");
                        currentRow.find("#ProductionCompletionDateError").text("");
                        currentRow.find("#ProductionCompletionDateError").css("display", "none");
                    }
                    
                    /*----------Code Added by Suraj Maurya on 15-10-2024 End-----------*/
                    //Commented by Suraj Maurya on 15-10-2024
                    //currentRow.find("#ProductionCompletionDate").css("border-color", "#ced4da");
                    //currentRow.find("#ProductionCompletionDateError").text("");
                    //currentRow.find("#ProductionCompletionDateError").css("display", "none");
                }
            }
            if (parseFloat(CheckNullNumber(ProcureQty)) > 0) {
                if (currentRow.find("#ProcurementCompletionDate").val() == "") {
                    currentRow.find("#ProcurementCompletionDate").css("border-color", "red");
                    currentRow.find("#ProcurementCompletionDateError").text($("#valueReq").text());
                    currentRow.find("#ProcurementCompletionDateError").css("display", "block");
                    currentRow.find("#ProcurementCompletionDate").focus();
                    ErrorFlag = "Y";
                }
                else {
                    currentRow.find("#ProcurementCompletionDate").css("border-color", "#ced4da");
                    currentRow.find("#ProcurementCompletionDateError").text("");
                    currentRow.find("#ProcurementCompletionDateError").css("display", "none");
                }
            }
        }
    });
    if (ErrorFlag == "Y") {
        if (ErrorMismatchFlag == "Y") {
            swal("", $("#PlannedPuantityShouldBeEqualWithOrderToProduceProcureQuantity").text(), "warning")
        }
        return false;
    }
    else {
        return true;
    }
}
function BindProductItmList(RowID, btype,currentRow) {
    if ($("#ddl_src_type").val() == "F") {
        //$(".fa-trash").css("display", "none");
        $("#BtnAddItem").closest("div .plus_icon1").css("display", "none");
        $("#AddBtnIconPP").css("display", "none");
        if (btype === "bdind") {
            var sno = currentRow.find("#hfsno").val();
            var Itemid = currentRow.find("#hfproductID").val();
            if (Itemid != "") {
                currentRow.find("#ProductName" + sno).append(`<option value="${currentRow.find("#hfproductID").val()}" selected>${currentRow.find("#hfproductName").val()}</option>`);
                currentRow.find("#ProductName" + sno).attr("disabled", true);
            }
        }
       
        //$("#ProductPlanItemDetailsTbl >tbody >tr").each(function (i, row) {//Commented by Suraj Maurya on 22-01-2025
        //    debugger;
        //    var currentRow = $(this);
        //    var sno = currentRow.find("#hfsno").val();
        //    var Itemid = currentRow.find("#hfproductID").val();
        //    if (Itemid != "") {
        //        currentRow.find("#ProductName" + sno).append(`<option value="${currentRow.find("#hfproductID").val()}" selected>${currentRow.find("#hfproductName").val()}</option>`);
        //        currentRow.find("#ProductName" + sno).attr("disabled", true);
        //    }
        //});
    }
    else {
        BindItemList("#ProductName", RowID, "#ProductPlanItemDetailsTbl", "#hfsno", "ForOneRow", "PPL");
        if (btype === "bdind") {
            var sno = currentRow.find("#hfsno").val();
            var Itemid = currentRow.find("#hfproductID").val();
            if (Itemid != "") {
                currentRow.find("#ProductName" + sno).removeAttr("onchange");
                currentRow.find("#ProductName" + sno).val(Itemid).trigger('change');
                currentRow.find("#ProductName" + sno).attr('onchange', 'OnChangeProductName(event)');
            }
            else {
                currentRow.find("#ProductName" + sno).removeAttr("onchange");
                currentRow.find("#ProductName" + sno).val("0").trigger('change');
                currentRow.find("#ProductName" + sno).attr('onchange', 'OnChangeProductName(event)');
            }
            //$("#ProductPlanItemDetailsTbl >tbody >tr").each(function (i, row) {
            //    debugger;
            //    var currentRow = $(this);
            //    var sno = currentRow.find("#hfsno").val();
            //    var Itemid = currentRow.find("#hfproductID").val();
            //    if (Itemid != "") {
            //        currentRow.find("#ProductName" + sno).removeAttr("onchange");
            //        currentRow.find("#ProductName" + sno).val(Itemid).trigger('change');
            //        currentRow.find("#ProductName" + sno).attr('onchange', 'OnChangeProductName(event)');
            //    }
            //    else {
            //        currentRow.find("#ProductName" + sno).removeAttr("onchange");
            //        currentRow.find("#ProductName" + sno).val("0").trigger('change');
            //        currentRow.find("#ProductName" + sno).attr('onchange', 'OnChangeProductName(event)');
            //    }
            //});
        }
    }
}
function OnChangeProductName(e) {
    debugger;
    var clickedrow = $(e.target).closest("tr");
    var ItemID = clickedrow.find("#hfproductID").val();
    var Itm_ID;
    var SNo = clickedrow.find("#hfsno").val();

    Itm_ID = clickedrow.find("#ProductName" + SNo).val();
    try {
        let BOM_Avl = clickedrow.find("#ProductName" + SNo + " option:selected").data().data.Bom_Avl;
        if (BOM_Avl == "N") {
            clickedrow.find("#BtnBOMDetail").attr("disabled", true);
        } else {
            clickedrow.find("#BtnBOMDetail").attr("disabled", false);
        }
        clickedrow.find("#BOM_Avl").val(BOM_Avl);
    }
    catch (ex) {
        console.log(ex);
    }
    
    clickedrow.find("#hfproductID").val(Itm_ID);
     
    if (Itm_ID == "0") {
        clickedrow.find("#productnameError").text($("#valueReq").text());
        clickedrow.find("#productnameError").css("display", "block");
        clickedrow.find("[aria-labelledby='select2-ProductName" + SNo + "-container']").css("border-color", "red");
    }
    else {
        clickedrow.find("#productnameError").css("display", "none");
        clickedrow.find("[aria-labelledby='select2-ProductName" + SNo + "-container']").css("border-color", "#ced4da");
    }
    ClearRowDetails(e, ItemID);
    DisableHeaderField();
    try {
        Cmn_BindUOM(clickedrow, Itm_ID, "", "Y","ProductionPlan");
    } catch (err) {
    }
}
function ClearRowDetails(e, ItemID) {
    var clickedrow = $(e.target).closest("tr");
    clickedrow.find("#UOM").val("");
    clickedrow.find("#ForecastQuantity").val("");
    clickedrow.find("#AvailableStock").val("");
    clickedrow.find("#PlannedQuantity").val("");
    clickedrow.find("#remarks").val("");
    Cmn_DeleteSubItemQtyDetail(ItemID)
}
function DisableHeaderField() {
    $("#ddl_src_type").attr('disabled', true);
    $("#ddl_financial_year").attr('disabled', true);
    $("#ddl_period").attr('disabled', true);
}
function ItemStockWareHouseWise(evt) {
    try {
        debugger;
        var clickedrow = $(evt.target).closest("tr");
        var sno = "";
        var ItemId = "";
        var ItemName = "";
        var UOMName = "";

        sno = clickedrow.find("#hfsno").val();
        ItemId = clickedrow.find("#hfproductID").val();
        ItemName = clickedrow.find("#ProductName" + sno + " option:selected").text();
        UOMName = clickedrow.find("#UOM").val();
        $.ajax(
            {
                type: "Post",
                url: "/Common/Common/getItemstockWareHouselWise",
                data: { ItemId: ItemId },
                success: function (data) {
                    debugger;
                    $('#ItemStockWareHouseWise').html(data);
                    $("#WareHouseWiseItemName").val(ItemName);
                    $("#WareHouseWiseUOM").val(UOMName);
                },
            });

    } catch (err) {
        console.log("UserValidate Error : " + err.message);
    }
}

function ItemStockShopFloorWise(evt) {
    try {
        debugger;
        var clickedrow = $(evt.target).closest("tr");
        var sno = "";
        var ItemId = "";
        var ItemName = "";
        var UOMName = "";
        sno = clickedrow.find("#hfsno").val();
        ItemId = clickedrow.find("#hfproductID").val();
        ItemName = clickedrow.find("#ProductName" + sno + " option:selected").text();
        UOMName = clickedrow.find("#UOM").val();
        $.ajax(
            {
                type: "Post",
                url: "/Common/Common/getItemstockShopFloorWise",
                data: { ItemId: ItemId },
                success: function (data) {
                    debugger;
                    $('#ItemStockWareHouseWise').html(data);
                    $("#WareHouseWiseItemName").val(ItemName);
                    $("#WareHouseWiseUOM").val(UOMName);
                },
            });

    } catch (err) {
        console.log("UserValidate Error : " + err.message);
    }
}
function ItemINTransitStockBranchWise(evt) {
    try {
        debugger;
        var clickedrow = $(evt.target).closest("tr");
        var sno = "";
        var ItemId = "";
        var ItemName = "";
        var UOMName = "";
        sno = clickedrow.find("#hfsno").val();
        ItemId = clickedrow.find("#hfproductID").val();
        ItemName = clickedrow.find("#ProductName" + sno + " option:selected").text();
        UOMName = clickedrow.find("#UOM").val();
        $.ajax(
            {
                type: "Post",
                url: "/Common/Common/getItemstockShopFloorWise",
                data: { ItemId: ItemId },
                success: function (data) {
                    debugger;
                    $('#ItemStockWareHouseWise').html(data);
                    $("#WareHouseWiseItemName").val(ItemName);
                    $("#WareHouseWiseUOM").val(UOMName);
                },
            });

    } catch (err) {
        console.log("UserValidate Error : " + err.message);
    }
}
function OnChangePlannedQty(el, evt) {
    debugger;
   
    var clickedrow = $(evt.target).closest("tr");
    var BOM_Avl = clickedrow.find("#BOM_Avl").val();
    var plannedqty = parseFloat(CheckNullNumber(clickedrow.find("#PlannedQuantity").val()));
    if (plannedqty == "" || plannedqty == null || plannedqty == 0) {
        /*commented by Hina on 01-03-2024 to show blank instead of 0 where insert field*/
        //plannedqty = "0";
            clickedrow.find("#PlannedQuantity").val("");
    }
    else {
        clickedrow.find("#PlannedQuantity").val(parseFloat(plannedqty).toFixed(0));        
        if (BOM_Avl == "N")
        {
            clickedrow.find("#OrderToProcureQuantity").attr("disabled", true);
            clickedrow.find("#OrderToProduceQuantity").attr("disabled", true);
            clickedrow.find("#ProcurementCompletionDate").attr("disabled", false);
            clickedrow.find("#OrderToProcureQuantity").val(parseFloat(plannedqty).toFixed(0));
        }
        else
        {
            var Itemtype = clickedrow.find("#ItemtypeFlag").val();
            if (Itemtype == "Y") {
                clickedrow.find("#OrderToProcureQuantity").attr("disabled", false);
            }
            else {
                clickedrow.find("#OrderToProcureQuantity").attr("disabled", true);
            }
            clickedrow.find("#OrderToProduceQuantity").attr("disabled", false);
        }        
    }
    if (BOM_Avl != "N") {
        clickedrow.find("#OrderToProduceQuantity").val(parseFloat(plannedqty).toFixed(0)).change();    
    }
    if (BOM_Avl != "N") {
        var Producqty = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProduceQuantity").val()))
        var Procureqty = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProcureQuantity").val()))
        var totalqty = Producqty - Procureqty;
        clickedrow.find("#OrderToProduceQuantity").val(parseFloat(totalqty).toFixed(0))
    }
    clickedrow.find("#OrderToProduceQuantityError").css("display", "none");
    clickedrow.find("#OrderToProduceQuantity").css("border-color", "#ced4da");
}
function OnKeyPressPlannedQty(el, evt) {
    if (Cmn_IntValueonly(el, evt, "#QtyDigit") == false) {
        return false;
    }  
    var clickedrow = $(evt.target).closest("tr");
    clickedrow.find("#PlannedQtyError").css("display", "none");
    clickedrow.find("#PlannedQuantity").css("border-color", "#ced4da");
    return true;
}
function OnKeyPressProcureQty(el, evt) {
    if (Cmn_FloatValueonly(el, evt, "#QtyDigit") == false) {
        return false;
    }
    var clickedrow = $(evt.target).closest("tr");
    clickedrow.find("#OrderToProcureQuantityError").css("display", "none");
    clickedrow.find("#OrderToProcureQuantity").css("border-color", "#ced4da");
    return true;
}
function OnKeyPressProduceQty(el, evt) {
    if (Cmn_IntValueonly(el, evt, "#QtyDigit") == false) {
        return false;
    }
    var clickedrow = $(evt.target).closest("tr");
    clickedrow.find("#OrderToProduceQuantityError").css("display", "none");
    clickedrow.find("#OrderToProduceQuantity").css("border-color", "#ced4da");
    return true;
}
function OnChangeProduceQty(evt) {
    debugger
   
    var clickedrow = $(evt.target).closest("tr");
    var Itemtype = clickedrow.find("#ItemtypeFlag").val();
    var ProduceQty = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProduceQuantity").val()));
    var PlannedQuantity = parseFloat(CheckNullNumber(clickedrow.find("#PlannedQuantity").val()));
    var ProcureQty = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProcureQuantity").val()));
    if (AvoidDot(ProduceQty) == false) {
        clickedrow.find("#OrderToProduceQuantity").val(parseFloat(0).toFixed(0));    
        clickedrow.find("#ProductionCompletionDate").attr("disabled", true);
        clickedrow.find("#ProductionCompletionDate").val("");
        clickedrow.find("#ProductionCompletionDate").css("border-color", "#ced4da");
        clickedrow.find("#ProductionCompletionDateError").text("");
        clickedrow.find("#ProductionCompletionDateError").css("display", "none");
        clickedrow.find("#OrderToProcureQuantity").val(parseFloat(PlannedQuantity).toFixed(0));//Add By shubham Maurya on 21-10-2024
        var ProcureQty1 = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProcureQuantity").val()));
        if (AvoidDot(ProcureQty1) == false) {
            clickedrow.find("#ProcurementCompletionDate").attr("disabled", true);
            clickedrow.find("#ProcurementCompletionDate").val("");
            clickedrow.find("#ProcurementCompletionDate").css("border-color", "#ced4da");
            clickedrow.find("#ProcurementCompletionDateError").text("");
            clickedrow.find("#ProcurementCompletionDateError").css("display", "none");
        }
    } else {
        if (parseFloat(CheckNullNumber(ProduceQty)) > parseFloat(CheckNullNumber(PlannedQuantity))) {
            clickedrow.find("#OrderToProduceQuantity").css("border-color", "red");
            clickedrow.find("#OrderToProduceQuantityError").css("display", "block");
            clickedrow.find("#OrderToProduceQuantityError").text($("#ExceedingQty").text());
            clickedrow.find("#OrderToProduceQuantity").val(parseFloat(ProduceQty).toFixed(0));
            return false;
        }

        var procQty = (parseFloat(CheckNullNumber(PlannedQuantity)) - parseFloat(CheckNullNumber(ProduceQty)));
     
        if (Itemtype == "Y") {

            clickedrow.find("#OrderToProcureQuantity").val(parseFloat(procQty).toFixed(0));
            ProcureQty = parseFloat(procQty).toFixed(0);
        }
        else {
            clickedrow.find("#OrderToProcureQuantity").val(parseFloat(0).toFixed(0));
            ProcureQty = parseFloat(0).toFixed(0);
        }


        if (parseFloat(CheckNullNumber(PlannedQuantity)) < (parseFloat(CheckNullNumber(ProduceQty)) + parseFloat(CheckNullNumber(ProcureQty)))) {
            clickedrow.find("#OrderToProduceQuantity").css("border-color", "red");
            clickedrow.find("#OrderToProduceQuantityError").css("display", "block");
            clickedrow.find("#OrderToProduceQuantityError").text("exceeding Planned Quantity");
             clickedrow.find("#OrderToProduceQuantity").val(parseFloat(ProduceQty).toFixed(0));
            
        } else {
            
            clickedrow.find("#OrderToProduceQuantityError").text("");
            clickedrow.find("#OrderToProduceQuantityError").css("display", "none");
            clickedrow.find("#OrderToProduceQuantity").css("border-color", "#ced4da");
            clickedrow.find("#OrderToProduceQuantity").val(parseFloat(ProduceQty).toFixed(0));         
            clickedrow.find("#ProductionCompletionDate").attr("disabled", false);
        }   
    }
    if (parseFloat(CheckNullNumber(PlannedQuantity)) == (parseFloat(CheckNullNumber(ProduceQty)) + parseFloat(CheckNullNumber(ProcureQty)))) {
        clickedrow.find("#PlannedQuantity").css("border-color", "#ced4da");
        clickedrow.find("#OrderToProcureQuantityError").text("");
        clickedrow.find("#OrderToProcureQuantityError").css("display", "none");
        clickedrow.find("#OrderToProcureQuantity").css("border-color", "#ced4da");
        if (parseFloat(CheckNullNumber(ProcureQty)) > 0) {
            clickedrow.find("#ProcurementCompletionDate").attr("disabled", false);
            if (clickedrow.find("#ProcurementCompletionDate").val() == "") {
                //clickedrow.find("#ProcurementCompletionDate").css("border-color", "red");
                //clickedrow.find("#ProcurementCompletionDateError").text($("#valueReq").text());
                //clickedrow.find("#ProcurementCompletionDateError").css("display", "block");
            }
        }
    }
    var OrderToProcureQty = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProcureQuantity").val()));
    var PlannedQuantity = parseFloat(CheckNullNumber(clickedrow.find("#PlannedQuantity").val()));
    var OrderToProduceQuantity = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProduceQuantity").val()));
    var totalQty = OrderToProcureQty + OrderToProduceQuantity
    if (PlannedQuantity == totalQty) {

    }
    if (OrderToProduceQuantity > OrderToProcureQty) {
        if (OrderToProcureQty == 0) {
            var qty = (PlannedQuantity - (OrderToProduceQuantity + OrderToProcureQty));
          
            if (Itemtype == "Y") {
                clickedrow.find("#OrderToProcureQuantity").val(parseFloat(qty).toFixed(0));
            }
            else {
                clickedrow.find("#OrderToProcureQuantity").val(parseFloat(0).toFixed(0));
                clickedrow.find("#OrderToProcureQuantity").css("disabled", true);
                clickedrow.find("#ProcurementCompletionDate").css("disabled", true);
            }
            if (qty == 0 || Itemtype=="N") {
                clickedrow.find("#ProcurementCompletionDate").attr("disabled", true);
            }
            else {
                clickedrow.find("#ProcurementCompletionDate").attr("disabled", false);
            }
        }     
    }
    var OTPQty = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProcureQuantity").val()));
    var ProcdQty = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProduceQuantity").val()));
    if (PlannedQuantity > (OTPQty + ProcdQty)) {
        var tqty = (PlannedQuantity - (OTPQty + ProcdQty));
        var proQty = OTPQty + tqty;
        var qt = parseFloat(CheckNullNumber(clickedrow.find("#OrderToProcureQuantity").val()));
        if (qt > 0) {
            clickedrow.find("#OrderToProcureQuantity").val(parseFloat(proQty).toFixed(0));
        }
    }
    //if (parseFloat(CheckNullNumber(clickedrow.find("#OrderToProcureQuantity").val())) > 0) {
    //    $("#RequiredRequirementArea").css("display", "block");
    //}
    //else {
    //    $("#RequiredRequirementArea").css("display", "none");
    //}
    RequiredRequirementArea();
}
function RequiredRequirementArea() {
    flag = "N";
    $("#ProductPlanItemDetailsTbl tbody tr").each(function () {
        var CurrentRow = $(this);
        if (parseFloat(CheckNullNumber(CurrentRow.find("#OrderToProcureQuantity").val())) > 0) {
            flag = "Y";
        }       
    });
    //if (flag == "Y") { /*Commented By Nitesh 04062025 */
    //   // $("#RequiredRequirementArea").css("display", "");
    //    $("#RequiredRequirementArea").removeAttr('style');
    //}
    //else {
    //    $("#RequiredRequirementArea").attr('style','display:none');
    //   //   $("#RequiredRequirementArea").css("display", "none");
    //}
}
function OnChangeProcureQty(evt) {
    debugger;
    var clickedrow = $(evt.target).closest("tr");
    var ProcureQty = clickedrow.find("#OrderToProcureQuantity").val();
    var PlannedQuantity = clickedrow.find("#PlannedQuantity").val();
    var ProduceQty = clickedrow.find("#OrderToProduceQuantity").val();
    if (AvoidDot(ProcureQty) == false) {
        clickedrow.find("#OrderToProcureQuantity").val(parseFloat(0).toFixed(0));
        clickedrow.find("#ProcurementCompletionDate").attr("disabled", true);
        clickedrow.find("#ProcurementCompletionDate").val("");
        clickedrow.find("#ProcurementCompletionDate").css("border-color", "#ced4da");
        clickedrow.find("#ProcurementCompletionDateError").text("");
        clickedrow.find("#ProcurementCompletionDateError").css("display", "none");
    } else {
        
        if (parseFloat(CheckNullNumber(PlannedQuantity)) < (parseFloat(CheckNullNumber(ProduceQty)) + parseFloat(CheckNullNumber(ProcureQty)))) {
            clickedrow.find("#OrderToProcureQuantity").css("border-color", "red");
            clickedrow.find("#OrderToProcureQuantityError").css("display", "block");
            clickedrow.find("#OrderToProcureQuantityError").text($("#ExceedingQty").text());
            clickedrow.find("#OrderToProcureQuantity").val(parseFloat(ProcureQty).toFixed(0));
        } else {
            clickedrow.find("#OrderToProcureQuantityError").text("");
            clickedrow.find("#OrderToProcureQuantityError").css("display", "none");
            clickedrow.find("#OrderToProcureQuantity").css("border-color", "#ced4da");
            clickedrow.find("#OrderToProcureQuantity").val(parseFloat(ProcureQty).toFixed(0));
            clickedrow.find("#ProcurementCompletionDate").attr("disabled", false);
        }
    }
    if (parseFloat(CheckNullNumber(PlannedQuantity)) == (parseFloat(CheckNullNumber(ProduceQty)) + parseFloat(CheckNullNumber(ProcureQty)))) {
        clickedrow.find("#PlannedQuantity").css("border-color", "#ced4da");
        clickedrow.find("#OrderToProduceQuantityError").text("");
        clickedrow.find("#OrderToProduceQuantityError").css("display", "none");
        clickedrow.find("#OrderToProduceQuantity").css("border-color", "#ced4da");
        if (parseFloat(CheckNullNumber(ProduceQty)) > 0) {
            clickedrow.find("#ProductionCompletionDate").attr("disabled", false);
            //if (clickedrow.find("#ProductionCompletionDate").val() == "") {
            //    clickedrow.find("#ProductionCompletionDate").css("border-color", "red");
            //    clickedrow.find("#ProductionCompletionDateError").text($("#valueReq").text());
            //    clickedrow.find("#ProductionCompletionDateError").css("display", "block");
            //}
        }
    }
}
function onchangeProductionCompDate(evt) {
    var clickedrow = $(evt.target).closest("tr");
    if (clickedrow.find("#ProductionCompletionDate").val() != "") {
        clickedrow.find("#ProductionCompletionDate").css("border-color", "#ced4da");
        clickedrow.find("#ProductionCompletionDateError").text("");
        clickedrow.find("#ProductionCompletionDateError").css("display", "none");
    }
    clickedrow.find("#ProductionCompletionDate").attr("min", "");
    clickedrow.find("#ProductionCompletionDate").attr("max", "");
}
function onchangeProcurementCompDate(evt) {
    var clickedrow = $(evt.target).closest("tr");
    if (clickedrow.find("#ProcurementCompletionDate").val() != "") {
        clickedrow.find("#ProcurementCompletionDate").css("border-color", "#ced4da");
        clickedrow.find("#ProcurementCompletionDateError").text("");
        clickedrow.find("#ProcurementCompletionDateError").css("display", "none");
    }
}
function OnClickIconBtn(e) {
    var clickedrow = $(e.target).closest("tr");
    var ItmCode = "";
    ItmCode = clickedrow.find("#hfproductID").val();
    ItemInfoBtnClick(ItmCode);
}
function functionConfirm(event) {
    debugger;
    swal({
        title: $("#deltital").text() + "?",
        text: $("#deltext").text() + "!",
        type: "warning",
        showCancelButton: true,
        confirmButtonClass: "btn-danger",
        confirmButtonText: "Yes, delete it!",
        closeOnConfirm: false
    }, function (isConfirm) {
        if (isConfirm) {
            $("#HdDeleteCommand").val("Delete");
            $('form').submit();
            return true;
        } else {
            return false;
        }
    });
    return false;
}
function OnClickCancelFlag() {
    if ($("#CancelFlag").is(":checked")) {
        $("#btn_save").attr('onclick', "return CheckFormValidation();");
        $("#btn_save").attr('disabled', false);
        $("#btn_save").css({ "-webkit-filter": "grayscale(0%)", "filter": "grayscale(0%);" });
    }
    else {
        $("#btn_save").attr('onclick', "");
        $("#btn_save").attr('disabled', true);
        $("#btn_save").css({ "-webkit-filter": "grayscale(100%)", "filter": "grayscale(100%);" });
    }
}

function OnClickProductionDetailsIcon(evt) {
    var clickedrow = $(evt.target).closest("tr");
    var ItemID = clickedrow.find("#hfproductID").val();
    var hdn_FromDate = $("#hdn_FromDate").val();
    var hdn_ToDate = $("#hdn_ToDate").val();
    var PP_no = $("#txt_PPNumber").val();
    var PP_dt = $("#txt_PPDate").val();
    debugger;
    if (ItemID != "" && ItemID != null) {
        $.ajax({
            type: "POST",
            url: "/ApplicationLayer/ProductionPlan/BindProductionDetails",
            data: {
                ProductionID: ItemID, hdn_FromDate: hdn_FromDate, hdn_ToDate: hdn_ToDate, PP_no: PP_no, PP_dt: PP_dt
            },
            dataType: "json",
            success: function (data) {
                debugger;
                if (data !== null && data !== "") {
                    var arr = [];
                    arr = JSON.parse(data);
                    if (arr.Table.length > 0) {
                        $('#TblProductionDetails tbody tr').remove();
                        for (var i = 0; i < arr.Table.length; i++) {

                            $('#TblProductionDetails tbody').append(`<tr>
                        <td width="3%">${i + 1}</td>
                        <td>${arr.Table[i].jc_no_dt}</td>
                        <td>${arr.Table[i].cnf_no_dt}</td>
                        <td class="num_right">${parseFloat(arr.Table[i].prod_qty).toFixed(QtyDecDigit)}</td>
                        <td class="num_right">${parseFloat(arr.Table[i].accept_qty).toFixed(QtyDecDigit)}</td>
                        <td class="num_right">${parseFloat(arr.Table[i].reject_qty).toFixed(QtyDecDigit)}</td>
                        <td class="num_right">${parseFloat(arr.Table[i].rework_qty).toFixed(QtyDecDigit)}</td>
                </tr>`);

                        }
                    }
                    else {
                        $('#TblProductionDetails tbody tr').remove();
                    }
                }
                else {
                    $('#TblProductionDetails tbody tr').remove();
                }
            },
        });
    }
}

/*-----------------------------Production Plan Against Sales Order----------------------------------*/
function OnChangeCustomer() {
    var CustID = $("#CustomerName").val();
    if (CustID == "0" || CustID == "") {

    } else {
        $("#CustomerName").css("border-color", "#ced4da");
        $("[aria-labelledby='select2-CustomerName-container']").css("border-color", "#ced4da");
        $("#vm_CustomerName").css("display", "none");
        $("#vm_CustomerName").text("");

        $("#OrderNumber").css("border-color", "#ced4da");
        $("[aria-labelledby='select2-OrderNumber-container']").css("border-color", "#ced4da");
        $("#vm_OrderNumber").css("display", "none");
        $("#vm_OrderNumber").text("");
    }
    BindOrderNumber();
}
function BindOrderNumber() {
    var CustID = $("#CustomerName").val();
    $("#OrderNumber").select2({
        ajax: {
            url: "/ApplicationLayer/ProductionPlan/GetOrderNumberList",
            data: function (params) {
                var queryParameters = {
                    OrderNumber: params.term,
                    CustID: CustID
                };
                return queryParameters;
            },
            dataType: "json",
            cache: true,
            delay: 250,
            contentType: "application/json; charset=utf-8",
            processResults: function (data, params) {
                debugger;
                var pageSize,
                    pageSize = 20;// or whatever pagesize
                data = data.filter(j => !JSON.stringify(ToHideArreyList()).includes(j.ID.split("_")[0]));

                if ($(".select2-search__field").parent().find("ul").length == 0) {
                    $(".select2-search__field").parent().append(`<ul class="select2-results__options"><li class="select2-results__option"><strong class="">
<div class="row"><div class="col-md-6 col-xs-6 def-cursor">${$("#DocNo").text()}</div>
<div class="col-md-6 col-xs-6 def-cursor">${$("#DocDate").text()}</div></div>
</strong></li></ul>`)
                }
                var page = params.page || 1;
                Fdata = data.slice((page - 1) * pageSize, page * pageSize);
                if (page == 1) {
                    if (Fdata[0] != null) {
                        if (Fdata[0].ID.trim() != "---Select---") {
                            var select = { ID: " ---Select---", Name: "0" };
                            Fdata.unshift(select);
                        }
                    }
                }
                return {
                    results: $.map(Fdata, function (val, Item) {
                        return { id: val.Name == "0" ? val.Name: val.ID + '_' + val.Name.split("_")[1], text: val.ID, UOM: val.Name.split("_")[0] };
                    }),
                    pagination: {
                        more: (page * pageSize) < data.length
                    }
                };
            }
        },
        templateResult: function (data) {

            var classAttr = $(data.element).attr('class');
            var hasClass = typeof classAttr != 'undefined';
            classAttr = hasClass ? ' ' + classAttr : '';
            var $result;
            $result = $(
                '<div class="row">' +
                '<div class="col-md-8 col-xs-8' + classAttr + '">' + data.text + '</div>' +
                '<div class="col-md-4 col-xs-4' + classAttr + '">' + data.UOM + '</div>' +
                '</div>'
            );
            return $result;
            firstEmptySelect = false;
        },
    });
}
function ToHideArreyList() {
    let array = [];
    $("#HdnTablePendingOrderQty tbody tr").each(function () {
        var currentrow = $(this);
        var so_no = currentrow.find("#h_app_so_no").text();
        array.push({ id: so_no });
    });
    if (array.length > 1) {
        array = array.filter(function (itm, i, a) {
            debugger;
            return i == a.indexOf(itm)
        });
    }
    return array;
}
async function AddSOItemDetail() {
    var OrderNumber = $("#OrderNumber").val();  
    var CustID = $("#CustomerName").val();
    debugger;
    var ErrFlag = "N";
    var RequiredArea = $("#ddlRequiredArea").val();

    if (RequiredArea == "0" || RequiredArea == null || RequiredArea == "") {
        $("#vmRequiredArea").text($("#valueReq").text());
        $("#vmRequiredArea").css("display", "block");
        $("#ddlRequiredArea").css("border-color", "red");
        ErrFlag = "Y";
    }
    else {
        $("#vmRequiredArea").css("display", "none");
        $("#ddlRequiredArea").css("border-color", "#ced4da");
    }
    if (CustID == "0" || CustID == "") {
        $("#CustomerName").css("border-color", "red");
        $("[aria-labelledby='select2-CustomerName-container']").css("border-color", "red");
        $("#vm_CustomerName").css("display", "block");
        $("#vm_CustomerName").text($("#valueReq").text());
        ErrFlag = "Y";
    } else {
        $("#CustomerName").css("border-color", "#ced4da");
        $("[aria-labelledby='select2-CustomerName-container']").css("border-color", "#ced4da");
        $("#vm_CustomerName").css("display", "none");
        $("#vm_CustomerName").text("");
    }
    if (OrderNumber == "0" || OrderNumber == "") {
        $("#OrderNumber").css("border-color", "red");
        $("[aria-labelledby='select2-OrderNumber-container']").css("border-color", "red");
        $("#vm_OrderNumber").css("display", "block");
        $("#vm_OrderNumber").text($("#valueReq").text());
        ErrFlag = "Y";
    } else {
        $("#OrderNumber").css("border-color", "#ced4da");
        $("[aria-labelledby='select2-OrderNumber-container']").css("border-color", "#ced4da");
        $("#vm_OrderNumber").css("display", "none");
        $("#vm_OrderNumber").text("");
    }
    if (ErrFlag == "Y") {
        return false;
    }
    if (OrderNumber != "0") {
        var OrderNo = OrderNumber.split('_')[0];
        var OrderDate = OrderNumber.split('_')[1];
        $("#HDOrderNumber").val(OrderNo);
        var HDOrderNumber = $("#HDOrderNumber").val();
        showLoader();
        let startTime = moment();
        try {
            await $.ajax({
                type: "POST",
                url: "/ApplicationLayer/ProductionPlan/AddSOItemDetail",
                data: {
                    CustID: CustID,
                    OrderNo: OrderNo,
                    OrderDate: OrderDate,
                },
                success: function (data) {
                    let completeTime = moment();
                    var duration = moment.duration(completeTime.diff(startTime));
                    console.log("Responce : " + duration.minutes() + ' minutes, ' + duration.seconds() + ' seconds');
                    var arr = JSON.parse(data);
                    if (arr != null) {
                        if (arr.Table.length > 0) {
                            $("#ddl_src_type").attr("disabled", true);
                            var PrewRow = $("#ProductPlanItemDetailsTbl >tbody >tr").length;
                            for (var i = 0; i < arr.Table.length; i++) {
                                $("#HdnTablePendingOrderQty tbody").append(`<tr>
                            <td id="h_item_id">${arr.Table[i].item_id}</td>
                            <td id="h_uom_id">${arr.Table[i].uom_id}</td>
                            <td id="h_app_so_no">${arr.Table[i].app_so_no}</td>
                            <td id="h_so_dt">${arr.Table[i].so_dt}</td>
                            <td hidden id="h_so_date">${arr.Table[i].so_date}</td>
                            <td id="h_cust_name">${arr.Table[i].cust_name}</td>
                            <td hidden id="h_cust_id">${arr.Table[i].cust_id}</td>
                            <td class="num_right" id="h_Pending_ord_qty">${arr.Table[i].Pending_ord_qty}</td>
                        </tr>`)
                                if (PrewRow > 0) {
                                    var matchItm = $("#ProductPlanItemDetailsTbl >tbody >tr #hfproductID[value=" + arr.Table[i].item_id + "]");
                                    if (matchItm.length > 0) {
                                        var BOM_Avl = arr.Table[i].BOM_Avl;
                                        var Crow = matchItm.closest("tr");
                                        var pendingOrd = parseFloat(parseFloat(Crow.find("#PendingOrderQuantity").val()) + parseFloat(arr.Table[i].Pending_ord_qty)).toFixed(QtyDigit)
                                        Crow.find("#PendingOrderQuantity").val(parseFloat(pendingOrd).toFixed(QtyDigit));
                                        Crow.find("#AvailableStockInBase").val(parseFloat(arr.Table[i].AvlStock).toFixed(QtyDigit));
                                        Crow.find("#WIPstock").val(parseFloat(arr.Table[i].wip_stock).toFixed(QtyDigit));
                                        Crow.find("#ShopFloorstock").val(parseFloat(arr.Table[i].shfl_avl_stk_bs).toFixed(QtyDigit));
                                        //Crow.find("#INtransit").val(parseFloat(arr.Table[i].intransit_stock).toFixed(QtyDigit));
                                        var PlannedQty = parseFloat(pendingOrd) - (parseFloat(arr.Table[i].AvlStock) + parseFloat(arr.Table[i].wip_stock) + parseFloat(arr.Table[i].shfl_avl_stk_bs) /*+ parseFloat(arr.Table[i].intransit_stock)*/);
                                        if (PlannedQty > 0) {

                                            if (BOM_Avl != "N") {
                                                Crow.find("#PlannedQuantity").val(parseFloat(PlannedQty).toFixed(QtyDigit));
                                                Crow.find("#OrderToProduceQuantity").val(parseFloat(PlannedQty).toFixed(0)).change();
                                                Crow.find("#OrderToProcureQuantity").val(parseFloat(0).toFixed(0)).change();
                                            }

                                        } else {

                                            if (BOM_Avl != "N") {
                                                Crow.find("#PlannedQuantity").val(parseFloat(0).toFixed(QtyDigit));
                                                Crow.find("#OrderToProduceQuantity").val(parseFloat(0).toFixed(0)).change();
                                                Crow.find("#OrderToProcureQuantity").val(parseFloat(0).toFixed(0)).change();
                                            }

                                        }
                                    }
                                    else {
                                        var rowNos = [];
                                        $("#ProductPlanItemDetailsTbl >tbody >tr #hfsno").each(function () {
                                            let RowNo = $(this).val();
                                            rowNos.push(RowNo);
                                        });
                                        let rowno = Math.max.apply(Math, rowNos);
                                        AddnewRowOnly(rowno + 1);
                                        HideShowAddProPlanBtn();
                                        var CrtRow = $("#ProductPlanItemDetailsTbl >tbody >tr #ProductName" + (rowno + 1)).closest("tr");
                                        if (CrtRow.find("#ProductName" + (rowno + 1)).val() == null) {
                                            CrtRow.find("#ProductName" + (rowno + 1)).append(`<option value="${arr.Table[i].item_id}">${arr.Table[i].item_name}</option>`);
                                            CrtRow.find("#hfproductID").val(arr.Table[i].item_id);
                                            var BOM_Avl = arr.Table[i].BOM_Avl;
                                            CrtRow.find("#BOM_Avl").val(BOM_Avl);
                                            if (BOM_Avl == "N") {
                                                CrtRow.find("#BtnBOMDetail").css('filter', 'grayscale(100%)');
                                                CrtRow.find("#BtnBOMDetail").attr('onclick', '');
                                                CrtRow.find("#BtnBOMDetail").attr('disabled', true);
                                                //CrtRow.find("#PlannedQuantity").attr('disabled', true);//commented by shubham on 04-11-2024 T.N.= 93223
                                                CrtRow.find("#PlannedQuantity").attr('disabled', false);
                                                CrtRow.find("#OrderToProduceQuantity").attr('disabled', true);
                                                CrtRow.find("#BOM_Avl").val(BOM_Avl);
                                            }
                                            HideShowPageWise(arr.Table[i].sub_item, CrtRow);
                                            CrtRow.find("#UOM").val(arr.Table[i].uom_alias);
                                            CrtRow.find("#UOMID").val(arr.Table[i].uom_id);
                                            CrtRow.find("#PendingOrderQuantity").val(parseFloat(arr.Table[i].Pending_ord_qty).toFixed(QtyDigit));
                                            CrtRow.find("#AvailableStockInBase").val(parseFloat(arr.Table[i].AvlStock).toFixed(QtyDigit));
                                            CrtRow.find("#ItemtypeFlag").val(arr.Table[i].i_pur);
                                            CrtRow.find("#WIPstock").val(parseFloat(arr.Table[i].wip_stock).toFixed(QtyDigit));
                                            CrtRow.find("#ShopFloorstock").val(parseFloat(arr.Table[i].shfl_avl_stk_bs).toFixed(QtyDigit));
                                            var PlannedQty = parseFloat(arr.Table[i].Pending_ord_qty) - (parseFloat(arr.Table[i].AvlStock) + parseFloat(arr.Table[i].wip_stock) + parseFloat(arr.Table[i].shfl_avl_stk_bs)/* + parseFloat(arr.Table[i].intransit_stock)*/);
                                            if (PlannedQty > 0) {

                                                if (BOM_Avl != "N") {
                                                    CrtRow.find("#PlannedQuantity").val(parseFloat(PlannedQty).toFixed(0));
                                                    //CrtRow.find("#OrderToProduceQuantity").attr("disabled", false);
                                                    //CrtRow.find("#OrderToProcureQuantity").attr("disabled", false);
                                                    CrtRow.find("#OrderToProduceQuantity").val(parseFloat(PlannedQty).toFixed(0)).change();
                                                    CrtRow.find("#OrderToProcureQuantity").val(parseFloat(0).toFixed(0)).change();
                                                }
                                            } else {

                                                if (BOM_Avl != "N") {
                                                    CrtRow.find("#PlannedQuantity").val(parseFloat(0).toFixed(0));
                                                    CrtRow.find("#OrderToProduceQuantity").val(parseFloat(0).toFixed(0)).change();
                                                    CrtRow.find("#OrderToProcureQuantity").val(parseFloat(0).toFixed(0)).change();
                                                }
                                            }
                                            CrtRow.find("#ProductName" + (rowno + 1)).attr("disabled", true);
                                        }
                                    }
                                }
                                else {
                                    AddnewRowOnly(i + 1);
                                    HideShowAddProPlanBtn()
                                    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function (i, row) {
                                        debugger
                                        var currentRow = $(this);
                                        if (currentRow.find("#ProductName" + (i + 1)).val() == null) {
                                            currentRow.find("#ProductName" + (i + 1)).append(`<option value="${arr.Table[i].item_id}">${arr.Table[i].item_name}</option>`);
                                            currentRow.find("#hfproductID").val(arr.Table[i].item_id);
                                            var BOM_Avl = arr.Table[i].BOM_Avl;
                                            currentRow.find("#BOM_Avl").val(BOM_Avl);
                                            if (BOM_Avl == "N") {
                                                currentRow.find("#BtnBOMDetail").css('filter', 'grayscale(100%)');
                                                currentRow.find("#BtnBOMDetail").attr('onclick', '');
                                                currentRow.find("#BtnBOMDetail").attr('disabled', true);
                                                //currentRow.find("#PlannedQuantity").attr('disabled', true);//commented by shubham on 04-11-2024 T.N.= 93223
                                                currentRow.find("#PlannedQuantity").attr('disabled', false);
                                                currentRow.find("#OrderToProduceQuantity").attr('disabled', true);
                                                currentRow.find("#SubItemPopUp").css('disabled', true);
                                            }
                                            currentRow.find("#UOM").val(arr.Table[i].uom_alias);
                                            currentRow.find("#UOMID").val(arr.Table[i].uom_id);
                                            HideShowPageWise(arr.Table[i].sub_item, currentRow);
                                            currentRow.find("#PendingOrderQuantity").val(parseFloat(arr.Table[i].Pending_ord_qty).toFixed(QtyDigit));
                                            currentRow.find("#WIPstock").val(parseFloat(arr.Table[i].wip_stock).toFixed(QtyDigit));
                                            currentRow.find("#ShopFloorstock").val(parseFloat(arr.Table[i].shfl_avl_stk_bs).toFixed(QtyDigit));
                                            currentRow.find("#AvailableStockInBase").val(parseFloat(arr.Table[i].AvlStock).toFixed(QtyDigit));
                                            currentRow.find("#ItemtypeFlag").val(arr.Table[i].i_pur);
                                            var PlannedQty = parseFloat(arr.Table[i].Pending_ord_qty) - (parseFloat(arr.Table[i].AvlStock) + parseFloat(arr.Table[i].wip_stock) + parseFloat(arr.Table[i].shfl_avl_stk_bs)/* + parseFloat(arr.Table[i].intransit_stock)*/);
                                            if (PlannedQty > 0) {
                                                if (BOM_Avl != "N") {
                                                    currentRow.find("#PlannedQuantity").val(parseFloat(PlannedQty).toFixed(QtyDigit));
                                                    if (arr.Table[i].i_pur == "Y") {
                                                        currentRow.find("#OrderToProcureQuantity").attr("disabled", false)
                                                      
                                                    }
                                                    else {
                                                        currentRow.find("#OrderToProcureQuantity").attr("disabled", true)
                                                    }
                                                   
                                                    currentRow.find("#OrderToProduceQuantity").attr("disabled", false)
                                                    currentRow.find("#OrderToProduceQuantity").val(parseFloat(PlannedQty).toFixed(0)).change();
                                                    currentRow.find("#OrderToProcureQuantity").val(parseFloat(0).toFixed(0)).change();
                                                }
                                            } else {
                                                 
                                                if (BOM_Avl != "N") {
                                                    /*commented by Hina on 01-03-2024 to show blank instead of 0 where insert field*/
                                                    //currentRow.find("#PlannedQuantity").val(parseFloat(0).toFixed(QtyDigit));
                                                    currentRow.find("#PlannedQuantity").val("");
                                                    currentRow.find("#OrderToProduceQuantity").val(parseFloat(0).toFixed(0)).change();
                                                    currentRow.find("#OrderToProcureQuantity").val(parseFloat(0).toFixed(0)).change();
                                                }
                                            }
                                            currentRow.find("#ProductName" + (i + 1)).attr("disabled", true);
                                        }
                                    });
                                }
                            }
                            debugger;
                            for (var i = 0; i < arr.Table1.length; i++) {
                                debugger;
                                var subitmlen = $("#hdn_Sub_ItemDetailTbl >tbody >tr").length;
                                if (subitmlen > 0) {
                                    var dtsub_itemid = arr.Table1[i].item_id;
                                    var dtsub_subitemid = arr.Table1[i].sub_item_id;
                                    var dtsub_ordqty = arr.Table1[i].ord_qty;
                                    var dtsub_penqty = arr.Table1[i].PendingQty;
                                    var existflag = "N";

                                    $("#hdn_Sub_ItemDetailTbl >tbody >tr").each(function (i, row) {
                                        debugger
                                        var Csubrow = $(this);
                                        //var Csubrow = matchsubItm.closest("tr");
                                        var sub_itemid = Csubrow.find("#ItemId").val();
                                        var sub_subitemid = Csubrow.find("#subItemId").val();
                                        if (sub_itemid == dtsub_itemid && sub_subitemid == dtsub_subitemid) {
                                            var subitmSoQty = Csubrow.find("#SrcDocQty").val() + dtsub_ordqty;
                                            var subitmpendingQty = Csubrow.find("#SubItemPPLPendingQty").val() + dtsub_penqty;
                                            Csubrow.find("#SrcDocQty").val(subitmSoQty);
                                            Csubrow.find("#SubItemPPLPendingQty").val(subitmpendingQty);
                                            existflag = "Y";
                                        }
                                    });
                                    if (existflag == "N") {

                                        $("#hdn_Sub_ItemDetailTbl tbody").append(
                                            `<tr>
                                                <td><input type="text" id="ItemId" value='${arr.Table1[i].item_id}'></td>
                                                <td><input type="text" id="subItemId" value='${arr.Table1[i].sub_item_id}'></td>
                                                <td><input type="text" id="SrcDocQty" value='${arr.Table1[i].ord_qty}'></td>                                              
                                                 <td><input type="text" id="SubItemPPLPendingQty" value='${arr.Table1[i].PendingQty}'></td>
                                                <td><input type="text" id="subItemQty" value=''></td>
                                        </tr>`)
                                    }
                                }
                                else {
                                    $("#hdn_Sub_ItemDetailTbl tbody").append(
                                        `<tr>
                                                <td><input type="text" id="ItemId" value='${arr.Table1[i].item_id}'></td>
                                                <td><input type="text" id="subItemId" value='${arr.Table1[i].sub_item_id}'></td>
                                                <td><input type="text" id="SrcDocQty" value='${arr.Table1[i].ord_qty}'></td>
                                                <td><input type="text" id="SubItemPPLPendingQty" value='${arr.Table1[i].PendingQty}'></td>
                                                <td><input type="text" id="subItemQty" value=''></td>
                                   </tr>`)
                                }
                            }
                            let ddl_src_type = $("#ddl_src_type").val();
                            if (ddl_src_type != "O") {
                                $(".deleteIcon").css("display", "none");
                            }
                            $("#AddBtnIconPP").css("display", "none");
                            $("#OrderNumber").val(0).trigger("change")
                            $("#OrderDate").val("");
                        }
                    }
                    completeTime = moment();
                    var duration = moment.duration(completeTime.diff(startTime));
                    console.log("Responce : " + duration.minutes() + ' minutes, ' + duration.seconds() + ' seconds');
                    hideLoader();
                }
            })
        }
        catch (ex) {
            console.log(ex);
            hideLoader();
        }
       
    } else {

    }
}
function BindCustomerList() {
    
    $("#CustomerName").select2({
        ajax: {
            url: "/ApplicationLayer/ProductionPlan/GetCustomerNameList",
            data: function (params) {
                var queryParameters = {
                    CustName: params.term,
                };
                return queryParameters;
            },
            dataType: "json",
            cache: true,
            delay: 250,
            contentType: "application/json; charset=utf-8",
            processResults: function (data, params) {
                if (data == 'ErrorPage') {
                    //LSO_ErrorPage();
                    return false;
                }
                params.page = params.page || 1;
                return {

                    results: $.map(data, function (val, item) {
                        return { id: val.ID, text: val.Name };
                    })
                };
            }
        },
    });
    
}
function OnChangeOrderNumber() {
    var OrderNumber = $("#OrderNumber").val();
    debugger;
    if (OrderNumber == "0" || OrderNumber == "") {

    } else {
        $("#OrderNumber").css("border-color", "#ced4da");
        $("[aria-labelledby='select2-OrderNumber-container']").css("border-color", "#ced4da");
        $("#vm_OrderNumber").css("display", "none");
        $("#vm_OrderNumber").text("");
    }
    if (OrderNumber != "0") {
        var OrderNo = OrderNumber.split('_')[0];
        var OrderDate = OrderNumber.split('_')[1];
        $("#OrderDate").val(OrderDate);
    }
    

}
function OnClickIconBtnPendingOrd(e) {
    var Crow = $(e.target).closest("tr");
    $("#TablePendingOrderQty tbody tr").remove();
    var ItemId = Crow.find("#hfproductID").val();
    var hfsno = Crow.find("#hfsno").val();
    var ItemName = Crow.find("#ProductName"+hfsno+" option:selected").text();
    var UOM = Crow.find("#UOM").val();
    var PendingOrderQuantity = Crow.find("#PendingOrderQuantity").val();
    $("#POQ_ProductName").val(ItemName);
    $("#POQ_UOM").val(UOM);
    $("#POQ_PendingOrderQuantity").val(PendingOrderQuantity);

    $("#HdnTablePendingOrderQty tbody tr").each(function () {
        var currentrow = $(this);
        var item_id = currentrow.find("#h_item_id").text();
        if (item_id == ItemId) {
            var srno = $("#TablePendingOrderQty tbody tr").length;
            $("#TablePendingOrderQty tbody").append(`<tr>
                            <td>${srno+1}</td>
                            <td id="">${currentrow.find("#h_app_so_no").text()}</td>
                            <td id="">${currentrow.find("#h_so_dt").text()}</td>
                            <td hidden id="">${currentrow.find("#h_so_date").text()}</td>
                            <td id="">${currentrow.find("#h_cust_name").text()}</td>
                            <td hidden id="">${currentrow.find("#h_cust_id").text()}</td>
                            <td class="num_right" id="">${parseFloat(currentrow.find("#h_Pending_ord_qty").text()).toFixed(QtyDecDigit)}</td>
                        </tr>`)
        }
    });
}
function OnClickIconBtnWIPStock(e, StockType) {
    var Crow = $(e.target).closest("tr");
    $("#TablePendingOrderQty tbody tr").remove();
    var ItemId = Crow.find("#hfproductID").val();
    var hfsno = Crow.find("#hfsno").val();
    var ItemName = Crow.find("#ProductName" + hfsno + " option:selected").text();
    var UOM = Crow.find("#UOM").val();
    $("#POQ_ProductName").val(ItemName);
    $("#POQ_UOM").val(UOM);
    $.ajax({
        type: "POST",
        url: "/ApplicationLayer/ProductionPlan/GetPendingStockItemWise",
        data: {
            ItemId: ItemId,
            ItemName: ItemName,
            UOM: UOM,
            StockType: StockType
        },
        success: function (data) {
            debugger;
            $("#ItemPendingStock").html(data);
        }
    });
}
function OnClickIconBtnBOMDetail(e) {
    var Crow = $(e.target).closest("tr");
    $("#PP_BOMDetail tbody tr").remove();
    var ItemId = Crow.find("#hfproductID").val(); 
    $.ajax(
        {
            type: "POST",
            url: "/ApplicationLayer/ProductionPlan/GetBOMDetailsItemWise",
            data: { ItemId: ItemId },
            success: function (data) {
                debugger;
                $("#PPLPopUp_BillOfMaterial").html(data);              
            },
        });
}

/***--------------------------------Sub Item Section-----------------------------------------***/
function HideShowPageWise(sub_item, clickedrow) {
    Cmn_SubItemHideShow(sub_item, clickedrow, "sub_item", "SubItemButton");
    Cmn_SubItemHideShow(sub_item, clickedrow, "", "SubItemProduceQty");
    Cmn_SubItemHideShow(sub_item, clickedrow, "", "SubItemAvlStockBtn");
    Cmn_SubItemHideShow(sub_item, clickedrow, "", "SubItemWipStockBtn");
    Cmn_SubItemHideShow(sub_item, clickedrow, "", "SubItemShflStockBtn");
    Cmn_SubItemHideShow(sub_item, clickedrow, "", "SubItemOrdrToPrecurQty");
}
function SubItemDetailsPopUp(flag, e) {
    debugger;
    var clickdRow = $(e.target).closest('tr');
    var hfsno = clickdRow.find("#hfsno").val();
    var SrcType = $("#ddl_src_type").val(); 
    var Fy = $("#ddl_financial_year option:selected").val();
    var F_period = $("#ddl_period option:selected").val();
    var ProductNm = clickdRow.find("#ProductName" + hfsno + " option:selected").text();
    var ProductId = clickdRow.find("#ProductName" + hfsno).val();
    var UOM = clickdRow.find("#UOM").val();
    var Doc_no = $("#txt_PPNumber").val();
    var Doc_dt = $("#txt_PPDate").val();
    var pp_no = $("#txt_PPNumber").val();
    var Sub_Quantity = 0;
    var NewArr = new Array();
    var NewArr1 = new Array();
    if (flag == "Quantity" || flag == "OrdrToPrecurQuantity") {
        $("#hdn_Sub_ItemDetailTbl tbody tr td #ItemId[value=" + ProductId + "]").closest("tr").each(function () {
            var row = $(this);
            var List = {};
            List.item_id = row.find("#ItemId").val();
            List.sub_item_id = row.find('#subItemId').val();
            if (SrcType == "F" || SrcType == "O") {
                var SrcDocQty = row.find('#SrcDocQty').val();
                List.SrcDocQuantity = row.find('#SrcDocQty').val();
                row.find('#SubItemPPLPendingQty').val(SrcDocQty);
                List.SubItemPPLPendingQty = row.find('#SubItemPPLPendingQty').val();
            }
            /*Code add and commented by Hina on 01-03-2024 to show blank instaed of 0 in sub item qty */
            var Qty = row.find('#subItemQty').val();
            if (Qty == "0") {
                Qty = "";
                List.qty = Qty;
            }
            else {
                List.qty = row.find('#subItemQty').val();
            }
            NewArr.push(List);
        });
        $("#hdn_SubItemDetailTblPP_Procure tbody tr td #ItemId[value=" + ProductId + "]").closest("tr").each(function () {
            var row = $(this);
            var List = {};
            List.item_id = row.find("#ItemId").val();
            List.sub_item_id = row.find('#subItemId').val();
            if (SrcType == "F" || SrcType == "O") {
                var SrcDocQty = row.find('#SrcDocQty').val();
                List.SrcDocQuantity = row.find('#SrcDocQty').val();
                row.find('#SubItemPPLPendingQty').val(SrcDocQty);
                List.SubItemPPLPendingQty = row.find('#SubItemPPLPendingQty').val();
            }
            /*Code add and commented by Hina on 01-03-2024 to show blank instaed of 0 in sub item qty */
            var Qty = row.find('#subItemQty').val();
            if (Qty == "0") {
                Qty = "";
                List.qty = Qty;
            }
            else {
                List.qty = row.find('#subItemQty').val();
            }
            NewArr1.push(List);
        });
        //Sub_Quantity = clickdRow.find("#OrderToProduceQuantity").val();
        Sub_Quantity = flag == "OrdrToPrecurQuantity" ? clickdRow.find("#OrderToProcureQuantity").val() : clickdRow.find("#OrderToProduceQuantity").val();

    } else if (flag == "PendingQty") {
        Sub_Quantity = clickdRow.find("#PendingQuantity").val();
    } else if (flag == "OrderedQty" || flag == "OrdrToPrecurQuantity") {
        ProductId = clickdRow.find("#Product_id").text().trim();
        ProductNm = clickdRow.find("#product_nm").text().trim();
        UOM = clickdRow.find("#UOM").text().trim();
        Sub_Quantity = clickdRow.find("#OrderedQty").text().trim();
        Doc_no = clickdRow.find("#jc_no").text();
        Doc_dt = clickdRow.find("#jc_dt").text();

    } else if (flag == "ProduceQty") {
        Sub_Quantity = clickdRow.find("#ProducedQuantity").val();
    }
   
    var IsDisabled = $("#DisableSubItem").val();
    var hd_Status = $("#hd_Status").val();
    if (SrcType == "O") {
        var So_Num = "";
        var SoNum = "";
        /* $("#HdnTablePendingOrderQty >tbody >tr").each(function (i, row) {*/
        $("#HdnTablePendingOrderQty tbody tr #h_item_id:contains('" + ProductId + "')").closest("tr").each(function () {
            var row = $(this);
           var itemid = row.find("#h_item_id").text();
            if (itemid == ProductId) {
                So_Num = row.find("#h_app_so_no").text();
                if (SoNum == "") {
                    SoNum = So_Num;
                }
                else {
                    SoNum = SoNum + ',' + So_Num;
                }
                $("#HDOrderNumber").val(SoNum);
            }  
        });
    }
    debugger;
    var hdn_SOOrderNO = $("#HDOrderNumber").val();
   

    $.ajax({
        type: "POST",
        url: "/ApplicationLayer/ProductionPlan/GetSubItemDetails",
        data: {
            Item_id: ProductId,
            SubItemListwithPageData: flag == "OrdrToPrecurQuantity" ? JSON.stringify(NewArr1) : JSON.stringify(NewArr),
            IsDisabled: IsDisabled,
            Flag: flag,
            Status: hd_Status,
            Doc_no: Doc_no,
            Doc_dt: Doc_dt,
            SrcType: SrcType,
            Fy: Fy,
            F_period: F_period,
            hdn_SOOrderNO: hdn_SOOrderNO,
            pp_no: pp_no


        },
        success: function (data) {
            debugger;
            $("#SubItemPopUp").html(data);
            $("#Sub_ProductlName").val(ProductNm);
            $("#Sub_ProductlId").val(ProductId);
            $("#Sub_serialUOM").val(UOM);
            $("#Sub_Quantity").val(Sub_Quantity);
            

        }

    })
    if (flag == 'enable') {

    }
    else if (flag='readonly') {

    }
}
function ProcurementCompletionDateReplicate() {
    debugger;
    var date = $("#ProcurementCompletionDt").val();
    $("#ProductPlanItemDetailsTbl >tbody >tr").each(function () {
        debugger;
        var currentRow = $(this);
        var Qty = currentRow.find("#OrderToProcureQuantity").val();
        if (parseFloat(CheckNullNumber(Qty)) > 0) {
            currentRow.find("#ProcurementCompletionDate").val(date);
            currentRow.find("#ProcurementCompletionDate").css("border-color", "#ced4da");
            currentRow.find("#ProcurementCompletionDateError").text("");
            currentRow.find("#ProcurementCompletionDateError").css("display", "none");
        }
    });
}
function GetSubItemAvlStock(e,StkType) {
    var Crow = $(e.target).closest('tr');
    var rowNo = Crow.find("#hfsno").val();
    var ProductNm = Crow.find("#ProductName" + rowNo + " option:selected").text();
    var ProductId = Crow.find("#ProductName" + rowNo + " option:selected").val();
    var UOM = Crow.find("#UOM").val();

    if (StkType == "WH") {
        var AvlStk = Crow.find("#AvailableStockInBase").val();
        Cmn_SubItemWareHouseAvlStock(ProductNm, ProductId, UOM, "0", AvlStk, "br");
    }
    else if (StkType == "SF") {
        var AvlStk = Crow.find("#ShopFloorstock").val();
        Cmn_SubItemShopfloorAvlStock(ProductNm, ProductId, UOM, "0", AvlStk, "AC");
    }
    else if (StkType == "WIP") {
        var AvlStk = Crow.find("#WIPstock").val();
        Cmn_SubItemWIPAvlStock(ProductNm, ProductId, UOM, "0", AvlStk)
    }
    
}

function CheckValidations_forSubItems() {
    debugger;
   return Cmn_CheckValidations_forSubItems("ProductPlanItemDetailsTbl", "hfsno", "ProductName", "OrderToProduceQuantity", "SubItemButton", "Y");
}
function CheckValidations_forSubItemsProc() {
    debugger;
    return Cmn_CheckValidations_forSubItems("ProductPlanItemDetailsTbl", "hfsno", "ProductName", "OrderToProcureQuantity", "SubItemOrdrToPrecurQty", "Y");
}
function ResetWorningBorderColor() {
    return Cmn_CheckValidations_forSubItems("ProductPlanItemDetailsTbl", "hfsno", "ProductName", "OrderToProduceQuantity","SubItemButton","N");
}
function ResetWorningBorderColorProc() {
    return Cmn_CheckValidations_forSubItems("ProductPlanItemDetailsTbl", "hfsno", "ProductName", "OrderToProcureQuantity", "SubItemOrdrToPrecurQty", "N");
}
/***--------------------------------Sub Item Section End-----------------------------------------***/

function onClockProductionDateHd(evt) {
    debugger;
    let ddl_src_type = $("#ddl_src_type").val();

    if (ddl_src_type == "D" || ddl_src_type == "F") {
        let txtFromDate = $("#hdn_FromDate").val();
        let txtToDate = $("#hdn_ToDate").val();
        $("#ProductionCompletionDt").attr("min", txtFromDate);
        $("#ProductionCompletionDt").attr("max", txtToDate);
    } else if (ddl_src_type == "A") {
        let AH_txtFromDate = $("#AH_txtFromDate").val();
        let AH_txtToDate = $("#AH_txtToDate").val();
        $("#ProductionCompletionDt").attr("min", AH_txtFromDate);
        $("#ProductionCompletionDt").attr("max", AH_txtToDate);
    }
    else if (ddl_src_type == "O") {
        $("#ProductionCompletionDt").attr("min", moment().format('YYYY-MM-DD'));
    }
}
function onClockProductionDate(evt) {
    var clickedrow = $(evt.target).closest("tr");
    let ddl_src_type = $("#ddl_src_type").val();

    if (ddl_src_type == "D" || ddl_src_type == "F") {
        let txtFromDate = $("#hdn_FromDate").val();
        let txtToDate = $("#hdn_ToDate").val();
        clickedrow.find("#ProductionCompletionDate").attr("min", txtFromDate);
        clickedrow.find("#ProductionCompletionDate").attr("max", txtToDate);
    } else if (ddl_src_type == "A") {
        let AH_txtFromDate = $("#AH_txtFromDate").val();
        let AH_txtToDate = $("#AH_txtToDate").val();
        clickedrow.find("#ProductionCompletionDate").attr("min", AH_txtFromDate);
        clickedrow.find("#ProductionCompletionDate").attr("max", AH_txtToDate);
    }
    else if (ddl_src_type == "O") {
        clickedrow.find("#ProductionCompletionDate").attr("min", moment().format('YYYY-MM-DD'));
    }

    //switch (ddl_src_type) {
    //    case "D"||"F":
    //        let txtFromDate = $("#hdn_FromDate").val();
    //        let txtToDate = $("#hdn_ToDate").val();
    //        clickedrow.find("#ProductionCompletionDate").attr("min", txtFromDate);
    //        clickedrow.find("#ProductionCompletionDate").attr("max", txtToDate);
    //        break;
    //    case "A":
    //        let AH_txtFromDate = $("#AH_txtFromDate").val();
    //        let AH_txtToDate = $("#AH_txtToDate").val();
    //        clickedrow.find("#ProductionCompletionDate").attr("min", AH_txtFromDate);
    //        clickedrow.find("#ProductionCompletionDate").attr("max", AH_txtToDate);
    //        break;
       
    //    case "O":
    //        clickedrow.find("#ProductionCompletionDate").attr("min", moment().format('YYYY-MM-DD'));
    //        break;
    //}
    
}
function RemoveMinMaxDate(evt) {
    
    var clickedrow = $(evt.target).closest("tr");
    clickedrow.find("#ProductionCompletionDate").attr("min", "");
    clickedrow.find("#ProductionCompletionDate").attr("max", "");
}

function approveonclick() { /**Added this Condition by Nitesh 11-01-2024 for Disable Approve btn after one Click**/
    debugger;
    var btn = $("#hdnsavebtn").val();
    if (btn == "AllreadyclickApprove")
    {
        $("#btn_approve").attr("disabled", true);
        $("#btn_approve").css("filter", "grayscale(100%)");
    }
    else {
        $("#btn_approve").css("filter", "grayscale(100%)");
        $("#hdnsavebtn").val("AllreadyclickApprove");
    }

}
function FilterItemDetail(e) {//added by Prakash Kumar on 18-02-2025 to filter item details
    debugger;
    Cmn_FilterTableData(e, "ProductPlanItemDetailsTbl", [{ "FieldId": "ProductName", "FieldType": "select", "SrNo": "hfsno" }]);
}
